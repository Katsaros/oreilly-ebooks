<figure data-type="cover"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/cover.png" width="1200" height="1387" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/cover.png"></figure><section data-type="titlepage" epub:type="titlepage" data-pdf-bookmark="Head First Design Patterns"><div class="preface" id="head_first_design_patterns">
<h1>Head First Design Patterns</h1>
</div></section><section data-type="copyright-page" epub:type="copyright-page" data-pdf-bookmark="Head First Design Patterns"><div class="preface" id="idm45875894366408">
<h1>Head First Design Patterns</h1>

<p class="author">by <span class="firstname">Eric </span> <span class="surname">Freeman</span> and <span class="firstname">Elisabeth </span> <span class="surname">Robson</span></p>

<p class="copyright">Copyright © 2020 Eric Freeman &amp;amp; Elisabeth Robson. All rights reserved.</p>

<p class="printlocation">Printed in the United States of America.</p>

<p class="publisher">Published by <span class="publishername">O’Reilly Media, Inc.</span> , 1005 Gravenstein Highway North, Sebastopol, CA 95472.</p>

<p>O’Reilly books may be purchased for educational, business, or sales promotional use. Online editions are also available for most titles ( <a href="http://oreilly.com">http://oreilly.com</a> ). For more information, contact our corporate/institutional sales department: 800-998-9938 or <span data-type="email">corporate@oreilly.com</span> .</p>

<ul class="stafflist">
	<li><span class="staffrole">Editors:</span> Michele Cronin and Melissa Duffield</li>
	<li><span class="staffrole">Production Editor:</span> Kristen Brown</li>
	<li><span class="staffrole">Copyeditor:</span> FILL IN COPYEDITOR</li>
	<li><span class="staffrole">Proofreader:</span> FILL IN PROOFREADER</li>
	<li><span class="staffrole">Indexer:</span> FILL IN INDEXER</li>
	<li><span class="staffrole">Interior Designer:</span> David Futato</li>
	<li><span class="staffrole">Cover Designer:</span> Karen Montgomery</li>
	<li><span class="staffrole">Illustrator:</span> Rebecca Demarest</li>
</ul>
<!--Add additional printedition spans below as needed.-->

<ul class="printings">
	<li><span class="printedition">December 2020:</span> Second Edition</li>
</ul>
<!--Add additional revdate spans below as needed.-->

<div>
<h1 class="revisions">Revision History for the Second Edition</h1>

<ul class="releases">
	<li><span class="revdate">2020-06-05:</span> First Early Release</li>
	<li>2020-07-10: Second Early Release</li>
	<li>2020-08-03: Third Early Release</li>
	<li>2020-09-28: Fourth Early Release</li>
</ul>
</div>

<p class="errata">See <a href="http://oreilly.com/catalog/errata.csp?isbn=9781492078005">http://oreilly.com/catalog/errata.csp?isbn=9781492078005</a> for release details.</p>

<div class="legal">
<p>The O’Reilly logo is a registered trademark of O’Reilly Media, Inc. Head First Design Patterns, the cover image, and related trade dress are trademarks of O’Reilly Media, Inc.</p>

<p>The views expressed in this work are those of the author(s), and do not represent the publisher’s views. While the publisher and the author(s) have used good faith efforts to ensure that the information and instructions contained in this work are accurate, the publisher and the author(s) disclaim all responsibility for errors or omissions, including without limitation responsibility for damages resulting from the use of or reliance on this work. Use of the information and instructions contained in this work is at your own risk. If any code samples or other technology this work contains or describes is subject to open source licenses or the intellectual property rights of others, it is your responsibility to ensure that your use thereof complies with such licenses and/or rights. <!--PROD: Uncomment the following sentence if appropriate and add it to the 
        above para:--> <!--This book is not intended as [legal/medical/financial; use the appropriate
        reference] advice. Please consult a qualified professional if you 
        require [legal/medical/financial] advice.--></p>
</div>

<div class="copyright-bottom">
<p class="isbn">978-1-492-07800-5</p>

<p class="printer">[FILL IN]</p>
</div>
</div></section><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 1. Intro to Design Patterns: Welcome to Design Patterns"><div class="chapter" id="intro_to_design_patterns_welcome_to_desi">
<h1><span class="label">Chapter 1. </span>Intro to Design Patterns: Welcome to Design Patterns</h1> 
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg01.png" alt="Images" width="696" height="555" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg01.png">
<h6></h6>
</div></figure>
<p><strong>Someone has already solved your problems.</strong> In this chapter, you’ll learn why (and how) you can exploit the wisdom and lessons learned by other developers who’ve been down the same design problem road and survived the trip. Before we’re done, we’ll look at the use and benefits of design patterns, look at some key object oriented design principles, and walk through an example of how one pattern works. The best way to use patterns is to <em>load your brain</em> with them and then <em>recognize places</em> in your designs and existing applications where you can <em>apply them</em>. Instead of <em>code</em> reuse, with patterns you get <em>experience</em> reuse.</p>
<section data-type="sect1" data-pdf-bookmark="It started with a simple SimUDuck app"><div class="sect1" id="it_started_with_a_simple_simuduck_app">
<h1>It started with a simple SimUDuck app</h1>
<p>Joe works for a company that makes a highly successful duck pond simulation game, <em>SimUDuck</em>. The game can show a large variety of duck species swimming and making quacking sounds. The initial designers of the system used standard OO techniques and created one Duck superclass from which all other duck types inherit.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg02-1.png" alt="Images" width="320" height="345" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg02-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg02-2.png" alt="Images" width="779" height="369" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg02-2.png">
<h6></h6>
</div></figure>
<p>In the last year, the company has been under increasing pressure from competitors. After a week long off-site brainstorming session over golf, the company executives think it’s time for a big innovation. They need something <em>really</em> impressive to show at the upcoming shareholders meeting in Maui <em>next week</em>.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="But now we need the ducks to FLY"><div class="sect1" id="but_now_we_need_the_ducks_to_fly">
<h1>But now we need the ducks to FLY</h1>
<p>The executives decided that flying ducks is just what the simulator needs to blow away the competitors. And of course Joe’s manager told them it’ll be no problem for Joe to just whip something up in a week. “After all,” said Joe’s boss, “he’s an OO programmer... <em>how hard can it be?”</em></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg03-1.png" alt="Images" width="976" height="520" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg03-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg03-2.png" alt="Images" width="750" height="554" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg03-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="But something went horribly wrong..."><div class="sect1" id="but_something_went_horribly_wronghellip">
<h1>But something went horribly wrong...</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg04-2.png" alt="Images" width="308" height="325" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg04-2.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg04-1.png" alt="Images" width="438" height="580" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg04-1.png">
<h6></h6>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="What happened?"><div class="sect2" id="what_happenedquestion_mark">
<h2>What happened?</h2>
<p>Joe failed to notice that not <em>all</em> subclasses of Duck should <em>fly</em>. When Joe added new behavior to the Duck superclass, he was also adding behavior that was <em>not</em> appropriate for some Duck subclasses. He now has flying inanimate objects in the SimUDuck program.</p>
<p><em>A localized update to the code caused a non-local side effect (flying rubber ducks)!</em></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg04-3.png" alt="Images" width="277" height="560" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg04-3.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg04-4.png" alt="Images" width="931" height="460" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg04-4.png">
<h6></h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>What Joe thought was a great use of inheritance for the purpose of <u>reuse</u> hasn’t turned out so well when it comes to <u>maintenance.</u></strong></p>
</div>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Joe thinks about inheritance..."><div class="sect1" id="joe_thinks_about_inheritancehellip">
<h1>Joe thinks about inheritance...</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg05-1.png" alt="Images" width="435" height="569" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg05-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg05-2.png" alt="Images" width="360" height="545" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg05-2.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00301">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p><strong>Which of the following are disadvantages of using inheritance to provide Duck behavior? (Choose all that apply.)</strong></p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> A. Code is duplicated across subclasses.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> B. Runtime behavior changes are difficult.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> C. We can’t make ducks dance.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> D. Hard to gain knowledge of all duck behaviors.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> E. Ducks can’t fly and quack at the same time.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> F. Changes can unintentionally affect other ducks.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="How about an interface?"><div class="sect1" id="how_about_an_interfacequestion_mark">
<h1>How about an interface?</h1>
<p>Joe realized that inheritance probably wasn’t the answer, because he just got a memo that says that the executives now want to update the product every six months (in ways they haven’t yet decided on). Joe knows the spec will keep changing and he’ll be forced to look at and possibly override fly() and quack() for every new Duck subclass that’s ever added to the program... <em>forever.</em></p>
<p>So, he needs a cleaner way to have only <em>some</em> (but not <em>all</em>) of the duck types fly or quack.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg06-1.png" alt="Images" width="472" height="553" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg06-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg06-2.png" alt="Images" width="791" height="335" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg06-2.png">
<h6></h6>
</div></figure>
<p><strong>What do YOU think about this design?</strong></p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What would you do if you were Joe?"><div class="sect1" id="what_would_you_do_if_you_were_joequestio">
<h1>What would you do if you were Joe?</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg07-1.png" alt="Images" width="428" height="687" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg07-1.png">
<h6></h6>
</div></figure>
<p>We know that not <em>all</em> of the subclasses should have flying or quacking behavior, so inheritance isn’t the right answer. But while having the subclasses implement Flyable and/or Quackable solves <em>part</em> of the problem (no inappropriately flying rubber ducks), it completely destroys code reuse for those behaviors, so it just creates a <em>different</em> maintenance nightmare. And of course there might be more than one kind of flying behavior even among the ducks that <em>do</em> fly...</p>
<p>At this point you might be waiting for a Design Pattern to come riding in on a white horse and save the day. But what fun would that be? No, we’re going to figure out a solution the old-fashioned way—<em>by applying good OO software design principles.</em></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg07-2.png" alt="Images" width="670" height="525" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg07-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The one constant in software development"><div class="sect1" id="the_one_constant_in_software_development">
<h1>The one constant in software development</h1>
<p><strong>Okay, what’s the one thing you can always count on in software development?</strong></p>
<p>No matter where you work, what you’re building, or what language you are programming in, what’s the one true constant that will be with you always?</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg08.png" alt="Images" width="330" height="144" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg08.png">
<h6></h6>
</div></figure>
<p>No matter how well you design an application, over time an application must grow and change or it will <em>die</em>.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00302">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>Lots of things can drive change. List some reasons you’ve had to change code in your applications (we put in a couple of our own to get you started).Check your answers with the solution at the end of the chapter before you go on.</p>
<p><u><span style="color:#9D9FA2">My customers or users decide they want something else, or they want new functionality.</span></u></p>
<p><u><span style="color:#9D9FA2">My company decided it is going with another database vendor and it is also purchasing its data from another supplier that uses a different data format. Argh!</span></u></p>
<p>______________________________________________________________________________________</p>
<p>______________________________________________________________________________________</p>
<p>______________________________________________________________________________________</p>
<p>______________________________________________________________________________________</p>
<p>______________________________________________________________________________________</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Zeroing in on the problem..."><div class="sect1" id="zeroing_in_on_the_problemhellip">
<h1>Zeroing in on the problem...</h1>
<p>So we know using inheritance hasn’t worked out very well, since the duck behavior keeps changing across the subclasses, and it’s not appropriate for <em>all</em> subclasses to have those behaviors. The Flyable and Quackable interface sounded promising at first—only ducks that really do fly will be Flyable, etc.—except Java interfaces typically have no implementation code, so no code reuse. In either case, whenever you need to modify a behavior, you’re often forced to track down and change it in all the different subclasses where that behavior is defined, probably introducing <em>new</em> bugs along the way!</p>
<p>Luckily, there’s a design principle for just this situation.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg09.png" alt="Images" width="450" height="234" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg09.png">
<h6></h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Take what varies and “encapsulate“ it so it won’t affect the rest of your code.</strong></p>
</div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>The result? Fewer unintended consequences from code changes and more f lexibility in your systems!</strong></p>
</div>
<p>In other words, if you’ve got some aspect of your code that is changing, say with every new requirement, then you know you’ve got a behavior that needs to be pulled out and separated from all the stuff that doesn’t change.</p>
<p>Here’s another way to think about this principle: <strong><em>take the parts that vary and encapsulate them, so that later you can alter or extend the parts that vary without affecting those that don’t.</em></strong></p>
<p>As simple as this concept is, it forms the basis for almost every design pattern. All patterns provide a way to let <em>some part of a system vary independently of all other parts</em>.</p>
<p>Okay, time to pull the duck behavior out of the Duck classes!</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Separating what changes from what stays the same"><div class="sect1" id="separating_what_changes_from_what_stays">
<h1>Separating what changes from what stays the same</h1>
<p>Where do we start? As far as we can tell, other than the problems with fly() and quack(), the Duck class is working well and there are no other parts of it that appear to vary or change frequently. So, other than a few slight changes, we’re going to pretty much leave the Duck class alone.</p>
<p>Now, to separate the “parts that change from those that stay the same,” we are going to create two <em>sets</em> of classes (totally apart from Duck), one for <em>fly</em> and one for <em>quack</em>. Each set of classes will hold all the implementations of the respective behavior. For instance, we might have <em>one</em> class that implements <em>quacking</em>, <em>another</em> that implements <em>squeaking</em>, and <em>another</em> that implements <em>silence</em>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>We know that fly() and quack() are the parts of the Duck class that vary across ducks.</strong></p>
</div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>To separate these behaviors from the Duck class, we’ll pull both methods out of the Duck class and create a new set of classes to represent each behavior.</strong></p>
</div>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg10.png" alt="Images" width="877" height="533" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg10.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Designing the Duck Behaviors"><div class="sect1" id="designing_the_duck_behaviors">
<h1>Designing the Duck Behaviors</h1>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>So how are we going to design the set of classes that implement the fly and quack behaviors?</strong></p>
</div>
<p>We’d like to keep things flexible; after all, it was the inflexibility in the duck behaviors that got us into trouble in the first place. And we know that we want to <em>assign</em> behaviors to the instances of Duck. For example, we might want to instantiate a new MallardDuck instance and initialize it with a specific <em>type</em> of flying behavior. And while we’re there, why not make sure that we can change the behavior of a duck dynamically? In other words, we should include behavior setter methods in the Duck classes so that we can <em>change</em> the MallardDuck’s flying behavior <em>at runtime</em>.</p>
<p>Given these goals, let’s look at our second design principle:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg11-1.png" alt="Images" width="442" height="123" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg11-1.png">
<h6></h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>From now on, the Duck behaviors will live in a separate class—a class that implements a particular behavior interface.</strong></p>
</div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>That way, the Duck classes won’t need to know any of the implementation details for their own behaviors.</strong></p>
</div>
<p>We’ll use an interface to represent each behavior—for instance, FlyBehavior and QuackBehavior—and each implementation of a <em>behavior</em> will implement one of those interfaces.</p>
<p>So this time it won’t be the <em>Duck</em> classes that will implement the flying and quacking interfaces. Instead, we’ll make a set of classes whose entire reason for living is to represent a behavior (for example, “squeaking”), and it’s the <em>behavior</em> class, rather than the Duck class, that will implement the behavior interface.</p>
<p>This is in contrast to the way we were doing things before, where a behavior came either from a concrete implementation in the superclass Duck, or by providing a specialized implementation in the subclass itself. In both cases we were relying on an <em>implementation</em>. We were locked into using that specific implementation and there was no room for changing the behavior (other than writing more code).</p>
<p>With our new design, the Duck subclasses will use a behavior represented by an <em>interface</em> (FlyBehavior and QuackBehavior), so that the actual <em>implementation</em> of the behavior (in other words, the specific concrete behavior coded in the class that implements the FlyBehavior or QuackBehavior) won’t be locked into the Duck subclass.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg11-2.png" alt="Images" width="676" height="498" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg11-2.png">
<h6></h6>
</div></figure>
<p><strong>“Program to an <em>interface</em>” really means “Program to a <em>supertype</em>.”</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg12-1.png" alt="Images" width="444" height="708" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg12-1.png">
<h6></h6>
</div></figure>
<p>The word <em>interface</em> is overloaded here. There’s the <em>concept</em> of interface, but there’s also the Java construct interface. You can <em>program to an interface</em>, without having to actually use a Java interface. The point is to exploit polymorphism by programming to a supertype so that the actual runtime object isn’t locked into the code. And we could rephrase “program to a supertype” as “the declared type of the variables should be a supertype, usually an abstract class or interface, so that the objects assigned to those variables can be of any concrete implementation of the supertype, which means the class declaring them doesn’t have to know about the actual object types!”</p>
<p>This is probably old news to you, but just to make sure we’re all saying the same thing, here’s a simple example of using a polymorphic type—imagine an abstract class Animal, with two concrete implementations, Dog and Cat.</p>
<p><strong>Programming to an implementation</strong> would be:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg12-2.png" alt="Images" width="505" height="91" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg12-2.png">
<h6></h6>
</div></figure>
<p>But <strong>programming to an interface/supertype</strong> would be:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg12-3.png" alt="Images" width="522" height="73" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg12-3.png">
<h6></h6>
</div></figure>
<p>Even better, rather than hardcoding the instantiation of the subtype (like new Dog()) into the code, <strong>assign the concrete implementation object at runtime:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg12-4.png" alt="Images" width="728" height="125" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg12-4.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg12-5.png" alt="Images" width="437" height="463" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg12-5.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Implementing the Duck Behaviors"><div class="sect1" id="implementing_the_duck_behaviors">
<h1>Implementing the Duck Behaviors</h1>
<p>Here we have the two interfaces, FlyBehavior and QuackBehavior, along with the corresponding classes that implement each concrete behavior:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg13-1.png" alt="Images" width="799" height="504" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg13-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg13-2.png" alt="Images" width="824" height="308" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg13-2.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0001102">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Do I always have to implement my application first, see where things are changing, and then go back to separate and encapsulate those things?</strong></p>
<p><strong>A:</strong> Not always; often when you are designing an application, you anticipate those areas that are going to vary and then go ahead and build the flexibility to deal with it into your code. You’ll find that the principles and patterns can be applied at any stage of the development lifecycle.</p>
<p><strong>Q: Should we make Duck an interface too?</strong></p>
<p><strong>A:</strong> Not in this case. As you’ll see once we’ve got everything hooked together, we do benefit by having Duck not be an interface, and having specific ducks, like MallardDuck, inherit common properties and methods. Now that we’ve removed what varies from the Duck inheritance, we get the benefits of this structure without the problems.</p>
<p><strong>Q: It feels a little weird to have a class that’s just a behavior. Aren’t classes supposed to represent things? Aren’t classes supposed to have both state AND behavior?</strong></p>
<p><strong>A:</strong> In an OO system, yes, classes represent things that generally have both state (instance variables) and methods. And in this case, the thing happens to be a behavior. But even a behavior can still have state and methods; a flying behavior might have instance variables representing the attributes for the flying (wing beats per minute, max altitude, and speed, etc.) behavior.</p></div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00303">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p><strong>1</strong> Using our new design, what would you do if you needed to add rocket-powered flying to the SimUDuck app?</p>
<p><strong>2</strong> Can you think of a class that might want to use the Quack behavior that isn’t a duck?</p>
</div></aside>
<p>Answers:</p>
<p>1) Create a FlyRocketPowered class that implements the FlyBehavior interface.</p>
<p>2) One example, a duck call (a device that makes duck sounds).</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Integrating the Duck Behavior"><div class="sect1" id="integrating_the_duck_behavior">
<h1>Integrating the Duck Behavior</h1>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Here’s the key: a Duck will now <u><em>delegate</em></u> its flying and quacking behavior, instead of using quacking and flying methods defined in the Duck class (or subclass).</strong></p>
</div>
<p><strong>Here’s how:</strong></p>
<ol>
<li><p><strong>First we’ll add two instance variables of type FlyBehavior and QuackBehavior—</strong>let’s call them flyBehavior and quackBehavior. Each concrete duck object will assign to those variables a <em>specific</em> behavior at runtime, like FlyWithWings for flying and Squeak for quacking.</p>
<p>We’ll also remove the fly() and quack() methods from the Duck class (and any subclasses) because we’ve moved this behavior out into the FlyBehavior and QuackBehavior classes.</p>
<p>We’ll replace fly() and quack() in the Duck class with two similar methods, called performFly() and performQuack(); you’ll see how they work next.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg15-1.png" alt="Images" width="926" height="327" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg15-1.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Now we implement performQuack():</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg15-2.png" alt="Images" width="808" height="234" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg15-2.png">
<h6></h6>
</div></figure>
<p>Pretty simple, huh? To perform the quack, a Duck just asks the object that is referenced by quackBehavior to quack for it. In this part of the code we don’t care <em>what kind</em> of object the concrete Duck is, <strong><em>all we care about is that it knows how to quack()!</em></strong></p></li>
</ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark="More integration..."><div class="sect1" id="more_integrationhellip">
<h1>More integration...</h1>
<ol start="3">
<li><p>Okay, time to worry about <strong>how the flyBehavior and quackBehavior instance variables are set</strong>. Let’s take a look at the MallardDuck class:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg16.png" alt="Images" width="953" height="415" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg16.png">
<h6></h6>
</div></figure>
<p>MallardDuck’s quack is a real live duck <strong>quack</strong>, not a <strong>squeak</strong> and not a <strong>mute quack</strong>. When a MallardDuck is instantiated, its constructor initializes the MallardDuck’s inherited quackBehavior instance variable to a new instance of type Quack (a QuackBehavior concrete implementation class).</p>
<p>And the same is true for the duck’s flying behavior—the MallardDuck’s constructor initializes the flyBehavior instance variable with an instance of type FlyWithWings (a FlyBehavior concrete implementation class).</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg17.png" alt="Images" width="693" height="714" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg17.png">
<h6></h6>
</div></figure>
<p>Good catch, that’s exactly what we’re doing... <em>for now.</em></p>
<p>Later in the book we’ll have more patterns in our toolbox that can help us fix it.</p>
<p>Still, notice that while we <em>are</em> setting the behaviors to concrete classes (by instantiating a behavior class like Quack or FlyWithWings and assigning it to our behavior reference variable), we could <em>easily</em> change that at runtime.</p>
<p>So, we still have a lot of flexibility here. That said, we’re doing a poor job of initializing the instance variables in a flexible way. But think about it: since the quackBehavior instance variable is an interface type, we could (through the magic of polymorphism) dynamically assign a different QuackBehavior implementation class at runtime.</p>
<p>Take a moment and think about how you would implement a duck so that its behavior could change at runtime. (You’ll see the code that does this a few pages from now.)</p></li>
</ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Testing the Duck code"><div class="sect1" id="testing_the_duck_code">
<h1>Testing the Duck code</h1>
<ol>
<li><p><strong>Type and compile the Duck class below (Duck.java), and the MallardDuck class from two pages back (MallardDuck.java).</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg18-1.png" alt="Images" width="662" height="447" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg18-1.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Type and compile the FlyBehavior interface (FlyBehavior.java) and the two behavior implementation classes (FlyWithWings.java and FlyNoWay.java).</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg18-2.png" alt="Images" width="816" height="408" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg18-2.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Type and compile the QuackBehavior interface (QuackBehavior.java) and the three behavior implementation classes (Quack.java, MuteQuack.java, and Squeak.java).</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg19-1a.png" alt="Images" width="700" height="671" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg19-1a.png">
<h6></h6>
</div></figure>
</li>
<li><p><strong>Type and compile the test class (MiniDuckSimulator.java).</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg19-1.png" alt="Images" width="871" height="224" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg19-1.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Run the code!</strong></p></li>
</ol>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg19-2.png" alt="Images" width="301" height="126" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg19-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Setting behavior dynamically"><div class="sect1" id="setting_behavior_dynamically">
<h1>Setting behavior dynamically</h1>
<p>What a shame to have all this dynamic talent built into our ducks and not be using it! Imagine you want to set the duck’s behavior type through a setter method on the duck subclass, rather than by instantiating it in the duck’s constructor.</p>
<ol><li><p><strong>Add two new methods to the Duck class:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg20-1.png" alt="Images" width="946" height="331" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg20-1.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Make a new Duck type (ModelDuck.java).</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg20-2.png" alt="Images" width="789" height="263" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg20-2.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Make a new FlyBehavior type (FlyRocketPowered.java).</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg20-3.png" alt="Images" width="779" height="242" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg20-3.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Change the test class (MiniDuckSimulator.java), add the ModelDuck, and make the ModelDuck rocket-enabled.</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg21.png" alt="Images" width="945" height="844" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg21.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Run it!</strong></p></li>
</ol>

<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>To change a duck’s behavior at runtime, just call the duck’s setter method for that behavior.</strong></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Big Picture on encapsulated behaviors"><div class="sect1" id="the_big_picture_on_encapsulated_behavior">
<h1>The Big Picture on encapsulated behaviors</h1>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Okay, now that we’ve done the deep dive on the duck simulator design, it’s time to come back up for air and take a look at the big picture.</strong></p>
</div>
<p>Below is the entire reworked class structure. We have everything you’d expect: ducks extending Duck, fly behaviors implementing FlyBehavior, and quack behaviors implementing QuackBehavior.</p>
<p>Notice also that we’ve started to describe things a little differently. Instead of thinking of the duck behaviors as a <em>set of behaviors</em>, we’ll start thinking of them as a <em>family of algorithms</em>. Think about it: in the SimUDuck design, the algorithms represent things a duck would do (different ways of quacking or flying), but we could just as easily use the same techniques for a set of classes that implement the ways to compute state sales tax by different states.</p>
<p>Pay careful attention to the <em>relationships</em> between the classes. In fact, grab your pen and write the appropriate relationship (IS-A, HAS-A, and IMPLEMENTS) on each arrow in the class diagram.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg22.png" alt="Images" width="718" height="508" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg22.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="HAS-A can be better than IS-A"><div class="sect1" id="has-a_can_be_better_than_is-a">
<h1>HAS-A can be better than IS-A</h1>
<p>The HAS-A relationship is an interesting one: each duck has a FlyBehavior and a QuackBehavior to which it delegates flying and quacking.</p>
<p>When you put two classes together like this you’re using <strong>composition</strong>. Instead of <em>inheriting</em> their behavior, the ducks get their behavior by being <em>composed</em> with the right behavior object.</p>
<p>This is an important technique; in fact, it is the basis of our third design principle:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg23-1.png" alt="Images" width="442" height="122" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg23-1.png">
<h6></h6>
</div></figure>
<p>As you’ve seen, creating systems using composition gives you a lot more flexibility. Not only does it let you encapsulate a family of algorithms into their own set of classes, but it also lets you <strong><em>change behavior at runtime</em></strong> as long as the object you’re composing with implements the correct behavior interface.</p>
<p>Composition is used in <em>many</em> design patterns and you’ll see a lot more about its advantages and disadvantages throughout the book.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id0001119">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Images" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>A duck call is a device that hunters use to mimic the calls (quacks) of ducks. How would you implement your own duck call that does not inherit from the Duck class?</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="guru_and-id00301">
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg23-2.png" alt="Images" width="104" height="139" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg23-2.png">
<h6></h6>
</div></figure>
<p><strong><em>Guru and Student...</em></strong></p>
<p><strong><em>Guru:</em></strong> <em>Tell me what you have learned of the Object-Oriented ways.</em></p>
<p><strong><em>Student:</em></strong> <em>Guru, I have learned that the promise of the object-oriented way is reuse.</em></p>
<p><strong><em>Guru:</em></strong> <em>Continue...</em></p>
<p><strong><em>Student:</em></strong> <em>Guru, through inheritance all good things may be reused and so we come to drastically cut development time like we swiftly cut bamboo in the woods.</em></p>
<p><strong><em>Guru:</em></strong> <em>Is more time spent on code <strong><em></em>before</strong> or <strong><em></em>after</strong> development is complete?</em></p>
<p><strong><em>Student:</em></strong> <em>The answer is <strong><em></em>after</strong>, Guru. We always spend more time maintaining and changing software than on initial development.</em></p>
<p><strong><em>Guru:</em></strong> <em>So, should effort go into reuse <strong><em></em>above</strong> maintainability and extensibility?</em></p>
<p><strong><em>Student:</em></strong> <em>Guru, I believe that there is truth in this.</em></p>
<p><strong><em>Guru:</em></strong> <em>I can see that you still have much to learn. I would like for you to go and meditate on inheritance further. As you’ve seen, inheritance has its problems, and there are other ways of achieving reuse.</em></p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Speaking of Design Patterns..."><div class="sect1" id="speaking_of_design_patternshellip">
<h1>Speaking of Design Patterns...</h1>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45875894035816">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg24.png" alt="Images" width="481" height="268" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg24.png"></span></h5>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>You just applied your first design pattern—the STRATEGY Pattern. That’s right, you used the Strategy Pattern to rework the SimUDuck app. Thanks to this pattern, the simulator is ready for any changes those execs might cook up on their next business trip to Maui.</strong></p>
<p><strong>Now that we’ve made you take the long road to learn it, here’s the formal definition of this pattern:</strong></p>
</div>
</div></aside>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>The Strategy Pattern</strong> defines a family of algorithms, encapsulates each one, and makes them interchangeable. Strategy lets the algorithm vary independently from clients that use it.</p>
</div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9FA2">Use THIS definition when you need to impress friends and influence key executives.</span></p>
</div>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-1.png" alt="Images" width="171" height="109" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-1.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Design Puzzle"><div class="sect1" id="design_puzzle">
<h1>Design Puzzle</h1>
<p>Below you’ll find a mess of classes and interfaces for an action adventure game. You’ll find classes for game characters along with classes for weapon behaviors the characters can use in the game. Each character can make use of one weapon at a time, but can change weapons at any time during the game. Your job is to sort it all out...</p>
<p>(Answers are at the end of the chapter.)</p>
<p><strong>Your task:</strong></p>
<ol>
<li><p>Arrange the classes.</p></li>
<li><p>Identify one abstract class, one interface, and eight classes.</p></li>
<li><p>Draw arrows between classes.</p>
<p>a. Draw this kind of arrow for inheritance (“extends”). <span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-2.png" alt="Images" width="79" height="20" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-2.png"></span></p>
<p>b. Draw this kind of arrow for interface (“implements”). <span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-3.png" alt="Images" width="83" height="15" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-3.png"></span></p>
<p>c. Draw this kind of arrow for “HAS-A”. <span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-4.png" alt="Images" width="60" height="19" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-4.png"></span></p></li>
<li><p>Put the method setWeapon() into the right class.</p>
</li>
</ol>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-5.png" alt="Images" width="838" height="477" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-5.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Overheard at the local diner..."><div class="sect1" id="overheard_at_the_local_dinerhellip">
<h1>Overheard at the local diner...</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg26.png" alt="Images" width="914" height="610" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg26.png">
<h6></h6>
</div></figure>
<p>What’s the difference between these two orders? Not a thing! They’re both the same order, except Alice is using twice the number of words and trying the patience of a grumpy short-order cook.</p>
<p>What’s Flo got that Alice doesn’t? <strong>A shared vocabulary</strong> with the short-order cook. Not only does that make it easier to communicate with the cook, but it gives the cook less to remember because he’s got all the diner patterns in his head.</p>
<p>Design Patterns give you a shared vocabulary with other developers. Once you’ve got the vocabulary you can more easily communicate with other developers and inspire those who don’t know patterns to start learning them. It also elevates your thinking about architectures by letting you <strong>think at the <em>pattern</em> level</strong>, not the nitty-gritty <em>object</em> level.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Overheard in the next cubicle..."><div class="sect1" id="overheard_in_the_next_cubiclehellip">
<h1>Overheard in the next cubicle...</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg27-1.png" alt="Images" width="520" height="624" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg27-1.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000125">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Images" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>Can you think of other shared vocabularies that are used beyond OO design and diner talk? (Hint: how about auto mechanics, carpenters, gourmet chefs, air traffic control.) What qualities are communicated along with the lingo?</p>
<p>Can you think of aspects of OO design that get communicated along with pattern names? What qualities get communicated along with the name “Strategy Pattern”?</p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg27-2.png" alt="Images" width="1023" height="485" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg27-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The power of a shared pattern vocabulary"><div class="sect1" id="the_power_of_a_shared_pattern_vocabulary">
<h1>The power of a shared pattern vocabulary</h1>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>When you communicate using patterns you are doing <u>more</u> than just sharing LINGO.</strong></p>
<p><strong>Shared pattern vocabularies are POWERFUL.</strong> When you communicate with another developer or your team using patterns, you are communicating not just a pattern name but a whole set of qualities, characteristics, and constraints that the pattern represents.</p>
</div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9FA2">“We’re using the Strategy Pattern to implement the various behaviors of our ducks.” This tells you the duck behavior has been encapsulated into its own set of classes that can be easily expanded and changed, even at runtime if needed.</span></p>
</div>
<p><strong>Patterns allow you to say more with less.</strong> When you use a pattern in a description, other developers quickly know precisely the design you have in mind.</p>
<p><strong>Talking at the pattern level allows you to stay “in the design” longer.</strong> Talking about software systems using patterns allows you to keep the discussion at the design level, without having to dive down to the nitty-gritty details of implementing objects and classes.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9FA2">How many design meetings have you been in that quickly degrade into implementation details?</span></p>
</div>
<p><strong>Shared vocabularies can turbo-charge your development team.</strong> A team well versed in design patterns can move more quickly with less room for misunderstanding.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9FA2">As your team begins to share design ideas and experience in terms of patterns, you will build a community of patterns users.</span></p>
</div>
<p><strong>Shared vocabularies encourage more junior developers to get up to speed.</strong> Junior developers look up to experienced developers. When senior developers make use of design patterns, junior developers also become motivated to learn them. Build a community of pattern users at your organization.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9FA2">Think about starting a patterns study group at your organization. Maybe you can even get paid while you’re learning...</span></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="How do I use Design Patterns?"><div class="sect1" id="how_do_i_use_design_patternsquestion_mar">
<h1>How do I use Design Patterns?</h1>
<p>We’ve all used off-the-shelf libraries and frameworks. We take them, write some code against their APIs, compile them into our programs, and benefit from a lot of code someone else has written. Think about the Java APIs and all the functionality they give you: network, GUI, IO, etc. Libraries and frameworks go a long way towards a development model where we can just pick and choose components and plug them right in. But... they don’t help us structure our own applications in ways that are easier to understand, more maintainable and flexible. That’s where Design Patterns come in.</p>
<p>Design patterns don’t go directly into your code, they first go into your BRAIN. Once you’ve loaded your brain with a good working knowledge of patterns, you can then start to apply them to your new designs, and rework your old code when you find it’s degrading into an inflexible mess.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg29.png" alt="Images" width="799" height="369" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg29.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id000169">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: If design patterns are so great, why can’t someone build a library of them so I don’t have to?</strong></p>
<p><strong>A:</strong> Design patterns are higher level than libraries. Design patterns tell us how to structure classes and objects to solve certain problems and it is our job to adapt those designs to fit our particular application.</p>
<p><strong>Q: Aren’t libraries and frameworks also design patterns?</strong></p>
<p><strong>A:</strong> Frameworks and libraries are not design patterns; they provide specific implementations that we link into our code. Sometimes, however, libraries and frameworks make use of design patterns in their implementations. That’s great, because once you understand design patterns, you’ll more quickly understand APIs that are structured around design patterns.</p>
<p><strong>Q: So, there are no libraries of design patterns?</strong></p>
<p><strong>A:</strong> No, but you will learn later about pattern catalogs with lists of patterns that you can apply to your applications.</p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg30.png" alt="Images" width="954" height="492" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg30.png">
<h6></h6>
</div></figure>
<p><strong>Developer:</strong> Okay, hmm, but isn’t this all just good object-oriented design; I mean as long as I follow encapsulation and I know about abstraction, inheritance, and polymorphism, do I really need to think about Design Patterns? Isn’t it pretty straightforward? Isn’t this why I took all those OO courses? I think Design Patterns are useful for people who don’t know good OO design.</p>
<p><strong>Guru:</strong> Ah, this is one of the true misunderstandings of object-oriented development: that by knowing the OO basics we are automatically going to be good at building flexible, reusable, and maintainable systems.</p>
<p><strong>Developer:</strong> No?</p>
<p><strong>Guru:</strong> No. As it turns out, constructing OO systems that have these properties is not always obvious and has been discovered only through hard work.</p>
<p><strong>Developer:</strong> I think I’m starting to get it. These, sometimes non-obvious, ways of constructing object-oriented systems have been collected...</p>
<p><strong>Guru:</strong> ...yes, into a set of patterns called Design Patterns.</p>
<p><strong>Developer:</strong> So, by knowing patterns, I can skip the hard work and jump straight to designs that always work?</p>
<p><strong>Guru:</strong> Yes, to an extent, but remember, design is an art. There will always be tradeoffs. But, if you follow well thought-out and time-tested design patterns, you’ll be way ahead.</p>
<p><strong>Developer:</strong> What do I do if I can’t find a pattern?</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg31.png" alt="Images" width="560" height="716" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg31.png">
<h6></h6>
</div></figure>
<p><strong>Guru:</strong> There are some object-oriented principles that underlie the patterns, and knowing these will help you to cope when you can’t find a pattern that matches your problem.</p>
<p><strong>Developer:</strong> Principles? You mean beyond abstraction, encapsulation, and...</p>
<p><strong>Guru:</strong> Yes, one of the secrets to creating maintainable OO systems is thinking about how they might change in the future, and these principles address those issues.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg32-1.png" alt="Images" width="172" height="163" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg32-1.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Tools for your Design Toolbox"><div class="sect1" id="tools_for_your_design_tool">
<h1>Tools for your Design Toolbox</h1>
<p>You’ve nearly made it through the first chapter! You’ve already put a few tools in your OO toolbox; let’s make a list of them before we move on to <a data-type="xref" href="ch02.html#the_observer_pattern_keeping_your_object">Chapter 2</a>.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg32-2.png" alt="Images" width="399" height="519" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg32-2.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id000171">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-2.png" alt="Images" width="108" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-2.png"></span> BULLET POINTS</h5>
<ul>
<li><p>Knowing the OO basics does not make you a good OO designer.</p></li>
<li><p>Good OO designs are reusable, extensible, and maintainable.</p></li>
<li><p>Patterns show you how to build systems with good OO design qualities.</p></li>
<li><p>Patterns are proven object-oriented experience.</p></li>
<li><p>Patterns don’t give you code, they give you general solutions to design problems. You apply them to your specific application.</p></li>
<li><p>Patterns aren’t <em>invented</em>, they are <em>discovered</em>.</p></li>
<li><p>Most patterns and principles address issues of <em>change</em> in software.</p></li>
<li><p>Most patterns allow some part of a system to vary independently of all other parts.</p></li>
<li><p>We often try to take what varies in a system and encapsulate it.</p></li>
<li><p>Patterns provide a shared language that can maximize the value of your communication with other developers.</p></li>
</ul>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-1.png" alt="Images" width="171" height="109" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-1.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Design Patterns Crossword"><div class="sect1" id="design_patterns_crosswo">
<h1>Design Patterns Crossword</h1>
<p>Let’s give your right brain something to do.</p>
<p>It’s your standard crossword; all of the solution words are from this chapter.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg33.png" alt="Images" width="597" height="508" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg33.png">
<h6></h6>
</div></figure>
<p><strong>ACROSS</strong></p>
<p>2. ________ what varies.</p>
<p>4. Design patterns __________.</p>
<p>6. Java IO, Networking, Sound.</p>
<p>9. Rubber ducks make a __________.</p>
<p>13. Bartender thought they were called.</p>
<p>15. Program to this, not an implementation.</p>
<p>17. Patterns go into your _________.</p>
<p>18. Learn from the other guy’s ___________.</p>
<p>19. Development constant.</p>
<p>20. Patterns give us a shared ____________.</p>
<p><strong>DOWN</strong></p>
<p>1. Patterns _______ in many applications.</p>
<p>3. Favor this over inheritance.</p>
<p>5. Dan was thrilled with this pattern.</p>
<p>7. Most patterns follow from OO _________.</p>
<p>8. Not your own __________.</p>
<p>10. High level libraries.</p>
<p>11. Joe’s favorite drink.</p>
<p>12. Pattern that fixed the simulator.</p>
<p>13. Duck that can’t quack.</p>
<p>14. Grilled cheese with bacon.</p>
<p>15. Duck demo was located here.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-1.png" alt="Images" width="171" height="109" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-1.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Design Puzzle Solution"><div class="sect1" id="design_puzzle_solution">
<h1>Design Puzzle Solution</h1>
<p>Character is the abstract class for all the other characters (King, Queen, Knight, and Troll), while WeaponBehavior is an interface that all weapon behaviors implement. So all actual characters and weapons are concrete classes.</p>
<p>To switch weapons, each character calls the setWeapon() method, which is defined in the Character superclass. During a fight the useWeapon() method is called on the current weapon set for a given character to inflict great bodily damage on another character.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg34.png" alt="Images" width="726" height="498" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg34.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id000101">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>Which of the following are disadvantages of using subclassing to provide specific Duck behavior? (Choose all that apply.) Here’s our solution.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-4a.png" alt="Images" width="25" height="28" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-4a.png"></span> A. Code is duplicated across subclasses.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-4a.png" alt="Images" width="25" height="28" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-4a.png"></span> B. Runtime behavior changes are difficult.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-5a.png" alt="Images" width="18" height="17" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-5a.png"></span> C. We can’t make duck’s dance.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-4a.png" alt="Images" width="25" height="28" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-4a.png"></span> D. Hard to gain knowledge of all duck behaviors.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-5a.png" alt="Images" width="18" height="17" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-5a.png"></span> E. Ducks can’t fly and quack at the same time.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-4a.png" alt="Images" width="25" height="28" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-4a.png"></span> F. Changes can unintentionally affect other ducks.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id000102">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>What are some factors that drive change in your applications? You might have a very different list, but here’s a few of ours. Look familiar? Here’s our solution.</p>
<p><span style="color:#9D9FA2">My customers or users decide they want something else, or they want new functionality.</span></p>
<p><span style="color:#9D9FA2">My company decided it is going with another database vendor and it is also purchasing its data from another supplier that uses a different data format. Argh!</span></p>
<p><span style="color:#9D9FA2">Well, technology changes and we’ve got to update our code to make use of protocols.</span></p>
<p><span style="color:#9D9FA2">We’ve learned enough building our system that we’d like to go back and do things a little better.</span></p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-1.png" alt="Images" width="171" height="109" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg25-1.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Design Patterns Crossword Solution"><div class="sect1" id="design_patterns_crossword_soluti">
<h1>Design Patterns Crossword Solution</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg36.png" alt="Images" width="575" height="490" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg36.png">
<h6></h6>
</div></figure>
</div></section>
</div></section><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 2. The Observer Pattern: Keeping your Objects in the Know"><div class="chapter" id="the_observer_pattern_keeping_your_object">
<h1><span class="label">Chapter 2. </span>The Observer Pattern: Keeping your Objects in the Know</h1> 
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg37.png" alt="Images" width="778" height="589" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg37.png">
<h6></h6>
</div></figure>
<p><strong>You don’t want to miss out when something interesting happens, do you?</strong> We’ve got a pattern that keeps your objects <em>in the know</em> when something they <em>care about</em> happens. It’s the Observer Pattern. It is one of the most commonly used design patterns, and it’s incredibly useful. We’re going to look at all kinds of interesting aspects of Observer, like its <em>one-to-many relationships</em> and <em>loose coupling</em>. And, with those concepts in mind, how can you help but be the life of the Patterns Party?</p>
<p><strong>Congratulations!</strong></p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Your team has just won the contract to build Weather-O-Rama, Inc.’s next-generation, internet-based Weather Monitoring Station.</strong></p>
</div>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg38.png" alt="Images" width="854" height="1077" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg38.png">
<h6></h6>
</div></figure>
<section data-type="sect1" data-pdf-bookmark="The Weather Monitoring application overview"><div class="sect1" id="the_weather_monitoring_application_overv">
<h1>The Weather Monitoring application overview</h1>
<p>Let’s take a look at the Weather Monitoring application we need to deliver—both what Weather-O-Rama is giving us, and what we’re going to need to build, or extend. The system has three components: the weather station (the physical device that acquires the actual weather data), the WeatherData object (that tracks the data coming from the Weather Station and updates the displays), and the display that shows users the current weather conditions:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg39.png" alt="Images" width="1041" height="588" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg39.png">
<h6></h6>
</div></figure>
<p>The WeatherData object was written by Weather-O-Rama and knows how to talk to the physical Weather Station to get updated weather data. We’ll need to adapt the WeatherData object so that it knows how to update the display. Hopefully Weather-O-Rama has given us hints for how to do this in the source code. Remember, we’re responsible for implementing three different display elements: Current Conditions (shows temperature, humidity, and pressure), Weather Statistics, and a simple Forecast.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>So, our job, if we choose to accept it, is to create an app that uses the WeatherData object to update three displays for current conditions, weather stats, and a forecast.</strong></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Unpacking the WeatherData class"><div class="sect1" id="unpacking_the_weatherdata_class">
<h1>Unpacking the WeatherData class</h1>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Let’s check out the source code attachments that Johnny Hurricane, the CEO, sent over. We’ll start with the WeatherData class:</strong></p>
</div>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg40.png" alt="Images" width="944" height="989" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg40.png">
<h6></h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>So, our job is to alter the measurementsChanged() method so that it updates the three displays for current conditions, weather stats, and forecast.</strong></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Our Goal"><div class="sect1" id="our_goal">
<h1>Our Goal</h1>
<p>We know we need to implement a display and then to have the WeatherData update that display each time it has new values, or, in other words, each time the measurementsChanged() method is called. But how? Let’s think through what we’re trying to acheive:</p>
<ul>
<li><p>We know the WeatherData class has getter methods for three measurement values: temperature, humidity, and barometric pressure.</p></li>
<li><p>We know the measurementsChanged() method is called any time new weather measurement data is available. (Again, we don’t know or care how this method is called; we just know that it <em>is called.</em>)</p></li>
<li><p>We’ll need to implement three display elements that use the weather data: a <em>current conditions</em> display, a <em>statistics display,</em> and a <em>forecast</em> display. These displays must be updated as often as the WeatherData has new measurements.</p></li>
<li><p>To update the displays, we’ll add code to the measurementsChanged() method.</p></li>
</ul>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg41-1.png" alt="Images" width="253" height="563" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg41-1.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Stretch Goal"><div class="sect1" id="stretch_goal">
<h1>Stretch Goal</h1>
<p>But let’s also think about the future—remember the constant in software development? Change. We expect, if successful, there will be more than three displays in the future, in fact, why not create a marketplace for additional displays? So, how about we build in:</p>
<ul>
<li><p>Expandability—other developers may want to create new custom displays. Why not allow users to add (or remove) as many display elements as they want to the application. Currently, we know about the initial <em>three</em> display types (current conditions, statistics, and forecast) but we expect a vibrant marketplace for new displays in the future.</p>
</li>
</ul>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Taking a first, misguided SWAG at the Weather Station"><div class="sect1" id="taking_a_firstcomma_misguided_swag_at_th">
<h1>Taking a first, misguided SWAG at the Weather Station</h1>
<p>Here’s a first implementation possibility—as we’ve discussed we’re going to add our code to the measurementsChanged() method in the WeatherData class:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg42.png" alt="Images" width="942" height="508" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg42.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00304">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>Based on our first implementation, which of the following apply? (Choose all that apply.)</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> A. We are coding to concrete implementations, not interfaces.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> B. For every new display we’ll need to alter this code.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> C. We have no way to add (or remove) display elements at run time.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> D. The display elements don’t implement a common interface.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> E. We haven’t encapsulated the part that changes.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> F. We are violating encapsulation of the WeatherData class.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What’s wrong with our implementation anyway?"><div class="sect1" id="whatapostrophes_wrong_with_our_implement">
<h1>What’s wrong with our implementation anyway?</h1>
<p>Think back to all those <a data-type="xref" href="ch01.html#intro_to_design_patterns_welcome_to_desi">Chapter 1</a> concepts and principles—which are we violating, and which are we not? Think in particular about the effects of change on this code. Let’s work through our thinking as we look at the code:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg43-1.png" alt="Images" width="887" height="532" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg43-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg43-2.png" alt="Images" width="452" height="423" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg43-2.png">
<h6></h6>
</div></figure>
<p>Good idea. Let’s take a look at Observer, then come back and figure out how to apply it to the Weather Monitoring app.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Meet the Observer Pattern"><div class="sect1" id="meet_the_observer_pattern">
<h1>Meet the Observer Pattern</h1>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>You know how newspaper or magazine subscriptions work:</strong></p>
</div>
<ol>
<li><p>A newspaper publisher goes into business and begins publishing newspapers.</p></li>
<li><p>You subscribe to a particular publisher, and every time there’s a new edition it gets delivered to you. As long as you remain a subscriber, you get new newspapers.</p></li>
<li><p>You unsubscribe when you don’t want papers anymore, and they stop being delivered.</p></li>
<li><p>While the publisher remains in business, people, hotels, airlines, and other businesses constantly subscribe and unsubscribe to the newspaper.</p></li>
</ol>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg44.png" alt="Images" width="723" height="534" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg44.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Publishers + Subscribers = Observer Pattern"><div class="sect1" id="publishers_plus_subscribers_equals_obser">
<h1>Publishers + Subscribers = Observer Pattern</h1>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>If you understand newspaper subscriptions, you pretty much understand the Observer Pattern, only we call the publisher the SUBJECT and the subscribers the OBSERVERS.</strong></p>
<p><strong>Let’s take a closer look:</strong></p>
</div>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg45.png" alt="Images" width="963" height="713" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg45.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="A day in the life of the Observer Pattern"><div class="sect1" id="a_day_in_the_life_of_the_observer_patter">
<h1>A day in the life of the Observer Pattern</h1>
<p><strong>A Duck object comes along and tells the Subject that he wants to become an observer.</strong></p>
<p>Duck really wants in on the action; those ints Subject is sending out whenever its state changes look pretty interesting...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg46-1.png" alt="Images" width="624" height="315" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg46-1.png">
<h6></h6>
</div></figure>
<p><strong>The Duck object is now an official observer.</strong></p>
<p>Duck is psyched... he’s on the list and is waiting with great anticipation for the next notification so he can get an int.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg46-2.png" alt="Images" width="481" height="315" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg46-2.png">
<h6></h6>
</div></figure>
<p><strong>The Subject gets a new data value!</strong></p>
<p>Now Duck and all the rest of the observers get a notification that the Subject has changed.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg46-3.png" alt="Images" width="478" height="314" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg46-3.png">
<h6></h6>
</div></figure>
<p><strong>The Mouse object asks to be removed as an observer.</strong></p>
<p>The Mouse object has been getting ints for ages and is tired of it, so he decides it’s time to stop being an observer.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg47-1.png" alt="Images" width="472" height="315" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg47-1.png">
<h6></h6>
</div></figure>
<p><strong>Mouse is outta here!</strong></p>
<p>The Subject acknowledges the Mouse’s request and removes him from the set of observers.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg47-2.png" alt="Images" width="489" height="314" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg47-2.png">
<h6></h6>
</div></figure>
<p><strong>The Subject has another new int.</strong></p>
<p>All the observers get another notification, except for the Mouse who is no longer included. Don’t tell anyone, but the Mouse secretly misses those ints... maybe he’ll ask to be an observer again some day</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg47-3.png" alt="Images" width="487" height="314" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg47-3.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Five-minute drama: a subject for observation"><div class="sect1" id="five-minute_drama_a_subject_for_observat">
<h1>Five-minute drama: a subject for observation</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg48-1.png" alt="Images" width="103" height="107" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg48-1.png">
<h6></h6>
</div></figure>
<p>In today’s skit, two enterprising software developers encounter a real live head hunter...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg48-2.png" alt="Images" width="308" height="507" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg48-2.png">
<h6></h6>
</div></figure>
<ol>
<li><p><strong>Software Developer #1</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg48-3.png" alt="Images" width="419" height="437" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg48-3.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Headhunter/Subject</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg48-4.png" alt="Images" width="427" height="425" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg48-4.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Software Developer #2</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg48-5.png" alt="Images" width="390" height="470" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg48-5.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Subject</strong></p></li>
<li><p>Meanwhile, for Lori and Jill life goes on; if a Java job comes along, they’ll get notified. After all, they are observers.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg49-1.png" alt="Images" width="446" height="513" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg49-1.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Subject</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg49-2.png" alt="Images" width="842" height="900" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg49-2.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Observer</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg49-3.png" alt="Images" width="436" height="319" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg49-3.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Observer</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg49-4.png" alt="Images" width="315" height="447" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg49-4.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Subject</strong></p></li></ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Two weeks later..."><div class="sect1" id="two_weeks_laterhellip">
<h1>Two weeks later...</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg50-1.png" alt="Images" width="231" height="417" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg50-1.png">
<h6></h6>
</div></figure>
<p>Jill’s loving life, and no longer an observer. She’s also enjoying the nice fat signing bonus that she got because the company didn’t have to pay a headhunter.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg50-2.png" alt="Images" width="384" height="423" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg50-2.png">
<h6></h6>
</div></figure>
<p>But what has become of our dear Lori? We hear she’s beating the headhunter at his own game. She’s not only still an observer, she’s got her own call list now, and she is notifying her own observers. Lori’s a subject and an observer all in one.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Observer Pattern defined"><div class="sect1" id="the_observer_pattern_defined">
<h1>The Observer Pattern defined</h1>
<p>A newspaper subscription, with its publisher and subscribers, is a good way to visualize the pattern.</p>
<p>In the real world, however, you’ll typically see the Observer Pattern defined like this:</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>The Observer Pattern</strong> defines a one-to-many dependency between objects so that when one object changes state, all of its dependents are notified and updated automatically.</p>
</div>
<p>Let’s relate this definition to how we’ve been thinking about the pattern:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg51.png" alt="Images" width="551" height="376" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg51.png">
<h6></h6>
</div></figure>

<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>The Observer Pattern defines a one-to-many relationship between a set of objects.</strong></p>
<p><strong>When the state of one object changes, all of its dependents are notified.</strong></p>
</div>
<p>The subject and observers define the one-to-many relationship. We have <em>one subject</em>, who notifies <em>many observers</em> when something in the subject changes. The observers <em>are dependent</em> on the subject—when the subject’s state changes, the observers are notified.</p>
<p>As you’ll discover, there are a few different ways to implement the Observer Pattern, but most revolve around a class design that includes Subject and Observer interfaces.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Observer Pattern: the Class Diagram"><div class="sect1" id="the_observer_pattern_the_class_diagram">
<h1>The Observer Pattern: the Class Diagram</h1>

<p>Let’s take a look at the structure of the Observer Pattern, complete with its Subject and Observer classes. Here’s the class diagram:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg52.png" alt="Images" width="940" height="687" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg52.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id000167">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: What does this have to do with one-to-many relationships?</strong></p>
<p><strong>A:</strong> With the Observer Pattern, the Subject is the object that contains the state and controls it. So, there is ONE subject with state. The observers, on the other hand, use the state, even if they don’t own it. There are many observers and they rely on the Subject to tell them when its state changes. So there is a relationship between the ONE Subject to the MANY Observers.</p>
<p><strong>Q: How does dependence come into this?</strong></p>
<p><strong>A:</strong> Because the subject is the sole owner of that data, the observers are dependent on the subject to update them when the data changes. This leads to a cleaner OO design than allowing many objects to control the same data.</p>
<p><strong>Q: I’ve also heard of a Publish-Subscribe Pattern. Is that just another name for the Observer Pattern?</strong></p>
<p><strong>A:</strong> No, although they are related. The Publish-Subscribe pattern is a more complex pattern that allows subscribers to express interest in different types of messages and further separates publishers from subscribers. It is often used in middleware systems.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="guru_and-id03301">
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg53.png" alt="Images" width="111" height="139" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg53.png">
<h6></h6>
</div></figure>
<p><strong><em>Guru and Student...</em></strong></p>
<p><strong><em>Guru:</em></strong> <em>Have we talked about loose coupling?</em></p>
<p><strong><em>Student:</em></strong> <em>Guru, I do not recall such a discussion.</em></p>
<p><strong><em>Guru:</em></strong> <em>Is a tightly woven basket stiff or flexible?</em></p>
<p><strong><em>Student:</em></strong> <em>Stiff, Guru.</em></p>
<p><strong><em>Guru:</em></strong> <em>And do stiff or flexible baskets tear or break less easily?</em></p>
<p><strong><em>Student:</em></strong> <em>A flexible basket tends to break less easily.</em></p>
<p><strong><em>Guru:</em></strong> <em>And in our software, might our designs break less easily if our objects are less tightly bound together?</em></p>
<p><strong><em>Student:</em></strong> <em>Guru, I see the truth of it. But what does it mean for objects to be less tightly bound?</em></p>
<p><strong><em>Guru:</em></strong> <em>We like to call it, loosely coupled.</em></p>
<p><strong><em>Student:</em></strong> <em>Ah!</em></p>
<p><strong><em>Guru:</em></strong> <em>We say a object is tightly coupled to another object when it is</em> <strong>too</strong> <em>dependent on that object.</em></p>
<p><strong><em>Student:</em></strong> <em>So a loosely coupled object can’t depend on another object?</em></p>
<p><strong><em>Guru:</em></strong> <em>Think of nature; all living things depend on each other. Likewise, all objects depend on other objects. But a loosely coupled object doesn’t know or care too much about the details of another object.</em></p>
<p><strong><em>Student:</em></strong> <em>But Guru, that doesn’t sound like a good quality. Surely not knowing is worse than knowing.</em></p>
<p><strong><em>Guru:</em></strong> <em>You are doing well in your studies, but you have much to learn. By not knowing too much about other objects we can create designs that can handle change better. Designs that have more flexibility, like the less tightly woven basket.</em></p>
<p><strong><em>Student:</em></strong> <em>Of course, I am sure you are right. Could you give me an example?</em></p>
<p><strong><em>Guru:</em></strong> <em>That is enough for today.</em></p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Power of Loose Coupling"><div class="sect1" id="the_power_of_loose_coupling">
<h1>The Power of Loose Coupling</h1>
<p>When two objects are <em>loosely coupled</em>, they can interact, but they typically have very little knowledge of each other. As we’re going to see, loosely coupled designs often give us a lot of flexibility (more on that in a bit). And, as it turns out, the Observer Pattern is a great example of loose coupling. Let’s walk through all the ways the pattern achieves loose coupling:</p>
<p><strong>First, the only thing the subject knows about an observer is that it implements a certain interface (the Observer interface).</strong> It doesn’t need to know the concrete class of the observer, what it does, or anything else about it.</p>
<p><strong>We can add new observers at any time.</strong> Because the only thing the subject depends on is a list of objects that implement the Observer interface, we can add new observers whenever we want. In fact, we can replace any observer at runtime with another observer and the subject will keep purring along. Likewise, we can remove observers at any time.</p>
<p><strong>We never need to modify the subject to add new types of observers.</strong> Let’s say we have a new concrete class come along that needs to be an observer. We don’t need to make any changes to the subject to accommodate the new class type; all we have to do is implement the Observer interface in the new class and register as an observer. The subject doesn’t care; it will deliver notifications to any object that implements the Observer interface.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg54-1.png" alt="Images" width="207" height="142" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg54-1.png">
<h6></h6>
</div></figure>
<p><strong>We can reuse subjects or observers independently of each other.</strong> If we have another use for a subject or an observer, we can easily reuse them because the two aren’t tightly coupled.</p>
<p><strong>Changes to either the subject or an observer will not affect the other.</strong> Because the two are loosely coupled, we are free to make changes to either, as long as the objects still meet their obligations to implement the subject or observer interfaces.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg54-2.png" alt="Images" width="697" height="122" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg54-2.png">
<h6></h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Loosely coupled designs allow us to build flexible OO systems that can handle change because they minimize the interdependency between objects.</strong></p>
</div>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id000177">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>Before moving on, try sketching out the classes you’ll need to implement the Weather Station, including the WeatherData class and its display elements. Make sure your diagram shows how all the pieces fit together and also how another developer might implement her own display element.</p>
<p>If you need a little help, read the next page; your teammates are already talking about how to design the Weather Station.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Cubicle conversation"><div class="sect1" id="cubicle_conversatio">
<h1>Cubicle conversation</h1>
<p>Back to the Weather Station project. Your teammates have already begun thinking through the problem...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg56.png" alt="Images" width="359" height="643" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg56.png">
<h6></h6>
</div></figure>
<p><strong>Mary:</strong> Well, it helps to know we’re using the Observer Pattern.</p>
<p><strong>Sue:</strong> Right... but how do we apply it?</p>
<p><strong>Mary:</strong> Hmm. Let’s look at the definition again:</p>
<p>The Observer Pattern defines a one-to-many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically.</p>
<p><strong>Mary:</strong> That actually makes some sense when you think about it. Our WeatherData class is the “one” and our “many” is the various display elements that use the weather measurements.</p>
<p><strong>Sue:</strong> That’s right. The WeatherData class certainly has state... that’s the temperature, humidity, and barometric pressure, and those definitely change.</p>
<p><strong>Mary:</strong> Yup, and when those measurements change, we have to notify all the display elements so they can do whatever it is they are going to do with the measurements.</p>
<p><strong>Sue:</strong> Cool, I now think I see how the Observer Pattern can be applied to our Weather Station problem.</p>
<p><strong>Mary:</strong> There are still a few things to consider that I’m not sure I understand yet.</p>
<p><strong>Sue:</strong> Like what?</p>
<p><strong>Mary:</strong> For one thing, how do we get the weather measurements to the display elements?</p>
<p><strong>Sue:</strong> Well, looking back at the picture of the Observer Pattern, if we make the WeatherData object the subject, and the display elements the observers, then the displays will register themselves with the WeatherData object in order to get the information they want, right?</p>
<p><strong>Mary:</strong> Yes... and once the Weather Station knows about a display element, then it can just call a method to tell it about the measurements.</p>
<p><strong>Sue:</strong> We gotta remember that every display element can be different... so I think that’s where having a common interface comes in. Even though every component has a different type, they should all implement the same interface so that the WeatherData object will know how to send them the measurements.</p>
<p><strong>Mary:</strong> I see what you mean. So every display will have, say, an update() method that WeatherData will call.</p>
<p><strong>Sue:</strong> And update() is defined in a common interface that all the elements implement...</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Designing the Weather Station"><div class="sect1" id="designing_the_weather_station">
<h1>Designing the Weather Station</h1>
<p>How does this diagram compare with yours?</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg57.png" alt="Images" width="1003" height="999" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg57.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Implementing the Weather Station"><div class="sect1" id="implementing_the_weather_station">
<h1>Implementing the Weather Station</h1>
<p>Alright we’ve had some great thinking from Mary and Sue (from a few pages back) and we’ve got a diagram that details the overall structure of our classes. So, let’s get our implemention of the weather station underway. Let’s start with the interfaces:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg58.png" alt="Images" width="954" height="553" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg58.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000188">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Images" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>Mary and Sue thought that passing the measurements directly to the observers was the most straightforward method of updating state. Do you think this is wise? Hint: is this an area of the application that might change in the future? If it did change, would the change be well encapsulated, or would it require changes in many parts of the code?</p>
<p>Can you think of other ways to approach the problem of passing the updated state to the observers?</p>
<p>Don’t worry; we’ll come back to this design decision after we finish the initial implementation.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Implementing the Subject interface in WeatherData"><div class="sect1" id="implementing_the_subject_interface_in_we">
<h1>Implementing the Subject interface in WeatherData</h1>
<p>Remember our first attempt at implementing the WeatherData class at the beginning of the chapter? You might want to refresh your memory. Now it’s time to go back and do things with the Observer Pattern in mind:</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9FA2">REMEMBER: we don’t provide import and package statements in the code listings. Get the complete source code from <a href="http://wickedlysmart.com/head-first-design-patterns/">http://wickedlysmart.com/head-first-design-patterns/</a>.</span></p>
</div>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg59.png" alt="Images" width="971" height="934" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg59.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Now, let’s build those display elements"><div class="sect1" id="nowcomma_letapostrophes_build_those_disp">
<h1>Now, let’s build those display elements</h1>
<p>Now that we’ve got our WeatherData class straightened out, it’s time to build the Display Elements. Weather-O-Rama ordered three: the current conditions display, the statistics display, and the forecast display. Let’s take a look at the current conditions display; once you have a good feel for this display element, check out the statistics and forecast displays in the code directory. You’ll see they are very similar.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg60.png" alt="Images" width="978" height="667" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg60.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0001121">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Is update() the best place to call display?</strong></p>
<p><strong>A:</strong> In this simple example it made sense to call display() when the values changed. However, you are right; there are much better ways to design the way the data gets displayed. We are going to see this when we get to the Model-View-Controller pattern.</p>
<p><strong>Q: Why did you store a reference to the WeatherData Subject? It doesn’t look like you use it again after the constructor.</strong></p>
<p><strong>A:</strong> True, but in the future we may want to un-register ourselves as an observer and it would be handy to already have a reference to the subject.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Power up the Weather Station"><div class="sect1" id="power_up_the_weather_station">
<h1>Power up the Weather Station</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg61-1.png" alt="Images" width="74" height="144" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg61-1.png">
<h6></h6>
</div></figure>
<ol>
<li><p><strong>First, let’s create a test harness.</strong></p>
<p>The Weather Station is ready to go. All we need is some code to glue everything together. We’ll be adding some more displays and generalizing things in a bit. For now, here’s our first attempt:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg61-2.png" alt="Images" width="989" height="448" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg61-2.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Run the code and let the Observer Pattern do its magic.</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg61-3.png" alt="Images" width="675" height="322" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg61-3.png">
<h6></h6>
</div></figure></li>
</ol>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00305">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>Johnny Hurricane, Weather-O-Rama’s CEO, just called and they can’t possibly ship without a Heat Index display element. Here are the details.</p>
<p>The heat index is an index that combines temperature and humidity to determine the apparent temperature (how hot it actually feels). To compute the heat index, you take the temperature, T, and the relative humidity, RH, and use this formula:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg62-1.png" alt="Images" width="751" height="163" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg62-1.png">
<h6></h6>
</div></figure>
<p>So get typing!</p>
<p>Just kidding. Don’t worry, you won’t have to type that formula in; just create your own HeatIndexDisplay.java file and copy the formula from heatindex.txt into it.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg62-2.png" alt="Images" width="420" height="57" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg62-2.png">
<h6></h6>
</div></figure>
<p>How does it work? You’d have to refer to <em>Head First Meteorology</em>, or try asking someone at the National Weather Service (or try a web search).</p>
<p>When you finish, your output should look like this:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg62-3.png" alt="Images" width="862" height="419" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg62-3.png">
<h6></h6>
</div></figure>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg63.png" alt="Images" width="277" height="144" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg63.png">
<h6></h6>
</div></figure>
<p>Tonight’s talk: <strong>A Subject and Observer spar over the right way to get state information to the Observer.</strong></p>
<table class="border">
<thead>
<tr>
<th><strong>Subject:</strong></th>
<th><strong>Observer:</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>I’m glad we’re finally getting a chance to chat in person.</td>
<td>&nbsp;</td></tr>
<tr>
<td>&nbsp;</td>
<td>Really? I thought you didn’t care much about us Observers.</td></tr>
<tr>
<td>Well, I do my job, don’t I? I always tell you what’s going on... Just because I don’t really know who you are doesn’t mean I don’t care. And besides, I do know the most important thing about you—you implement the Observer interface.</td>
<td>&nbsp;</td></tr>
<tr>
<td>&nbsp;</td>
<td>Yeah, but that’s just a small part of who I am. Anyway, I know a lot more about you...</td></tr>
<tr>
<td>Oh yeah, like what?</td>
<td>&nbsp;</td></tr>
<tr>
<td>&nbsp;</td>
<td>Well, you’re always passing your state around to us Observers so we can see what’s going on inside you. Which gets a little annoying at times...</td></tr>
<tr>
<td>Well, excuuuse me. I have to send my state with my notifications so all you lazy Observers will know what happened!</td>
<td>&nbsp;</td></tr>
<tr>
<td>&nbsp;</td>
<td>Okay, wait just a minute here; first, we’re not lazy, we just have other stuff to do in between your oh-so-important notifications, Mr. Subject, and second, why don’t you let us come to you for the state we want rather than pushing it out to just everyone?</td></tr>
<tr>
<td>Well... I guess that might work. I’d have to open myself up even more, though, to let all you Observers come in and get the state that you need. That might be kind of dangerous. I can’t let you come in and just snoop around looking at everything I’ve got.</td></tr>
<tr>
<td>&nbsp;</td>
<td>Why don’t you just write some public getter methods that will let us pull out the state we need?</td></tr>
<tr>
<td>Yes, I could let you <strong>pull</strong> my state. But won’t that be less convenient for you? If you have to come to me every time you want something, you might have to make multiple method calls to get all the state you want. That’s why I like <strong>push</strong> better... then you have everything you need in one notification.</td>
<td>&nbsp;</td></tr>
<tr>
<td>&nbsp;</td>
<td>Don’t be so pushy! There are so many different kinds of us Observers, there’s no way you can anticipate everything we need. Just let us come to you to get the state we need. That way, if some of us only need a little bit of state, we aren’t forced to get it all. It also makes things easier to modify later. Say, for example, you expand yourself and add some more state. If you use pull, you don’t have to go around and change the update calls on every observer; you just need to change yourself to allow more getter methods to access our additional state.</td></tr>
<tr>
<td>Well as I like to say, don’t call us, we’ll call you! But, I’ll give it some thought.</td>
<td>&nbsp;</td></tr>
<tr>
<td>&nbsp;</td>
<td>I won’t hold my breath.</td></tr>
<tr>
<td>You never know, hell <em>could</em> freeze over.</td>
<td>&nbsp;</td></tr>
<tr>
<td>&nbsp;</td>
<td>I see, always the wise guy...</td></tr>
<tr>
<td>Indeed.</td>
<td>&nbsp;</td></tr>
</tbody>
</table>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Looking for the Observer Pattern in the Wild"><div class="sect1" id="looking_for_the_observer_pattern_in_the">
<h1>Looking for the Observer Pattern in the Wild</h1>
<p>The Observer Pattern is one of the most common patterns in use, and you’ll find plenty of examples of the pattern being used in many libraries and frameworks. If we look at the Java Development Kit (JDK) for instance, both the JavaBeans and Swing libraries make use of the Observer Pattern. The pattern’s not limited to Java either; it’s used in JavaScript’s events and in Cocoa and Swift’s Key-Value Observing protocol, to name a couple of other examples. One of the advantages of knowing design patterns is recognizing and quickly understanding the design movitation in your favorite libraries. Let’s take a quick diversion into the Swing library to see how Observer is used.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg65-1.png" alt="Images" width="159" height="221" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg65-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg65-2.png" alt="Images" width="207" height="157" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg65-2.png">
<h6></h6>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="The Swing library"><div class="sect2" id="the_swing_library">
<h2>The Swing library</h2>
<p>You probably already know that Swing is Java’s GUI toolkit for user interfaces. One of the most basic components of that toolkit is the JButton class. If you look up JButton’s superclass, AbstractButton, you’ll find that it has a lot of add/remove listener methods. These methods allow you to add and remove observers—or, as they are called in Swing, listeners—to listen for various types of events that occur on the Swing component. For instance, an ActionListener lets you “listen in” on any types of actions that might occur on a button, like a button press. You’ll find various types of listeners all over the Swing API.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="A little life-changing application"><div class="sect2" id="a_little_life-changing_application">
<h2>A little life-changing application</h2>
<p>Okay, our application is pretty simple. You’ve got a button that says “Should I do it?” and when you click on that button the listeners (observers) get to answer the question in any way they want. We’re implementing two such listeners, called the AngelListener and the DevilListener. Here’s how the application behaves:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg65-3.png" alt="Images" width="800" height="407" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg65-3.png">
<h6></h6>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Coding the life-changing application"><div class="sect1" id="coding_the_life-changing_application">
<h1>Coding the life-changing application</h1>
<p>This life-changing application requires very little code. All we need to do is create a JButton object, add it to a JFrame and set up our listeners. We’re going to use inner classes for the listeners, which is a common technique in Swing programming. If you aren’t up on inner classes or Swing, you might want to review the “Getting GUI” chapter of <em>Head First Java</em>.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg66.png" alt="Images" width="973" height="897" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg66.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg67.png" alt="Images" width="1000" height="1114" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg67.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0001103">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: I thought Java had Observer and Observable classes?</strong></p>
<p><strong>A:</strong> Good catch. Java used to provide an Observable class (the Subject) and an Observer interface, which you could use to help integrate the Observer pattern in your code. The Observable class provided methods to add, delete, and notify observers, so that you didn’t have to write that code. And the Observer interface provided an interface just like ours, with one update() method. These classes were deprecated in Java 9. Folks found it easier to support the basic Observer pattern in their own code, or wanted something more robust, which is now provided in JavaBeans, and so the Observer/Observable classes are being phased out.</p>
<p><strong>Q: Does Java offer other built-in support for Observer to replace those classes?</strong></p>
<p><strong>A:</strong> JavaBeans offers built-in support through PropertyChangeEvents that are generated when a Bean changes a particular kind of property, and sends notifications to PropertyChangeListeners. There are also related publisher/subscriber components in the Flow API for handling asynchronous streams.</p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg68.png" alt="Images" width="617" height="602" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg68.png">
<h6></h6>
</div></figure>
<p><strong>That’s a good idea.</strong></p>
<p>In our current Weather Station design, we are <em>pushing</em> all three pieces of data to the update() method in the displays, even if the displays don’t need all these values. That’s okay, but what if Weather-O-Rama adds another data value later, like wind speed? Then we’ll have to change all the update() methods in all the displays, even if most of them don’t need or want the wind speed data.</p>
<p>Now, whether we pull or push the data tot the Observer is an implementation detail, but in a lot of cases it makes sense to let Observers retrieve the data they need rather than passing more and more data to the Observers through the update() method. After all, over time, this is an area that may change and grow unwieldy. And, we know CEO Johnny Hurricane is going to want to expand the Weather Station and sell more displays, so let’s take another pass at the design and see if we can make it even easier to expand in the future.</p>
<p>Updating the Weather Station code to allow Observers to <em>pull</em> the data they need is a pretty straight forward exercise. All we need to do is make sure the Subject has getter methods for its data, and then change our Observers to use them to pull the data that’s appropriate for their needs. Let’s do that.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Meanwhile back at Weather-O-Rama"><div class="sect1" id="meanwhile_back_at_weather-o-rama">
<h1>Meanwhile back at Weather-O-Rama</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg69-1.png" alt="Images" width="97" height="189" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg69-1.png">
<h6></h6>
</div></figure>
<p>There’s another way of handling the data in the Subject: we can rely on the Observers to pull it from the Subject as needed. Right now, when the Subject’s data changes, we <em>push</em> the new values for temperature, humidity, and pressure to the Observers, by passing that data in the call to update().</p>
<p>Let’s set things up so that when an Observer is notified of a change, it calls getter methods on the Subject to <em>pull</em> the values it needs.</p>
<p>To switch to using pull, we need to make a few small changes to our existing code.</p>
<section data-type="sect2" data-pdf-bookmark="For the Subject to send notifications..."><div class="sect2" id="for_the_subject_to_send_notificationshel">
<h2>For the Subject to send notifications...</h2>
<ol>
<li><p>We’ll modify the notifyObservers() method in WeatherData to call the method update() in the Observers with no arguments:</p></li>
</ol>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg69-2.png" alt="Images" width="480" height="138" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg69-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="For an Observer to receive notifications..."><div class="sect2" id="for_an_observer_to_receive_notifications">
<h2>For an Observer to receive notifications...</h2>
<ol>
<li><p>Then we’ll modify the Observer interface, changing the signature of the update() method so that it has no parameters:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg69-3.png" alt="Images" width="315" height="76" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg69-3.png">
<h6></h6>
</div></figure></li>
<li><p>And finally, we modify each concrete Observer to change the signature of its respective update() methds and get the weather data from the Subject using the WeatherData’s getter methods. Here’s the new code for the CurrentConditionsDisplay class:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg69-4.png" alt="Images" width="863" height="177" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg69-4.png">
<h6></h6>
</div></figure></li>
</ol>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Code Magnets"><div class="sect1" id="code_magnets">
<h1>Code Magnets</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg70-1.png" alt="Images" width="120" height="177" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg70-1.png">
<h6></h6>
</div></figure>
<p>The ForecastDisplay class is all scrambled up on the fridge. Can you reconstruct the code snippets to make it work? Some of the curly braces fell on the floor and they were too small to pick up, so feel free to add as many of those as you need!</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg70-2.png" alt="Images" width="1013" height="977" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg70-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Test Drive the new code"><div class="sect1" id="test_drive_the_new_code">
<h1>Test Drive the new code</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg71-1.png" alt="Images" width="137" height="46" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg71-1.png">
<h6></h6>
</div></figure>
<p>Okay, you’ve got one more display to update, the Avg/Min/Max display, go ahead and do that now!</p>
<p>Just to be sure, let’s run the new code...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg71-2.png" alt="Images" width="969" height="996" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg71-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Tools for your Design Toolbox"><div class="sect1" id="tools_for_your_design_toolbox-id000101">
<h1>Tools for your Design Toolbox</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg72-1.png" alt="Images" width="144" height="137" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg72-1.png">
<h6></h6>
</div></figure>
<p>Welcome to the end of <a data-type="xref" href="#the_observer_pattern_keeping_your_object">Chapter 2</a>. You’ve added a few new things to your OO toolbox...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg72-2.png" alt="Images" width="654" height="952" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg72-2.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id000140">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-2.png" alt="Images" width="108" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-2.png"></span> BULLET POINTS</h5>
<ul>
<li><p>The Observer Pattern defines a one-to-many relationship between objects.</p></li>
<li><p>Subjects update Observers using a common interface.</p></li>
<li><p>Observers of any concrete type can participate in the pattern as long as they implement the Observer interface.</p></li>
<li><p>Observers are loosely coupled in that the Subject knows nothing about them, other than that they implement the Observer interface.</p></li>
<li><p>You can push or pull data from the Subject when using the pattern (pull is considered more “correct”).</p></li>
<li><p>Swing makes heavy use of the Observer Pattern, as do many GUI frameworks.</p></li>
<li><p>You’ll also find the pattern in many other places, including RxJava, JavaBeans, and RMI, as well as in other language frameworks, like Cocoa, Swift, and JavaScript events.</p></li>
<li><p>The Observer pattern is related to the Publish/Subscribe pattern, which is for more complex situations with multiple Subjects, and/or multiple message types.</p></li>
<li><p>The Observer pattern is a commonly used pattern, and we’ll see it again when we learn about Model-View-Controller.</p></li>
</ul>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Design Principle Challenge"><div class="sect1" id="design_principle_challenge">
<h1>Design Principle Challenge</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg73-1.png" alt="Images" width="116" height="112" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg73-1.png">
<h6></h6>
</div></figure>
<p>For each design principle, describe how the Observer Pattern makes use of the principle.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg73-2.png" alt="Images" width="947" height="865" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg73-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Design Patterns Crossword"><div class="sect1" id="design_patterns_crossword-id000101">
<h1>Design Patterns Crossword</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3a.png" alt="Images" width="148" height="93" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3a.png">
<h6></h6>
</div></figure>
<p>Time to give your right brain something to do again! All of the solution words are from <a data-type="xref" href="ch01.html#intro_to_design_patterns_welcome_to_desi">Chapter 1</a> &amp; <a data-type="xref" href="#the_observer_pattern_keeping_your_object">Chapter 2</a>.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg74.png" alt="Images" width="800" height="545" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg74.png">
<h6></h6>
</div></figure>
<p><strong>ACROSS</strong></p>
<p>1. One Subject likes to talk to _______ observers.</p>
<p>3. Subject initially wanted to _________ all the data to Observer.</p>
<p>6. CEO almost forgot the ________ index display.</p>
<p>8. CurrentConditionsDisplay implements this interface.</p>
<p>9. Java framework with lots of Observers.</p>
<p>11. A Subject is similar to a __________.</p>
<p>12. Observers like to be ___________ when something new happens.</p>
<p>15. How to get yourself off the Observer list.</p>
<p>16. Ron was both an Observer and a _________.</p>
<p>18. Subject is an ______.</p>
<p>20. You want to keep your coupling ________.</p>
<p>21. Program to an __________ not an implementation.</p>
<p>22. Devil and Angel are _________ to the button.</p>
<p><strong>DOWN</strong></p>
<p>1. He didn’t want any more ints, so he removed himself.</p>
<p>2. Temperature, humidity and __________.</p>
<p>4. Weather-O-Rama’s CEO named after this kind of storm.</p>
<p>5. He says you should go for it.</p>
<p>7. The Subject doesn’t have to know much about the _____.</p>
<p>10. The WeatherData class __________ the Subject interface.</p>
<p>13. Don’t count on this for notification.</p>
<p>14. Observers are______ on the Subject.</p>
<p>17. Implement this method to get notified.</p>
<p>19. Jill got one of her own.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id000103">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>Based on our first implementation, which of the following apply? (Choose all that apply.)</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-3.png" alt="Images" width="21" height="20" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-3.png"></span> A. We are coding to concrete implementations, not interfaces.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-3.png" alt="Images" width="21" height="20" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-3.png"></span> B. For every new display element we need to alter code.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-3.png" alt="Images" width="21" height="20" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-3.png"></span> C. We have no way to add display elements at run time.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> D. The display elements don’t implement a common interface.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-3.png" alt="Images" width="21" height="20" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-3.png"></span> E. We haven’t encapsulated what changes.</p>
<p><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png" alt="Images" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-4.png"></span> F. We are violating encapsulation of the WeatherData class.</p>
</div></aside>
<section data-type="sect2" data-pdf-bookmark="Design Principle Challenge Solution"><div class="sect2" id="design_principle_challenge_solution">
<h2>Design Principle Challenge Solution</h2>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-1.png" alt="Images" width="75" height="73" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-2.png" alt="Images" width="714" height="641" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg75-2.png">
<h6></h6>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Code Magnets Solution"><div class="sect1" id="code_magnets_solution">
<h1>Code Magnets Solution</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg76-1.png" alt="Images" width="120" height="177" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg76-1.png">
<h6></h6>
</div></figure>
<p>The ForecastDisplay class is all scrambled up on the fridge. Can you reconstruct the code snippets to make it work? Some of the curly braces fell on the floor and they were too small to pick up, so feel free to add as many of those as you need! Here’s our solution.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg76-2.png" alt="Images" width="678" height="959" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg76-2.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3a.png" alt="Images" width="148" height="93" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3a.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Design Patterns Crossword Solution"><div class="sect1" id="design_patterns_crossword_solution-id000">
<h1>Design Patterns Crossword Solution</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg77.png" alt="Images" width="800" height="557" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg77.png">
<h6></h6>
</div></figure>
</div></section>
</div></section><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 3. The Decorator Pattern: Decorating Objects"><div class="chapter" id="the_decorator_pattern_decorating_objects">
<h1><span class="label">Chapter 3. </span>The Decorator Pattern: Decorating Objects</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0081-01.png" alt="Images" width="839" height="638" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0081-01.png">
<h6></h6>
</div></figure>
<p><strong>Just call this chapter “Design Eye for the Inheritance Guy.”</strong> We’ll re-examine the typical overuse of inheritance and you’ll learn how to decorate your classes at runtime using a form of object composition. Why? Once you know the techniques of decorating, you’ll be able to give your (or someone else’s) objects new responsibilities <em>without making any code changes to the underlying classes.</em></p>
<section data-type="sect1" data-pdf-bookmark="Welcome to Starbuzz Coffee"><div class="sect1" id="welcome_to_starbuzz_coffee">
<h1>Welcome to Starbuzz Coffee</h1>
<p>Starbuzz Coffee has made a name for itself as the fastest growing coffee shop around. If you’ve seen one on your local corner, look across the street; you’ll see another one.</p>
<p>Because they’ve grown so quickly, they’re scrambling to update their ordering systems to match their beverage offerings.</p>
<p>When they first went into business they designed their classes like this...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0082-01.png" alt="Images" width="301" height="222" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0082-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0082-02.png" alt="Images" width="971" height="738" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0082-02.png">
<h6></h6>
</div></figure>
<p>In addition to your coffee, you can also ask for several condiments like steamed milk, soy, and mocha (otherwise known as chocolate), and have it all topped off with whipped milk. Starbuzz charges a bit for each of these, so they really need to get them built into their order system.</p>
<p>Here’s their first attempt... </p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0083-01.png" alt="Images" width="888" height="845" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0083-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0083-02.png" alt="Images" width="479" height="327" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0083-02.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000189">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Inline" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>It’s pretty obvious that Starbuzz has created a maintenance nightmare for themselves. What happens when the price of milk goes up? What do they do when they add a new caramel topping?</p>
<p>Thinking beyond the maintenance problem, which of the design principles that we’ve covered so far are they violating?</p>
<p><em>Hint: they’re violating two of them in a big way!</em></p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0084-02.png" alt="Images" width="603" height="650" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0084-02.png">
<h6></h6>
</div></figure>
<p>Well, let’s give it a try. Let’s start with the Beverage base class and add instance variables to represent whether or not each beverage has milk, soy, mocha, and whip...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0084-03.png" alt="Images" width="809" height="490" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0084-03.png">
<h6></h6>
</div></figure>
<p>Now let’s add in the subclasses, one for each beverage on the menu:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0085-01.png" alt="Images" width="1066" height="696" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0085-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id04306">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Inline" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>Write the <code>cost()</code> methods for the following classes (pseudo-Java is okay):</p>
<pre data-type="programlisting"><strong>public class Beverage {</strong>
      <strong>public double cost() {</strong>






      }
}
<strong>public class DarkRoast extends Beverage {</strong>
 

    <strong>public DarkRoast() {</strong>
        <strong>description = “Most Excellent Dark Roast”;</strong>
    <strong>}</strong>
    <strong>public double cost() {</strong>


    <strong>}</strong>
<strong>}</strong></pre>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0086-01.png" alt="Images" width="1038" height="589" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0086-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id04307">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Inline" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>What requirements or other factors might change that will impact this design?</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0086-02.png" alt="Images" width="1096" height="426" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0086-02.png">
<h6></h6>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id0000001">
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0087-01.png" alt="Images" width="127" height="174" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0087-01.png">
<h6></h6>
</div></figure>
<p><strong><em>Guru and Student...</em></strong></p>
<p><em><strong>Guru:</strong> It has been some time since our last meeting. Have you been deep in meditation on inheritance?</em></p>
<p><em><strong>Student:</strong> Yes, Guru. While inheritance is powerful, I have learned that it doesn’t always lead to the most flexible or maintainable designs.</em></p>
<p><em><strong>Guru:</strong> Ah yes, you have made some progress. So, tell me, my student, how then will you achieve reuse if not through inheritance?</em></p>
<p><em><strong>Student:</strong> Guru, I have learned there are ways of “inheriting” behavior at runtime through composition and delegation.</em></p>
<p><em><strong>Guru:</strong> Please, go on...</em></p>
<p><em><strong>Student:</strong> When I inherit behavior by subclassing, that behavior is set statically at compile time. In addition, all subclasses must inherit the same behavior. If however, I can extend an object’s behavior through composition, then I can do this dynamically at runtime.</em></p>
<p><em><strong>Guru:</strong> Very good; you are beginning to see the power of composition.</em></p>
<p><em><strong>Student:</strong> Yes, it is possible for me to add multiple new responsibilities to objects through this technique, including responsibilities that were not even thought of by the designer of the superclass. And, I don’t have to touch their code!</em></p>
<p><em><strong>Guru:</strong> What have you learned about the effect of composition on maintaining your code?</em></p>
<p><em><strong>Student:</strong> Well, that is what I was getting at. By dynamically composing objects, I can add new functionality by writing new code rather than altering existing code. Because I’m not changing existing code, the chances of introducing bugs or causing unintended side effects in pre-existing code are much reduced.</em></p>
<p><em><strong>Guru:</strong> Very good. Enough for today, I would like for you to go and meditate further on this topic... Remember, code should be closed (to change) like the lotus flower in the evening, yet open (to extension) like the lotus flower in the morning.</em></p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Open-Closed Principle"><div class="sect1" id="the_open-closed_principle">
<h1>The Open-Closed Principle</h1>
<p><strong>We’re on to one of the most important design principles:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0088-01.png" alt="Images" width="495" height="160" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0088-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0088-02.png" alt="Images" width="322" height="266" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0088-02.png">
<h6></h6>
</div></figure>
<p>Come on in; we’re <em>open</em>. Feel free to extend our classes with any new behavior you like. If your needs or requirements change (and we know they will), just go ahead and make your own extensions.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0088-03.png" alt="Images" width="270" height="292" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0088-03.png">
<h6></h6>
</div></figure>
<p>Sorry, we’re <em>closed</em>. That’s right, we spent a lot of time getting this code correct and bug free, so we can’t let you alter the existing code. It must remain closed to modification. If you don’t like it, you can speak to the manager.</p>
<p><strong>Our goal is to allow classes to be easily extended to incorporate new behavior without modifying existing code. What do we get if we accomplish this? Designs that are resilient to change and flexible enough to take on new functionality to meet changing requirements.</strong></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0001104">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Open for extension and closed for modification? That sounds very contradictory. How can a design be both?</strong></p>
<p><strong>A</strong>: That’s a very good question. It certainly sounds contradictory at first. After all, the less modifiable something is, the harder it is to extend, right?</p>
<p>As it turns out, though, there are some clever OO techniques for allowing systems to be extended, even if we can’t change the underlying code. Think about the Observer Pattern (in <a data-type="xref" href="ch02.html#the_observer_pattern_keeping_your_object">Chapter 2</a>)... by adding new Observers, we can extend the Subject at any time, without adding code to the Subject. You’ll see quite a few more ways of extending behavior with other OO design techniques.</p>
<p><strong>Q: Okay, I understand Observable, but how do I generally design something to be extensible, yet closed for modification?</strong></p>
<p><strong>A</strong>: Many of the patterns give us time-tested designs that protect your code from being modified by supplying a means of extension. In this chapter you’ll see a good example of using the Decorator Pattern to follow the Open-Closed principle.</p>
<p><strong>Q: How can I make every part of my design follow the Open-Closed Principle?</strong></p>
<p><strong>A</strong>: Usually, you can’t. Making OO design flexible and open to extension without the modification of existing code takes time and effort. In general, we don’t have the luxury of tying down every part of our designs (and it would probably be wasteful). Following the Open-Closed Principle usually introduces new levels of abstraction, which adds complexity to our code. You want to concentrate on those areas that are most likely to change in your designs and apply the principles there.</p>
<p><strong>Q: How do I know which areas of change are more important?</strong></p>
<p><strong>A</strong>: That is partly a matter of experience in designing OO systems and also a matter of knowing the domain you are working in. Looking at other examples will help you learn to identify areas of change in your own designs.</p>
</div></aside>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>While it may seem like a contradiction, there are techniques for allowing code to be extended without direct modification.</strong></p>
</div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Be careful when choosing the areas of code that need to be extended; applying the Open-Closed Principle EVERYWHERE is wasteful and unnecessary, and can lead to complex, hard-to-understand code.</strong></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Meet the Decorator Pattern"><div class="sect1" id="meet_the_decorator_pattern">
<h1>Meet the Decorator Pattern</h1>
<p>Okay, we’ve seen that representing our beverage and condiments with inheritance has not worked out very well—we get class explosions and rigid designs, or we add functionality to the base class that isn’t appropriate for some of the subclasses.</p>
<p>So, here’s what we’ll do instead: we’ll start with a beverage and “decorate” it with the condiments at runtime. For example, if the customer wants a Dark Roast with Mocha and Whip, then we’ll:</p>
<ol>
<li><p><strong>Take a DarkRoast object</strong></p></li>
<li><p><strong>Decorate it with a Mocha object</strong></p></li>
<li><p><strong>Decorate it with a Whip object</strong></p></li>
<li><p><strong>Call the cost() method and rely on delegation to add up the condiment costs</strong></p></li>
</ol>
<p>Okay, but how do you “decorate” an object, and how does delegation come into this? A hint: think of decorator objects as “wrappers.” Let’s see how this works...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0090-01.png" alt="Images" width="514" height="991" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0090-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Constructing a drink order with Decorators"><div class="sect1" id="constructing_a_drink_order_with_decorato">
<h1>Constructing a drink order with Decorators</h1>
<ol>
<li><p><strong>We start with our DarkRoast object.</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0091-01.png" alt="Images" width="536" height="206" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0091-01.png">
<h6></h6>
</div></figure></li>
<li><p><strong>The customer wants Mocha, so we create a Mocha object and wrap it around the DarkRoast.</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0091-02.png" alt="Images" width="748" height="337" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0091-02.png">
<h6></h6>
</div></figure></li>
<li><p><strong>The customer also wants Whip, so we create a Whip decorator and wrap Mocha with it.</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0091-03.png" alt="Images" width="701" height="340" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0091-03.png">
<h6></h6>
</div></figure></li>
<li><p><strong>Now it’s time to compute the cost for the customer. We do this by calling cost() on the outermost decorator, Whip, and Whip is going to delegate computing the cost to the objects it decorates. And so on. Let’s see how this works:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0092-01.png" alt="Images" width="876" height="568" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0092-01.png">
<h6></h6>
</div></figure></li>
</ol>
<section data-type="sect2" data-pdf-bookmark="Okay, here’s what we know about Decorators, so far..."><div class="sect2" id="okaycomma_hereapostrophes_what_we_know_a">
<h2>Okay, here’s what we know about Decorators, so far...</h2>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0092-02.png" alt="Images" width="895" height="269" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0092-02.png">
<h6></h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Now let’s see how this all really works by looking at the Decorator Pattern definition and writing some code.</strong></p>
</div>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Decorator Pattern defined"><div class="sect1" id="the_decorator_pattern_defined">
<h1>The Decorator Pattern defined</h1>
<p>Let’s first take a look at the Decorator Pattern description:</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="the_decorator">
<p><strong>The Decorator Pattern</strong> attaches additional responsibilities to an object dynamically. Decorators provide a flexible alternative to subclassing for extending functionality.</p>
</div></aside>
<p>While that describes the <em>role</em> of the Decorator Pattern, it doesn’t give us a lot of insight into how we’d <em>apply</em> the pattern to our own implementation. Let’s take a look at the class diagram, which is a little more revealing (on the next page we’ll look at the same structure applied to the beverage problem).</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0093-01.png" alt="Images" width="1080" height="804" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0093-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Decorating our Beverages"><div class="sect1" id="decorating_our_beverages">
<h1>Decorating our Beverages</h1>
<p><strong>Let’s rework our Starbuzz beverages using the Decorator pattern...</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0094-01.png" alt="Images" width="1106" height="750" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0094-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000190">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Inline" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>Before going further, think about how you’d implement the cost() method of the coffees and the condiments. Also think about how you’d implement the getDescription() method of the condiments.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Cubicle Conversation"><div class="sect1" id="cubicle_conversati">
<h1>Cubicle Conversation</h1>
<p><strong>Some confusion over Inheritance versus Composition</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0095-01.png" alt="Images" width="616" height="656" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0095-01.png">
<h6></h6>
</div></figure>
<p><strong>Sue:</strong> What do you mean?</p>
<p><strong>Mary:</strong> Look at the class diagram. The CondimentDecorator is extending the Beverage class. That’s inheritance, right?</p>
<p><strong>Sue:</strong> True. I think the point is that it’s vital that the decorators have the same type as the objects they are going to decorate. So here we’re using inheritance to achieve the <em>type matching</em>, but we aren’t using inheritance to get <em>behavior</em>.</p>
<p><strong>Mary:</strong> Okay, I can see how decorators need the same “interface” as the components they wrap because they need to stand in place of the component. But where does the behavior come in?</p>
<p><strong>Sue:</strong> When we compose a decorator with a component, we are adding new behavior. We are acquiring new behavior not by <em>inheriting</em> it from a superclass, but by <em>composing</em> objects together.</p>
<p><strong>Mary:</strong> Okay, so we’re subclassing the abstract class Beverage in order to have the correct type, not to inherit its behavior. The behavior comes in through the composition of decorators with the base components as well as other decorators.</p>
<p><strong>Sue:</strong> That’s right.</p>
<p><strong>Mary:</strong> Oh, I get it! And because we are using object composition, we get a whole lot more flexibility about how to mix and match condiments and beverages. Very slick.</p>
<p><strong>Sue:</strong> Yes, if we rely on inheritance, then our behavior can only be determined statically at compile time. In other words, we get only whatever behavior the superclass gives us or that we override. With composition, we can mix and match decorators any way we like... <em>at runtime</em>.</p>
<p><strong>Mary:</strong> I get it—we can implement new decorators at any time to add new behavior. If we relied on inheritance, we’d have to go in and change existing code any time we wanted new behavior.</p>
<p><strong>Sue:</strong> Exactly.</p>
<p><strong>Mary:</strong> I just have one more question: if all we need to inherit is the type of the component, how come we didn’t use an interface instead of an abstract class for the Beverage class?</p>
<p><strong>Sue:</strong> Well, remember, when we got this code, Starbuzz already <em>had</em> an abstract Beverage class. Traditionally the Decorator Pattern does specify an abstract component, but in Java, obviously, we could use an interface. But we always try to avoid altering existing code, so don’t “fix” it if the abstract class will work just fine.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="New barista training"><div class="sect1" id="new_barista_training">
<h1>New barista training</h1>
<p>Make a picture for what happens when the order is for a “double mocha soy latte with whip” beverage. Use the menu to get the correct prices, and draw your picture using the same format we used earlier (from a few pages back):</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0096-01.png" alt="Images" width="666" height="282" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0096-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0096-02.png" alt="Images" width="1102" height="1304" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0096-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Writing the Starbuzz code"><div class="sect1" id="writing_the_starbuzz_code">
<h1>Writing the Starbuzz code</h1>
<p><strong>It’s time to whip this design into some real code.</strong></p>
<p><strong>Let’s start with the Beverage class, which doesn’t need to change from Starbuzz’s original design. Let’s take a look:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0097-01.png" alt="Images" width="100" height="157" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0097-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0097-02.png" alt="Images" width="888" height="314" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0097-02.png">
<h6></h6>
</div></figure>
<p><strong>Beverage is simple enough. Let’s implement the abstract class for the Condiments (the Decorator) as well:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0097-03.png" alt="Images" width="1009" height="461" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0097-03.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Coding beverages"><div class="sect1" id="coding_beverages">
<h1>Coding beverages</h1>
<p><strong>Now that we’ve got our base classes out of the way, let’s implement some beverages. We’ll start with Espresso. Remember, we need to set a description for the specific beverage and also implement the cost() method.</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0098-01.png" alt="Images" width="935" height="1029" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0098-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Coding condiments"><div class="sect1" id="coding_condiments">
<h1>Coding condiments</h1>
<p><strong>If you look back at the Decorator Pattern class diagram, you’ll see we’ve now written our abstract component (Beverage), we have our concrete components (HouseBlend), and we have our abstract decorator (CondimentDecorator). Now it’s time to implement the concrete decorators. Here’s Mocha:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0099-01.png" alt="Images" width="1033" height="872" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0099-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-id000101">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3.png" alt="Inline" width="123" height="103" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3.png"></span> Exercise</h5>
<p>Write and compile the code for the other Soy and Whip condiments. You’ll need them to finish and test the application.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Serving some coffees"><div class="sect1" id="serving_some_coffees">
<h1>Serving some coffees</h1>
<p>Congratulations. It’s time to sit back, order a few coffees, and marvel at the flexible design you created with the Decorator Pattern.</p>
<p><strong>Here’s some test code to make orders:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0100-01.png" alt="Images" width="1086" height="818" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0100-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0100-02.png" alt="Images" width="728" height="194" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0100-02.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0001105">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: I’m a little worried about code that might test for a specific concrete component—say, HouseBlend—and do something, like issue a discount. Once I’ve wrapped the HouseBlend with decorators, this isn’t going to work anymore.</strong></p>
<p>A: That is exactly right. If you have code that relies on the concrete component’s type, decorators will break that code. As long as you only write code against the abstract component type, the use of decorators will remain transparent to your code. However, once you start writing code against concrete components, you’ll want to rethink your application design and your use of decorators.</p>
<p><strong>Q: Wouldn’t it be easy for some client of a beverage to end up with a decorator that isn’t the outermost decorator? Like if I had a DarkRoast with Mocha, Soy, and Whip, it would be easy to write code that somehow ended up with a reference to Soy instead of Whip, which means it would not include Whip in the order.</strong></p>
<p>A: You could certainly argue that you have to manage more objects with the Decorator Pattern and so there is an increased chance that coding errors will introduce the kinds of problems you suggest. However, decorators are typically created by using other patterns like Factory and Builder. Once we’ve covered these patterns, you’ll see that the creation of the concrete component with its decorator is “well encapsulated” and doesn’t lead to these kinds of problems.</p>
<p><strong>Q: Can decorators know about the other decorations in the chain? Say I wanted my getDescription() method to print “Whip, Double Mocha” instead of “Mocha, Whip, Mocha.” That would require that my outermost decorator know all the decorators it is wrapping.</strong></p>
<p>A: Decorators are meant to add behavior to the object they wrap. When you need to peek at multiple layers into the decorator chain, you are starting to push the decorator beyond its true intent. Nevertheless, such things are possible. Imagine a CondimentPrettyPrint decorator that parses the final decription and can print “Mocha, Whip, Mocha” as “Whip, Double Mocha.” Note that getDescription() could return an ArrayList of descriptions to make this easier.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00308">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Inline" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>Our friends at Starbuzz have introduced sizes to their menu. You can now order a coffee in tall, grande, and venti sizes (translation: small, medium, and large). Starbuzz saw this as an intrinsic part of the coffee class, so they’ve added two methods to the Beverage class: setSize() and getSize(). They’d also like for the condiments to be charged according to size, so for instance, Soy costs 10¢, 15¢, and 20¢, respectively, for tall, grande, and venti coffees. The updated Beverage class is shown below.</p>
<p>How would you alter the decorator classes to handle this change in requirements?</p>
<pre data-type="programlisting"><strong>public abstract class Beverage {</strong>
       <span style="background-color:#DCDDDF;"><strong>public enum Size { TALL, GRANDE, VENTI }; </strong></span>
       <span style="background-color:#DCDDDF;"><strong>Size size = Size.TALL;</strong>                    </span>
       <strong>String description = “Unknown Beverage”;</strong>
       <strong>public String getDescription() {</strong>
              <strong>return description;</strong>
       <strong>}</strong>
       <span style="background-color:#DCDDDF;"><strong>public void setSize(Size size) {  </strong></span>
       <span style="background-color:#DCDDDF;">       <strong>this.size = size;</strong>          </span>
       <span style="background-color:#DCDDDF;"><strong>}                                 </strong></span>
       <span style="background-color:#DCDDDF;"><strong>public Size getSize() {</strong>           </span>
       <span style="background-color:#DCDDDF;">       <strong>return this.size;</strong>          </span>
       <span style="background-color:#DCDDDF;"><strong>}                                 </strong></span>
       <strong>public abstract double cost();</strong>
   <strong>}</strong></pre>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Real World Decorators: Java I/O"><div class="sect1" id="real_world_decorators_java_isoliduso">
<h1>Real World Decorators: Java I/O</h1>
<p>The large number of classes in the java.io package is... <em>overwhelming</em>. Don’t feel alone if you said “whoa” the first (and second and third) time you looked at this API. But now that you know the Decorator Pattern, the I/O classes should make more sense since the java.io package is largely based on Decorator. Here’s a typical set of objects that use decorators to add functionality to reading data from a file:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0101-01.png" alt="Images" width="958" height="610" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0101-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Decorating the java.io classes"><div class="sect1" id="decorating_the_javadotio_classes">
<h1>Decorating the java.io classes</h1>
<p>BufferedInputStream and ZipInputStream both extend FilterInputStream, which extends InputStream. InputStream acts as the abstract decorator class:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0102-01.png" alt="Images" width="1111" height="518" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0102-01.png">
<h6></h6>
</div></figure>
<p>You can see that this isn’t so different from the Starbuzz design. You should now be in a good position to look over the java.io API docs and compose decorators on the various <em>input</em> streams.</p>
<p>You’ll see that the <em>output</em> streams have the same design. And you’ve probably already found that the Reader/Writer streams (for character-based data) closely mirror the design of the streams classes (with a few differences and inconsistencies, but close enough to figure out what’s going on).</p>
<p>Java I/O also points out one of the <em>downsides</em> of the Decorator Pattern: designs using this pattern often result in a large number of small classes that can be overwhelming to a developer trying to use the Decorator-based API. But now that you know how Decorator works, you can keep things in perspective and when you’re using someone else’s Decorator-heavy API, you can work through how their classes are organized so that you can easily use wrapping to get the behavior you’re after. </p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Writing your own Java I/O Decorator"><div class="sect1" id="writing_your_own_java_isoliduso_decorato">
<h1>Writing your own Java I/O Decorator</h1>
<p>Okay, you know the Decorator Pattern, you’ve seen the I/O class diagram. You should be ready to write your own input decorator.</p>
<p>How about this: write a decorator that converts all uppercase characters to lowercase in the input stream. In other words, if we read in “I know the Decorator Pattern therefore I RULE!” then your decorator converts this to “i know the decorator pattern therefore i rule!”</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0103-01.png" alt="Images" width="436" height="637" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0103-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0103-02.png" alt="Images" width="1094" height="890" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0103-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Test out your new Java I/O Decorator"><div class="sect1" id="test_out_your_new_java_isoliduso_decorat">
<h1>Test out your new Java I/O Decorator</h1>
<p>Write some quick code to test the I/O decorator:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0104-01.png" alt="Images" width="1096" height="678" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0104-01.png">
<h6></h6>
</div></figure>
<p><strong>Give it a spin:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0104-02.png" alt="Images" width="731" height="194" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0104-02.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="patterns_exposed-id000101">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0105-01.png" alt="Inline" width="167" height="154" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0105-01.png"></span> Patterns Exposed</h5>
<p><strong>This week’s interview: Confessions of a Decorator</strong></p>
<p><strong>Head First:</strong> Welcome, Decorator Pattern. We’ve heard that you’ve been a bit down on yourself lately?</p>
<p><strong>Decorator:</strong> Yes, I know the world sees me as the glamorous design pattern, but you know, I’ve got my share of problems just like everyone.</p>
<p><strong>HeadFirst:</strong> Can you perhaps share some of your troubles with us?</p>
<p><strong>Decorator:</strong> Sure. Well, you know I’ve got the power to add flexibility to designs, that much is for sure, but I also have a <em>dark side</em>. You see, I can sometimes add a lot of small classes to a design and this occasionally results in a design that’s less than straightforward for others to understand.</p>
<p><strong>HeadFirst:</strong> Can you give us an example?</p>
<p><strong>Decorator:</strong> Take the Java I/O libraries. These are notoriously difficult for people to understand at first. But if they just saw the classes as a set of wrappers around an InputStream, life would be much easier.</p>
<p><strong>HeadFirst:</strong> That doesn’t sound so bad. You’re still a great pattern, and improving this is just a matter of public education, right?</p>
<p><strong>Decorator:</strong> There’s more, I’m afraid. I’ve got typing problems: you see, people sometimes take a piece of client code that relies on specific types and introduce decorators without thinking through everything. Now, one great thing about me is that <em>you can usually insert decorators transparently and the client never has to know it’s dealing with a decorator.</em> But like I said, some code is dependent on specific types and when you start introducing decorators, boom! Bad things happen.</p>
<p><strong>HeadFirst:</strong> Well, I think everyone understands that you have to be careful when inserting decorators. I don’t think this is a reason to be too down on yourself.</p>
<p><strong>Decorator:</strong> I know, I try not to be. I also have the problem that introducing decorators can increase the complexity of the code needed to instantiate the component. Once you’ve got decorators, you’ve got to not only instantiate the component, but also wrap it with who knows how many decorators.</p>
<p><strong>HeadFirst:</strong> I’ll be interviewing the Factory and Builder patterns next week—I hear they can be very helpful with this?</p>
<p><strong>Decorator:</strong> That’s true; I should talk to those guys more often.</p>
<p><strong>HeadFirst:</strong> Well, we all think you’re a great pattern for creating flexible designs and staying true to the Open-Closed Principle, so keep your chin up and think positively!</p>
<p><strong>Decorator:</strong> I’ll do my best, thank you.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Tools for your Design Toolbox"><div class="sect1" id="tools_for_your_design_toolb">
<h1><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0107-01.png" alt="Inline" width="120" height="115" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0107-01.png"></span> Tools for your Design Toolbox</h1>
<p>You’ve got another chapter under your belt and a new principle and pattern in the toolbox.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0107-02.png" alt="Images" width="697" height="1083" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0107-02.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id003141">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0107-03.png" alt="Inline" width="118" height="77" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0107-03.png"></span> BULLET POINTS</h5>
<ul>
<li><p>Inheritance is one form of extension, but not necessarily the best way to achieve flexibility in our designs.</p></li>
<li><p>In our designs we should allow behavior to be extended without the need to modify existing code.</p></li>
<li><p>Composition and delegation can often be used to add new behaviors at runtime.</p></li>
<li><p>The Decorator Pattern provides an alternative to subclassing for extending behavior.</p></li>
<li><p>The Decorator Pattern involves a set of decorator classes that are used to wrap concrete components.</p></li>
<li><p>Decorator classes mirror the type of the components they decorate. (In fact, they are the same type as the components they decorate, either through inheritance or interface implementation.)</p></li>
<li><p>Decorators change the behavior of their components by adding new functionality before and/or after (or even in place of) method calls to the component.</p></li>
<li><p>You can wrap a component with any number of decorators.</p></li>
<li><p>Decorators are typically transparent to the client of the component; that is, unless the client is relying on the component’s concrete type.</p></li>
<li><p>Decorators can result in many small objects in our design, and overuse can be complex.</p></li>
</ul>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id004104">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Inline" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>Write the <code>cost()</code> methods for the following classes (pseudo-Java is okay). Here’s our solution:</p>
<pre data-type="programlisting"><strong>public class Beverage {</strong>

<strong>// declare instance variables for milkCost,</strong>
<strong>// soyCost, mochaCost, and whipCost, and</strong>
<strong>// getters and setters for milk, soy, mocha</strong>
<strong>// and whip.</strong> 

<strong>public double cost() {</strong>

        <strong>float condimentCost = 0.0;</strong>
        <strong>if (hasMilk()) {</strong>
            <strong>condimentCost += milkCost;</strong>
        <strong>}</strong>
        <strong>if (hasSoy()) {</strong>
            <strong>condimentCost += soyCost;</strong>
        <strong>}</strong>
        <strong>if (hasMocha()) {</strong>
            <strong>condimentCost += mochaCost;</strong>
        <strong>}</strong>
        <strong>if (hasWhip()) {</strong>
            <strong>condimentCost += whipCost;</strong>
        <strong>}</strong>
        <strong>return condimentCost;</strong>
      <strong>}</strong>
    <strong>}</strong>

    <strong>public class DarkRoast extends Beverage {</strong>

       <strong>public DarkRoast() {</strong>
          <strong>description = “Most Excellent Dark Roast”;</strong>
       <strong>}</strong>

       <strong>public double cost() {</strong>
          <strong>return 1.99 + super.cost();</strong>
       <strong>}</strong>
   <strong>}</strong></pre>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id000105">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Inline" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p><strong>New barista training</strong></p>
<p>“double mocha soy latte with whip”</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0108-01.png" alt="Images" width="1063" height="579" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0108-01.png">
<h6></h6>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id000106">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Inline" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>Our friends at Starbuzz have introduced sizes to their menu. You can now order a coffee in tall, grande, and venti sizes (for us normal folk: small, medium, and large). Starbuzz saw this as an intrinsic part of the coffee class, so they’ve added two methods to the Beverage class: setSize() and getSize(). They’d also like for the condiments to be charged according to size, so for instance, Soy costs 10¢, 15¢, and 20¢, respectively, for tall, grande, and venti coffees.</p>
<p>How would you alter the decorator classes to handle this change in requirements? Here’s our solution.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0110-01.png" alt="Images" width="945" height="945" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0110-01.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
</div></section><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. The Factory Pattern: Baking with OO Goodness"><div class="chapter" id="the_factory_pattern_baking_with_oo_goodn">
<h1><span class="label">Chapter 4. </span>The Factory Pattern: Baking with OO Goodness</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0111-01.png" alt="Images" width="593" height="731" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0111-01.png">
<h6></h6>
</div></figure>
<p><strong>Get ready to bake some loosely coupled OO designs.</strong> There is more to making objects than just using the <strong>new</strong> operator. You’ll learn that instantiation is an activity that shouldn’t always be done in public and can often lead to <em>coupling problems</em>. And we don’t want <em>that</em>, do we? Find out how Factory Patterns can help save you from embarrassing dependencies.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0112-01.png" alt="Images" width="562" height="789" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0112-01.png">
<h6></h6>
</div></figure>
<p><strong>When you see “new,” think “concrete.”</strong></p>
<p>Yes, when you use the <strong>new</strong> operator you are certainly instantiating a concrete class, so that’s definitely an implementation and not an interface. And, you make a good observation: that tying your code to a concrete class can make it more fragile and less flexible.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0112-02.png" alt="Images" width="581" height="151" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0112-02.png">
<h6></h6>
</div></figure>
<p>When we have a whole set of related concrete classes, often we end up writing code like this:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0112-03.png" alt="Images" width="671" height="251" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0112-03.png">
<h6></h6>
</div></figure>
<p>Here we’ve got several concrete classes being instantiated, and the decision of which to instantiate is made at runtime depending on some set of conditions.</p>
<p>When you see code like this, you know that when it comes time for changes or extensions, you’ll have to reopen this code and examine what needs to be added (or deleted). Often this kind of code ends up in several parts of the application making maintenance and updates more difficult and error-prone.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0113-01.png" alt="Images" width="550" height="531" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0113-01.png">
<h6></h6>
</div></figure>
<p><strong>What’s wrong with “new”?</strong></p>
<p>Technically there’s nothing wrong with the <strong>new</strong> operator. After all, it’s a fundamental part most modern object-oriented languages. The real culprit is our old friend CHANGE and how change impacts our use of <strong>new</strong>.</p>
<p>By coding to an interface, you know you can insulate yourself from many of the changes that might happen to a system down the road. Why? If your code is written to an interface, then it will work with any new classes implementing that interface through polymorphism. However, when you have code that makes use of lots of concrete classes, you’re looking for trouble because that code may have to be changed as new concrete classes are added. So, in other words, your code will not be “closed for modification.” To extend your code with new concrete types, you’ll have to reopen it.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><em>Remember that designs should be “open for extension but closed for modification” - see <a data-type="xref" href="ch03.html#the_decorator_pattern_decorating_objects">Chapter 3</a> for a review.</em></p>
</div>
<p>So what can you do? It’s times like these that you can fall back on OO design principles to look for clues. Remember, our first principle deals with change and guides us to <em>identify the aspects that vary and separate them from what stays the same</em>.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000191">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Inline" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>How might you take all the parts of your application that instantiate concrete classes and separate or encapsulate them from the rest of your application?</p>
</div></aside>
<section data-type="sect1" data-pdf-bookmark="Identifying the aspects that vary"><div class="sect1" id="identif_ying_the_aspects_that_vary">
<h1>Identifying the aspects that vary</h1>
<p>Let’s say you have a pizza shop, and as a cutting-edge pizza store owner in Objectville you might end up writing some code like this:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0114-01.png" alt="Images" width="317" height="288" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0114-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0114-02.png" alt="Images" width="844" height="291" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0114-02.png">
<h6></h6>
</div></figure>
<p><strong>But you need more than one type of pizza...</strong></p>
<p>So then you’d add some code that <em>determines</em> the appropriate type of pizza and then goes about <em>making</em> the pizza:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0114-03.png" alt="Images" width="929" height="595" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0114-03.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="But the pressure is on to add more pizza types"><div class="sect1" id="but_the_pressure_is_on_to_add_more_pizza">
<h1>But the pressure is on to add more pizza types</h1>
<p>You realize that all of your competitors have added a couple of trendy pizzas to their menus: the Clam Pizza and the Veggie Pizza. Obviously you need to keep up with the competition, so you’ll add these items to your menu. And you haven’t been selling many Greek pizzas lately, so you decide to take that off the menu:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0115-01.png" alt="Images" width="1089" height="853" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0115-01.png">
<h6></h6>
</div></figure>
<p>Clearly, dealing with <em>which</em> concrete class is instantiated is really messing up our orderPizza() method and preventing it from being closed for modification. But now that we know what is varying and what isn’t, it’s probably time to encapsulate it.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Encapsulating object creation"><div class="sect1" id="encapsulating_object_creation">
<h1>Encapsulating object creation</h1>
<p>So now we know we’d be better off moving the object creation out of the orderPizza() method. But how? Well, what we’re going to do is take the creation code and move it out into another object that is only going to be concerned with creating pizzas.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0116-01.png" alt="Images" width="1037" height="958" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0116-01.png">
<h6></h6>
</div></figure>
<p><strong>We’ve got a name for this new object: we call it a Factory.</strong></p>
<p>Factories handle the details of object creation. Once we have a SimplePizzaFactory, our orderPizza() method becomes a client of that object. Any time it needs a pizza it asks the pizza factory to make one. Gone are the days when the orderPizza() method needs to know about Greek versus Clam pizzas. Now the orderPizza() method just cares that it gets a pizza that implements the Pizza interface so that it can call prepare(), bake(), cut(), and box().</p>
<p>We’ve still got a few details to fill in here; for instance, what does the orderPizza() method replace its creation code with? Let’s implement a simple factory for the pizza store and find out...</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Building a simple pizza factory"><div class="sect1" id="building_a_simple_pizza_factory">
<h1>Building a simple pizza factory</h1>
<p>We’ll start with the factory itself. What we’re going to do is define a class that encapsulates the object creation for all pizzas. Here it is...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0117-01.png" alt="Images" width="684" height="419" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0117-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0001106">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: What’s the advantage of this? It looks like we are just pushing the problem off to another object.</strong></p>
<p><strong>A</strong>: One thing to remember is that the SimplePizzaFactory may have many clients. We’ve only seen the orderPizza() method; however, there may be a PizzaShopMenu class that uses the factory to get pizzas for their current description and price. We might also have a HomeDelivery class that handles pizzas in a different way than our PizzaShop class but is also a client of the factory.</p>
<p>So, by encapsulating the pizza creating in one class, we now have only one place to make modifications when the implementation changes.</p>
<p>And, don’t forget, we are also just about to remove the concrete instantiations from our client code.</p>
<p><strong>Q: I’ve seen a similar design where a factory like this is defined as a static method. What is the difference?</strong></p>
<p><strong>A</strong>: Defining a simple factory as a static method is a common technique and is often called a static factory. Why use a static method? Because you don’t need to instantiate an object to make use of the create method. But, it also has the disadvantage that you can’t subclass and change the behavior of the create method.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Reworking the PizzaStore class"><div class="sect1" id="reworking_the_pizzastore_class">
<h1>Reworking the PizzaStore class</h1>
<p>Now it’s time to fix up our client code. What we want to do is rely on the factory to create the pizzas for us. Here are the changes:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0118-01.png" alt="Images" width="1016" height="759" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0118-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id002192">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Inline" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>We know that object composition allows us to change behavior dynamically at runtime (among other things) because we can swap in and out implementations. How might we be able to use that in the PizzaStore? What factory implementations might we be able to swap in and out?</p>
<p>We don’t know about you, but we’re thinking New York, Chicago, and California style pizza factories (let’s not forget New Haven, too)</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Simple Factory defined"><div class="sect1" id="the_simple_factory_defined">
<h1>The Simple Factory defined</h1>
<p>The Simple Factory isn’t actually a Design Pattern; it’s more of a programming idiom. But it is commonly used, so we’ll give it a Head First Pattern Honorable Mention. Some developers do mistake this idiom for the “Factory Pattern,” but the next time that happens you can subtly show you know your stuff, just don’t strut as you educate them on the distinction.</p>
<p>Just because Simple Factory isn’t a REAL pattern doesn’t mean we shouldn’t check out how it’s put together. Let’s take a look at the class diagram of our new Pizza Store:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0119-01.png" alt="Images" width="254" height="194" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0119-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0119-02.png" alt="Images" width="1094" height="683" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0119-02.png">
<h6></h6>
</div></figure>
<p>Think of Simple Factory as a warm up. Next, we’ll explore two heavy-duty patterns that are both factories. But don’t worry, there’s more pizza to come!</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>*Just another reminder: in design patterns, the phrase “implement an interface” does NOT always mean “write a class that implements a Java interface, by using the ‘implements’ keyword in the class declaration.” In the general use of the phrase, a concrete class implementing a method from a supertype (which could be a abstract class OR interface) is still considered to be “implementing the interface” of that supertype.</p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Franchising the pizza store"><div class="sect1" id="franchising_the_pizza_store">
<h1>Franchising the pizza store</h1>
<p>Your Objectville PizzaStore has done so well that you’ve trounced the competition and now everyone wants a PizzaStore in their own neighborhood. As the franchiser, you want to ensure the quality of the franchise operations and so you want them to use your time-tested code.</p>
<p>But what about regional differences? Each franchise might want to offer different styles of pizzas (New York, Chicago, and California, to name a few), depending on where the franchise store is located and the tastes of the local pizza connoisseurs.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Yes, different areas of the US serve very different styles of pizza—from the deep-dish pizzas of Chicago, to the thin crust of New York, to the crackerlike pizza of California (some would say topped with fruits and nuts).</p>
</div>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0120-02.png" alt="Images" width="1088" height="448" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0120-02.png">
<h6></h6>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="We’ve seen one approach..."><div class="sect2" id="weapostropheve_seen_one_approachhellip">
<h2>We’ve seen one approach...</h2>
<p>If we take out SimplePizzaFactory and create three different factories—NYPizzaFactory, ChicagoPizzaFactory and CaliforniaPizzaFactory—then we can just compose the PizzaStore with the appropriate factory and a franchise is good to go. That’s one approach.</p>
<p>Let’s see what that would look like...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0121-01.png" alt="Images" width="1051" height="222" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0121-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0121-02.png" alt="Images" width="863" height="274" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0121-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="But you’d like a little more quality control..."><div class="sect2" id="but_youapostrophed_like_a_little_more_qu">
<h2>But you’d like a little more quality control...</h2>
<p>So you test-marketed the SimpleFactory idea, and what you found was that the franchises were using your factory to create pizzas, but starting to employ their own home-grown procedures for the rest of the process: they’d bake things a little differently, they’d forget to cut the pizza and they’d use third-party boxes.</p>
<p>Rethinking the problem a bit, you see that what you’d really like to do is create a framework that ties the store and the pizza creation together, yet still allows things to remain flexible.</p>
<p>In our early code, before the SimplePizzaFactory, we had the pizza-making code tied to the PizzaStore, but it wasn’t flexible. So, how can we have our pizza and eat it too?</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0121-03.png" alt="Images" width="567" height="679" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0121-03.png">
<h6></h6>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="A framework for the pizza store"><div class="sect1" id="a_framework_for_the_pizza_store">
<h1>A framework for the pizza store</h1>
<p>There <em>is</em> a way to localize all the pizza-making activities to the PizzaStore class, <em>and</em> to give the franchises freedom to have their own regional style.</p>
<p>What we’re going to do is put the createPizza() method back into PizzaStore, but this time as an <u>abstract method</u>, and then create a PizzaStore subclass for each regional style.</p>
<p>First, let’s look at the changes to the PizzaStore:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0122-01.png" alt="Images" width="928" height="809" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0122-01.png">
<h6></h6>
</div></figure>
<p>Now we’ve got a store waiting for subclasses; we’re going to have a subclass for each regional type (NYPizzaStore, ChicagoPizzaStore, CaliforniaPizzaStore) and each subclass is going to make the decision about what makes up a pizza. Let’s take a look at how this is going to work.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Allowing the subclasses to decide"><div class="sect1" id="allowing_the_subclasses_to_decide">
<h1>Allowing the subclasses to decide</h1>
<p>Remember, the PizzaStore already has a well-honed order system in the orderPizza() method and you want to ensure that it’s consistent across all franchises.</p>
<p>What varies among the regional PizzaStores is the style of pizzas they make—New York Pizza has thin crust, Chicago Pizza has thick, and so on—and we are going to push all these variations into the createPizza() method and make it responsible for creating the right kind of pizza. The way we do this is by letting each subclass of PizzaStore define what the createPizza() method looks like. So, we will have a number of concrete subclasses of PizzaStore, each with its own pizza variations, all fitting within the PizzaStore framework and still making use of the well-tuned orderPizza() method.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0123-01.png" alt="Images" width="1084" height="931" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0123-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0124-01.png" alt="Images" width="580" height="791" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0124-01.png">
<h6></h6>
</div></figure>
<p>Well, think about it from the point of view of the PizzaStore’s orderPizza() method: it is defined in the abstract PizzaStore, but concrete types are only created in the subclasses.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0124-02.png" alt="Images" width="679" height="138" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0124-02.png">
<h6></h6>
</div></figure>
<p>Now, to take this a little further, the orderPizza() method does a lot of things with a Pizza object (like prepare, bake, cut, box), but because Pizza is abstract, orderPizza() has no idea what real concrete classes are involved. In other words, it’s decoupled!</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0124-03.png" alt="Images" width="622" height="292" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0124-03.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0124-04.png" alt="Images" width="806" height="218" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0124-04.png">
<h6></h6>
</div></figure>
<p>So, is there a real-time decision that subclasses make? No, but from the perspective of orderPizza(), if you chose a NYStylePizzaStore, that subclass gets to determine which pizza is made. So the subclasses aren’t really “deciding”—it was <em>you</em> who decided by choosing which store you wanted—but they do determine which kind of pizza gets made.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Let’s make a PizzaStore"><div class="sect1" id="letapostrophes_make_a_pizzastore">
<h1>Let’s make a PizzaStore</h1>
<p>Being a franchise has its benefits. You get all the PizzaStore functionality for free. All the regional stores need to do is subclass PizzaStore and supply a createPizza() method that implements their style of Pizza. We’ll take care of the big three pizza styles for the franchisees.</p>
<p>Here’s the New York regional style:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0125-01.png" alt="Images" width="1063" height="744" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0125-01.png">
<h6></h6>
</div></figure>
<p>Once we’ve got our PizzaStore subclasses built, it will be time to see about ordering up a pizza or two. But before we do that, why don’t you take a crack at building the Chicago Style and California Style pizza stores on the next page.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id05310">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Inline" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>We’ve knocked out the NYPizzaStore; just two more to go and we’ll be ready to franchise! Write the Chicago and California PizzaStore implementations here:</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Declaring a factory method"><div class="sect1" id="declaring_a_factory_method">
<h1>Declaring a factory method</h1>
<p>With just a couple of transformations to the PizzaStore we’ve gone from having an object handle the instantiation of our concrete classes to a set of subclasses that are now taking on that responsibility. Let’s take a closer look:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0126-01.png" alt="Images" width="1024" height="669" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0126-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="code_up_close-id000101">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-4.png" alt="Inline" width="70" height="55" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-4.png"></span> Code Up Close</h5>
<p>A <u>factory method</u> handles object creation and encapsulates it in a subclass. This decouples the client code in the superclass from the object creation code in the subclass.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0126-01a.png" alt="Images" width="999" height="336" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0126-01a.png">
<h6></h6>
</div></figure>
</div></aside>
<section data-type="sect2" data-pdf-bookmark="Let’s see how it works: ordering pizzas with the pizza factory method"><div class="sect2" id="letapostrophes_see_how_it_works_ordering">
<h2>Let’s see how it works: ordering pizzas with the pizza factory method</h2>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0128-01.png" alt="Images" width="875" height="595" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0128-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="So how do they order?"><div class="sect2" id="so_how_do_they_orderquestion_mark">
<h2>So how do they order?</h2>
<ol>
<li><p>First, Joel and Ethan need an instance of a PizzaStore. Joel needs to instantiate a ChicagoPizzaStore and Ethan needs a NYPizzaStore.</p></li>
<li><p>With a PizzaStore in hand, both Ethan and Joel call the orderPizza() method and pass in the type of pizza they want (cheese, veggie, and so on).</p></li>
<li><p>To create the pizzas, the createPizza() method is called, which is defined in the two subclasses NYPizzaStore and ChicagoPizzaStore. As we defined them, the NYPizzaStore instantiates a NY style pizza, and the ChicagoPizzaStore instantiates a Chicago style pizza. In either case, the Pizza is returned to the orderPizza() method.</p></li>
<li><p>The orderPizza() method has no idea what kind of pizza was created, but it knows it is a pizza and it prepares, bakes, cuts, and boxes it for Ethan and Joel.</p></li>
</ol>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Let’s check out how these pizzas are really made to order..."><div class="sect2" id="letapostrophes_check_out_how_these_pizza">
<h2>Let’s check out how these pizzas are really made to order...</h2>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0129-01.png" alt="Images" width="258" height="118" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0129-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0129-02.png" alt="Images" width="1037" height="1098" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0129-02.png">
<h6></h6>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We’re just missing one thing: Pizzas!"><div class="sect1" id="weapostrophere_just_missing_one_thing_pi">
<h1>We’re just missing one thing: Pizzas!</h1>
<section data-type="sect2" data-pdf-bookmark="Our PizzaStore isn’t going to be very popular without some pizzas, so let’s implement them:"><div class="sect2" id="our_pizzastore_isnapostrophet_going_to_b">
<h2>Our PizzaStore isn’t going to be very popular without some pizzas, so let’s implement them:</h2>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0130-01.png" alt="Images" width="317" height="288" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0130-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0130-02.png" alt="Images" width="1101" height="1068" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0130-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Now we just need some concrete subclasses... how about defining New York and Chicago st yle cheese pizzas?"><div class="sect2" id="now_we_just_need_some_concrete_subclasse">
<h2>Now we just need some concrete subclasses... how about defining New York and Chicago st yle cheese pizzas?</h2>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0131-01.png" alt="Images" width="981" height="1024" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0131-01.png">
<h6></h6>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="You’ve waited long enough. Time for some pizzas!"><div class="sect1" id="youapostropheve_waited_long_enoughdot_ti">
<h1>You’ve waited long enough. Time for some pizzas!</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0132-01.png" alt="Images" width="1046" height="489" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0132-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0132-02.png" alt="Images" width="977" height="648" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0132-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="It’s finally time to meet the Factory Method Pattern"><div class="sect1" id="itapostrophes_finally_time_to_meet_the_f">
<h1>It’s finally time to meet the Factory Method Pattern</h1>
<p>All factory patterns encapsulate object creation. The Factory Method Pattern encapsulates object creation by letting subclasses decide what objects to create. Let’s check out these class diagrams to see who the players are in this pattern:</p>
<section data-type="sect2" data-pdf-bookmark="The Creator classes"><div class="sect2" id="the_creator_classes">
<h2>The Creator classes</h2>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0133-01.png" alt="Images" width="1047" height="505" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0133-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="The Product classes"><div class="sect2" id="the_product_classes">
<h2>The Product classes</h2>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0133-02.png" alt="Images" width="955" height="406" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0133-02.png">
<h6></h6>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="View Creators and Products in Parallel"><div class="sect1" id="view_creators_and_products_in_parallel">
<h1>View Creators and Products in Parallel</h1>
<p>For every concrete Creator, there’s typically a whole set of products that it creates. Chicago pizza creators create different types of Chicago-style pizza, New York pizza creators create different types of New York-style pizza, and so on. In fact, we can view our sets of Creator classes and their corresponding Product classes as <em>parallel hierarchies</em>.</p>
<p>Let’s look at the two parallel class hierarchies and see how they relate:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0134-01.png" alt="Images" width="1085" height="883" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0134-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Design Puzzle"><div class="sect1" id="design_puzzl">
<h1><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0135-01.png" alt="Inline" width="100" height="63" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0135-01.png"></span> Design Puzzle</h1>
<p>We need another kind of pizza for those crazy Californians (crazy in a <em>good</em> way, of course). Draw another parallel set of classes that you’d need to add a new California region to our PizzaStore.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0135-02.png" alt="Images" width="914" height="659" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0135-02.png">
<h6></h6>
</div></figure>
<p>Okay, now write the five <em>most bizarre</em> things you can think of to put on a pizza. Then, you’ll be ready to go into business making pizza in California!</p>
<p>________________________________</p>
<p>________________________________</p>
<p>________________________________</p>
<p>________________________________</p>
<p>________________________________</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Factory Method Pattern defined"><div class="sect1" id="factory_method_pattern_defined">
<h1>Factory Method Pattern defined</h1>
<p>It’s time to roll out the official definition of the Factory Method Pattern:</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>The Factory Method Pattern</strong> defines an interface for creating an object, but lets subclasses decide which class to instantiate. Factory Method lets a class defer instantiation to subclasses.</p>
</div>
<p>As with every factory, the Factory Method Pattern gives us a way to encapsulate the instantiations of concrete types. Looking at the class diagram below, you can see that the abstract Creator class gives you an interface with a method for creating objects, also known as the “factory method.” Any other methods implemented in the abstract Creator are written to operate on products produced by the factory method. Only subclasses actually implement the factory method and create products.</p>
<p>As in the official definition, you’ll often hear developers say “the Factory Method pattern lets subclasses decide which class to instantiate.” Because the Creator class is written without knowledge of the actual products that will be created, we say “decide” not because the pattern allows subclasses <em>themselves</em> to decide, but rather, because the decision actually comes down to <em>which subclass</em> is used to create the product.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You could ask them what “decides” means, but we bet you now understand this better than they do!</p>
</div>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0136-02.png" alt="Images" width="1106" height="632" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0136-02.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0001107">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: What’s the advantage of the Factory Method Pattern when you only have one ConcreteCreator?</strong></p>
<p><strong>A</strong>: The Factory Method Pattern is useful if you’ve only got one concrete creator because you are decoupling the implementation of the product from its use. If you add additional products or change a product’s implementation, it will not affect your Creator (because the Creator is not tightly coupled to any ConcreteProduct).</p>
<p><strong>Q: Would it be correct to say that our NY and Chicago stores are implemented using Simple Factory? They look just like it.</strong></p>
<p><strong>A</strong>: They’re similar, but used in different ways. Even though the implementation of each concrete store looks a lot like the SimplePizzaFactory, remember that the concrete stores are extending a class that has defined createPizza() as an abstract method. It is up to each store to define the behavior of the createPizza() method. In Simple Factory, the factory is another object that is composed with the PizzaStore.</p>
<p><strong>Q: Are the factory method and the Creator always abstract?</strong></p>
<p><strong>A</strong>: No, you can define a default factory method to produce some concrete product. Then you always have a means of creating products even if there are no subclasses of the Creator.</p>
<p><strong>Q: Each store can make four different kinds of pizzas based on the type passed in. Do all concrete creators make multiple products, or do they sometimes just make one?</strong></p>
<p><strong>A</strong>: We implemented what is known as the parameterized factory method. It can make more than one object based on a parameter passed in, as you noticed. Often, however, a factory just produces one object and is not parameterized. Both are valid forms of the pattern.</p>
<p><strong>Q: Your parameterized types don’t seem “type-safe.” I’m just passing in a String! What if I asked for a “CalmPizza”?</strong></p>
<p><strong>A</strong>: You are certainly correct and that would cause what we call in the business a “runtime error.” There are several other more sophisticated techniques that can be used to make parameters more “type safe”—in other words, to ensure errors in parameters can be caught at compile time. For instance, you can create objects that represent the parameter types, use static constants, or use enums.</p>
<p><strong>Q: I’m still a bit confused about the difference between Simple Factory and Factory Method. They look very similar, except that in Factory Method, the class that returns the pizza is a subclass. Can you explain?</strong></p>
<p><strong>A</strong>: You’re right that the subclasses do look a lot like Simple Factory; however, think of Simple Factory as a one-shot deal, while with Factory Method you are creating a framework that lets the subclasses decide which implementation will be used. For example, the orderPizza() method in the Factory Method provides a general framework for creating pizzas that relies on a factory method to actually create the concrete classes that go into making a pizza. By subclassing the PizzaStore class, you decide what concrete products go into making the pizza that orderPizza() returns. Compare that with Simple Factory, which gives you a way to encapsulate object creation, but doesn’t give you the flexibility of the Factory Method because there is no way to vary the products you’re creating.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id0000002">
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0138-01.png" alt="Images" width="121" height="183" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0138-01.png">
<h6></h6>
</div></figure>
<p><strong><em>Guru and Student...</em></strong></p>
<p><strong><em>Guru:</em></strong> <em>Tell me about your training.</em></p>
<p><strong><em>Student:</em></strong> <em>Guru, I have taken my study of “encapsulate what varies” further.</em></p>
<p><strong><em>Guru:</em></strong> <em>Go on...</em></p>
<p><strong><em>Student:</em></strong> <em>I have learned that one can encapsulate the code that creates objects. When you have code that instantiates concrete classes, this is an area of frequent change. I’ve learned a technique called “factories” that allows you to encapsulate this behavior of instantiation.</em></p>
<p><strong><em>Guru:</em></strong> <em>And these “factories,” of what benefit are they?</em></p>
<p><strong><em>Student:</em></strong> <em>There are many. By placing all my creation code in one object or method, I avoid duplication in my code and provide one place to perform maintenance. That also means clients depend only upon interfaces rather than the concrete classes required to instantiate objects. As I have learned in my studies, this allows me to program to an interface, not an implementation, and that makes my code more flexible and extensible in the future.</em></p>
<p><strong><em>Guru:</em></strong> <em>Yes, your OO instincts are growing. Do you have any questions for your guru today?</em></p>
<p><strong><em>Student:</em></strong> <em>Guru, I know that by encapsulating object creation I am coding to abstractions and decoupling my client code from actual implementations. But my factory code must still use concrete classes to instantiate real objects. Am I not pulling the wool over my own eyes?</em></p>
<p><strong><em>Guru:</em></strong> <em>Object creation is a reality of life; we must create objects or we will never create a single Java application. But, with knowledge of this reality, we can design our code so that we have corralled this creation code like the sheep whose wool you would pull over your eyes. Once corralled, we can protect and care for the creation code. If we let our creation code run wild, then we will never collect its “wool.”</em></p>
<p><strong><em>Student:</em></strong> <em>Guru, I see the truth in this.</em></p>
<p><strong><em>Guru:</em></strong> <em> As I knew you would. Now, please go and meditate on object dependencies.</em></p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00811">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Inline" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>Let’s pretend you’ve never heard of an OO factory. Here’s a “very dependent” version of the PizzaStore that doesn’t use a factory. We need for you to make a count of the number of concrete pizza objects this class is dependent on. If you added California style pizzas to this PizzaStore, how many objects would it be dependent on then?</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0139-01.png" alt="Images" width="945" height="980" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0139-01.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Looking at object dependencies"><div class="sect1" id="looking_at_object_dependencies">
<h1>Looking at object dependencies</h1>
<p>When you directly instantiate an object, you are depending on its concrete class. Take a look at our very dependent PizzaStore one page back. It creates all the pizza objects right in the PizzaStore class instead of delegating to a factory.</p>
<p>If we draw a diagram representing that version of the PizzaStore and all the objects it depends on, here’s what it looks like:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0140-01.png" alt="Images" width="975" height="786" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0140-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Dependency Inversion Principle"><div class="sect1" id="the_dependency_inversion_principle">
<h1>The Dependency Inversion Principle</h1>
<p>It should be pretty clear that reducing dependencies to concrete classes in our code is a “good thing.” In fact, we’ve got an OO design principle that formalizes this notion; it even has a big, formal name: <em>Dependency Inversion Principle.</em></p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><em>Yet another phrase you can use to impress the execs in the room! Your raise will more than offset the cost of this book, and you’ll gain the admiration of your fellow developers.</em></p>
</div>
<p>Here’s the general principle:</p>
<div data-type="note" epub:type="note">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0140-01a.png" alt="Inline" width="60" height="58" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0140-01a.png"></span> Design Principle</h5>
<p><em>Depend upon abstractions. Do not depend upon concrete classes.</em></p>
</div>
<p>At first, this principle sounds a lot like “Program to an interface, not an implementation,” right? It is similar; however, the Dependency Inversion Principle makes an even stronger statement about abstraction. It suggests that our high-level components should not depend on our low-level components; rather, they should <em>both</em> depend on abstractions.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><em>A “high-level” component is a class with behavior defined in terms of other, “low-level” components.</em></p>
<p><em>For example, PizzaStore is a high-level component because its behavior is defined in terms of pizzas - it creates all the different pizza objects, and prepares, bakes, cuts, and boxes them, while the pizzas it uses are low-level components.</em></p>
</div>
<p>But what the heck does that mean?</p>
<p>Well, let’s start by looking again at the pizza store diagram on the previous page. PizzaStore is our “high-level component” and the pizza implementations are our “lowlevel components,” and clearly the PizzaStore is dependent on the concrete pizza classes.</p>
<p>Now, this principle tells us we should instead write our code so that we are depending on abstractions, not concrete classes. That goes for both our high-level modules and our low-level modules.</p>
<p>But how do we do this? Let’s think about how we’d apply this principle to our very dependent PizzaStore implementation...</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Applying the Principle"><div class="sect1" id="applying_the_principle">
<h1>Applying the Principle</h1>
<p>Now, the main problem with the very dependent PizzaStore is that it depends on every type of pizza because it actually instantiates concrete types in its orderPizza() method.</p>
<p>While we’ve created an abstraction, Pizza, we’re nevertheless creating concrete Pizzas in this code, so we don’t get a lot of leverage out of this abstraction.</p>
<p>How can we get those instantiations out of the orderPizza() method? Well, as we know, the Factory Method allows us to do just that.</p>
<p>So, after we’ve applied the Factory Method, our diagram looks like this:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0142-01.png" alt="Images" width="804" height="575" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0142-01.png">
<h6></h6>
</div></figure>
<p>After applying the Factory Method, you’ll notice that our high-level component, the PizzaStore, and our low-level components, the pizzas, both depend on Pizza, the abstraction. Factory Method is not the only technique for adhering to the Dependency Inversion Principle, but it is one of the more powerful ones.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0143-01.png" alt="Images" width="331" height="706" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0143-01.png">
<h6></h6>
</div></figure>
<p><strong>Where’s the “inversion” in Dependency Inversion Principle?</strong></p>
<p>The “inversion” in the name Dependency Inversion Principle is there because it inverts the way you typically might think about your OO design. Look at the diagram on the previous page. Notice that the low-level components now depend on a higher level abstraction. Likewise, the high-level component is also tied to the same abstraction. So, the top-to-bottom dependency chart we drew a couple of pages back has inverted itself, with both high-level and low-level modules now depending on the abstraction.</p>
<p>Let’s also walk through the thinking behind the typical design process and see how introducing the principle can invert the way we think about the design...</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Inverting your thinking..."><div class="sect1" id="inverting_your_thinkinghellip">
<h1>Inverting your thinking...</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0144-01.png" alt="Images" width="580" height="473" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0144-01.png">
<h6></h6>
</div></figure>
<p>Okay, so you need to implement a PizzaStore. What’s the first thought that pops into your head?</p>
<p>Right, you start at the top and follow things down to the concrete classes. But, as you’ve seen, you don’t want your pizza store to know about the concrete pizza types, because then it’ll be dependent on all those concrete classes!</p>
<p>Now, let’s “invert” your thinking... instead of starting at the top, start at the Pizzas and think about what you can abstract.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0144-02.png" alt="Images" width="496" height="456" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0144-02.png">
<h6></h6>
</div></figure>
<p>Right! You are thinking about the abstraction <em>Pizza</em>. So now, go back and think about the design of the Pizza Store again.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0144-03.png" alt="Images" width="546" height="506" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0144-03.png">
<h6></h6>
</div></figure>
<p>Close. But to do that you’ll have to rely on a factory to get those concrete classes out of your Pizza Store. Once you’ve done that, your different concrete pizza types depend only on an abstraction and so does your store. We’ve taken a design where the store depended on concrete classes and inverted those dependencies (along with your thinking).</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="A few guidelines to help you follow the Principle..."><div class="sect1" id="a_few_guidelines_to_help_you_follow_the">
<h1>A few guidelines to help you follow the Principle...</h1>
<p>The following guidelines can help you avoid OO designs that violate the Dependency Inversion Principle:</p>
<ul>
<li><p>No variable should hold a reference to a concrete class.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><em>If you use new, you’ll be holding a reference to a concrete class. Use a factory to get around that!</em></p>
</div></li>
<li><p>No class should derive from a concrete class.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><em>If you derive from a concrete class, you’re depending on a concrete class. Derive from an abstraction, like an interface or an abstract class.</em></p>
</div></li>
<li><p>No method should override an implemented method of any of its base classes.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><em>If you override an implemented method, then your base class wasn’t really an abstraction to start with. Those methods implemented in the base class are meant to be shared by all your subclasses.</em></p>
</div></li></ul>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0145-04.png" alt="Images" width="641" height="640" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0145-04.png">
<h6></h6>
</div></figure>
<p>You’re exactly right! Like many of our principles, this is a guideline you should strive for, rather than a rule you should follow all the time. Clearly, every single Java program ever written violates these guidelines!</p>
<p>But, if you internalize these guidelines and have them in the back of your mind when you design, you’ll know when you are violating the principle and you’ll have a good reason for doing so. For instance, if you have a class that isn’t likely to change, and you know it, then it’s not the end of the world if you instantiate a concrete class in your code. Think about it; we instantiate String objects all the time without thinking twice. Does that violate the principle? Yes. Is that okay? Yes. Why? Because String is very unlikely to change.</p>
<p>If, on the other hand, a class you write is likely to change, you have some good techniques like Factory Method to encapsulate that change.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Meanwhile, back at the PizzaStore..."><div class="sect1" id="meanwhilecomma_back_at_the_pizzastorehel">
<h1>Meanwhile, back at the PizzaStore...</h1>
<p>The design for the PizzaStore is really shaping up: it’s got a flexible framework and it does a good job of adhering to design principles.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0146-01.png" alt="Images" width="422" height="433" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0146-01.png">
<h6></h6>
</div></figure>
<p>Now, the key to Objectville Pizza’s success has always been fresh, quality ingredients, and what you’ve discovered is that with the new framework your franchises have been following your <em>procedures</em>, but a few franchises have been substituting inferior ingredients in their pies to lower costs and increase their margins. You know you’ve got to do something, because in the long term this is going to hurt the Objectville brand!</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><em>That is, the baking, the cutting, the boxing, and so on...</em></p>
</div>
<section data-type="sect2" data-pdf-bookmark="Ensuring consistency in your ingredients"><div class="sect2" id="ensuring_consistency_in_your_ingredients">
<h2>Ensuring consistency in your ingredients</h2>
<p>So how are you going to ensure each franchise is using quality ingredients? You’re going to build a factory that produces them and ships them to your franchises!</p>
<p>Now there is only one problem with this plan: the franchises are located in different regions and what is red sauce in New York is not red sauce in Chicago. So, you have one set of ingredients that needs to be shipped to New York and a <em>different</em> set that needs to be shipped to Chicago. Let’s take a closer look:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0146-03.png" alt="Images" width="1068" height="450" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0146-03.png">
<h6></h6>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Families of ingredients..."><div class="sect1" id="families_of_ingredientshellip">
<h1>Families of ingredients...</h1>
<p>New York uses one set of ingredients and Chicago another. Given the popularity of Objectville Pizza, it won’t be long before you also need to ship another set of regional ingredients to California, and what’s next? Austin?</p>
<p>For this to work, you are going to have to figure out how to handle families of ingredients.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0147-01.png" alt="Images" width="1099" height="1207" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0147-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Building the ingredient factories"><div class="sect1" id="building_the_ingredient_factories">
<h1>Building the ingredient factories</h1>
<p> Now we’re going to build a factory to create our ingredients; the factory will be responsible for creating each ingredient in the ingredient family. In other words, the factory will need to create dough, sauce, cheese, and so on... You’ll see how we are going to handle the regional differences shortly.</p>
<p>Let’s start by defining an interface for the factory that is going to create all our ingredients:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0148-01.png" alt="Images" width="888" height="423" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0148-01.png">
<h6></h6>
</div></figure>
<p><strong>With that interface, here’s what we’re going to do:</strong></p>
<ol>
<li><p>Build a factory for each region. To do this, you’ll create a subclass of PizzaIngredientFactory that implements each create method.</p></li>
<li><p>Implement a set of ingredient classes to be used with the factory, like ReggianoCheese, RedPeppers, and ThickCrustDough. These classes can be shared among regions where appropriate.</p></li>
<li><p>Then we still need to hook all this up by working our new ingredient factories into our old PizzaStore code.</p></li>
</ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Building the New York ingredient factory"><div class="sect1" id="building_the_new_york_ingredient_factory">
<h1>Building the New York ingredient factory</h1>
<p>Okay, here’s the implementation for the New York ingredient factory. This factory specializes in Marinara Sauce, Reggiano Cheese, Fresh Clams...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0149-01.png" alt="Images" width="1105" height="1140" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0149-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00712">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Inline" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>Write the ChicagoPizzaIngredientFactory. You can reference the classes below in your implementation:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0150-01.png" alt="Images" width="907" height="261" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0150-01.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Reworking the pizzas..."><div class="sect1" id="reworking_the_pizzashellip">
<h1>Reworking the pizzas...</h1>
<p>We’ve got our factories all fired up and ready to produce quality ingredients; now we just need to rework our Pizzas so they only use factory-produced ingredients. We’ll start with our abstract Pizza class:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0151-01.png" alt="Images" width="917" height="1043" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0151-01.png">
<h6></h6>
</div></figure>
<p>Now that you’ve got an abstract Pizza to work from, it’s time to create the New York and Chicago style Pizzas—only this time around they will get their ingredients straight from the factory. The franchisees’ days of skimping on ingredients are over!</p>
<p>When we wrote the Factory Method code, we had a NYCheesePizza and a ChicagoCheesePizza class. If you look at the two classes, the only thing that differs is the use of regional ingredients. The pizzas are made just the same (dough + sauce + cheese). The same goes for the other pizzas: Veggie, Clam, and so on. They all follow the same preparation steps; they just have different ingredients.</p>
<p>So, what you’ll see is that we really don’t need two classes for each pizza; the ingredient factory is going to handle the regional differences for us.</p>
<p>Here’s the Cheese Pizza:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0152-01.png" alt="Images" width="1080" height="557" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0152-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="code_up_close-id000102">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-4.png" alt="Inline" width="70" height="55" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-4.png"></span> Code Up Close</h5>
<p>The Pizza code uses the factory it has been composed with to produce the ingredients used in the pizza. The ingredients produced depend on which factory we’re using. The Pizza class doesn’t care; it knows how to make pizzas. Now, it’s decoupled from the differences in regional ingredients and can be easily reused when there are factories for the Austin, the Nashville, and beyond.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0153-01.png" alt="Images" width="994" height="191" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0153-01.png">
<h6></h6>
</div></figure>
</div></aside>
<p>Let’s check out the ClamPizza as well:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0153-02.png" alt="Images" width="1008" height="633" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0153-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Revisiting our pizza stores"><div class="sect1" id="revisiting_our_pizza_stores">
<h1>Revisiting our pizza stores</h1>
<p>We’re almost there; we just need to make a quick trip to our franchise stores to make sure they are using the correct Pizzas. We also need to give them a reference to their local ingredient factories:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0154-01.png" alt="Images" width="1089" height="929" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0154-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000193">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Inline" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>Compare this version of the createPizza() method to the one in the Factory Method implementation earlier in the chapter.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What have we done?"><div class="sect1" id="what_have_we_donequestion_mar">
<h1>What have we done?</h1>
<p>That was quite a series of code changes; what exactly did we do?</p>
<p>We provided a means of creating a family of ingredients for pizzas by introducing a new type of factory called an Abstract Factory.</p>
<p>An Abstract Factory gives us an interface for creating a family of products. By writing code that uses this interface, we decouple our code from the actual factory that creates the products. That allows us to implement a variety of factories that produce products meant for different contexts—such as different regions, different operating systems, or different look and feels.</p>
<p>Because our code is decoupled from the actual products, we can substitute different factories to get different behaviors (like getting marinara instead of plum tomatoes).</p>
<p>An Abstract Factory provides an interface for a family of products. What’s a family? In our case, it’s all the things we need to make a pizza: dough, sauce, cheese, meats, and veggies.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0155-01.png" alt="Images" width="810" height="975" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0155-01.png">
<h6></h6>
</div></figure>
<p>From the abstract factory, we derive one or more concrete factories that produce the same products, but with different implementations.</p>
<p>We then write our code so that it uses the factory to create products. By passing in a variety of factories, we get a variety of implementations of those products. But our client code stays the same.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="More pizza for Ethan and Joel..."><div class="sect1" id="more_pizza_for_ethan_and_joelhellip">
<h1>More pizza for Ethan and Joel...</h1>
<p><strong>Ethan and Joel can’t get enough Object ville Pizza! What they don’t know is that now their orders are making use of the new ingredient factories. So now when they order...</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0156-01.png" alt="Images" width="194" height="99" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0156-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0156-02.png" alt="Images" width="701" height="504" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0156-02.png">
<h6></h6>
</div></figure>
<p>The first part of the order process hasn’t changed at all.<br>Let’s follow Ethan’s order again:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0156-03.png" alt="Images" width="1088" height="562" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0156-03.png">
<h6></h6>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="From here things change, because we are using an ingredient factory"><div class="sect2" id="from_here_things_changecomma_because_we">
<h2>From here things change, because we are using an ingredient factory</h2>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0156-01.png" alt="Images" width="194" height="99" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0156-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0157-01.png" alt="Images" width="1025" height="1080" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0157-01.png">
<h6></h6>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Abstract Factory Pattern defined"><div class="sect1" id="abstract_factory_pattern_defined">
<h1>Abstract Factory Pattern defined</h1>
<p>We’re adding yet another factory pattern to our pattern family, one that lets us create families of products. Let’s check out the official definition for this pattern:</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="the_abstract">
<p><strong>The Abstract Factory Pattern</strong> provides an interface for creating families of related or dependent objects without specifying their concrete classes.</p>
</div></aside>
<p>We’ve certainly seen that Abstract Factory allows a client to use an abstract interface to create a set of related products without knowing (or caring) about the concrete products that are actually produced. In this way, the client is decoupled from any of the specifics of the concrete products. Let’s look at the class diagram to see how this all holds together:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0158-01.png" alt="Images" width="1063" height="862" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0158-01.png">
<h6></h6>
</div></figure>
<p><strong>That’s a fairly complicated class diagram; let’s look at it all in terms of our PizzaStore:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0159-01.png" alt="Images" width="1077" height="1208" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0159-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0160-01.png" alt="Images" width="692" height="656" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0160-01.png">
<h6></h6>
</div></figure>
<p><strong>Is that a Factory Method lurking inside the Abstract Factory?</strong></p>
<p>Good catch! Yes, often the methods of an Abstract Factory are implemented as factory methods. It makes sense, right? The job of an Abstract Factory is to define an interface for creating a set of products. Each method in that interface is responsible for creating a concrete product, and we implement a subclass of the Abstract Factory to supply those implementations. So, factory methods are a natural way to implement your product methods in your abstract factories.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="patterns_exposed-id000102">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0160-02.png" alt="Inline" width="150" height="138" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0160-02.png"></span> Patterns Exposed</h5>
<p><strong>This week’s interview: Factory Method and Abstract Factory, on each other</strong></p>
<p><strong>HeadFirst:</strong> Wow, an interview with two patterns at once! This is a first for us.</p>
<p><strong>Factory Method:</strong> Yeah, I’m not so sure I like being lumped in with Abstract Factory, you know. Just because we’re both factory patterns doesn’t mean we shouldn’t get our own interviews.</p>
<p><strong>HeadFirst:</strong> Don’t be miffed, we wanted to interview you together so we could help clear up any confusion about who’s who for the readers. You do have similarities, and I’ve heard that people sometimes get you confused.</p>
<p><strong>Abstract Factory:</strong> It is true, there have been times I’ve been mistaken for Factory Method, and I know you’ve had similar issues, Factory Method. We’re both really good at decoupling applications from specific implementations; we just do it in different ways. So I can see why people might sometimes get us confused.</p>
<p><strong>Factory Method:</strong> Well, it still ticks me off. After all, I use classes to create and you use objects; that’s totally different!</p>
<p><strong>HeadFirst:</strong> Can you explain more about that, Factory Method?</p>
<p><strong>Factory Method:</strong> Sure. Both Abstract Factory and I create objects—that’s our jobs. But I do it through inheritance...</p>
<p><strong>Abstract Factory:</strong> ...and I do it through object composition.</p>
<p><strong>Factory Method:</strong> Right. So that means, to create objects using Factory Method, you need to extend a class and provide an implementation for a factory method.</p>
<p><strong>HeadFirst:</strong> And that factory method does what?</p>
<p><strong>Factory Method:</strong> It creates objects, of course! I mean, the whole point of the Factory Method Pattern is that you’re using a subclass to do your creation for you. In that way, clients only need to know the abstract type they are using, the subclass worries about the concrete type. So, in other words, I keep clients decoupled from the concrete types.</p>
<p><strong>Abstract Factory:</strong> And I do too, only I do it in a different way.</p>
<p><strong>HeadFirst:</strong> Go on, Abstract Factory... you said something about object composition?</p>
<p><strong>Abstract Factory:</strong> I provide an abstract type for creating a family of products. Subclasses of this type define how those products are produced. To use the factory, you instantiate one and pass it into some code that is written against the abstract type. So, like Factory Method, my clients are decoupled from the actual concrete products they use.</p>
<p><strong>HeadFirst:</strong> Oh, I see, so another advantage is that you group together a set of related products.</p>
<p><strong>Abstract Factory:</strong> That’s right.</p>
<p><strong>HeadFirst:</strong> What happens if you need to extend that set of related products to, say, add another one? Doesn’t that require changing your interface?</p>
<p><strong>Abstract Factory:</strong> That’s true; my interface has to change if new products are added, which I know people don’t like to do....</p>
<p><strong>Factory Method:</strong> &lt;snicker&gt;</p>
<p><strong>Abstract Factory:</strong> What are you snickering at, Factory Method?</p>
<p><strong>Factory Method:</strong> Oh, come on, that’s a big deal! Changing your interface means you have to go in and change the interface of every subclass! That sounds like a lot of work.</p>
<p><strong>Abstract Factory:</strong> Yeah, but I need a big interface because I am used to creating entire families of products. You’re only creating one product, so you don’t really need a big interface, you just need one method.</p>
<p><strong>HeadFirst:</strong> Abstract Factory, I heard that you often use factory methods to implement your concrete factories?</p>
<p><strong>Abstract Factory:</strong> Yes, I’ll admit it, my concrete factories often implement a factory method to create their products. In my case, they are used purely to create products...</p>
<p><strong>Factory Method:</strong> ...while in my case I usually implement code in the abstract creator that makes use of the concrete types the subclasses create.</p>
<p><strong>HeadFirst:</strong> It sounds like you both are good at what you do. I’m sure people like having a choice; after all, factories are so useful, they’ll want to use them in all kinds of different situations. You both encapsulate object creation to keep applications loosely coupled and less dependent on implementations, which is really great, whether you’re using Factory Method or Abstract Factory. May I allow you each a parting word?</p>
<p><strong>Abstract Factory:</strong> Thanks. Remember me, Abstract Factory, and use me whenever you have families of products you need to create and you want to make sure your clients create products that belong together.</p>
<p><strong>Factory Method:</strong> And I’m Factory Method; use me to decouple your client code from the concrete classes you need to instantiate, or if you don’t know ahead of time all the concrete classes you are going to need. To use me, just subclass me and implement my factory method!</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Factory Method and Abstract Factory compared"><div class="sect1" id="factory_method_and_abstract_factory_comp">
<h1>Factory Method and Abstract Factory compared</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0161-01.png" alt="Images" width="1030" height="1212" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0161-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0163-01.png" alt="Images" width="1078" height="1257" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0163-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Tools for your Design Toolbox"><div class="sect1" id="tools_for_your_design_toolbox-id00011">
<h1><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0164-01.png" alt="Inline" width="172" height="165" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0164-01.png"></span> Tools for your Design Toolbox</h1>
<p>In this chapter, we added two more tools to your toolbox: Factory Method and Abstract Factory. Both patterns encapsulate object creation and allow you to decouple your code from concrete types.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0164-02.png" alt="Images" width="705" height="1015" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0164-02.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id000142">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-2.png" alt="Inline" width="108" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-2.png"></span> BULLET POINTS</h5>
<ul>
<li><p>All factories encapsulate object creation.</p></li>
<li><p>Simple Factory, while not a bona fide design pattern, is a simple way to decouple your clients from concrete classes.</p></li>
<li><p>Factory Method relies on inheritance: object creation is delegated to subclasses, which implement the factory method to create objects.</p></li>
<li><p>Abstract Factory relies on object composition: object creation is implemented in methods exposed in the factory interface.</p></li>
<li><p>All factory patterns promote loose coupling by reducing the dependency of your application on concrete classes.</p></li>
<li><p>The intent of Factory Method is to allow a class to defer instantiation to its subclasses.</p></li>
<li><p>The intent of Abstract Factory is to create families of related objects without having to depend on their concrete classes.</p></li>
<li><p>The Dependency Inversion Principle guides us to avoid dependencies on concrete types and to strive for abstractions.</p></li>
<li><p>Factories are a powerful technique for coding to abstractions, not concrete classes.</p></li>
</ul>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Design Patterns Crossword"><div class="sect1" id="design_patterns_crosswor">
<h1><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-5.png" alt="Inline" width="100" height="63" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-5.png"></span> Design Patterns Crossword</h1>
<p>It’s been a long chapter. Grab a slice of Pizza and relax while doing this crossword; all of the solution words are from this chapter.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0165-01.png" alt="Images" width="721" height="491" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0165-01.png">
<h6></h6>
</div></figure>
<p><strong>ACROSS</strong></p>
<p>1. In Factory Method, each franchise is a ________.</p>
<p>4. In Factory Method, who decides which class to instantiate?</p>
<p>6. Role of PizzaStore in Factory Method Pattern.</p>
<p>7. All New York style pizzas use this kind of cheese.</p>
<p>8. In Abstract Factory, each ingredient factory is a _______.</p>
<p>9. When you use new, you are programming to an ___________.</p>
<p>11. createPizza() is a ____________ (two words).</p>
<p>12. Joel likes this kind of pizza.</p>
<p>13. In Factory Method, the PizzaStore and the concrete Pizzas all depend on this abstraction.</p>
<p>14. When a class instantiates an object from a concrete class, it’s ___________ on that object.</p>
<p>15. All factory patterns allow us to __________ object creation.</p>
<p><strong>DOWN</strong></p>
<p>2.We used ___________ in Simple Factory and Abstract Factory, and inheritance in Factory Method.</p>
<p>3. Abstract Factory creates a ___________ of products.</p>
<p>5. Not a REAL factory pattern, but handy nonetheless.</p>
<p>10. Ethan likes this kind of pizza.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id000107">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Inline" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>We’ve knocked out the NYPizzaStore; just two more to go and we’ll be ready to franchise! Write the Chicago and California PizzaStore implementations here:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0166-01.png" alt="Images" width="886" height="917" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0166-01.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Design Puzzle Solution"><div class="sect1" id="design_puzzle_solutio">
<h1><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-5.png" alt="Inline" width="100" height="63" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-5.png"></span> Design Puzzle Solution</h1>
<p>We need another kind of pizza for those crazy Californians (crazy in a GOOD way, of course). Draw another parallel set of classes that you’d need to add a new California region to our PizzaStore.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0167-01.png" alt="Images" width="1075" height="660" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0167-01.png">
<h6></h6>
</div></figure>
<p>Okay, now write the five silliest things you can think of to put on a pizza. Then, you’ll be ready to go into business making pizza in California!</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0167-02.png" alt="Images" width="795" height="192" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0167-02.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id000108">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Inline" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>Let’s pretend you’ve never heard of an OO factory. Here’s a “very dependent” version of the PizzaStore that doesn’t use a factory. We need for you to make a count of the number of concrete pizza objects this class is dependent on. If you added California style pizzas to this PizzaStore, how many objects would it be dependent on then?</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0168-01.png" alt="Images" width="934" height="980" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0168-01.png">
<h6></h6>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id000109">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Inline" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>Go ahead and write the ChicagoPizzaIngredientFactory; you can reference the classes below in your implementation:</p>
<pre data-type="programlisting">public class ChicagoPizzaIngredientFactory
    implements PizzaIngredientFactory
{

    public Dough createDough() {
        return new ThickCrustDough();
    }

    public Sauce createSauce() {
        return new PlumTomatoSauce();
    }

    public Cheese createCheese() {
        return new MozzarellaCheese();
    }

    public Veggies[] createVeggies() {
        Veggies veggies[] = { new BlackOlives(),
                              new Spinach(),
                              new Eggplant() };
        return veggies;
    }

    public Pepperoni createPepperoni() {
        return new SlicedPepperoni();
    }

    public Clams createClam() {
        return new FrozenClams();
    }
}</pre>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0169-01.png" alt="Images" width="907" height="268" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0169-01.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Design Patterns Crossword Solution"><div class="sect1" id="design_patterns_crossword_sol">
<h1><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-5.png" alt="Inline" width="100" height="63" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-5.png"></span> Design Patterns Crossword Solution</h1>
<p>It’s been a long chapter. Grab a slice of Pizza and relax while doing this crossword; all of the solution words are from this chapter. Here’s the solution.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0170-01.png" alt="Images" width="877" height="580" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/f0170-01.png">
<h6></h6>
</div></figure>
</div></section>
</div></section><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 5. The Singleton Pattern: One of a Kind Objects"><div class="chapter" id="the_singleton_pattern_one_of_a_kind_obje">
<h1><span class="label">Chapter 5. </span>The Singleton Pattern: One of a Kind Objects</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg171.png" alt="Images" width="714" height="541" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg171.png">
<h6></h6>
</div></figure>
<p><strong>Our next stop is the Singleton Pattern, our ticket to creating one-of-a-kind objects for which there is only one instance, ever.</strong> You might be happy to know that of all patterns, the Singleton is the simplest in terms of its class diagram; in fact, the diagram holds just a single class! But don’t get too comfortable; despite its simplicity from a class design perspective, it’s going to require some deep object-oriented thinking in its implementation. So put on that thinking cap, and let’s get going.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg172.png" alt="Images" width="791" height="480" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg172.png">
<h6></h6>
</div></figure>
<p><strong>Developer:</strong> What use is that?</p>
<p><strong>Guru:</strong> There are many objects we only need one of: thread pools, caches, dialog boxes, objects that handle preferences and registry settings, objects used for logging, and objects that act as device drivers to devices like printers and graphics cards. In fact, for many of these types of objects, if we were to instantiate more than one we’d run into all sorts of problems like incorrect program behavior, overuse of resources, or inconsistent results.</p>
<p><strong>Developer:</strong> Okay, so maybe there are classes that should only be instantiated once, but do I need a whole chapter for this? Can’t I just do this by convention or by global variables? You know, like in Java, I could do it with a static variable.</p>
<p><strong>Guru:</strong> In many ways, the Singleton Pattern <strong>is a convention</strong> for ensuring one and only one object is instantiated for a given class. If you’ve got a better one, the world would like to hear about it; but remember, like all patterns, the Singleton Pattern is a time-tested method for ensuring only one object gets created. The Singleton Pattern also gives us a global point of access, just like a global variable, but without the downsides.</p>
<p><strong>Developer:</strong> What downsides?</p>
<p><strong>Guru:</strong> Well, here’s one example: if you assign an object to a global variable, then that object might be created when your application begins. Right? What if this object is resource intensive and your application never ends up using it? As you will see, with the Singleton Pattern, we can create our objects only when they are needed.</p>
<p><strong>Developer:</strong> This still doesn’t seem like it should be so difficult.</p>
<p><strong>Guru:</strong> If you’ve got a good handle on static class variables and methods as well as access modifiers, it’s not. But, in either case, it is interesting to see how a Singleton works, and, as simple as it sounds, Singleton code is hard to get right. Just ask yourself: how do I prevent more than one object from being instantiated? It’s not so obvious, is it?</p>
<section data-type="sect1" data-pdf-bookmark="The Little Singleton"><div class="sect1" id="the_little_singleton">
<h1>The Little Singleton</h1>
<section data-type="sect2" data-pdf-bookmark="A small Socratic exercise in the st yle of The Little Lisper"><div class="sect2" id="a_small_socratic_exercise_in_the_st_yle">
<h2>A small Socratic exercise in the st yle of The Little Lisper</h2>
<table class="border">
<tbody>
<tr>
<td>How would you create a single object?</td>
<td><code><strong>new MyObject();</strong></code></td>
</tr>
<tr>
<td>And, what if another object wanted to create a MyObject? Could it call new on MyObject again?</td>
<td>Yes, of course.</td>
</tr>
<tr>
<td>So as long as we have a class, can we always instantiate it one or more times?</td>
<td>Yes. Well, only if it’s a public class.</td>
</tr>
<tr>
<td>And if not?</td>
<td>Well, if it’s not a public class, only classes in the same package can instantiate it. But they can still instantiate it more than once.</td>
</tr>
<tr>
<td>Hmm, interesting.
Did you know you could do this?
<pre data-type="programlisting"><strong>public MyClass {</strong>

   
   <strong>private MyClass() {}</strong>

<strong>}</strong>
</pre>
</td>
<td>No, I’d never thought of it, but I guess it makes sense because it is a legal definition.</td>
</tr>
<tr>
<td>What does it mean?</td>
<td>I suppose it is a class that can’t be instantiated because it has a private constructor.</td>
</tr>
<tr>
<td>Well, is there ANY object that could use the private constructor?</td>
<td>Hmm, I think the code in MyClass is the only code that could call it. But that doesn’t make much sense.</td>
</tr>
<tr>
<td>Why not?</td>
<td>Because I’d have to have an instance of the class to call it, but I can’t have an instance because no other class can instantiate it. It’s a chicken-and-egg problem: I can use the constructor from an object of type MyClass, but I can never instantiate that object because no other object can use “new MyClass()”.</td>
</tr>
<tr>
<td><p>Okay. It was just a thought.<br>What does this mean?</p>
<pre data-type="programlisting"><strong>public MyClass {</strong>


   <strong>public static MyClass getInstance() {</strong>
   
   <strong>}</strong>
<strong>}</strong>
</pre></td>
<td>MyClass is a class with a static method. We can call the static method like this:
<code><strong>MyClass.getInstance();</strong></code></td>
</tr>
<tr>
<td>Why did you use MyClass, instead of some object name?</td>
<td>Well, getInstance() is a static method; in other words, it is a CLASS method. You need to use the class name to reference a static method.</td>
</tr>
<tr>
<td><p>Very interesting. What if we put things together.<br><em>Now</em> can I instantiate a MyClass?</p>
<pre data-type="programlisting"><strong>public MyClass {</strong>
 

   <strong>private MyClass() {}</strong>


   <strong>public static MyClass getInstance() {</strong>

       <strong>return new MyClass();</strong>
   <strong>}</strong>
<strong>}</strong>
</pre></td>
<td>Wow, you sure can.</td>
</tr>
<tr>
<td>So, now can you think of a second way to instantiate an object?</td>
<td><code><strong>MyClass.getInstance();</strong></code></td>
</tr>
<tr>
<td>Can you finish the code so that only ONE instance of MyClass is ever created?</td>
<td>Yes, I think so...</td>
</tr>
</tbody>
</table>
<p>(You’ll find the code on the next page.)</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Dissecting the classic Singleton Pattern implementation"><div class="sect1" id="dissecting_the_classic_singleton_pattern">
<h1>Dissecting the classic Singleton Pattern implementation</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg175-1.png" alt="Images" width="1008" height="1039" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg175-1.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="watch_itexclamation_mark-id000101">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg175-2.png" alt="Images" width="113" height="132" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg175-2.png"> Watch it!</h5>
<p>If you’re just flipping through the book, don’t blindly type in this code; you’ll see it has a few issues later in the chapter.</p>
</div></aside>
<section data-type="sect2" data-pdf-bookmark=" Patterns Exposed"><div class="sect2" id="patterns_exposed">
<h2><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg176.png" alt="Images" width="147" height="140" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg176.png"> Patterns Exposed</h2>
<p><strong>This week’s interview: Confessions of a Singleton</strong></p>
<p><strong>HeadFirst:</strong> Today we are pleased to bring you an interview with a Singleton object. Why don’t you begin by telling us a bit about yourself.</p>
<p><strong>Singleton:</strong> Well, I’m totally unique; there is just one of me!</p>
<p><strong>HeadFirst:</strong> One?</p>
<p><strong>Singleton:</strong> Yes, one. I’m based on the Singleton Pattern, which assures that at any time there is only one instance of me.</p>
<p><strong>HeadFirst:</strong> Isn’t that sort of a waste? Someone took the time to develop a full-blown class and now all we can get is one object out of it?</p>
<p><strong>Singleton:</strong> Not at all! There is power in ONE. Let’s say you have an object that contains registry settings. You don’t want multiple copies of that object and its values running around—that would lead to chaos. By using an object like me you can assure that every object in your application is making use of the same global resource.</p>
<p><strong>HeadFirst:</strong> Tell us more...</p>
<p><strong>Singleton:</strong> Oh, I’m good for all kinds of things. Being single sometimes has its advantages you know. I’m often used to manage pools of resources, like connection or thread pools.</p>
<p><strong>HeadFirst:</strong> Still, only one of your kind? That sounds lonely.</p>
<p><strong>Singleton:</strong> Because there’s only one of me, I do keep busy, but it would be nice if more developers knew me—many developers run into bugs because they have multiple copies of objects floating around they’re not even aware of.</p>
<p><strong>HeadFirst:</strong> So, if we may ask, how do you know there is only one of you? Can’t anyone with a new operator create a “new you”?</p>
<p><strong>Singleton:</strong> Nope! I’m truly unique.</p>
<p><strong>HeadFirst:</strong> Well, do developers swear an oath not to instantiate you more than once?</p>
<p><strong>Singleton:</strong> Of course not. The truth be told... well, this is getting kind of personal but... I have no public constructor.</p>
<p><strong>HeadFirst:</strong> NO PUBLIC CONSTRUCTOR! Oh, sorry, no public constructor?</p>
<p><strong>Singleton:</strong> That’s right. My constructor is declared private.</p>
<p><strong>HeadFirst:</strong> How does that work? How do you EVER get instantiated?</p>
<p><strong>Singleton:</strong> You see, to get a hold of a Singleton object, you don’t instantiate one, you just ask for an instance. So my class has a static method called getInstance(). Call that, and I’ll show up at once, ready to work. In fact, I may already be helping other objects when you request me.</p>
<p><strong>HeadFirst:</strong> Well, Mr. Singleton, there seems to be a lot under your covers to make all this work. Thanks for revealing yourself and we hope to speak with you again soon!</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Chocolate Factory"><div class="sect1" id="the_chocolate_factory">
<h1>The Chocolate Factory</h1>
<p>Everyone knows that all modern chocolate factories have computer-controlled chocolate boilers. The job of the boiler is to take in chocolate and milk, bring them to a boil, and then pass them on to the next phase of making chocolate bars.</p>
<p>Here’s the controller class for Choc-O-Holic, Inc.’s industrial strength Chocolate Boiler. Check out the code; you’ll notice they’ve tried to be very careful to ensure that bad things don’t happen, like draining 500 gallons of unboiled mixture, or filling the boiler when it’s already full, or boiling an empty boiler!</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg177-2.png" alt="Images" width="195" height="356" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg177-2.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg177-1.png" alt="Images" width="913" height="870" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg177-1.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000196">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Images" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>Choc-O-Holic has done a decent job of ensuring bad things don’t happen, don’t you think? Then again, you probably suspect that if two ChocolateBoiler instances get loose, some very bad things can happen.</p>
<p>How might things go wrong if more than one instance of ChocolateBoiler is created in an application?</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00306">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>Can you help Choc-O-Holic improve their ChocolateBoiler class by turning it into a singleton?</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg178.png" alt="Images" width="504" height="509" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg178.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Singleton Pattern defined"><div class="sect1" id="singleton_pattern_defined">
<h1>Singleton Pattern defined</h1>
<p><strong>Now that you’ve got the classic implementation of Singleton in your head, it’s time to sit back, enjoy a bar of chocolate, and check out the finer points of the Singleton Pattern.</strong></p>
<p><strong>Let’s start with the concise definition of the pattern:</strong></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id000002">
<p><strong>The Singleton Pattern</strong> ensures a class has only one instance, and provides a global point of access to it.</p>
</div></aside>
<p><strong>No big surprises there. But let’s break it down a bit more:</strong></p>
<ul>
<li><p>What’s really going on here? We’re taking a class and letting it manage a single instance of itself. We’re also preventing any other class from creating a new instance on its own. To get an instance, you’ve got to go through the class itself.</p></li>
<li><p>We’re also providing a global access point to the instance: whenever you need an instance, just query the class and it will hand you back the single instance. As you’ve seen, we can implement this so that the Singleton is created in a lazy manner, which is especially important for resource-intensive objects.</p></li>
</ul>
<p><strong>Okay, let’s check out the class diagram:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg179.png" alt="Images" width="865" height="371" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg179.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Hershey, PA, we have a problem..."><div class="sect1" id="hersheycomma_pacomma_we_have_a_problemhe">
<h1> Hershey, PA, we have a problem...</h1>
<p><strong>It looks like the Chocolate Boiler has let us down; despite the fact we improved the code using Classic Singleton, somehow the ChocolateBoiler’s fill() method was able to start filling the boiler even though a batch of milk and chocolate was already boiling! That’s 500 gallons of spilled milk (and chocolate)! What happened!?</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg180.png" alt="Images" width="996" height="801" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg180.png">
<h6></h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Could the addition of threads have caused this? Isn’t it the case that once we’ve set the uniqueInstance variable to the sole instance of ChocolateBoiler, all calls to getInstance() should return the same instance? Right?</strong></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="BE the JVM"><div class="sect1" id="be_the_jvm">
<h1>BE the JVM</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg181-1.png" alt="Images" width="225" height="260" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg181-1.png">
<h6></h6>
</div></figure>
<p><strong>We have two threads, each executing this code. Your job is to play the JVM and determine whether there is a case in which two threads might get ahold of different boiler objects. Hint: you really just need to look at the sequence of operations in the getInstance() method and the value of uniqueInstance to see how they might overlap. Use the code magnets to help you study how the code might interleave to create two boiler objects.</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg181-2.png" alt="Images" width="452" height="330" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg181-2.png">
<h6></h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Make sure you check your answer on page 190 before continuing!</strong></p>
</div>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg181-3.png" alt="Images" width="725" height="538" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg181-3.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Dealing with multithreading"><div class="sect1" id="dealing_with_multithreading">
<h1>Dealing with multithreading</h1>
<p><strong>Our multithreading woes are almost trivially fixed by making getInstance() a synchronized method:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg182-1.png" alt="Images" width="863" height="477" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg182-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg182-2.png" alt="Images" width="486" height="489" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg182-2.png">
<h6></h6>
</div></figure>
<p>Good point, and it’s actually a little worse than you make out: the only time synchronization is relevant is the first time through this method. In other words, once we’ve set the uniqueInstance variable to an instance of Singleton, we have no further need to synchronize this method. After the first time through, synchronization is totally unneeded overhead!</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Can we improve multithreading?"><div class="sect1" id="can_we_improve_multithreadingquestion_ma">
<h1>Can we improve multithreading?</h1>
<p>For most Java applications, we obviously need to ensure that the Singleton works in the presence of multiple threads. But, it is expensive to synchronize the getInstance() method, so what do we do?</p>
<p>Well, we have a few options...</p>
<section data-type="sect2" data-pdf-bookmark="1. Do nothing if the performance of getInstance() isn’t critical to your application."><div class="sect2" id="do_nothing_if_the_performance_of_getinst">
<h2>1. Do nothing if the performance of getInstance() isn’t critical to your application.</h2>
<p>That’s right; if calling the getInstance() method isn’t causing substantial overhead for your application, forget about it. Synchronizing getInstance() is straightforward and effective. Just keep in mind that synchronizing a method can decrease performance by a factor of 100, so if a high-traffic part of your code begins using getInstance(), you may have to reconsider.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="2. Move to an eagerly created instance rather than a lazily created one."><div class="sect2" id="move_to_an_eagerly_created_instance_rath">
<h2>2. Move to an eagerly created instance rather than a lazily created one.</h2>
<p>If your application always creates and uses an instance of the Singleton or the overhead of creation and runtime aspects of the Singleton are not onerous, you may want to create your Singleton eagerly, like this:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg183.png" alt="Images" width="906" height="285" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg183.png">
<h6></h6>
</div></figure>
<p>Using this approach, we rely on the JVM to create the unique instance of the Singleton when the class is loaded. The JVM guarantees that the instance will be created before any thread accesses the static uniqueInstance variable.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="3. Use “double-checked locking” to reduce the use of synchronization in getInstance()."><div class="sect2" id="use_quotation_markdouble-checked_locking">
<h2>3. Use “double-checked locking” to reduce the use of synchronization in getInstance().</h2>
<p>With double-checked locking, we first check to see if an instance is created, and if not, THEN we synchronize. This way, we only synchronize the first time through, just what we want.</p>
<p>Let’s check out the code:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg184.png" alt="Images" width="916" height="515" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg184.png">
<h6></h6>
</div></figure>
<p>If performance is an issue in your use of the getInstance() method then this method of implementing the Singleton can drastically reduce the overhead.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="watch_itexclamation_mark-id000103">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com0.png" alt="Images" width="112" height="137" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com0.png"> Watch it!</h5>
<p><strong>Double-checked locking doesn’t work in Java 1.4 or earlier!</strong></p>
<p>If for some reason you’re using an old version of Java, unfortunately, in Java version 1.4 and earlier, many JVMs contain implementations of the volatile keyword that allow improper synchronization for double-checked locking. If you must use a JVM earlier than Java 5, consider other methods of implementing your Singleton.</p>
</div></aside>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Meanwhile, back at the Chocolate Factory..."><div class="sect1" id="meanwhilecomma_back_at_the_chocolate_fac">
<h1>Meanwhile, back at the Chocolate Factory...</h1>
<p>While we’ve been off diagnosing the multithreading problems, the chocolate boiler has been cleaned up and is ready to go. But first, we have to fix the multithreading problems. We have a few solutions at hand, each with different tradeoffs, so which solution are we going to employ?</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg185.png" alt="Images" width="96" height="169" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg185.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00307">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>For each solution, describe its applicability to the problem of fixing the Chocolate Boiler code:</p>
<p><strong>Synchronize the getInstance() method:</strong></p>
<p>_________________________________________</p>
<p>_________________________________________</p>
<p><strong>Use eager instantiation:</strong></p>
<p>_________________________________________</p>
<p>_________________________________________</p>
<p><strong>Double-checked locking:</strong></p>
<p>_________________________________________</p>
<p>_________________________________________</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Congratulations!"><div class="sect1" id="congratulationsexclamation_mark">
<h1>Congratulations!</h1>
<p>At this point, the Chocolate Factory is a happy customer and Choc-O-Holic was glad to have some expertise applied to their boiler code. No matter which multithreading solution you applied, the boiler should be in good shape with no more mishaps. Congratulations. You’ve not only managed to escape 500lbs of hot chocolate in this chapter, but you’ve been through all the potential problems of the Singleton.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0011104">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: For such a simple pattern consisting of only one class, Singletons sure seem to have some problems.</strong></p>
<p><strong>A</strong>: Well, we warned you up front! But don’t let the problems discourage you; while implementing Singletons correctly can be tricky, after reading this chapter you are now well informed on the techniques for creating Singletons and should use them wherever you need to control the number of instances you are creating.</p>
<p><strong>Q: Can’t I just create a class in which all methods and variables are defined as static? Wouldn’t that be the same as a Singleton?</strong></p>
<p><strong>A</strong>: Yes, if your class is self-contained and doesn’t depend on complex initialization. However, because of the way static initializations are handled in Java, this can get very messy, especially if multiple classes are involved. Often this scenario can result in subtle, hard-to-find bugs involving order of initialization. Unless there is a compelling need to implement your “singleton” this way, it is far better to stay in the object world.</p>
<p><strong>Q: What about class loaders? I heard there is a chance that two class loaders could each end up with their own instance of Singleton.</strong></p>
<p><strong>A</strong>: Yes, that is true as each class loader defines a namespace. If you have two or more class loaders, you can load the same class multiple times (once in each classloader). Now, if that class happens to be a Singleton, then since we have more than one version of the class, we also have more than one instance of the Singleton. So, if you are using multiple classloaders and Singletons, be careful. One way around this problem is to specify the classloader yourself.</p>
<p><strong>Q: And Reflection, and Serialization/Deserialization?</strong></p>
<p>A: Yes, Reflection and Serialization/Deserialization can also present problems with Singletons. If you’re an advanced Java user using reflection, serialization and deserialization you’ll need to keep that in mind.</p>
<p><strong>Q: Earlier we talked about the loose coupling principle. Isn’t a Singleton violating this? After all, every object in our code that depends on the Singleton is going to be tightly coupled to that very specific object.</strong></p>
<p><strong>A</strong>: Yes, and in fact this is a common criticism of the Singleton Pattern. The loose coupling principles says to “Strive for loosly coupled designs between objects that interact.” It is easy for Singletons to violate this principle: if you make a change to the Singleton, you will likely have to make a change to every object that is connected to it.</p>
<p><strong>Q: I’ve always been taught that a class should do one thing and one thing only. For a class to do two things is considered bad OO design. Isn’t a Singleton violating this too?</strong></p>
<p><strong>A</strong>: You would be referring to the Single Responsibility Principle, and yes, you are correct, the Singleton is not only responsible for managing its one instance (and providing global access), it is also responsible for whatever its main role is in your application. So, certainly you could argue it is taking on two responsibilities. Nevertheless, it isn’t hard to see that there is utility in a class managing its own instance; it certainly makes the overall design simpler. In addition, many developers are familiar with the Singleton pattern as it is in wide use. That said, some developers do feel the need to abstract out the Singleton functionality.</p>
<p><strong>Q: I wanted to subclass my Singleton code, but I ran into problems. Is it okay to subclass a Singleton?</strong></p>
<p><strong>A</strong>: One problem with subclassing a Singleton is that the constructor is private. You can’t extend a class with a private constructor. So, the first thing you’ll have to do is change your constructor so that it’s public or protected. But then, it’s not really a Singleton anymore, because other classes can instantiate it.</p>
<p>If you do change your constructor, there’s another issue. The implementation of Singleton is based on a static variable, so if you do a straightforward subclass, all of your derived classes will share the same instance variable. This is probably not what you had in mind. So, for subclassing to work, implementing a registry of sorts is required in the base class.</p>
<p>But, what are you really gaining from subclassing a Singleton? Like most patterns, the Singleton is not necessarily meant to be a solution that can fit into a library. In addition, the Singleton code is trivial to add to any existing class. Last, if you are using a large number of Singletons in your application, you should take a hard look at your design. Singletons are meant to be used sparingly.</p>
<p><strong>Q: I still don’t totally understand why global variables are worse than a Singleton.</strong></p>
<p><strong>A</strong>: In Java, global variables are basically static references to objects. There are a couple of disadvantages to using global variables in this manner. We’ve already mentioned one: the issue of lazy versus eager instantiation. But we need to keep in mind the intent of the pattern: to ensure only one instance of a class exists and to provide global access. A global variable can provide the latter, but not the former. Global variables also tend to encourage developers to pollute the namespace with lots of global references to small objects. Singletons don’t encourage this in the same way, but can be abused nonetheless.</p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg187-1.png" alt="Images" width="541" height="470" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg187-1.png">
<h6></h6>
</div></figure>
<p><strong>Ah, good idea!</strong></p>
<p>Many of the problems we’ve discussed—worrying about synchronization, class loading issues, reflection, and serialization/deserialization issues—can all be solved by using an enum to create your Singleton. Here’s how you’d do that:</p>
<pre data-type="programlisting"> <strong>public enum Singleton {</strong>
     <strong><em>UNIQUE_INSTANCE;</em></strong>
     <strong>// more useful fields here</strong>
 <strong>}</strong>
 <strong>public class SingletonClient {</strong>
       <strong>public static void main(String[] args) {</strong>
              <strong>Singleton singleton = Singleton.UNIQUE_INSTANCE;</strong>
              <strong>// use the singleton here</strong>
       <strong>}</strong>
<strong>}</strong>
</pre>
<div class="note">
<p>And back in the old days, when we had to walk to school, up-hill, in the snow, in both directions, Java didn’t have enums.</p>
</div>
<p>Yep, that’s all there is to it. Simplest Singelton ever, right? Now, you might be asking, why did we go through all that earlier with creating a Singleton class with a getInstance() method and then synchronizing, and so on... we did that so you really, truly understand how Singleton works. Now you know, you can go off and use enum whenever you need a Singleton, and still be able to ace that Java interview if the question pops up: “How do you implement a Singleton <em>without</em> using enum?”</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000197">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Images" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>Can you re-work Choc-O-Holic to use an enum? Give it a try.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Tools for your Design Toolbox"><div class="sect1" id="tools_for_your_design_toolbo">
<h1>Tools for your Design Toolbox</h1>
<p>You’ve now added another pattern to your toolbox. Singleton gives you another method of creating objects—in this case, unique objects.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg188-1.png" alt="Images" width="144" height="137" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg188-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg188-2.png" alt="Images" width="388" height="516" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg188-2.png">
<h6></h6>
</div></figure>
<div class="note">
<p>As you’ve seen, despite its apparent simplicity, there are a lot of details involved in the Singleton’s implementation. After reading this chapter, though, you are ready to go out and use Singleton in the wild.</p>
</div>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id000141">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-2.png" alt="Images" width="108" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-2.png"></span> BULLET POINTS</h5>
<ul>
<li><p>The Singleton Pattern ensures you have at most one instance of a class in your application.</p></li>
<li><p>The Singleton Pattern also provides a global access point to that instance.</p></li>
<li><p>Java’s implementation of the Singleton Pattern makes use of a private constructor, a static method combined with a static variable.</p></li>
<li><p>Examine your performance and resource constraints and carefully choose an appropriate Singleton implementation for multithreaded applications (and we should consider all applications multithreaded!).</p></li>
<li><p>Beware of the double-checked locking implementation; it is not thread-safe in versions before Java 2, version 5.</p></li>
<li><p>Be careful if you are using multiple class loaders; this could defeat the Singleton implementation and result in multiple instances.</p></li>
<li><p>You can use Java’s enums to simplify your Singleton implementation.</p></li>
</ul>
</div></aside>
<section data-type="sect2" data-pdf-bookmark=" Design Patterns Crossword"><div class="sect2" id="design_patterns_crossword-id00011">
<h2><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3.png" alt="Images" width="123" height="103" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3.png"> Design Patterns Crossword</h2>
<p>Sit back, open that case of chocolate that you were sent for solving the multithreading problem, and have some downtime working on this little crossword puzzle; all of the solution words are from this chapter.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg189.png" alt="Images" width="708" height="522" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg189.png">
<h6></h6>
</div></figure>
<p><strong>ACROSS</strong></p>
<p>1. It was “one of a kind.”</p>
<p>2. Added to chocolate in the boiler.</p>
<p>8. An incorrect implementation caused this to overflow.</p>
<p>10. Singleton provides a single instance and __________ (three words).</p>
<p>12. Flawed multi-threading approach if not using Java 5 or later.</p>
<p>13. Chocolate capital of the USA.</p>
<p>14. One advantage over global variables: ________ creation.</p>
<p>15. Company that produces boilers.</p>
<p>16. To totally defeat the new constructor, we have to declare the constructor __________.</p>
<p><strong>DOWN</strong></p>
<p>1. Multiple __________ can cause problems.</p>
<p>3. A Singleton is a class that manages an instance of ________.</p>
<p>4. If you don’t need to worry about lazy instantiation, you can create your instance __________.</p>
<p>5. Prior to Java 1.2, this can eat your Singletons (two words).</p>
<p>6. The Singleton was embarrassed it had no public __________.</p>
<p>7. The classic implementation doesn’t handle this.</p>
<p>9. Singleton ensures only one of these exists.</p>
<p>11. The Singleton Pattern has one.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="BE the JVM Solution"><div class="sect1" id="be_the_jvm_solution">
<h1>BE the JVM Solution</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg190.png" alt="Images" width="626" height="512" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg190.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id000104">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>Can you help Choc-O-Holic improve their ChocolateBoiler class by turning it into a singleton?</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg191.png" alt="Images" width="662" height="817" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg191.png">
<h6></h6>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id005105">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>For each solution, describe its applicability to the problem of fixing the Chocolate Boiler code:</p>
<p><strong>Synchronize the getInstance() method:</strong></p>
<p><span class="blue">A<u> straightforward technique that is guaranteed to work. We don’t seem to </u>have<br>a<u>ny performance concerns with the chocolate boiler, so this would be a good ch</u>oice.</span></p>
<p><strong>Use eager instantiation:</strong></p>
<p><span class="blue">We<u> are always going to instantiate the chocolate boiler in our code, so statically</u> initializing<br>the<u> instance would cause no concerns. This solution would work as well as the sy</u>nchronized<br>method, although perhaps be less obvious to a developer familar with the standard pattern.</span></p>
<p><strong>Double-checked locking:</strong></p>
<p><span class="blue">Giv<u>en we have no performance concerns, double-checked locking seems like overki</u>ll. In<br>add<u>ition, we’d have to ensure that we are running at least Java 5</u>.</span></p>
</div></aside>
<section data-type="sect2" data-pdf-bookmark=" Design Patterns Crossword Solution"><div class="sect2" id="design_patterns_crossword_solutio">
<h2><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3.png" alt="Images" width="123" height="103" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3.png"> Design Patterns Crossword Solution</h2>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg192.png" alt="Images" width="652" height="483" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg192.png">
<h6></h6>
</div></figure>
</div></section>
</div></section>
</div></section><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. The Command Pattern: Encapsulating Invocation"><div class="chapter" id="the_command_pattern_encapsulating_invoca">
<h1><span class="label">Chapter 6. </span>The Command Pattern: Encapsulating Invocation</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg193.png" alt="Images" width="760" height="565" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg193.png">
<h6></h6>
</div></figure>
<p><strong>In this chapter, we take encapsulation to a whole new level: we’re going to encapsulate method invocation.</strong> That’s right; by encapsulating method invocation, we can crystallize pieces of computation so that the object invoking the computation doesn’t need to worry about how to do things, it just uses our crystallized method to get it done. We can also do some wickedly smart things with these encapsulated method invocations, like save them away for logging or reuse them to implement undo in our code. </p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg194.png" alt="Images" width="751" height="1075" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg194.png">
<h6></h6>
</div></figure>
<section data-type="sect1" data-pdf-bookmark="Free hardware! Let’s check out the Remote Control..."><div class="sect1" id="free_hardwareexclamation_mark_letapostro">
<h1>Free hardware! Let’s check out the Remote Control...</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg195.png" alt="Images" width="961" height="757" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg195.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Taking a look at the vendor classes"><div class="sect1" id="taking_a_look_at_the_vendor_classes">
<h1>Taking a look at the vendor classes</h1>
<p>Let’s check out the vendor classes the CEO attached to his email. These should give you some idea of the interfaces of the objects we need to control from the remote.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg196.png" alt="Images" width="881" height="814" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg196.png">
<h6></h6>
</div></figure>
<p>It looks like we have quite a set of classes here, and not a lot of industry effort to come up with a set of common interfaces. Not only that, it sounds like we can expect more of these classes in the future. Designing a remote control API is going to be interesting. Let’s get on to the design.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Cubicle Conversation"><div class="sect1" id="cubicle_conversation">
<h1>Cubicle Conversation</h1>
<p>Your teammates are already discussing how to design the remote control API...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg197.png" alt="Images" width="512" height="703" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg197.png">
<h6></h6>
</div></figure>
<p><strong>Mary</strong>: Yes, I thought we’d see a bunch of classes with on() and off() methods, but here we’ve got methods like dim(), setTemperature(), setVolume(), and setInputChannel(), waterOn().</p>
<p><strong>Sue</strong>: Not only that, it sounds like we can expect more vendor classes in the future with just as diverse methods.</p>
<p><strong>Mary</strong>: I think it’s important we view this as a separation of concerns.</p>
<p><strong>Sue</strong>: Meaning?</p>
<p><strong>Mary</strong>: well, what I mean is that the remote should know how to interpret button presses and make requests, but it shouldn’t know a lot about home automation or how to turn on a hot tub.</p>
<p><strong>Sue</strong>: But if the remote is dumb and just knows how to make generic requests, how do we design the remote so that it can invoke an action that, say, turns on a light or opens a garage door?</p>
<p><strong>Mary</strong>: I’m not sure, but we don’t want the remote to have to know the specifics of the vendor classes.</p>
<p><strong>Sue</strong>: What do you mean?</p>
<p><strong>Mary</strong>: We don’t want the remote to consist of a set of if statements, like “if slot1 <code>==</code> Light, then light.on(), else if slot1 <code>==</code> Hottub then hottub.jetsOn()”. We know that is a bad design.</p>
<p><strong>Sue</strong>: I agree. Whenever a new vendor class comes out, we’d have to go in and modify the code, potentially creating bugs and more work for ourselves!</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg198.png" alt="Images" width="582" height="433" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg198.png">
<h6></h6>
</div></figure>
<p><strong>Mary</strong>: Yeah? Tell us more.</p>
<p><strong>Joe</strong>: The Command Pattern allows you to decouple the requester of an action from the object that actually performs the action. So, here the requester would be the remote control and the object that performs the action would be an instance of one of your vendor classes.</p>
<p><strong>Sue</strong>: How is that possible? How can we decouple them? After all, when I press a button, the remote has to turn on a light.</p>
<p><strong>Joe</strong>: You can do that by introducing “command objects” into your design. A command object encapsulates a request to do something (like turn on a light) on a specific object (say, the living room light object). So, if we store a command object for each button, when the button is pressed we ask the command object to do some work. The remote doesn’t have any idea what the work is, it just has a command object that knows how to talk to the right object to get the work done. So, you see, the remote is decoupled from the light object!</p>
<p><strong>Sue</strong>: This certainly sounds like it’s going in the right direction.</p>
<p><strong>Mary</strong>: Still, I’m having a hard time wrapping my head around the pattern.</p>
<p><strong>Joe</strong>: Given that the objects are so decoupled, it’s a little difficult to picture how the pattern actually works.</p>
<p><strong>Mary</strong>: Let me see if I at least have the right idea: using this pattern, we could create an API in which these command objects can be loaded into button slots, allowing the remote code to stay very simple. And, the command objects encapsulate how to do a home automation task along with the object that needs to do it.</p>
<p><strong>Joe</strong>: Yes, I think so. I also think this pattern can help you with that undo button, but I haven’t studied that part yet.</p>
<p><strong>Mary</strong>: This sounds really encouraging, but I think I have a bit of work to do to really “get” the pattern.</p>
<p><strong>Sue</strong>: Me too.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Meanwhile, back at the Diner..., or, A brief introduction to the Command Pattern"><div class="sect1" id="meanwhilecomma_back_at_the_dinerhellipco">
<h1>Meanwhile, back at the Diner..., or, A brief introduction to the Command Pattern</h1>
<p>As Joe said, it is a little hard to understand the Command Pattern by just hearing its description. But don’t fear, we have some friends ready to help: remember our friendly diner from <a data-type="xref" href="ch01.html#intro_to_design_patterns_welcome_to_desi">Chapter 1</a>? It’s been a while since we visited Alice, Flo, and the short-order cook, but we’ve got good reason for returning (beyond the food and great conversation): the diner is going to help us understand the Command Pattern. </p>
<p>So, let’s take a short detour back to the diner and study the interactions between the customers, the waitress, the orders and the short-order cook. Through these interactions, you’re going to understand the objects involved in the Command Pattern and also get a feel for how the decoupling works. After that, we’re going to knock out that remote control API.</p>
<p>Checking in at the Objectville Diner...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg199-1.png" alt="Images" width="353" height="264" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg199-1.png">
<h6></h6>
</div></figure>
<p><strong>Okay, we all know how the Diner operates:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg199-2.png" alt="Images" width="965" height="641" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg199-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Let’s study the interaction in a little more detail..."><div class="sect1" id="letapostrophes_study_the_interaction_in">
<h1>Let’s study the interaction in a little more detail...</h1>
<p><strong>...and given this Diner is in Objectville, let’s think about the object and method calls involved, too!</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg200.png" alt="Images" width="991" height="1033" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg200.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Objectville Diner roles and responsibilities"><div class="sect1" id="the_objectville_diner_roles_and_responsi">
<h1>The Objectville Diner roles and responsibilities</h1>
<p><strong>An Order Slip encapsulates a request to prepare a meal.</strong></p>
<p><strong>Think of the Order Slip as an object, an object that acts as a request to prepare a meal. </strong>Like any object, it can be passed around—from the Waitress to the order counter, or to the next Waitress taking over her shift. It has an interface that consists of only one method, orderUp(), that encapsulates the actions needed to prepare the meal. It also has a reference to the object that needs to prepare it (in our case, the Cook). It’s encapsulated in that the Waitress doesn’t have to know what’s in the order or even who prepares the meal; she only needs to pass the slip through the order window and call “Order up!”</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg201-1.png" alt="Images" width="416" height="368" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg201-1.png">
<h6></h6>
</div></figure>
<div class="note">
<p>Okay, in real life a waitress would probably care what is on the Order Slip and who cooks it, but this is Objectville... work with us here!</p>
</div>
<p><strong>The Waitress’s job is to take Order Slips and invoke the orderUp() method on them.</strong></p>
<p><strong>The Waitress has it easy: take an order from the customer, continue helping customers until she makes it back to the order counter, then invoke the orderUp() method to have the meal prepared. </strong>As we’ve already discussed, in Objectville, the Waitress really isn’t worried about what’s on the order or who is going to prepare it; she just knows Order Slips have an orderUp() method she can call to get the job done.</p>
<p>Now, throughout the day, the Waitress’s takeOrder() method gets parameterized with different Order Slips from different customers, but that doesn’t faze her; she knows all Order Slips support the orderUp() method and she can call orderUp() any time she needs a meal prepared.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg201-2.png" alt="Images" width="343" height="411" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg201-2.png">
<h6></h6>
</div></figure>
<p><strong>The Short Order Cook has the knowledge required to prepare the meal.</strong></p>
<p><strong>The Short Order Cook is the object that really knows how to prepare meals. </strong>Once the Waitress has invoked the orderUp() method; the Short Order Cook takes over and implements all the methods that are needed to create meals. Notice the Waitress and the Cook are totally decoupled: the Waitress has Order Slips that encapsulate the details of the meal; she just calls a method on each order to get it prepared. Likewise, the Cook gets his instructions from the Order Slip; he never needs to directly communicate with the Waitress.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg201-3.png" alt="Images" width="387" height="251" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg201-3.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg202-1.png" alt="Images" width="380" height="668" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg202-1.png">
<h6></h6>
</div></figure>
<p><strong>Patience, we’re getting there... </strong></p>
<p>Think of the Diner as a model for an OO design pattern that allows us to separate an object making a request from the objects that receive and execute those requests. For instance, in our remote control API, we need to separate the code that gets invoked when we press a button from the objects of the vendor-specific classes that carry out those requests. What if each slot of the remote held an object like the Diner’s Order Slip object? Then, when a button is pressed, we could just call the equivalent of the “orderUp()” method on this object and have the lights turn on without the remote knowing the details of how to make those things happen or what objects are making them happen.</p>
<p>Now, let’s switch gears a bit and map all this Diner talk to the Command Pattern...</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000289">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Images" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>Before we move on, spend some time studying the diagram two pages back along with Diner roles and responsibilities until you think you’ve got a handle on the Objectville Diner objects and relationships. Once you’ve done that, get ready to nail the Command Pattern!</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg202-2.png" alt="Images" width="422" height="314" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg202-2.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="From the Diner to the Command Pattern"><div class="sect1" id="from_the_diner_to_the_command_pattern">
<h1>From the Diner to the Command Pattern</h1>
<p>Okay, we’ve spent enough time in the Objectville Diner that we know all the personalities and their responsibilities quite well. Now we’re going to rework the Diner diagram to reflect the Command Pattern. You’ll see that all the players are the same; only the names have changed. </p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg203.png" alt="Images" width="937" height="969" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg203.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="loading_the_invoker-id000001">
<h5>Loading the Invoker</h5>
<ol>
<li><p>The client creates a command object.</p></li>
<li><p>The client does a setCommand() to store the command object in the invoker.</p></li>
<li><p><strong>Later</strong>... the client asks the invoker to execute the command. Note: as you’ll see later in the chapter, once the command is loaded into the invoker, it may be used and discarded, or it may remain and be used many times.</p></li>
</ol>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="who_does_whatquestion_mark-id000002">
<h5>Who Does What?</h5>
<p>Match the diner objects and methods with the corresponding names from the Command Pattern.</p>
<table class="border">
<thead>
<tr>
<th>Diner</th>
<th>Command Pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td>Waitress</td>
<td>Command</td>
</tr>
<tr>
<td>Short Order Cook</td>
<td>execute()</td>
</tr>
<tr>
<td>orderUp()</td>
<td>Client</td>
</tr>
<tr>
<td>Order</td>
<td>Invoker</td>
</tr>
<tr>
<td>Customer</td>
<td>Receiver</td>
</tr>
<tr>
<td>takeOrder()</td>
<td>setCommand()</td>
</tr>
</tbody>
</table>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Our first command object"><div class="sect1" id="our_first_command_object">
<h1>Our first command object</h1>
<p>Isn’t it about time we build our first command object? Let’s go ahead and write some code for the remote control. While we haven’t figured out how to design the remote control API yet, building a few things from the bottom up may help us...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg205-1.png" alt="Images" width="164" height="164" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg205-1.png">
<h6></h6>
</div></figure>
<p><strong>Implementing the Command interface</strong></p>
<p>First things first: all command objects implement the same interface, which consists of one method. In the Diner we called this method orderUp(); however, we typically just use the name execute().</p>
<p>Here’s the Command interface:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg205-2.png" alt="Images" width="835" height="76" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg205-2.png">
<h6></h6>
</div></figure>
<p><strong>Implementing a command to turn a light on</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg205-3.png" alt="Images" width="320" height="124" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg205-3.png">
<h6></h6>
</div></figure>
<p>Now, let’s say you want to implement a command for turning a light on. Referring to our set of vendor classes, the Light class has two methods: on() and off(). Here’s how you can implement this as a command:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg205-4.png" alt="Images" width="896" height="410" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg205-4.png">
<h6></h6>
</div></figure>
<p>Now that you’ve got a LightOnCommand class, let’s see if we can put it to use...</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Using the command object"><div class="sect1" id="using_the_command_object">
<h1>Using the command object</h1>
<p>Okay, let’s make things simple: say we’ve got a remote control with only one button and corresponding slot to hold a device to control:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg206-1.png" alt="Images" width="928" height="365" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg206-1.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Creating a simple test to use the Remote Control"><div class="sect1" id="creating_a_simple_test_to_use_the_remote">
<h1>Creating a simple test to use the Remote Control</h1>
<p>Here’s just a bit of code to test out the simple remote control. Let’s take a look and we’ll point out how the pieces match the Command Pattern diagram:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg206-2.png" alt="Images" width="965" height="518" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg206-2.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id04308">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>Okay, it’s time for you to implement the GarageDoorOpenCommand class. First, supply the code for the class below. You’ll need the GarageDoor class diagram.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg207-1.png" alt="Images" width="356" height="182" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg207-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg207-2.png" alt="Images" width="502" height="230" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg207-2.png">
<h6></h6>
</div></figure>
<p>Now that you’ve got your class, what is the output of the following code? (Hint: the GarageDoor up() method prints out “Garage Door is Open” when it is complete.)</p>
<pre data-type="programlisting">public class RemoteControlTest {
    public static void main(String[] args) {
        SimpleRemoteControl remote = new SimpleRemoteControl();
        Light light = new Light();
        GarageDoor garageDoor = new GarageDoor();
        LightOnCommand lightOn = new LightOnCommand(light);
        GarageDoorOpenCommand garageOpen =
            new GarageDoorOpenCommand(garageDoor);


        remote.setCommand(lightOn);
        remote.buttonWasPressed();
        remote.setCommand(garageOpen);
        remote.buttonWasPressed();
    }
}
</pre>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg207-3.png" alt="Images" width="849" height="164" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg207-3.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Command Pattern defined"><div class="sect1" id="the_command_pattern_defined">
<h1>The Command Pattern defined</h1>
<p>You’ve done your time in the Objectville Diner, you’ve partly implemented the remote control API, and in the process you’ve got a fairly good picture of how the classes and objects interact in the Command Pattern. Now we’re going to define the Command Pattern and nail down all the details. </p>
<p>Let’s start with its official definition:</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id000003">
<p><strong>The Command Pattern</strong> encapsulates a request as an object, thereby letting you parameterize other objects with different requests, queue or log requests, and support undoable operations.</p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg208-1.png" alt="Images" width="279" height="320" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg208-1.png">
<h6></h6>
</div></figure>
<p>Let’s step through this. We know that a command object <em>encapsulates a request</em> by binding together a set of actions on a specific receiver. To achieve this, it packages the actions and the receiver up into an object that exposes just one method, execute(). When called, execute() causes the actions to be invoked on the receiver. From the outside, no other objects really know what actions get performed on what receiver; they just know that if they call the execute() method, their request will be serviced.</p>
<p>We’ve also seen a couple examples of <em>parameterizing an object</em> with a command. Back at the diner, the Waitress was parameterized with multiple orders throughout the day. In the simple remote control, we first loaded the button slot with a “light on” command and then later replaced it with a “garage door open” command. Like the Waitress, your remote slot didn’t care what command object it had, as long as it implemented the Command interface.</p>
<p>What we haven’t encountered yet is using commands to implement<em> queues and logs and support undo operations</em>. Don’t worry, those are pretty straightforward extensions of the basic Command Pattern and we will get to them soon. We can also easily support what’s known as the Meta Command Pattern once we have the basics in place. The Meta Command Pattern allows you to create macros of commands so that you can execute multiple commands at once.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg208-2.png" alt="Images" width="404" height="460" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg208-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Command Pattern defined: the class diagram"><div class="sect1" id="the_command_pattern_defined_the_class_di">
<h1>The Command Pattern defined: the class diagram</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg209.png" alt="Images" width="996" height="759" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg209.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000290">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Images" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>How does the design of the Command Pattern support the decoupling of the invoker of a request and the receiver of the request?</p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg210.png" alt="Images" width="458" height="724" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg210.png">
<h6></h6>
</div></figure>
<p><strong>Mary</strong>: Me too. So where do we begin?</p>
<p><strong>Sue</strong>: Like we did in the SimpleRemote, we need to provide a way to assign commands to slots. In our case we have seven slots, each with an “on” and “off ” button. So we might assign commands to the remote something like this: </p>
<pre data-type="programlisting"><strong>onCommands[0] = onCommand;</strong>
<strong>offCommands[0] = offCommand;</strong>
</pre>
<p>and so on for each of the seven command slots.</p>
<p><strong>Mary</strong>: That makes sense, except for the Light objects. How does the remote know the living room from the kitchen light?</p>
<p><strong>Sue</strong>: Ah, that’s just it, it doesn’t! The remote doesn’t know anything but how to call execute() on the corresponding command object when a button is pressed.</p>
<p><strong>Mary</strong>: Yeah, I sorta got that, but in the implementation, how do we make sure the right objects are turning on and off the right devices?</p>
<p><strong>Sue</strong>: When we create the commands to be loaded into the remote, we create one LightCommand that is bound to the living room light object and another that is bound to the kitchen light object. Remember, the receiver of the request gets bound to the command it’s encapsulated in. So, by the time the button is pressed, no one cares which light is which; the right thing just happens when the execute() method is called.</p>
<p><strong>Mary</strong>: I think I’ve got it. Let’s implement the remote and I think this will get clearer!</p>
<p><strong>Sue</strong>: Sounds good. Let’s give it a shot...</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Assigning Commands to slots"><div class="sect1" id="assigning_commands_to_slots">
<h1>Assigning Commands to slots</h1>
<p>So we have a plan: we’re going to assign a command to each slot in the remote control. This makes the remote control our <em>invoker</em>. When a button is pressed the execute() method is going to be called on the corresponding command, which results in actions being invoked on the receiver (like lights, ceiling fans, and stereos).</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg211.png" alt="Images" width="939" height="832" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg211.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Implementing the Remote Control"><div class="sect1" id="implementing_the_remote_control">
<h1>Implementing the Remote Control</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg212.png" alt="Images" width="950" height="1095" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg212.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Implementing the Commands"><div class="sect1" id="implementing_the_commands">
<h1>Implementing the Commands</h1>
<p>Well, we’ve already gotten our feet wet implementing the LightOnCommand for the SimpleRemoteControl. We can plug that same code in here and everything works beautifully. Off commands are no different; in fact, the LightOffCommand looks like this:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg213-1.png" alt="Images" width="832" height="323" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg213-1.png">
<h6></h6>
</div></figure>
<p>Let’s try something a little more challenging; how about writing on and off commands for the Stereo? Okay, off is easy, we just bind the Stereo to the off() method in the StereoOffCommand. On is a little more complicated; let’s say we want to write a StereoOnWithCDCommand...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg213-2.png" alt="Images" width="218" height="207" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg213-2.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg213-3.png" alt="Images" width="892" height="384" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg213-3.png">
<h6></h6>
</div></figure>
<p>Not too bad. Take a look at the rest of the vendor classes; by now, you can definitely knock out the rest of the Command classes we need for those.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Putting the Remote Control through its paces"><div class="sect1" id="putting_the_remote_control_through_its_p">
<h1>Putting the Remote Control through its paces</h1>
<p>Our job with the remote is pretty much done; all we need to do is run some tests and get some documentation together to describe the API. Home Automation or Bust, Inc. sure is going to be impressed, don’t ya think? We’ve managed to come up with a design that is going to allow them to produce a remote that is easy to maintain and they’re going to have no trouble convincing the vendors to write some simple command classes in the future since they are so easy to write.</p>
<p>Let’s get to testing this code! </p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg214.png" alt="Images" width="928" height="837" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg214.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg215-1.png" alt="Images" width="1004" height="417" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg215-1.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Now, let’s check out the execution of our remote control test..."><div class="sect1" id="nowcomma_letapostrophes_check_out_the_ex">
<h1>Now, let’s check out the execution of our remote control test...</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg215-2.png" alt="Images" width="981" height="512" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg215-2.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg216-1.png" alt="Images" width="422" height="699" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg216-1.png">
<h6></h6>
</div></figure>
<p>Good catch. We did sneak a little something in there. In the remote control, we didn’t want to check to see if a command was loaded every time we referenced a slot. For instance, in the onButtonWasPushed() method, we would need code like this:</p>
<pre data-type="programlisting">      <strong>public void onButtonWasPushed(int slot) {</strong>
          <span style="background-color:#DCDDDE;"><strong>if (onCommands[slot] != null) {</strong></span>
              <strong>onCommands[slot].execute();</strong>
          <strong>}</strong>
      <strong>}</strong>
</pre>
<p>So, how do we get around that? Implement a command that does nothing!</p>
<pre data-type="programlisting">      <strong>public class NoCommand implements Command {</strong>
          <strong>public void execute() { }</strong>
      <strong>}</strong>
</pre>
<p>Then, in our RemoteControl constructor, we assign every slot a NoCommand object by default and we know we’ll always have some command to call in each slot.</p>
<pre data-type="programlisting">      <strong>Command noCommand = new NoCommand();</strong>
      <strong>for (int i = 0; i &lt; 7; i++) {</strong>
          <strong>onCommands[i] = noCommand;</strong>
          <strong>offCommands[i] = noCommand;</strong>
      <strong>}</strong>
</pre>
<p>So in the output of our test run, you are seeing only slots that have been assigned to a command other than the default NoCommand object, which we assigned when we created the RemoteControl.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="pattern_honorable_mention-id000001">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg216-2.png" alt="Images" width="94" height="155" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg216-2.png"> Pattern Honorable Mention</h5>
<p>The NoCommand object is an example of a <em>null object</em>. A null object is useful when you don’t have a meaningful object to return, and yet you want to remove the responsibility for handling <strong>null</strong> from the client. For instance, in our remote control we didn’t have a meaningful object to assign to each slot out of the box, so we provided a NoCommand object that acts as a surrogate and does nothing when its execute method is called.</p>
<p>You’ll find uses for Null Objects in conjunction with many Design Patterns and sometimes you’ll even see Null Object listed as a Design Pattern.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Time to write that documentation..."><div class="sect1" id="time_to_write_that_documentationhellip">
<h1>Time to write that documentation...</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg217.png" alt="Images" width="1000" height="1105" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg217.png">
<h6></h6>
</div></figure>

<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="serious_coding-id000001">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg218-1.png" alt="Images" width="129" height="139" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg218-1.png"> Serious Coding</h5>
<p>Want to take your Command Pattern coding to the next level? You can use Java’s lambda expressions to skip the step of creating all those concrete command objects. With lambda expressions, instead of instantiating the concrete command objects, you can use <em>function objects</em> in their place. In other words, we can use a function object <em>as a command</em>. And, while we’re at it, we can delete all those concrete Command classes, too. </p>
<p>Let’s take a look at how you’d use lambda expressions as commands to simplify our previous code:</p>
<p><strong>The updated code, using lambda expressions:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg218-2.png" alt="Images" width="977" height="482" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg218-2.png">
<h6></h6>
</div></figure>
<p>Once we’ve replaced the concrete commands with lambda expressions, we can then delete all those concrete command classes (LightOnCommand, LightOffCommand, HottubOnCommand, HottubOffCommand, etc.). If you do this for every concrete command, you’ll reduce the total number of classes in the remote control application from 22 to 9.</p>
<p>Note that you can only do this if your Command interface has <em>one</em> abstract method. As soon as we add a second abstract method, the lambda short hand no longer works.</p>
<p>If you like this technique, check out your favorite Java reference for more information on the lambda expression.</p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg219-1.png" alt="Images" width="625" height="385" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg219-1.png">
<h6></h6>
</div></figure>
<div class="note">
<p><strong>Whoops! We almost forgot... luckily, once we have our basic Command classes, undo is easy to add. Let’s step through adding undo to our commands and to the remote control...</strong></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What are we doing?"><div class="sect1" id="what_are_we_doingquestion_mark">
<h1>What are we doing?</h1>
<p>Okay, we need to add functionality to support the undo button on the remote. It works like this: say the Living Room Light is off and you press the on button on the remote. Obviously the light turns on. Now if you press the undo button then the last action will be reversed—in this case, the light will turn off. Before we get into more complex examples, let’s get the light working with the undo button:</p>
<ol>
<li><p>When commands support undo, they have an undo() method that mirrors the execute() method. Whatever execute() last did, undo() reverses. So, before we can add undo to our commands, we need to add an undo() method to the Command interface:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg219-2.png" alt="Images" width="586" height="107" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg219-2.png">
<h6></h6>
</div></figure>
<p>That was simple enough.</p>
<p>Now, let’s dive into the Light command and implement the undo() method.</p></li>
<li><p>Let’s start with the LightOnCommand: if the LightOnCommand’s execute() method was called, then the on() method was last called. We know that undo() needs to do the opposite of this by calling the off() method.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg220-1.png" alt="Images" width="571" height="388" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg220-1.png">
<h6></h6>
</div></figure>
<p>Piece of cake! Now for the LightOffCommand. Here the undo() method just needs to call the Light’s on() method.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg220-2.png" alt="Images" width="539" height="388" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg220-2.png">
<h6></h6>
</div></figure>
<p>Could this be any easier? Okay, we aren’t done yet; we need to work a little support into the Remote Control to handle tracking the last button pressed and the undo button press.</p></li>
<li><p>To add support for the undo button we only have to make a few small changes to the Remote Control class. Here’s how we’re going to do it: we’ll add a new instance variable to track the last command invoked; then, whenever the undo button is pressed, we retrieve that command and invoke its undo() method.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg221.png" alt="Images" width="883" height="974" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg221.png">
<h6></h6>
</div></figure></li>
</ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Time to QA that Undo button!"><div class="sect1" id="time_to_qa_that_undo_buttonexclamation_m">
<h1>Time to QA that Undo button!</h1>
<p>Okay, let’s rework the test harness a bit to test the undo button:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg222-1.png" alt="Images" width="972" height="532" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg222-1.png">
<h6></h6>
</div></figure>
<p>And here are the test results...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg222-2.png" alt="Images" width="778" height="475" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg222-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Using state to implement Undo"><div class="sect1" id="using_state_to_implement_undo">
<h1>Using state to implement Undo</h1>
<p>Okay, implementing undo on the Light was instructive but a little too easy. Typically, we need to manage a bit of state to implement undo. Let’s try something a little more interesting, like the CeilingFan from the vendor classes. The CeilingFan allows a number of speeds to be set along with an off method.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg223-1.png" alt="Images" width="225" height="192" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg223-1.png">
<h6></h6>
</div></figure>
<p>Here’s the source code for the CeilingFan:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg223-2.png" alt="Images" width="986" height="907" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg223-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Adding Undo to the CeilingFan commands"><div class="sect1" id="adding_undo_to_the_ceilingfan_commands">
<h1>Adding Undo to the CeilingFan commands</h1>
<p>Now let’s tackle adding undo to the various CeilingFan commands. To do so, we need to track the last speed setting of the fan and, if the undo() method is called, restore the fan to its previous setting. Here’s the code for the CeilingFanHighCommand:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg224-1.png" alt="Images" width="313" height="178" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg224-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg224-2.png" alt="Images" width="923" height="669" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg224-2.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000192">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png" alt="Images" width="77" height="68" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1.png"></span> BRAIN POWER</h5>
<p>We’ve got three more ceiling fan commands to write: low, medium, and off. Can you see how these are implemented?</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Get ready to test the ceiling fan"><div class="sect1" id="get_ready_to_test_the_ceiling_fan">
<h1>Get ready to test the ceiling fan</h1>
<p>Time to load up our remote control with the ceiling fan commands. We’re going to load slot 0’s on button with the medium setting for the fan and slot 1 with the high setting. Both corresponding off buttons will hold the ceiling fan off command.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg225-1.png" alt="Images" width="465" height="420" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg225-1.png">
<h6></h6>
</div></figure>
<p>Here’s our test script:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg225-2.png" alt="Images" width="973" height="763" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg225-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Testing the ceiling fan..."><div class="sect1" id="testing_the_ceiling_fanhellip">
<h1>Testing the ceiling fan...</h1>
<p>Okay, let’s fire up the remote, load it with commands, and push some buttons!</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg226.png" alt="Images" width="990" height="958" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg226.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Every remote needs a Party Mode!"><div class="sect1" id="every_remote_needs_a_party_modeexclamati">
<h1>Every remote needs a Party Mode!</h1>
<p><strong>What’s the point of having a remote if you can’t push one button and have the lights dimmed, the stereo and TV turned on and set to a DVD, and the hot tub fired up?</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg227-1.png" alt="Images" width="394" height="329" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg227-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg227-2.png" alt="Images" width="949" height="923" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg227-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Using a macro command"><div class="sect1" id="using_a_macro_command">
<h1>Using a macro command</h1>
<p>Let’s step through how we use a macro command:</p>
<ol>
<li><p>First we create the set of commands we want to go into the macro:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg228-1.png" alt="Images" width="855" height="259" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg228-1.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00309">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>We will also need commands for the off buttons. Write the code to create those here:</p>
</div></aside></li>
<li><p>Next we create two arrays, one for the On commands and one for the Off commands, and load them with the corresponding commands:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg228-2.png" alt="Images" width="850" height="242" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg228-2.png">
<h6></h6>
</div></figure></li>
<li><p>Then we assign MacroCommand to a button like we always do:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg228-3.png" alt="Images" width="850" height="78" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg228-3.png">
<h6></h6>
</div></figure></li>
<li><p>Finally, we just need to push some buttons and see if this works.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg229.png" alt="Images" width="950" height="1005" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg229.png">
<h6></h6>
</div></figure></li>
</ol>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-id000001">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3.png" alt="Images" width="123" height="103" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3.png"></span> Exercise</h5>
<p>The only thing our MacroCommand is missing is its undo functionality. When the undo button is pressed after a macro command, all the commands that were invoked in the macro must undo their previous actions. Here’s the code for MacroCommand; go ahead and implement the undo() method:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg230.png" alt="Images" width="656" height="446" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg230.png">
<h6></h6>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0000105">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Do I always need a receiver? Why can’t the command object implement the details of the execute() method?</strong></p>
<p><strong>A</strong>: In general, we strive for “dumb” command objects that just invoke an action on a receiver; however, there are many examples of “smart” command objects that implement most, if not all, of the logic needed to carry out a request. Certainly you can do this; just keep in mind you’ll no longer have the same level of decoupling between the invoker and receiver, nor will you be able to parameterize your commands with receivers.</p>
<p><strong>Q: How can I implement a history of undo operations? In other words, I want to be able to press the undo button multiple times?</strong></p>
<p><strong>A</strong>: Great question. It’s pretty easy actually; instead of keeping just a reference to the last Command executed, you keep a stack of previous commands. Then, whenever undo is pressed, your invoker pops the first item off the stack and calls its undo() method. </p>
<p><strong>Q: Could I have just implemented party mode as a Command by creating a PartyCommand and putting the calls to execute the other Commands in the PartyCommand’s execute() method?</strong></p>
<p><strong>A</strong>: You could; however, you’d essentially be “hardcoding” the party mode into the PartyCommand. Why go to the trouble? With the MacroCommand, you can decide dynamically which Commands you want to go into the PartyCommand, so you have more flexibility using MacroCommands. In general, the MacroCommand is a more elegant solution and requires less new code.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="More uses of the Command Pattern: queuing requests"><div class="sect1" id="more_uses_of_the_command_pattern_queuing">
<h1>More uses of the Command Pattern: queuing requests</h1>
<p>Commands give us a way to package a piece of computation (a receiver and a set of actions) and pass it around as a first-class object. Now, the computation itself may be invoked long after some client application creates the command object. In fact, it may even be invoked by a different thread. We can take this scenario and apply it to many useful applications such as schedulers, thread pools, and job queues, to name a few.</p>
<p>Imagine a job queue: you add commands to the queue on one end, and on the other end sits a group of threads. Threads run the following script: they remove a command from the queue, call its execute() method, wait for the call to finish, then discard the command object and retrieve a new one.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg231.png" alt="Images" width="828" height="776" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg231.png">
<h6></h6>
</div></figure>
<p>Note that the job queue classes are totally decoupled from the objects that are doing the computation. One minute a thread may be computing a financial computation, and the next it may be retrieving something from the network. The job queue objects don’t care; they just retrieve commands and call execute(). Likewise, as long as you put objects into the queue that implement the Command Pattern, your execute() method will be invoked when a thread is available.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000093">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1a.png" alt="Images" width="73" height="66" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-1a.png"></span> BRAIN POWER</h5>
<p>How might a web server make use of such a queue? What other applications can you think of?</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="More uses of the Command Pattern: logging requests"><div class="sect1" id="more_uses_of_the_command_pattern_logging">
<h1>More uses of the Command Pattern: logging requests</h1>
<p>The semantics of some applications require that we log all actions and be able to recover after a crash by reinvoking those actions. The Command Pattern can support these semantics with the addition of two methods: store() and load(). In Java we could use object serialization to implement these methods, but the normal caveats for using serialization for persistence apply.</p>
<p>How does this work? As we execute commands, we store a history of them on disk. When a crash occurs, we reload the command objects and invoke their execute() methods in batch and in order.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg232-1.png" alt="Images" width="259" height="343" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg232-1.png">
<h6></h6>
</div></figure>
<p>Now, this kind of logging wouldn’t make sense for a remote control; however, there are many applications that invoke actions on large data structures that can’t be quickly saved each time a change is made. By using logging, we can save all the operations since the last check point, and if there is a system failure, apply those operations to our checkpoint. Take, for example, a spreadsheet application: we might want to implement our failure recovery by logging the actions on the spreadsheet rather than writing a copy of the spreadsheet to disk every time a change occurs. In more advanced applications, these techniques can be extended to apply to sets of operations in a transactional manner so that all of the operations complete, or none of them do.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg232-2.png" alt="Images" width="947" height="539" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg232-2.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Command Pattern in the Real World"><div class="sect1" id="command_pattern_in_the_real_world">
<h1>Command Pattern in the Real World</h1>
<p>Remember the little life changing application from <a data-type="xref" href="ch02.html#the_observer_pattern_keeping_your_object">Chapter 2</a>?</p>
<p>In that chapter we saw how Java’s Swing library is chock full of Observers in the form of ActionListeners that listen in (or <em>observe</em>) events on user interface components. </p>
<p>Well, it turns out that ActionListener is not just an Observer interface, it’s also a Command interface, and our AngelListener and DevilListener classes are not just Observers, they are also concrete Commands. That’s right, we have two patterns in one example! </p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg233.png" alt="Images" width="551" height="305" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg233.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00310">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil</h5>
<p>Here’s the code (the important bits anyway) for the little life changing application from <a data-type="xref" href="ch02.html#the_observer_pattern_keeping_your_object">Chapter 2</a>. See if you can identify who is the client, who are the Commands, who is the Invoker, and who is the Receiver?</p>
<pre data-type="programlisting"><strong>public class SwingObserverExample {</strong>
       <strong>// Set up ...</strong>
        <strong>JButton button = new JButton("Should I do it?");</strong>
        <strong>button.addActionListener(new AngelListener());</strong>
        <strong>button.addActionListener(new DevilListener());</strong>
        <strong>// Set frame properties here</strong>
   <strong>}</strong>
   <strong>class AngelListener implements ActionListener {</strong>
        <strong>public void actionPerformed(ActionEvent event) {</strong>
            <strong>System.out.println("Don't do it, you might regret it!");</strong>
        <strong>}</strong>
   <strong>}</strong>
   <strong>class DevilListener implements ActionListener {</strong>
       <strong>public void actionPerformed(ActionEvent event) {</strong>
           <strong>System.out.println("Come on, do it!");</strong>
       <strong>}</strong>
   <strong>}</strong>
<strong>}</strong>
</pre>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id000006">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>Here’s the code (the important bits anyway) for the little life changing application from <a data-type="xref" href="ch02.html#the_observer_pattern_keeping_your_object">Chapter 2</a>. See if you can identify who is the client, who are the Commands, who is the Invoker, and who is the Receiver?</p>
<p>Here’s our solution.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg234.png" alt="Images" width="931" height="863" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg234.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Tools for your Design Toolbox"><div class="sect1" id="tools_for_your_design_toolbox-id09001">
<h1>Tools for your Design Toolbox</h1>
<p>Your toolbox is starting to get heavy! In this chapter we’ve added a pattern that allows us to encapsulate methods into Command objects: store them, pass them around, and invoke them when you need them.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg235-1.png" alt="Images" width="144" height="137" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg235-1.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg235-2.png" alt="Images" width="631" height="872" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg235-2.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id000042">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-2.png" alt="Images" width="108" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-2.png"></span> BULLET POINTS</h5>
<ul>
<li><p>The Command Pattern decouples an object making a request from the one that knows how to perform it.</p></li>
<li><p>A Command object is at the center of this decoupling and encapsulates a receiver with an action (or set of actions) .</p></li>
<li><p>An invoker makes a request of a Command object by calling its execute() method, which invokes those actions on the receiver.</p></li>
<li><p>Invokers can be parameterized with Commands, even dynamically at runtime.</p></li>
<li><p>Commands may support undo by implementing an undo method that restores the object to its previous state before the execute() method was last called.</p></li>
<li><p>Macro Commands are a simple extension of Command that allow multiple commands to be invoked. Likewise, Macro Commands can easily support undo().</p></li>
<li><p>In practice, it is not uncommon for “smart” Command objects to implement the request themselves rather than delegating to a receiver.</p></li>
<li><p>Commands may also be used to implement logging and transactional systems.</p></li>
</ul>
</div></aside>
<section data-type="sect2" data-pdf-bookmark=" Design Patterns Crossword"><div class="sect2" id="design_patterns_crossword-id00002">
<h2><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3.png" alt="Images" width="123" height="103" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3.png"> Design Patterns Crossword</h2>
<p>Time to take a breather and let it all sink in.</p>
<p>It’s another crossword; all of the solution words are from this chapter. </p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg236.png" alt="Images" width="816" height="585" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg236.png">
<h6></h6>
</div></figure>
<p><strong>ACROSS</strong></p>
<p>3. The Waitress was one.</p>
<p>4. A command __________ a set of actions and areceiver.</p>
<p>7. Dr. Seuss diner food.</p>
<p>8. Our favorite city.</p>
<p>9. Act as the receivers in the remote control.</p>
<p>13. Object that knows the actions and the receiver.</p>
<p>14. Another thing Command can do.</p>
<p>15. Object that knows how to get things done.</p>
<p>17. A command encapsulates this.</p>
<p><strong>DOWN</strong></p>
<p>1. Role of customer in the Command Pattern.</p>
<p>2. Our first command object controlled this.</p>
<p>5. Invoker and receiver are _________.</p>
<p>6. Company that got us word-of-mouth business.</p>
<p>10. All commands provide this.</p>
<p>11. The Cook and this person were definitely decoupled.</p>
<p>12. Carries out a request.</p>
<p>16. Waitress didn’t do this.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="who_does_what_solutionquestion_mar">
<h5>Who Does What Solution?</h5>
<p>Match the diner objects and methods with the corresponding names from the Command Pattern</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg237-1.png" alt="Images" width="595" height="417" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg237-1.png">
<h6></h6>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id000007">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>Here’s the code for the GarageDoorOpenCommand class.</p>
<pre data-type="programlisting"><strong>public class GarageDoorOpenCommand implements Command {</strong>
   <span style="background-color:#DCDDDE;"><strong>GarageDoor garageDoor;</strong></span>

   <span style="background-color:#DCDDDE;"><strong>public GarageDoorOpenCommand(GarageDoor garageDoor) {</strong></span>
      <span style="background-color:#DCDDDE;"><strong>this.garageDoor = garageDoor;</strong></span>
   <span style="background-color:#DCDDDE;"><strong>}</strong></span>
   <span style="background-color:#DCDDDE;"><strong>public void execute() {</strong></span>
      <span style="background-color:#DCDDDE;"><strong>garageDoor.up();</strong></span>
   <span style="background-color:#DCDDDE;"><strong>}</strong></span>
<strong>}</strong>
</pre>
<p>Here’s the output:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg237-2.png" alt="Images" width="520" height="145" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg237-2.png">
<h6></h6>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-id000001">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3.png" alt="Images" width="123" height="103" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com-3.png"></span> Exercise Solution</h5>
<p>Here is the undo() method for the MacroCommand.</p>
<pre data-type="programlisting"><strong>public class MacroCommand implements Command {</strong>
    <strong>Command[] commands;</strong>
    <strong>public MacroCommand(Command[] commands) {</strong>
        <strong>this.commands = commands;</strong>
    <strong>}</strong>
    <strong>public void execute() {</strong>
        <strong>for (int i = 0; i &lt; commands.length; i++) {</strong>
            <strong>commands[i].execute();</strong>
        <strong>}</strong>
    <strong>}</strong>
    <span style="background-color:#DCDDDE;"><strong>public void undo() {</strong></span>
        <span style="background-color:#DCDDDE;"><strong>for (int i = commands.length - 1; i &gt; = 0; i--) {</strong></span>
            <span style="background-color:#DCDDDE;"><strong>commands[i].undo();</strong></span>
        <span style="background-color:#DCDDDE;"><strong>}</strong></span>
    <span style="background-color:#DCDDDE;"><strong>}</strong></span>
<strong>}</strong>
</pre>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id000008">
<h5><span class="inlineimage"><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png" alt="Images" width="117" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/com.png"></span> Sharpen your pencil Solution</h5>
<p>Here is the code to create commands for the off button.</p>
<pre data-type="programlisting"><strong>LightOffCommand lightOff = new LightOffCommand(light);</strong>
<strong>StereoOffCommand stereoOff = new StereoOffCommand(stereo);</strong>
<strong>TVOffCommand tvOff = new TVOffCommand(tv);</strong>
<strong>HottubOffCommand hottubOff = new HottubOffCommand(hottub);</strong>
</pre>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg238.png" alt="Images" width="634" height="468" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg238.png">
<h6></h6>
</div></figure>
</div></section>
</div></section>
</div></section><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 7. The Adapter and Facade Patterns Being Adaptive"><div class="chapter" id="the_adapter_and_facade_patterns_being_ad">
<h1><span class="label">Chapter 7. </span>The Adapter and Facade Patterns Being Adaptive</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg243-01.png" alt="Images" width="963" height="658" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg243-01.png">
<h6></h6>
</div></figure>
<p><strong>In this chapter we’re going to attempt such impossible feats as putting a square peg in a round hole.</strong> Sound impossible? Not when we have Design Patterns. Remember the Decorator Pattern? We <strong>wrapped objects</strong> to give them new responsibilities. Now we’re going to wrap some objects with a different purpose: to make their interfaces look like something they’re not. Why would we do that? So we can adapt a design expecting one interface to a class that implements a different interface. That’s not all; while we’re at it, we’re going to look at another pattern that wraps objects to simplify their interface.</p>
<section data-type="sect1" data-pdf-bookmark="Adapters all around us"><div class="sect1" id="adapters_all_around_us">
<h1>Adapters all around us</h1>
<p><strong>You’ll have no trouble understanding what an OO adapter is because the real world is full of them. How’s this for an example: Have you ever needed to use a US-made laptop in Great Britain? Then you’ve probably needed an AC power adapter...</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg244-01.png" alt="Images" width="808" height="575" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg244-01.png">
<h6></h6>
</div></figure>
<p>You know what the adapter does: it sits in between the plug of your laptop and the British AC outlet; its job is to adapt the British outlet so that you can plug your laptop into it and receive power. Or look at it this way: the adapter changes the interface of the outlet into one that your laptop expects.</p>
<div class="note">
<p><span class="ash">How many other real-world adapters can you think of?</span></p>
</div>
<p>Some AC adapters are simple—they only change the shape of the outlet so that it matches your plug, and they pass the AC current straight through—but other adapters are more complex internally and may need to step the power up or down to match your devices’ needs.</p>
<p>Okay, that’s the real world; what about object-oriented adapters? Well, our OO adapters play the same role as their real-world counterparts: they take an interface and adapt it to one that a client is expecting.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Object-oriented adapters"><div class="sect1" id="object_oriented_adapters">
<h1>Object-oriented adapters</h1>
<p>Say you’ve got an existing software system that you need to work a new vendor class library into, but the new vendor designed their interfaces differently than the last vendor:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg245-01.png" alt="Images" width="640" height="239" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg245-01.png">
<h6></h6>
</div></figure>
<p>Okay, you don’t want to solve the problem by changing your existing code (and you can’t change the vendor’s code). So what do you do? Well, you can write a class that adapts the new vendor interface into the one you’re expecting.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg245-02.png" alt="Images" width="557" height="272" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg245-02.png">
<h6></h6>
</div></figure>
<p>The adapter acts as the middleman by receiving requests from the client and converting them into requests that make sense on the vendor classes.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg245-03.png" alt="Images" width="775" height="216" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg245-03.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="If it walks like a duck and quacks like a duck, then it must might be a duck turkey wrapped with a duck adapter..."><div class="sect1" id="if_it_walks_like_a_duck_and_quacks_like">
<h1>If it walks like a duck and quacks like a duck, then it <span class="strikeout">must</span> might be a <span class="strikeout">duck</span> turkey wrapped with a duck adapter...</h1>
<p>It’s time to see an adapter in action. Remember our ducks from <a data-type="xref" href="ch01.html#intro_to_design_patterns_welcome_to_desi">Chapter 1</a>? Let’s review a slightly simplified version of the Duck interfaces and classes:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg246-01.png" alt="Images" width="134" height="268" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg246-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg246-02.png" alt="Images" width="565" height="167" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg246-02.png">
<h6></h6>
</div></figure>
<p>Here’s a subclass of Duck, the MallardDuck.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg246-03.png" alt="Images" width="788" height="261" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg246-03.png">
<h6></h6>
</div></figure>
<p>Now it’s time to meet the newest fowl on the block:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg246-04.png" alt="Images" width="609" height="185" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg246-04.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg247-01.png" alt="Images" width="813" height="261" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg247-01.png">
<h6></h6>
</div></figure>
<p>Now, let’s say you’re short on Duck objects and you’d like to use some Turkey objects in their place. Obviously we can’t use the turkeys outright because they have a different interface.</p>
<p>So, let’s write an Adapter:</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="code_up_close-id0000001">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg247-02.png" alt="Images" width="92" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg247-02.png"> Code Up Close</h5>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg247-03.png" alt="Images" width="874" height="617" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg247-03.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Test drive the adapter"><div class="sect1" id="test_drive_the_adapter">
<h1>Test drive the adapter</h1>
<p>Now we just need some code to test drive our adapter:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg248-01.png" alt="Images" width="946" height="1068" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg248-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Adapter Pattern explained"><div class="sect1" id="the_adapter_pattern_explained">
<h1>The Adapter Pattern explained</h1>
<p>Now that we have an idea of what an Adapter is, let’s step back and look at all the pieces again.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg249-01.png" alt="Images" width="953" height="521" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg249-01.png">
<h6></h6>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Here’s how the Client uses the Adapter"><div class="sect2" id="hereapostrophes_how_the_client_uses_the">
<h2>Here’s how the Client uses the Adapter</h2>
<ol>
<li><p><strong>The client makes a request to the adapter by calling a method on it using the target interface.</strong></p></li>
<li><p><strong>The adapter translates the request into one or more calls on the adaptee using the adaptee interface.</strong></p></li>
<li><p><strong>The client receives the results of the call and never knows there is an adapter doing the translation.</strong></p></li>
</ol>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg249-02.png" alt="Images" width="283" height="120" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg249-02.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00311">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-01.png" alt="Images" width="191" height="140" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-01.png"> Sharpen your pencil</h5>
<p>Let’s say we also need an Adapter that converts a Duck to a Turkey. Let’s call it DuckAdapter. Write that class:</p>
<p>How did you handle the fly method (after all, we know ducks fly longer than turkeys)? Check the answers at the end of the chapter for our solution. Did you think of a better way?</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0000110">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: How much “adapting” does an adapter need to do? It seems like if I need to implement a large target interface, I could have a LOT of work on my hands?</strong></p>
<p><strong>A</strong>: You certainly could. The job of implementing an adapter really is proportional to the size of the interface you need to support as your target interface. Think about your options, however. You could rework all your client-side calls to the interface, which would result in a lot of investigative work and code changes. Or, you can cleanly provide one class that encapsulates all the changes in that class.</p>
<p><strong>Q: Does an adapter always wrap one and only one class?</strong></p>
<p><strong>A</strong>: The Adapter Pattern’s role is to convert one interface into another. While most examples of the adapter pattern show an adapter wrapping one adaptee, we both know the world is often a bit more messy. So, you may well have situations where an adapter holds two or more adaptees that are needed to implement the target interface.</p>
<p>This relates to another pattern called the Facade Pattern; people often confuse the two. Remind us to revisit this point when we talk about facades later in this chapter.</p>
<p><strong>Q: What if I have old and new parts of my system, and the old parts expect the old vendor interface, but we’ve already written the new parts to use the new vendor interface? It is going to get confusing using an adapter here and the unwrapped interface there. Wouldn’t I be better off just writing my older code and forgetting the adapter?</strong></p>
<p><strong>A</strong>: Not necessarily. One thing you can do is create a Two Way Adapter that supports both interfaces. To create a Two Way Adapter, just implement both interfaces involved, so the adapter can act as an old interface or a new interface.</p>
</div></aside>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Adapter Pattern defined"><div class="sect1" id="adapter_pattern_defined">
<h1>Adapter Pattern defined</h1>
<p>Enough ducks, turkeys, and AC power adapters; let’s get real and look at the official definition of the Adapter Pattern:</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id0000010">
<p><strong>The Adapter Pattern</strong> converts the interface of a class into another interface the clients expect. Adapter lets classes work together that couldn’t otherwise because of incompatible interfaces.</p>
</div></aside>
<p>Now, we know this pattern allows us to use a client with an incompatible interface by creating an Adapter that does the conversion. This acts to decouple the client from the implemented interface, and if we expect the interface to change over time, the adapter encapsulates that change so that the client doesn’t have to be modified each time it needs to operate against a different interface.</p>
<p>We’ve taken a look at the runtime behavior of the pattern; let’s take a look at its class diagram as well:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg251-01.png" alt="Images" width="789" height="332" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg251-01.png">
<h6></h6>
</div></figure>
<p>The Adapter Pattern is full of good object-oriented design principles: check out the use of object composition to wrap the adaptee with an altered interface. This approach has the added advantage that we can use an adapter with any subclass of the adaptee.</p>
<p>Also check out how the pattern binds the client to an interface, not an implementation; we could use several adapters, each converting a different backend set of classes. Or, we could add new implementations after the fact, as long as they adhere to the Target interface.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Object and class adapters"><div class="sect1" id="object_and_class_adapters">
<h1>Object and class adapters</h1>
<p>Now despite having defined the pattern, we haven’t told you the whole story yet. There are actually <em>two</em> kinds of adapters: <em>object</em> adapters and <em>class</em> adapters. This chapter has covered object adapters and the class diagram on the previous page is a diagram of an object adapter.</p>
<p>So what’s a <em>class</em> adapter and why haven’t we told you about it? Because you need multiple inheritance to implement it, which isn’t possible in Java. But, that doesn’t mean you might not encounter a need for class adapters down the road when using your favorite multiple inheritance language! Let’s look at the class diagram for multiple inheritance.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-01.png" alt="Images" width="945" height="336" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-01.png">
<h6></h6>
</div></figure>
<p>Look familiar? That’s right—the only difference is that with class adapter we subclass the Target and the Adaptee, while with object adapter we use composition to pass requests to an Adaptee.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000094">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png" alt="Images" width="76" height="74" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png"> BRAIN POWER</h5>
<p>Object adapters and class adapters use two different means of adapting the adaptee (composition versus inheritance). How do these implementation differences affect the flexibility of the adapter?</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Duck Magnets"><div class="sect1" id="duck_magnets">
<h1>Duck Magnets</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg253-01.png" alt="Images" width="96" height="144" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg253-01.png">
<h6></h6>
</div></figure>
<p>Your job is to take the duck and turkey magnets and drag them over the part of the diagram that describes the role played by that bird, in our earlier example. (Try not to flip back through the pages.) Then add your own annotations to describe how it works.</p>
<p><strong>Class Adapter</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg253-02.png" alt="Images" width="648" height="207" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg253-02.png">
<h6></h6>
</div></figure>
<p><strong>Object Adapter</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg253-03.png" alt="Images" width="642" height="239" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg253-03.png">
<h6></h6>
</div></figure>
<div class="note">
<p><span class="ash">Drag these onto the class diagram, to show which part of the diagram represents the Duck and which represents the Turkey.</span></p>
</div>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg253-04.png" alt="Images" width="455" height="215" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg253-04.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Duck Magnets Answer"><div class="sect1" id="duck_magnets_answer">
<h1><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg254-01.png" alt="Images" width="63" height="92" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg254-01.png"> Duck Magnets Answer</h1>
<div class="note">
<p><span class="ash">Note: the class adapter uses multiple inheritance, so you can’t do it in Java...</span></p>
</div>
<p><strong>Class Adapter</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg254-02.png" alt="Images" width="940" height="433" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg254-02.png">
<h6></h6>
</div></figure>
<p><strong>Object Adapter</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg254-03.png" alt="Images" width="937" height="491" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg254-03.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg255-01.png" alt="Images" width="277" height="144" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg255-01.png">
<h6></h6>
</div></figure>
<p>Tonight’s talk: <strong>The Object Adapter and Class Adapter meet face to face.</strong></p>
<table class="border">
<tbody>
<tr>
<td><strong>Object Adapter:</strong></td>
<td><strong>Class Adapter:</strong></td>
</tr>
<tr>
<td>Because I use composition I’ve got a leg up. I can not only adapt an adaptee class, but any of its subclasses.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>That’s true, I do have trouble with that because I am committed to one specific adaptee class, but I have a huge advantage because I don’t have to reimplement my entire adaptee. I can also override the behavior of my adaptee if I need to because I’m just subclassing.</td>
</tr>
<tr>
<td>In my part of the world, we like to use composition over inheritance; you may be saving a few lines of code, but all I’m doing is writing a little code to delegate to the adaptee. We like to keep things flexible.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Flexible maybe, but efficient? No. Using a class adapter there is just one of me, not an adapter and an adaptee.</td>
</tr>
<tr>
<td>You’re worried about one little object? You might be able to quickly override a method, but any behavior I add to my adapter code works with my adaptee class <em>and</em> all its subclasses.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Yeah, but what if a subclass of adaptee adds some new behavior. Then what?</td>
</tr>
<tr>
<td>Hey, come on, cut me a break, I just need to compose with the subclass to make that work.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Sounds messy...</td>
</tr>
<tr>
<td>You wanna see messy? Look in the mirror!</td>
<td></td>
</tr>
</tbody>
</table>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Real-world adapters"><div class="sect1" id="real_world_adapters">
<h1>Real-world adapters</h1>
<p>Let’s take a look at the use of a simple Adapter in the real world (something more serious than Ducks at least)...</p>
<section data-type="sect2" data-pdf-bookmark="Enumerators"><div class="sect2" id="enumerators">
<h2>Enumerators</h2>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg256-01.png" alt="Images" width="500" height="278" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg256-01.png">
<h6></h6>
</div></figure>
<p>If you’ve been around Java for a while you probably remember that the early collection types (Vector, Stack, Hashtable, and a few others) implement a method, elements(), which returns an Enumeration. The Enumeration interface allows you to step through the elements of a collection without knowing the specifics of how they are managed in the collection.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Iterators"><div class="sect1" id="iterators">
<h1>Iterators</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg256-02.png" alt="Images" width="550" height="301" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg256-02.png">
<h6></h6>
</div></figure>
<p>The more recent Collection classes use an Iterator interface that, like Enumeration, allows you to iterate through a set of items in a collection, and adds the ability to remove items.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Using Enumerators with code that expects Iterators"><div class="sect1" id="using_enumerators_with_code_that_expects">
<h1>Using Enumerators with code that expects Iterators</h1>
<p>We are sometimes faced with legacy code that exposes the Enumeration interface, yet we’d like for our new code to use only Iterators. It looks like we need to build an adapter.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Adapting an Enumeration to an Iterator"><div class="sect1" id="adapting_an_enumeration_to_an_iterator">
<h1>Adapting an Enumeration to an Iterator</h1>
<p>First we’ll look at the two interfaces to figure out how the methods map from one to the other. In other words, we’ll figure out what to call on the adaptee when the client invokes a method on the target.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg257-01.png" alt="Images" width="726" height="350" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg257-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Designing the Adapter"><div class="sect1" id="designing_the_adapter">
<h1>Designing the Adapter</h1>
<p>Here’s what the classes should look like: we need an adapter that implements the Target interface and that is composed with an adaptee. The hasNext() and next() methods are going to be straightforward to map from target to adaptee: we just pass them right through. But what do you do about remove()? Think about it for a moment (and we’ll deal with it on the next page). For now, here’s the class diagram:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg257-02.png" alt="Images" width="965" height="330" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg257-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Dealing with the remove() method"><div class="sect1" id="dealing_with_the_removeleft_parenthesisr">
<h1>Dealing with the remove() method</h1>
<p>Well, we know Enumeration just doesn’t support remove. It’s a “read only” interface. There’s no way to implement a fully functioning remove() method on the adapter. The best we can do is throw a runtime exception. Luckily, the designers of the Iterator interface foresaw this need and defined the remove() method so that it supports an UnsupportedOperationException.</p>
<p>This is a case where the adapter isn’t perfect; clients will have to watch out for potential exceptions, but as long as the client is careful and the adapter is well documented this is a perfectly reasonable solution.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Writing the EnumerationIterator adapter"><div class="sect1" id="writing_the_enumerationiterator_adapter">
<h1>Writing the EnumerationIterator adapter</h1>
<p>Here’s simple but effective code for all those legacy classes still producing Enumerations:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg258-01.png" alt="Images" width="938" height="681" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg258-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-id006001">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg259-01.png" alt="Images" width="122" height="103" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg259-01.png"> Exercise</h5>
<p>While Java has gone in the direction of the Iterator, there is nevertheless still legacy client code that depends on the Enumeration interface, so an Adapter that converts an Iterator to an Enumeration could potentially be useful.</p>
<p>Write an Adapter that adapts an Iterator to an Enumeration. You can test your code by adapting an ArrayList. The ArrayList class supports the Iterator interface but doesn’t support Enumerations.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000095">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png" alt="Images" width="76" height="74" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png"> BRAIN POWER</h5>
<p>Some AC adapters do more than just change the interface<strong>—</strong>they add other features like surge protection, indicator lights, and other bells and whistles.</p>
<p>If you were going to implement these kinds of features, what pattern would you use?</p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg260-01.png" alt="Images" width="277" height="144" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg260-01.png">
<h6></h6>
</div></figure>
<p>Tonight’s talk: <strong>The Decorator Pattern and the Adapter Pattern discuss their differences.</strong></p>
<table class="border">
<tbody>
<tr>
<td><strong>Decorator:</strong></td>
<td><strong>Adapter:</strong></td>
</tr>
<tr>
<td>I’m important. My job is all about <em>responsibility</em>—you know that when a Decorator is involved there’s going to be some new responsibilities or behaviors added to your design.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>You decorators want all the glory while us adapters are down in the trenches doing the dirty work: converting interfaces. Our jobs may not be glamorous, but our clients sure do appreciate us making their lives simpler.</td>
</tr>
<tr>
<td>That may be true, but don’t think we don’t work hard. When we have to decorate a big interface, whoa, that can take a lot of code.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Try being an adapter when you’ve got to bring several classes together to provide the interface your client is expecting. Now that’s tough. But we have a saying: “an decoupled client is a happy client.”</td>
</tr>
<tr>
<td>Cute. Don’t think we get all the glory; sometimes I’m just one decorator that is being wrapped by who knows how many other decorators. When a method call gets delegated to you, you have no idea how many other decorators have already dealt with it and you don’t know that you’ll ever get noticed for your efforts servicing the request.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Hey, if adapters are doing their job, our clients never even know we’re there. It can be a thankless job.</td>
</tr>
<tr>
<td></td>
<td>But, the great thing about us adapters is that we allow clients to make use of new libraries and subsets without changing <em>any</em> code; they just rely on us to do the conversion for them. Hey, it’s a niche, but we’re good at it.</td>
</tr>
<tr>
<td>Well, us decorators do that as well, only we allow <em>new behavior</em> to be added to classes without altering existing code. I still say that adapters are just fancy decorators—I mean, just like us, you wrap an object.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>No, no, no, not at all. We <em>always</em> convert the interface of what we wrap; you <em>never</em> do. I’d say a decorator is like an adapter; it is just that you don’t change the interface!</td>
</tr>
<tr>
<td>Uh, no. Our job in life is to extend the behaviors or responsibilities of the objects we wrap; we aren’t a <em>simple pass through</em>.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Hey, who are you calling a simple pass through? Come on down and we’ll see how long <em>you</em> last converting a few interfaces!</td>
</tr>
<tr>
<td>Maybe we should agree to disagree. We seem to look somewhat similar on paper, but clearly we are <em>miles</em> apart in our <em>intent</em>.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Oh yeah, I’m with you there.</td>
</tr>
</tbody>
</table>
</div></section>
<section data-type="sect1" data-pdf-bookmark="And now for something different..."><div class="sect1" id="and_now_for_something_differenthellip">
<h1>And now for something different...</h1>
<p><strong>There’s another pattern in this chapter.</strong></p>
<p>You’ve seen how the Adapter Pattern converts the interface of a class into one that a client is expecting. You also know we achieve this in Java by wrapping the object that has an incompatible interface with an object that implements the correct one.</p>
<p>We’re going to look at a pattern now that alters an interface, but for a different reason: to simplify the interface. It’s aptly named the Facade Pattern because this pattern hides all the complexity of one or more classes behind a clean, well-lit facade.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="who_does_whatquestion_mark">
<h5>WHO DOES WHAT?</h5>
<p>Match each pattern with its intent:</p>
<table class="border">
<thead>
<tr>
<th><u>Pattern</u></th>
<th><u>Intent</u></th>
</tr>
</thead>
<tbody>
<tr>
<td>Decorator</td>
<td>Converts one interface to another</td>
</tr>
<tr>
<td>Adapter</td>
<td>Doesn’t alter the interface, but adds responsibility</td>
</tr>
<tr>
<td>Facade</td>
<td>Makes an interface simpler</td>
</tr>
</tbody>
</table>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Home Sweet Home Theater"><div class="sect1" id="home_sweet_home_theater">
<h1>Home Sweet Home Theater</h1>
<p>Before we dive into the details of the Facade Pattern, let’s take a look at a growing national obsession: building a nice theater to binge watch all those movies and tv series.</p>
<p>You’ve done your research and you’ve assembled a killer system complete with a streaming player, a projection video system, an automated screen, surround sound, and even a popcorn popper.</p>
<p>Check out all the components you’ve put together:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg263-01.png" alt="Images" width="221" height="190" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg263-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg263-02.png" alt="Images" width="875" height="620" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg263-02.png">
<h6></h6>
</div></figure>
<p>You’ve spent weeks running wire, mounting the projector, making all the connections, and fine tuning. Now it’s time to put it all in motion and enjoy a movie...</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Watching a movie (the hard way)"><div class="sect1" id="watching_a_movie_left_parenthesisthe_har">
<h1>Watching a movie (the hard way)</h1>
<p><strong>Pick out a movie, relax, and get ready for movie magic. Oh, there’s just one thing—to watch the movie, you need to perform a few tasks:</strong></p>
<ol>
<li><p><strong>Turn on the popcorn popper</strong></p></li>
<li><p><strong>Start the popper popping</strong></p></li>
<li><p><strong>Dim the lights</strong></p></li>
<li><p><strong>Put the screen down</strong></p></li>
<li><p><strong>Turn the projector on</strong></p></li>
<li><p><strong>Set the projector input to streaming player</strong></p></li>
<li><p><strong>Put the projector on wide-screen mode</strong></p></li>
<li><p><strong>Turn the sound amplifier on</strong></p></li>
<li><p><strong>Set the amplifier to streaming player input</strong></p></li>
<li><p><strong>Set the amplifier to surround sound</strong></p></li>
<li><p><strong>Set the amplifier volume to medium (5)</strong></p></li>
<li><p><strong>Turn the streaming player on</strong></p></li>
<li><p><strong>Start playing the movie</strong></p></li>
</ol>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg264-01.png" alt="Images" width="492" height="466" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg264-01.png">
<h6></h6>
</div></figure>
<p><strong>Let’s check out those same tasks in terms of the classes and the method calls needed to perform them:</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg265-01.png" alt="Images" width="933" height="622" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg265-01.png">
<h6></h6>
</div></figure>
<p><strong>But there’s more...</strong></p>
<ul>
<li><p>When the movie is over, how do you turn everything off? Wouldn’t you have to do all of this over again, in reverse?</p></li>
<li><p>Wouldn’t it be as complex to listen to the radio?</p></li>
<li><p>If you decide to upgrade your system, you’re probably going to have to learn a slightly different procedure.</p></li>
</ul>
<p>So what to do? The complexity of using your home theater is becoming apparent!</p>
<p>Let’s see how the Facade Pattern can get us out of this mess so we can enjoy the movie...</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Lights, Camera, Facade!"><div class="sect1" id="lightscomma_cameracomma_facadeexclamatio">
<h1>Lights, Camera, Facade!</h1>
<p>A Facade is just what you need: with the Facade Pattern you can take a complex subsystem and make it easier to use by implementing a Facade class that provides one, more reasonable interface. Don’t worry; if you need the power of the complex subsystem, it’s still there for you to use, but if all you need is a straightforward interface, the Facade is there for you.</p>
<p> Let’s take a look at how the Facade operates:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg266-01.png" alt="Images" width="2500" height="1249" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg266-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0000106">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: If the facade encapsulates the subsystem classes, how does a client that needs lower-level functionality gain access to them?</strong></p>
<p><strong>A</strong>: Facades don’t “encapsulate” the subsystem classes; they merely provide a simplified interface to their functionality. The subsystem classes still remain available for direct use by clients that need to use more specific interfaces. This is a nice property of the Facade Pattern: it provides a simplified interface while still exposing the full functionality of the system to those who may need it.</p>
<p><strong>Q: Does the facade add any functionality or does it just pass through each request to the subsystem?</strong></p>
<p><strong>A</strong>: A facade is free to add its own “smarts” in addition to making use of the subsystem. For instance, while our home theater facade doesn’t implement any new behavior, it is smart enough to know that the popcorn popper has to be turned on before it can pop (as well as the details of how to turn on and stage a movie showing).</p>
<p><strong>Q: Does each subsystem have only one facade?</strong></p>
<p><strong>A</strong>: Not necessarily. The pattern certainly allows for any number of facades to be created for a given subsystem.</p>
<p><strong>Q: What is the benefit of the facade other than the fact that I now have a simpler interface?</strong></p>
<p><strong>A</strong>: The Facade Pattern also allows you to decouple your client implementation from any one subsystem. Let’s say that you get a big raise and decide to upgrade your home theater to all new components that have different interfaces. Well, if you coded your client to the facade rather than the subsystem, your client code doesn’t need to change, just the facade (and hopefully the manufacturer is supplying that!).</p>
<p><strong>Q: So the way to tell the difference between the Adapter Pattern and the Facade Pattern is that the adapter wraps one class and the facade may represent many classes?</strong></p>
<p><strong>A</strong>: No! Remember, the Adapter Pattern changes the interface of one or more classes into one interface that a client is expecting. While most textbook examples show the adapter adapting one class, you may need to adapt many classes to provide the interface a client is coded to. Likewise, a Facade may provide a simplified interface to a single class with a very complex interface.</p>
<p>The difference between the two is not in terms of how many classes they “wrap,” it is in their intent. The intent of the Adapter Pattern is to alter an interface so that it matches one a client is expecting. The intent of the Facade Pattern is to provide a simplified interface to a subsystem.</p>
</div></aside>
<div class="note">
<p><strong>A facade not only simplifies an interface, it decouples a client from a subsystem of components.</strong></p>
</div>
<div class="note">
<p><strong>Facades and adapters may wrap multiple classes, but a facade’s intent is to simplify, while an adapter’s is to convert the interface to something different.</strong></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Constructing your home theater facade"><div class="sect1" id="constructing_your_home_theater_facade">
<h1>Constructing your home theater facade</h1>
<p>Let’s step through the construction of the HomeTheaterFacade. The first step is to use composition so that the facade has access to all the components of the subsystem:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg269-01.png" alt="Images" width="835" height="879" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg269-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Implementing the simplified interface"><div class="sect1" id="implementing_the_simplified_interface">
<h1>Implementing the simplified interface</h1>
<p>Now it’s time to bring the components of the subsystem together into a unified interface. Let’s implement the watchMovie() and endMovie() methods:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg270-01.png" alt="Images" width="954" height="786" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg270-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000096">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png" alt="Images" width="76" height="74" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png"> BRAIN POWER</h5>
<p>Think about the facades you’ve encountered in the Java API. Where would you like to have a few new ones?</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Time to watch a movie (the easy way)"><div class="sect1" id="time_to_watch_a_movie_left_parenthesisth">
<h1>Time to watch a movie (the easy way)</h1>
<p>It’s showtime!</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg271-01.png" alt="Images" width="128" height="109" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg271-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg271-02.png" alt="Images" width="986" height="1040" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg271-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Facade Pattern defined"><div class="sect1" id="facade_pattern_defined">
<h1>Facade Pattern defined</h1>
<p>To use the Facade Pattern, we create a class that simplifies and unifies a set of more complex classes that belong to some subsystem. Unlike a lot of patterns, Facade is fairly straightforward; there are no mind-bending abstractions to get your head around. But that doesn’t make it any less powerful: the Facade Pattern allows us to avoid tight coupling between clients and subsystems, and, as you will see shortly, also helps us adhere to a new object-oriented principle.</p>
<p>Before we introduce that new principle, let’s take a look at the official definition of the pattern:</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id0090002">
<p><strong>The Facade Pattern</strong> provides a unified interface to a set of interfaces in a subsystem. Facade defines a higher-level interface that makes the subsystem easier to use.</p>
</div></aside>
<p>There isn’t a lot here that you don’t already know, but one of the most important things to remember about a pattern is its intent. This definition tells us loud and clear that the purpose of the facade is to make a subsystem easier to use through a simplified interface. You can see this in the pattern’s class diagram:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg272-01.png" alt="Images" width="877" height="457" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg272-01.png">
<h6></h6>
</div></figure>
<p>That’s it; you’ve got another pattern under your belt! Now, it’s time for that new OO principle. Watch out, this one can challenge some assumptions!</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Principle of Least Knowledge"><div class="sect1" id="the_principle_of_least_knowledge">
<h1>The Principle of Least Knowledge</h1>
<p>The Principle of Least Knowledge guides us to reduce the interactions between objects to just a few close “friends.” The principle is usually stated as:</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="design_principle-id0000001">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg273-01.png" alt="Images" width="110" height="106" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg273-01.png"> <em>Design Principle</em></h5>
<p><em>Principle of Least Knowledge: talk only to your immediate friends.</em></p>
</div></aside>
<p>But what does this mean in real terms? It means when you are designing a system, for any object, be careful of the number of classes it interacts with and also how it comes to interact with those classes.</p>
<p>This principle prevents us from creating designs that have a large number of classes coupled together so that changes in one part of the system cascade to other parts. When you build a lot of dependencies between many classes, you are building a fragile system that will be costly to maintain and complex for others to understand.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000097">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png" alt="Images" width="76" height="74" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png"> BRAIN POWER</h5>
<p>How many classes is this code coupled to?</p>
<pre data-type="programlisting"><strong>public float getTemp() {
    return station.getThermometer().getTemperature();
}</strong>
</pre>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="How NOT to Win Friends and Influence Objects"><div class="sect1" id="how_not_to_win_friends_and_influence_obj">
<h1>How NOT to Win Friends and Influence Objects</h1>
<p>Okay, but how do you keep from doing this? The principle provides some guidelines: take any object; now from any method in that object, the principle tells us that we should only invoke methods that belong to:</p>
<ul>
<li><p>The object itself</p></li>
<li><p>Objects passed in as a parameter to the method</p></li>
<li><p>Any object the method creates or instantiates</p></li>
<li><p>Any components of the object</p></li>
</ul>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg274-01.png" alt="Images" width="613" height="236" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg274-01.png">
<h6></h6>
</div></figure>
<p>This sounds kind of stringent doesn’t it? What’s the harm in calling the method of an object we get back from another call? Well, if we were to do that, then we’d be making a request of another object’s subpart (and increasing the number of objects we directly know). In such cases, the principle forces us to ask the object to make the request for us; that way we don’t have to know about its component objects (and we keep our circle of friends small). For example:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg274-02.png" alt="Images" width="911" height="447" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg274-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Keeping your method calls in bounds..."><div class="sect1" id="keeping_your_method_calls_in_boundshelli">
<h1>Keeping your method calls in bounds...</h1>
<p>Here’s a Car class that demonstrates all the ways you can call methods and still adhere to the Principle of Least Knowledge:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg275-01.png" alt="Images" width="871" height="671" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg275-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0000107">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: There is another principle called the Law of Demeter; how are they related?</strong></p>
<p><strong>A</strong>: The two are one and the same and you’ll encounter these terms being used interchangeably. We prefer to use the Principle of Least Knowledge for a couple of reasons: (1) the name is more intuitive and (2) the use of the word “Law” implies we always have to apply this principle. In fact, no principle is a law, all principles should be used when and where they are helpful. All design involves tradeoffs (abstractions versus speed, space versus time, and so on) and while principles provide guidance, all factors should be taken into account before applying them.</p>
<p><strong>Q: Are there any disadvantages to applying the Principle of Least Knowledge?</strong></p>
<p><strong>A</strong>: Yes; while the principle reduces the dependencies between objects and studies have shown this reduces software maintenance, it is also the case that applying this principle results in more “wrapper” classes being written to handle method calls to other components. This can result in increased complexity and development time as well as decreased runtime performance.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00312">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-01.png" alt="Images" width="191" height="140" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-01.png"> Sharpen your Pencil</h5>
<p>Do either of these classes violate the Principle of Least Knowledge? Why or why not?</p>
<pre data-type="programlisting">public House {
    WeatherStation station;

    // other methods and constructor

    public float getTemp() {

        return station.getThermometer().getTemperature();
    }
}
public House {
    WeatherStation station;

    // other methods and constructor

    public float getTemp() {
        Thermometer thermometer = station.getThermometer();
        return getTempHelper(thermometer);
    }

    public float getTempHelper(Thermometer thermometer) {
        return thermometer.getTemperature();
 }
}
</pre>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-02.png" alt="Images" width="200" height="120" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-02.png">
<h6></h6>
</div></figure>
</div></aside>
<p><strong>HARD HAT AREA. WATCH OUT FOR FALLING ASSUMPTIONS</strong></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000098">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png" alt="Images" width="76" height="74" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png"> BRAIN POWER</h5>
<p>Can you think of a common use of Java that violates the Principle of Least Knowledge?</p>
<p>Should you care?</p>
<p>Answer: How about System.out.println()?</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Facade and the Principle of Least Knowledge"><div class="sect1" id="the_facade_and_the_principle_of_least_kn">
<h1>The Facade and the Principle of Least Knowledge</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg277-01.png" alt="Images" width="968" height="1040" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg277-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Tools for your Design Toolbox"><div class="sect1" id="tools_for_your_design_toolbox">
<h1>Tools for your Design Toolbox</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg278-01.png" alt="Images" width="113" height="108" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg278-01.png">
<h6></h6>
</div></figure>
<p>Your toolbox is starting to get heavy! In this chapter we’ve added a couple of patterns that allow us to alter interfaces and reduce coupling between clients and the systems they use.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg278-02.png" alt="Images" width="667" height="974" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg278-02.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id0000100">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg278-03.png" alt="Images" width="108" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg278-03.png"> BULLET POINTS</h5>
<ul>
<li><p>When you need to use an existing class and its interface is not the one you need, use an adapter.</p></li>
<li><p>When you need to simplify and unify a large interface or complex set of interfaces, use a facade.</p></li>
<li><p>An adapter changes an interface into one a client expects.</p></li>
<li><p>A facade decouples a client from a complex subsystem.</p></li>
<li><p>Implementing an adapter may require little work or a great deal of work depending on the size and complexity of the target interface.</p></li>
<li><p>Implementing a facade requires that we compose the facade with its subsystem and use delegation to perform the work of the facade.</p></li>
<li><p>There are two forms of the Adapter Pattern: object and class adapters. Class adapters require multiple inheritance.</p></li>
<li><p>You can implement more than one facade for a subsystem.</p></li>
<li><p>An adapter wraps an object to change its interface, a decorator wraps an object to add new behaviors and responsibilities, and a facade “wraps” a set of objects to simplify.</p></li>
</ul>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Design Patterns Crossword"><div class="sect1" id="design_patterns_crossword">
<h1>Design Patterns Crossword</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg279-01.png" alt="Images" width="148" height="93" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg279-01.png">
<h6></h6>
</div></figure>
<p>Yes, it’s another crossword. All of the solution words are from this chapter.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg279-02.png" alt="Images" width="798" height="543" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg279-02.png">
<h6></h6>
</div></figure>
<p><strong>ACROSS</strong></p>
<p>1. True or false? Adapters can wrap only one object.</p>
<p>5. An Adapter __________ an interface.</p>
<p>6. Movie we watched (five words).</p>
<p>10. If in Britain, you might need one of these (two words).</p>
<p>11. Adapter with two roles (two words).</p>
<p>14. Facade still ________ low-level access.</p>
<p>15. Ducks do it better than Turkeys.</p>
<p>16. Disadvantage of the Principle of Least Knowledge: too many __________.</p>
<p>17. A __________ simplifies an interface.</p>
<p>19. New American dream (two words).</p>
<p><strong>DOWN</strong></p>
<p>2. Decorator called Adapter this (three words).</p>
<p>3. One advantage of Facade.</p>
<p>4. Principle that wasn’t as easy as it sounded (two words).</p>
<p>7. A __________ adds new behavior.</p>
<p>8. Masquerading as a Duck.</p>
<p>9. Example that violates the Principle of Least Knowledge: System.out.__________.</p>
<p>12. No movie is complete without this.</p>
<p>13. Adapter client uses the __________ interface.</p>
<p>18. An Adapter and a Decorator can be said to ________ an object.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id00001">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-01.png" alt="Images" width="191" height="140" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-01.png"> Sharpen your pencil Solution</h5>
<p>Let’s say we also need an Adapter that converts a Duck to a Turkey. Let’s call it DuckAdapter. Here’s our solution:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg280-01.png" alt="Images" width="919" height="418" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg280-01.png">
<h6></h6>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id00002">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-01.png" alt="Images" width="191" height="140" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-01.png"> Sharpen your pencil Solution</h5>
<p>Do either of these classes violate the Principle of Least Knowledge? Why or why not?</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg280-02.png" alt="Images" width="942" height="482" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg280-02.png">
<h6></h6>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-id0000200">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg259-01.png" alt="Images" width="122" height="103" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg259-01.png"> Exercise Solution</h5>
<p>You’ve seen how to implement an adapter that adapts an Enumeration to an Iterator; now write an adapter that adapts an Iterator to an Enumeration.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg281-01.png" alt="Images" width="877" height="388" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg281-01.png">
<h6></h6>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="who_does_what_solutionquestion_mark">
<h5>WHO DOES WHAT SOLUTION?</h5>
<p>Match each pattern with its intent:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg281-02.png" alt="Images" width="634" height="363" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg281-02.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Design Patterns Crossword Solution"><div class="sect1" id="design_patterns_crossword_solution">
<h1>Design Patterns Crossword Solution</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg282-01.png" alt="Images" width="147" height="93" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg282-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg282-02.png" alt="Images" width="850" height="578" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg282-02.png">
<h6></h6>
</div></figure>
</div></section>
</div></section><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 8. The Template Method Pattern: Encapsulating Algorithms"><div class="chapter" id="the_template_method_pattern_encapsulatin">
<h1><span class="label">Chapter 8. </span>The Template Method Pattern: Encapsulating Algorithms</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg283-01.png" alt="Images" width="625" height="627" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg283-01.png">
<h6></h6>
</div></figure>
<p><strong>We’re on an encapsulation roll; we’ve encapsulated object creation, method invocation, complex interfaces, ducks, pizzas...what could be next?</strong> We’re going to get down to encapsulating pieces of algorithms so that subclasses can hook themselves right into a computation anytime they want. We’re even going to learn about a design principle inspired by Hollywood. Let’s get started...</p>
<section data-type="sect1" data-pdf-bookmark="It’s time for some more caffeine"><div class="sect1" id="itapostrophes_time_for_some_more_caffein">
<h1>It’s time for some more caffeine</h1>
<p>Some people can’t live without their coffee; some people can’t live without their tea. The common ingredient? Caffeine, of course!</p>
<p>But there’s more; tea and coffee are made in very similar ways. Let’s check it out:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg284-01.png" alt="Images" width="879" height="717" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg284-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Whipping up some coffee and tea classes (in Java)"><div class="sect1" id="whipping_up_some_coffee_and_tea_classes">
<h1>Whipping up some coffee and tea classes (in Java)</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg285-01.png" alt="Images" width="110" height="167" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg285-01.png">
<h6></h6>
</div></figure>
<p>Let’s play “coding barista” and write some code for creating coffee and tea.</p>
<p>Here’s the coffee:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg285-02.png" alt="Images" width="987" height="869" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg285-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="And now the Tea..."><div class="sect1" id="and_now_the_teahellip">
<h1>And now the Tea...</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg286-01.png" alt="Images" width="109" height="127" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg286-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg286-02.png" alt="Images" width="927" height="655" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg286-02.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg286-03.png" alt="Images" width="625" height="431" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg286-03.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="design_puzzle-id000001">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg287-01.png" alt="Images" width="143" height="90" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg287-01.png"> Design Puzzle</h5>
<p>You’ve seen that the Coffee and Tea classes have a fair bit of code duplication. Take another look at the Coffee and Tea classes and draw a class diagram showing how you’d redesign the classes to remove redundancy:</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Let’s astract that Coffee and Tea"><div class="sect1" id="letapostrophes_astract_that_coffee_and_t">
<h1>Let’s astract that Coffee and Tea</h1>
<p>It looks like we’ve got a pretty straightforward design exercise on our hands with the Coffee and Tea classes. Your first cut might have looked something like this:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg288-01.png" alt="Images" width="963" height="599" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg288-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000099">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png" alt="Images" width="76" height="74" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png"> BRAIN POWER</h5>
<p>Did we do a good job on the redesign? Hmmmm, take another look. Are we overlooking some other commonality? What are other ways that Coffee and Tea are similar?</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Taking the design further..."><div class="sect1" id="taking_the_design_furtherhellip">
<h1>Taking the design further...</h1>
<p>So what else do Coffee and Tea have in common? Let’s start with the recipes.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg289-01.png" alt="Images" width="741" height="383" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg289-01.png">
<h6></h6>
</div></figure>
<p>Notice that both recipes follow the same algorithm:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg289-02.png" alt="Images" width="934" height="315" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg289-02.png">
<h6></h6>
</div></figure>
<p>So, can we find a way to abstract prepareRecipe() too? Yes, let’s find out...</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Abstracting prepareRecipe()"><div class="sect1" id="abstracting_preparerecipeleft_parenthesi">
<h1>Abstracting prepareRecipe()</h1>
<p>Let’s step through abstracting prepareRecipe() from each subclass (that is, the Coffee and Tea classes)...</p>
<ol>
<li><p>The first problem we have is that Coffee uses brewCoffeeGrinds() and addSugarAndMilk() methods, while Tea uses steepTeaBag() and addLemon() methods.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg290-01.png" alt="Images" width="704" height="209" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg290-01.png">
<h6></h6>
</div></figure>
<p>Let’s think through this: steeping and brewing aren’t so different; they’re pretty analogous. So let’s make a new method name, say, brew(), and we’ll use the same name whether we’re brewing coffee or steeping tea.</p>
<p>Likewise, adding sugar and milk is pretty much the same as adding a lemon: both are adding condiments to the beverage. Let’s also make up a new method name, addCondiments(), to handle this. So, our new prepareRecipe() method will look like this:</p>
<pre data-type="programlisting"><strong>void prepareRecipe() {
    boilWater();
    <span style="color:#DCDDDE;">brew();</span>
    pourInCup();
    <span style="color:#DCDDDE;">addCondiments();</span>
}</strong>
</pre></li>
<li><p>Now we have a new prepareRecipe() method, but we need to fit it into the code. To do this we are going to start with the CaffeineBeverage superclass:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg290-02.png" alt="Images" width="193" height="88" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg290-02.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg291-01.png" alt="Images" width="900" height="606" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg291-01.png">
<h6></h6>
</div></figure></li>
<li><p>Finally, we need to deal with the Coffee and Tea classes. They now rely on CaffeineBeverage to handle the recipe, so they just need to handle brewing and condiments:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg291-02.png" alt="Images" width="925" height="473" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg291-02.png">
<h6></h6>
</div></figure></li>
</ol>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00313">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-01.png" alt="Images" width="191" height="140" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-01.png"> Sharpen your pencil</h5>
<p>Draw the new class diagram now that we’ve moved the implementation of prepareRecipe() into the CaffeineBeverage class:</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What have we done?"><div class="sect1" id="what_have_we_donequestion_mark">
<h1>What have we done?</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg293-01.png" alt="Images" width="964" height="1010" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg293-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Meet the Template Method"><div class="sect1" id="meet_the_template_method">
<h1>Meet the Template Method</h1>
<p>We’ve basically just implemented the Template Method Pattern. What’s that? Let’s look at the structure of the CaffeineBeverage class; it contains the actual “template method”:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg294-01.png" alt="Images" width="954" height="863" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg294-01.png">
<h6></h6>
</div></figure>
<div class="note">
<p><strong>The Template Method defines the steps of an algorithm and allows subclasses to provide the implementation for one or more steps.</strong></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Let’s make some tea..."><div class="sect1" id="letapostrophes_make_some_teahellip">
<h1>Let’s make some tea...</h1>
<p>Let’s step through making a tea and trace through how the template method works. You’ll see that the template method controls the algorithm; at certain points in the algorithm, it lets the subclass supply the implementation of the steps...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg295-01.png" alt="Images" width="105" height="95" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg295-01.png">
<h6></h6>
</div></figure>
<p><strong><em>Behind the Scenes</em></strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg295-02.png" alt="Images" width="970" height="836" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg295-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What did the Template Method get us?"><div class="sect1" id="what_did_the_template_method_get_usquest">
<h1>What did the Template Method get us?</h1>
<table class="border">
<tbody>
<tr>
<td><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg296-01.png" alt="Images" width="97" height="231" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg296-01.png"></td>
<td><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg296-02.png" alt="Images" width="159" height="251" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg296-02.png"></td>
</tr>
<tr>
<td><strong>Underpowered Tea &amp; Coffee implementation</strong></td>
<td><strong>New, hip CaffeineBeverage powered by Template Method</strong></td>
</tr>
<tr>
<td>Coffee and Tea are running the show; they control the algorithm.</td>
<td>The CaffeineBeverage class runs the show; it has the algorithm, and protects it.</td>
</tr>
<tr>
<td>Code is duplicated across Coffee and Tea.</td>
<td>The CaffeineBeverage class maximizes reuse among the subclasses.</td>
</tr>
<tr>
<td>Code changes to the algorithm require opening the subclasses and making multiple changes.</td>
<td>The algorithm lives in one place and code changes only need to be made there.</td>
</tr>
<tr>
<td>Classes are organized in a structure that requires a lot of work to add a new caffeine beverage.</td>
<td>The Template Method version provides a framework that other caffeine beverages can be plugged into. New caffeine beverages only need to implement a couple of methods.</td>
</tr>
<tr>
<td>Knowledge of the algorithm and how to implement it is distributed over many classes.</td>
<td>The CaffeineBeverage class concentrates knowledge about the algorithm and relies on subclasses to provide complete implementations.</td>
</tr>
</tbody>
</table>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Template Method Pattern defined"><div class="sect1" id="template_method_pattern_defined">
<h1>Template Method Pattern defined</h1>
<p>You’ve seen how the Template Method Pattern works in our Tea and Coffee example; now, check out the official definition and nail down all the details:</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000201">
<p><strong>The Template Method Pattern</strong> defines the skeleton of an algorithm in a method, deferring some steps to subclasses. Template Method lets subclasses redefine certain steps of an algorithm without changing the algorithm’s structure.</p>
</div></aside>
<p>This pattern is all about creating a template for an algorithm. What’s a template? As you’ve seen it’s just a method; more specifically, it’s a method that defines an algorithm as a set of steps. One or more of these steps is defined to be abstract and implemented by a subclass. This ensures the algorithm’s structure stays unchanged, while subclasses provide some part of the implementation.</p>
<p>Let’s check out the class diagram:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg297-01.png" alt="Images" width="913" height="589" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg297-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="code_up_close-id0000200">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg298-01.png" alt="Images" width="96" height="77" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg298-01.png"> Code Up Close</h5>
<p>Let’s take a closer look at how the AbstractClass is defined, including the template method and primitive operations.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg298-02.png" alt="Images" width="811" height="880" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg298-02.png">
<h6></h6>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="code_way_up_close-id0000201">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg299-01.png" alt="Images" width="89" height="121" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg299-01.png"> Code Way Up Close</h5>
<p>Now we’re going to look even closer at the types of method that can go in the abstract class:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg299-02.png" alt="Images" width="830" height="837" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg299-02.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Hooked on Template Method..."><div class="sect1" id="hooked_on_template_methodhellip">
<h1>Hooked on Template Method...</h1>
<p>A hook is a method that is declared in the abstract class, but only given an empty or default implementation. This gives subclasses the ability to “hook into” the algorithm at various points, if they wish; a subclass is also free to ignore the hook.</p>
<p>There are several uses of hooks; let’s take a look at one now. We’ll talk about a few other uses later:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg300-01.png" alt="Images" width="471" height="476" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg300-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg300-02.png" alt="Images" width="895" height="816" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg300-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Using the hook"><div class="sect1" id="using_the_hook">
<h1>Using the hook</h1>
<p>To use the hook, we override it in our subclass. Here, the hook controls whether the CaffeineBeverage evaluates a certain part of the algorithm; that is, whether it adds a condiment to the beverage.</p>
<p>How do we know whether the customer wants the condiment? Just ask!</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg301-01.png" alt="Images" width="933" height="925" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg301-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Let’s run the Test Drive"><div class="sect1" id="letapostrophes_run_the_test_drive">
<h1>Let’s run the Test Drive</h1>
<p>Okay, the water’s boiling... Here’s the test code where we create a hot tea and a hot coffee.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg302-01.png" alt="Images" width="898" height="385" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg302-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="And let’s give it a run..."><div class="sect1" id="and_letapostrophes_give_it_a_runhellip">
<h1>And let’s give it a run...</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg302-02.png" alt="Images" width="735" height="472" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg302-02.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg303-01.png" alt="Images" width="488" height="443" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg303-01.png">
<h6></h6>
</div></figure>
<p>You know what? We agree with you. But you have to admit before you thought of that, it was a pretty cool example of how a hook can be used to conditionally control the flow of the algorithm in the abstract class. Right?</p>
<p>We’re sure you can think of many other more realistic scenarios where you could use the template method and hooks in your own code.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0000108">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: When I’m creating a template method, how do I know when to use abstract methods and when to use hooks?</strong></p>
<p><strong>A</strong>: Use abstract methods when your subclass MUST provide an implementation of the method or step in the algorithm. Use hooks when that part of the algorithm is optional. With hooks, a subclass may choose to implement that hook, but it doesn’t have to.</p>
<p><strong>Q: What are hooks really supposed to be used for?</strong></p>
<p><strong>A</strong>: There are a few uses of hooks. As we just said, a hook may provide a way for a subclass to implement an optional part of an algorithm, or if it isn’t important to the subclass’s implementation, it can skip it. Another use is to give the subclass a chance to react to some step in the template method that is about to happen, or just happened. For instance, a hook method like justReorderedList() allows the subclass to perform some activity (such as redisplaying an onscreen representation) after an internal list is reordered. As you’ve seen, a hook can also provide a subclass with the ability to make a decision for the abstract class.</p>
<p><strong>Q: Does a subclass have to implement all the abstract methods in the AbstractClass?</strong></p>
<p><strong>A</strong>: Yes, each concrete subclass defines the entire set of abstract methods and provides a complete implementation of the undefined steps of the template method’s algorithm.</p>
<p><strong>Q: It seems like I should keep my abstract methods small in number; otherwise, it will be a big job to implement them in the subclass.</strong></p>
<p><strong>A</strong>: That’s a good thing to keep in mind when you write template methods. Sometimes this can be done by not making the steps of your algorithm too granular. But it’s obviously a trade off: the less granularity, the less flexibility.</p>
<p>Remember, too, that some steps will be optional; so you can implement these as hooks rather than abstract methods, easing the burden on the subclasses of your abstract class.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Hollywood Principle"><div class="sect1" id="the_hollywood_principle">
<h1>The Hollywood Principle</h1>
<p>We’ve got another design principle for you; it’s called the Hollywood Principle:</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id000020">
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg304-01.png" alt="Images" width="109" height="107" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg304-01.png">
<h6></h6>
</div></figure>
<p><strong><em>The Hollywood Principle</em></strong></p>
<p><em>Don’t call us, we’ll call you.</em></p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg304-02.png" alt="Images" width="437" height="524" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg304-02.png">
<h6></h6>
</div></figure>
<p>Easy to remember, right? But what has it got to do with OO design?</p>
<p>The Hollywood Principle gives us a way to prevent “dependency rot.” Dependency rot happens when you have high-level components depending on low-level components depending on high-level components depending on sideways components depending on low-level components, and so on. When rot sets in, no one can easily understand the way a system is designed.</p>
<p>With the Hollywood Principle, we allow low-level components to hook themselves into a system, but the high-level components determine when they are needed, and how. In other words, the high-level components give the low-level components a “don’t call us, we’ll call you” treatment.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg304-03.png" alt="Images" width="807" height="292" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg304-03.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Hollywood Principle and Template Method"><div class="sect1" id="the_hollywood_principle_and_template_met">
<h1>The Hollywood Principle and Template Method</h1>
<p>The connection between the Hollywood Principle and the Template Method Pattern is probably somewhat apparent: when we design with the Template Method Pattern, we’re telling subclasses, “don’t call us, we’ll call you.” How? Let’s take another look at our CaffeineBeverage design:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg305-01.png" alt="Images" width="945" height="558" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg305-01.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000100">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png" alt="Images" width="76" height="74" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png"> BRAIN POWER</h5>
<p>What other patterns make use of the Hollywood Principle?</p>
<p><span class="ash">The Factory Method, Observer; any others?</span></p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0000109">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: How does the Hollywood Principle relate to the Dependency Inversion Principle that we learned a few chapters back?</strong></p>
<p><strong>A</strong>: The Dependency Inversion Principle teaches us to avoid the use of concrete classes and instead work as much as possible with abstractions. The Hollywood Principle is a technique for building frameworks or components so that lower-level components can be hooked into the computation, but without creating dependencies between the lower-level components and the higher-level layers. So, they both have the goal of decoupling, but the Dependency Inversion Principle makes a much stronger and more general statement about how to avoid dependencies in design.</p>
<p>The Hollywood Principle gives us a technique for creating designs that allow low-level structures to interoperate while preventing other classes from becoming too dependent on them.</p>
<p><strong>Q: Is a low-level component disallowed from calling a method in a higher-level component?</strong></p>
<p><strong>A</strong>: Not really. In fact, a low-level component will often end up calling a method defined above it in the inheritance hierarchy purely through inheritance. But we want to avoid creating explicit circular dependencies between the low-level component and the high-level ones.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="who_does_whatquestion_mark-id00001">
<h5>WHO DOES WHAT?</h5>
<p>Match each pattern with its description:</p>
<table class="border">
<thead>
<tr>
<th><u>Pattern</u></th>
<th><u>Description</u></th>
</tr>
</thead>
<tbody>
<tr>
<td>Template Method</td>
<td>Encapsulate interchangeable behaviors and use delegation to decide which behavior to use.</td>
</tr>
<tr>
<td>Strategy</td>
<td>Subclasses decide how to implement steps in an algorithm.</td>
</tr>
<tr>
<td>Factory Method</td>
<td>Subclasses decide which concrete classes to instantiate.</td>
</tr>
</tbody>
</table>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Template Methods in the Wild"><div class="sect1" id="template_methods_in_the_wild">
<h1>Template Methods in the Wild</h1>
<p>The Template Method Pattern is a very common pattern and you’re going to find lots of it in the wild. You’ve got to have a keen eye, though, because there are many implementations of the template methods that don’t quite look like the textbook design of the pattern.</p>
<p>This pattern shows up so often because it’s a great design tool for creating frameworks, where the framework controls how something gets done, but leaves you (the person using the framework) to specify your own details about what is actually happening at each step of the framework’s algorithm.</p>
<p>Let’s take a little safari through a few uses in the wild (well, okay, in the Java API)...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg307-01.png" alt="Images" width="268" height="191" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg307-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg307-02.png" alt="Images" width="590" height="743" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg307-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Sorting with Template Method"><div class="sect1" id="sorting_with_template_method">
<h1>Sorting with Template Method</h1>
<p>What’s something we often need to do with arrays? Sort them!</p>
<p>Recognizing that, the designers of the Java Arrays class have provided us with a handy template method for sorting. Let’s take a look at how this method operates:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg308-01.png" alt="Images" width="986" height="1137" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg308-01.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We’ve got some ducks to sort..."><div class="sect1" id="weapostropheve_got_some_ducks_to_sorthel">
<h1>We’ve got some ducks to sort...</h1>
<p>Let’s say you have an array of ducks that you’d like to sort. How do you do it? Well, the sort template method in Arrays gives us the algorithm, but you need to tell it how to compare ducks, which you do by implementing the compareTo() method... Make sense?</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg309-01.png" alt="Images" width="238" height="267" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg309-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg309-02.png" alt="Images" width="522" height="574" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg309-02.png">
<h6></h6>
</div></figure>
<p>Good point. Here’s the deal: the designers of sort() wanted it to be useful across all arrays, so they had to make sort() a static method that could be used from anywhere. But that’s okay, it works almost the same as if it were in a superclass. Now, here is one more detail: because sort() really isn’t defined in our superclass, the sort() method needs to know that you’ve implemented the compareTo() method, or else you don’t have the piece needed to complete the sort algorithm.</p>
<p>To handle this, the designers made use of the Comparable interface. All you have to do is implement this interface, which has one method (surprise): compareTo().</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What is compareTo()?"><div class="sect1" id="what_is_comparetoleft_parenthesisright_p">
<h1>What is compareTo()?</h1>
<p>The compareTo() method compares two objects and returns whether one is less than, greater than, or equal to the other. sort() uses this as the basis of its comparison of objects in the array.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg309-03.png" alt="Images" width="799" height="249" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg309-03.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Comparing Ducks and Ducks"><div class="sect1" id="comparing_ducks_and_ducks">
<h1>Comparing Ducks and Ducks</h1>
<p>Okay, so you know that if you want to sort Ducks, you’re going to have to implement this compareTo() method; by doing that you’ll give the Arrays class what it needs to complete the algorithm and sort your ducks.</p>
<p>Here’s the duck implementation:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg310-01.png" alt="Images" width="270" height="227" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg310-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg310-02.png" alt="Images" width="984" height="898" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg310-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Let’s sort some Ducks"><div class="sect1" id="letapostrophes_sort_some_ducks">
<h1>Let’s sort some Ducks</h1>
<p>Here’s the test drive for sorting Ducks...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg311-01.png" alt="Images" width="932" height="654" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg311-01.png">
<h6></h6>
</div></figure>
<p><strong>Let the sorting commence!</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg311-02.png" alt="Images" width="529" height="391" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg311-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The making of the sorting duck machine"><div class="sect1" id="the_making_of_the_sorting_duck_machine">
<h1>The making of the sorting duck machine</h1>
<p>Let’s trace through how the Arrays sort() template method works. We’ll check out how the template method controls the algorithm, and at certain points in the algorithm, how it asks our Ducks to supply the implementation of a step...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg312-01.png" alt="Images" width="104" height="95" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg312-01.png">
<h6></h6>
</div></figure>
<p><strong>Behind the Scenes</strong></p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg312-02.png" alt="Images" width="959" height="977" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg312-02.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id0000117">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Is this really the Template Method Pattern, or are you trying too hard?</strong></p>
<p><strong>A</strong>: The pattern calls for implementing an algorithm and letting subclasses supply the implementation of the steps—and the Arrays sort is clearly not doing that! But, as we know, patterns in the wild aren’t always just like the textbook patterns. They have to be modified to fit the context and implementation constraints.</p>
<p>The designers of the Arrays sort() method had a few constraints. In general, you can’t subclass a Java array and they wanted the sort to be used on all arrays (and each array is a different class). So they defined a static method and deferred the comparison part of the algorithm to the items being sorted.</p>
<p>So, while it’s not a textbook template method, this implementation is still in the spirit of the Template Method Pattern. Also, by eliminating the requirement that you have to subclass Arrays to use this algorithm, they’ve made sorting in some ways more flexible and useful.</p>
<p><strong>Q: This implementation of sorting actually seems more like the Strategy Pattern than the Template Method Pattern. Why do we consider it Template Method?</strong></p>
<p><strong>A</strong>: You’re probably thinking that because the Strategy Pattern uses object composition. You’re right in a way—we’re using the Arrays object to sort our array, so that’s similar to Strategy. But remember, in Strategy, the class that you compose with implements the entire algorithm. The algorithm that Arrays implements for sort is incomplete; it needs a class to fill in the missing compareTo() method. So, in that way, it’s more like Template Method.</p>
<p><strong>Q: Are there other examples of template methods in the Java API?</strong></p>
<p><strong>A</strong>: Yes, you’ll find them in a few places. For example, java.io has a read() method in InputStream that subclasses must implement and is used by the template method read(byte b[], int off, int len).</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000101">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png" alt="Images" width="76" height="74" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png"> BRAIN POWER</h5>
<p>We know that we should favor composition over inheritance, right? Well, the implementers of the sort() template method decided not to use inheritance and instead to implement sort() as a static method that is composed with a Comparable at runtime. How is this better? How is it worse? How would you approach this problem? Do Java arrays make this particularly tricky?</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id000102">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png" alt="Images" width="76" height="74" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg252-02.png"> BRAIN<sup>2</sup> POWER</h5>
<p>Think of another pattern that is a specialization of the template method. In this specialization, primitive operations are used to create and return objects. What pattern is this?</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Swingin’ with Frames"><div class="sect1" id="swinginapostrophe_with_frames">
<h1>Swingin’ with Frames</h1>
<p>Up next on our Template Method safari... keep your eye out for swinging JFrames!</p>
<p>If you haven’t encountered JFrame, it’s the most basic Swing container and inherits a paint() method. By default, paint() does nothing because it’s a hook! By overriding paint(), you can insert yourself into JFrame’s algorithm for displaying its area of the screen and have your own graphic output incorporated into the JFrame. Here’s an embarrassingly simple example of using a JFrame to override the paint() hook method:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg314-01.png" alt="Images" width="204" height="145" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg314-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg314-02.png" alt="Images" width="908" height="931" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg314-02.png">
<h6></h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Custom Lists with AbstractList"><div class="sect1" id="custom_lists_with_abstractlist">
<h1>Custom Lists with AbstractList</h1>
<p>Our final stop on the safari: AbstractList.</p>
<p>The list collections in Java, like ArrayList and LinkedList, extend the AbstractList class, which provides some of the basic implementations for list behavior. If you want to create your own custom list—say, a list that contains only Strings—you can do that by extending AbstractList so you get that basic list behavior for free.</p>
<p>AbstractList has a template method, subList() that relies on two abstract methods, get() and size(). So when you extend AbstractList to create your own custom list you’ll provide implementations for these methods.</p>
<p>Here’s an implementation of a custom list that contains only String objects, and uses arrays for the underlying implementation:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg315-01.png" alt="Images" width="222" height="156" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg315-01.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg315-02.png" alt="Images" width="415" height="333" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg315-02.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg315-03.png" alt="Images" width="919" height="469" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg315-03.png">
<h6></h6>
</div></figure>
<p>Test the subList() template method in your MyStringList implementation like this:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg315-04.png" alt="Images" width="957" height="112" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg315-04.png">
<h6></h6>
</div></figure>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg316-01.png" alt="Images" width="277" height="144" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg316-01.png">
<h6></h6>
</div></figure>
<p>Tonight’s talk: <strong>Template Method and Strategy compare methods.</strong></p>
<table class="border">
<tbody>
<tr>
<td><strong>Template Method:</strong></td>
<td><strong>Strategy:</strong></td>
</tr>
<tr>
<td>Hey Strategy, what are you doing in my chapter? I figured I’d get stuck with someone boring like Factory Method.</td>
<td><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg316-02.png" alt="Images" width="311" height="142" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg316-02.png"><br>Nope, it’s me, although be careful—you and Factory Method are related, aren’t you?</td>
</tr>
<tr>
<td>I was just kidding! But seriously, what are you doing here? We haven’t heard from you in seven chapters!</td>
<td></td>
</tr>
<tr>
<td></td>
<td>I’d heard you were on the final draft of your chapter and I thought I’d swing by to see how it was going. We have a lot in common, so I thought I might be able to help...</td>
</tr>
<tr>
<td>You might want to remind the reader what you’re all about, since it’s been so long.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>I don’t know, since <a data-type="xref" href="ch01.html#intro_to_design_patterns_welcome_to_desi">Chapter 1</a>, people have been stopping me in the street saying, “Aren’t you that pattern...?” So I think they know who I am. But for your sake: I define a family of algorithms and make them interchangeable. Since each algorithm is encapsulated, the client can use different algorithms easily.</td>
</tr>
<tr>
<td>Hey, that does sound a lot like what I do. But my intent’s a little different from yours; my job is to define the outline of an algorithm, but let my subclasses do some of the work. That way, I can have different implementations of an algorithm’s individual steps, but keep control over the algorithm’s structure. Seems like you have to give up control of your algorithms.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>I’m not sure I’d put it quite like <em>that</em>... and anyway, I’m not stuck using inheritance for algorithm implementations. I offer clients a choice of algorithm implementation through object composition.</td>
</tr>
<tr>
<td>I remember that. But I have more control over my algorithm and I don’t duplicate code. In fact, if every part of my algorithm is the same except for, say, one line, then my classes are much more efficient than yours. All my duplicated code gets put into the superclass, so all the subclasses can share it.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>You might be a little more efficient (just a little) and require fewer objects. <em>And</em> you might also be a little less complicated in comparison to my delegation model, but I’m more flexible because I use object composition. With me, clients can change their algorithms at runtime simply by using a different strategy object. Come on, they didn’t choose me for <a data-type="xref" href="ch01.html#intro_to_design_patterns_welcome_to_desi">Chapter 1</a> for nothing!</td>
</tr>
<tr>
<td>Yeah, well, I’m <em>real</em> happy for ya, but don’t forget I’m the most used pattern around. Why? Because I provide a fundamental method for code reuse that allows subclasses to specify behavior. I’m sure you can see that this is perfect for creating frameworks.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Yeah, I guess... but, what about dependency? You’re way more dependent than me.</td>
</tr>
<tr>
<td>How’s that? My superclass is abstract.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>But you have to depend on methods implemented in your subclasses, which are part of your algorithm. I don’t depend on anyone; I can do the entire algorithm myself !</td>
</tr>
<tr>
<td>Like I said, Strategy, I’m <em>real</em> happy for you. Thanks for stopping by, but I’ve got to get the rest of this chapter done.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Okay, okay, don’t get touchy. I’ll let you work, but let me know if you need my special techniques anyway; I’m always glad to help.</td>
</tr>
<tr>
<td>Got it. Don’t call us, we’ll call you...</td>
<td></td>
</tr>
</tbody>
</table>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Design Patterns Crossword"><div class="sect1" id="design_patterns_crossword-id00001">
<h1>Design Patterns Crossword</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg318-01.png" alt="Images" width="146" height="93" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg318-01.png">
<h6></h6>
</div></figure>
<p>It’s that time again...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg318-02.png" alt="Images" width="836" height="587" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg318-02.png">
<h6></h6>
</div></figure>
<p><strong>ACROSS</strong></p>
<p>1. Huey, Louie, and Dewey all weigh __________ pounds.</p>
<p>2. The template method is usually defined in an _______ class.</p>
<p>4. In this chapter we gave you more _________.</p>
<p>7. The steps in the algorithm that must be supplied by the subclasses are usually declared ___________.</p>
<p>11. The JFrame hook method that we overrode to print “I Rule”.</p>
<p>12. ___________ has a subList() template method. 13. Type of sort used in Arrays.</p>
<p>14. The Template Method Pattern uses _____________ to defer implementation to other classes.</p>
<p>15. “Don’t call us, we’ll call you” is known as the _________ Principle.</p>
<p><strong>DOWN</strong></p>
<p>1. Coffee and ______.</p>
<p>3. Factory Method is a __________ of Template Method.</p>
<p>5. A template method defines the steps of an ________.</p>
<p>6. Big-headed pattern.</p>
<p>8. _______ algorithm steps are implemented by hook methods.</p>
<p>9. Our favorite coffee shop in Objectville.</p>
<p>10. The Arrays class implements its template method as a ______ method.</p>
<p>15. A method in the abstract superclass that does nothing or provides default behavior is called a ____________ method.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Tools for your Design Toolbox"><div class="sect1" id="tools_for_your_design_toolbox-id00001">
<h1>Tools for your Design Toolbox</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg319-01.png" alt="Images" width="113" height="108" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg319-01.png">
<h6></h6>
</div></figure>
<p>We’ve added Template Method to your toolbox. With Template Method you can reuse code like a pro while keeping control of your algorithms.</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg319-02.png" alt="Images" width="655" height="996" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg319-02.png">
<h6></h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id0000101">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg278-03.png" alt="Images" width="108" height="71" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg278-03.png"> BULLET POINTS</h5>
<ul>
<li><p>A “template method” defines the steps of an algorithm, deferring to subclasses for the implementation of those steps.</p></li>
<li><p>The Template Method Pattern gives us an important technique for code reuse.</p></li>
<li><p>The template method’s abstract class may define concrete methods, abstract methods, and hooks.</p></li>
<li><p>Abstract methods are implemented by subclasses.</p></li>
<li><p>Hooks are methods that do nothing or default behavior in the abstract class, but may be overridden in the subclass.</p></li>
<li><p>To prevent subclasses from changing the algorithm in the template method, declare the template method as final.</p></li>
<li><p>The Hollywood Principle guides us to put decision making in high-level modules that can decide how and when to call low-level modules.</p></li>
<li><p>You’ll see lots of uses of the Template Method Pattern in real-world code, but don’t expect it all (like any pattern) to be designed “by the book.”</p></li>
<li><p>The Strategy and Template Method Patterns both encapsulate algorithms, the first by composition and the other by inheritance.</p></li>
<li><p>The Factory Method is a specialization of Template Method.</p></li>
</ul>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id00003">
<h5><img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-01.png" alt="Images" width="191" height="140" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg276-01.png"> Sharpen your pencil Solution</h5>
<p>Draw the new class diagram now that we’ve moved prepareRecipe() into the CaffeineBeverage class:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg320-01.png" alt="Images" width="432" height="317" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg320-01.png">
<h6></h6>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="who_does_what_solutionquestion_mark-id00">
<h5>WHO DOES WHAT SOLUTION?</h5>
<p>Match each pattern with its description:</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg320-02.png" alt="Images" width="630" height="357" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg320-02.png">
<h6></h6>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Design Patterns Crossword Solution"><div class="sect1" id="design_patterns_crossword_solution-id401">
<h1>Design Patterns Crossword Solution</h1>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg321-01.png" alt="Images" width="148" height="93" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg321-01.png">
<h6></h6>
</div></figure>
<p>It’s that time again...</p>
<figure class="informal"><div class="figure">
<img src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg321-02.png" alt="Images" width="902" height="583" data-mfp-src="https://learning.oreilly.com/library/view/head-first-design/9781492077992/assets/pg321-02.png">
<h6></h6>
</div></figure>
</div></section>
</div></section>/div>
undefined
