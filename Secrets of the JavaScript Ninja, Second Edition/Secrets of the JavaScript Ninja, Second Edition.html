<div>
            <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/cover.jpg" alt="cover" style="height: 100%" width="550" height="690" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/cover.jpg">
        </div>
    <h1 class="calibre1" id="calibre_pb_0">Secrets of the JavaScript Ninja, Second Edition</h1>
      <h4 class="center">John Resig
         Bear Bibeault
         Josip Maras 
      </h4>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/logo.jpg" alt="" class="calibre2" width="144" height="21" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/logo.jpg"></p>
      <h2 id="copyrightp1g" class="part"><a id="start" class="calibre3"></a>Copyright
      </h2>
      
      
      <p class="noind">For online information and ordering of this and other Manning books, please visit <a href="http://www.manning.com" class="calibre4">www.manning.com</a>. The publisher offers discounts on this book when ordered in quantity. For more information, please contact
      </p>
      
      <pre class="calibre5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Special&nbsp;Sales&nbsp;Department
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Manning&nbsp;Publications&nbsp;Co.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20&nbsp;Baldwin&nbsp;Road
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PO&nbsp;Box&nbsp;761
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Shelter&nbsp;Island,&nbsp;NY&nbsp;11964
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Email:&nbsp;<i class="calibre6">orders@manning.com</i></pre>
      
      <p class="noind">©2016 by Manning Publications Co. All rights reserved.</p>
      
      
      <p class="noind">No part of this publication may be reproduced, stored in a retrieval system, or transmitted, in any form or by means electronic,
         mechanical, photocopying, or otherwise, without prior written permission of the publisher.
      </p>
      
      <p class="noind">Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where
         those designations appear in the book, and Manning Publications was aware of a trademark claim, the designations have been
         printed in initial caps or all caps.
      </p>
      
      <p class="noind"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/common01.jpg" alt="" class="calibre2" width="15" height="16" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/common01.jpg">Recognizing the importance of preserving what has been written, it is Manning’s policy to have the books we publish printed
         on acid-free paper, and we exert our best efforts to that end. Recognizing also our responsibility to conserve the resources
         of our planet, Manning books are printed on paper that is at least 15 percent recycled and processed without the use of elemental
         chlorine.
      </p>
      
      
      <table cellpadding="8" width="100%" frame="void" cellspacing="5" rules="none" class="calibre7">
         <colgroup span="2" class="calibre8">
            <col width="100" class="calibre9">
            <col width="300" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="docTableCell" valign="middle"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/common02.jpg" alt="" class="calibre2" width="48" height="34" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/common02.jpg"></td>
               <td class="docTableCell" valign="middle"><pre class="calibre12">Manning&nbsp;Publications&nbsp;Co.
20&nbsp;Baldwin&nbsp;Road
PO&nbsp;Box&nbsp;761
Shelter&nbsp;Island,&nbsp;NY&nbsp;11964</pre></td>
            </tr>
         </tbody>
      </table>
      
      <pre class="calibre5">Development&nbsp;editor:&nbsp;Dan&nbsp;Maharry
Technical&nbsp;development&nbsp;editor:&nbsp;Gregor&nbsp;Zurowski
Review&nbsp;editor:&nbsp;Ozren&nbsp;Harlovic
Project&nbsp;editor:&nbsp;Tiffany&nbsp;Taylor
Copy&nbsp;editor:&nbsp;Sharon&nbsp;Wilkey
Proofreader:&nbsp;Alyson&nbsp;Brener
Technical&nbsp;proofreaders:&nbsp;Mathias&nbsp;Bynens,
Jon&nbsp;Borgman
Typesetter:&nbsp;Gordan&nbsp;Salinovic
Cover&nbsp;designer:&nbsp;Marija&nbsp;Tudor
</pre>
      
      
      <p class="noind">ISBN 9781617292859</p>
      
      <p class="noind">Printed in the United States of America</p>
      
      <p class="noind">1 2 3 4 5 6 7 8 9 10 – EBM – 21 20 19 18 17 16</p>
      
      
      <h2 id="btoc" class="part">Brief Table of Contents</h2>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_001.html#copyrightp1g" class="calibre4">Copyright</a><br class="calibre13"></p>
         <p class="ind"><a href="#btoc" class="calibre4">Brief Table of Contents</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_003.html#toc" class="calibre4">Table of Contents</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_004.html#pref01" class="calibre4">ES6 cheat sheet</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_005.html#pref02" class="calibre4">Praise for the First Edition</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_006.html#pref03" class="calibre4">Author’s Introduction</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_007.html#pref04" class="calibre4">Acknowledgments</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_008.html#pref05" class="calibre4">About this Book</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_009.html#pref06" class="calibre4">About the Cover Illustration</a><br class="calibre13"></p>
      </blockquote>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_010.html#part01" class="calibre4">1. Warming up</a><br class="calibre13"></p>
         <blockquote class="toc">
            <p class="ind"><a href="kindle_split_011.html#ch01" class="calibre4">Chapter 1. JavaScript is everywhere</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_012.html#ch02" class="calibre4">Chapter 2. Building the page at runtime</a><br class="calibre13"></p>
         </blockquote>
         <p class="ind"><a href="kindle_split_013.html#part02" class="calibre4">2. Understanding functions</a><br class="calibre13"></p>
         <blockquote class="toc">
            <p class="ind"><a href="kindle_split_014.html#ch03" class="calibre4">Chapter 3. First-class functions for the novice: definitions and arguments</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_015.html#ch04" class="calibre4">Chapter 4. Functions for the journeyman: understanding function invocation</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_016.html#ch05" class="calibre4">Chapter 5. Functions for the master: closures and scopes</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_017.html#ch06" class="calibre4">Chapter 6. Functions for the future: generators and promises</a><br class="calibre13"></p>
         </blockquote>
         <p class="ind"><a href="kindle_split_018.html#part03" class="calibre4">3. Digging into objects and fortifying your code</a><br class="calibre13"></p>
         <blockquote class="toc">
            <p class="ind"><a href="kindle_split_019.html#ch07" class="calibre4">Chapter 7. Object orientation with prototypes</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_020.html#ch08" class="calibre4">Chapter 8. Controlling access to objects</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_021.html#ch09" class="calibre4">Chapter 9. Dealing with collections</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_022.html#ch10" class="calibre4">Chapter 10. Wrangling regular expressions</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_023.html#ch11" class="calibre4">Chapter 11. Code modularization techniques</a><br class="calibre13"></p>
         </blockquote>
         <p class="ind"><a href="kindle_split_024.html#part04" class="calibre4">4. Browser reconnaissance</a><br class="calibre13"></p>
         <blockquote class="toc">
            <p class="ind"><a href="kindle_split_025.html#ch12" class="calibre4">Chapter 12. Working the DOM</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_026.html#ch13" class="calibre4">Chapter 13. Surviving events</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_027.html#ch14" class="calibre4">Chapter 14. Developing cross-browser strategies</a><br class="calibre13"></p>
         </blockquote>
      </blockquote>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_028.html#app01" class="calibre4">Appendix A. Additional ES6 features</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02" class="calibre4">Appendix B. Arming with testing and debugging</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_030.html#app03" class="calibre4">Appendix C. Exercise answers</a><br class="calibre13"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="ind"><a href="kindle_split_031.html#MainIndex" class="calibre4">Index</a><br class="calibre13"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="ind"><a href="kindle_split_032.html#lof" class="calibre4">List of Figures</a><br class="calibre13"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="ind"><a href="kindle_split_033.html#lot" class="calibre4">List of Tables</a><br class="calibre13"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="ind"><a href="kindle_split_034.html#loe" class="calibre4">List of Listings</a><br class="calibre13"></p>
      </blockquote>
      <h2 id="toc" class="part">Table of Contents</h2>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_001.html#copyrightp1g" class="calibre4">Copyright</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_002.html#btoc" class="calibre4">Brief Table of Contents</a><br class="calibre13"></p>
         <p class="ind"><a href="#toc" class="calibre4">Table of Contents</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_004.html#pref01" class="calibre4">ES6 cheat sheet</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_005.html#pref02" class="calibre4">Praise for the First Edition</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_006.html#pref03" class="calibre4">Author’s Introduction</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_007.html#pref04" class="calibre4">Acknowledgments</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_008.html#pref05" class="calibre4">About this Book</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_009.html#pref06" class="calibre4">About the Cover Illustration</a><br class="calibre13"></p>
      </blockquote>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_010.html#part01" class="calibre4">1. Warming up</a><br class="calibre13"></p>
         <blockquote class="toc">
            <p class="ind"><a href="kindle_split_011.html#ch01" class="calibre4">Chapter 1. JavaScript is everywhere</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_011.html#ch01lev1sec1" class="calibre4">1.1. Understanding the JavaScript language</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_011.html#ch01lev2sec1" class="calibre4">1.1.1. How will JavaScript evolve?</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_011.html#ch01lev2sec2" class="calibre4">1.1.2. Transpilers give us access to tomorrow’s JavaScript today</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_011.html#ch01lev1sec2" class="calibre4">1.2. Understanding the browser</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_011.html#ch01lev1sec3" class="calibre4">1.3. Using current best practices</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_011.html#ch01lev2sec3" class="calibre4">1.3.1. Debugging</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_011.html#ch01lev2sec4" class="calibre4">1.3.2. Testing</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_011.html#ch01lev2sec5" class="calibre4">1.3.3. Performance analysis</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_011.html#ch01lev1sec4" class="calibre4">1.4. Boosting skill transferability</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_011.html#ch01lev1sec5" class="calibre4">1.5. Summary</a><br class="calibre13"></p>
            </blockquote>
            <p class="ind"><a href="kindle_split_012.html#ch02" class="calibre4">Chapter 2. Building the page at runtime</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_012.html#ch02lev1sec1" class="calibre4">2.1. The lifecycle overview</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_012.html#ch02lev1sec2" class="calibre4">2.2. The page-building phase</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_012.html#ch02lev2sec1" class="calibre4">2.2.1. Parsing the HTML and building the DOM</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_012.html#ch02lev2sec2" class="calibre4">2.2.2. Executing JavaScript code</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_012.html#ch02lev1sec3" class="calibre4">2.3. Event handling</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_012.html#ch02lev2sec3" class="calibre4">2.3.1. Event-handling overview</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_012.html#ch02lev2sec4" class="calibre4">2.3.2. Registering event handlers</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_012.html#ch02lev2sec5" class="calibre4">2.3.3. Handling events</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_012.html#ch02lev1sec4" class="calibre4">2.4. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_012.html#ch02lev1sec5" class="calibre4">2.5. Exercises</a><br class="calibre13"></p>
            </blockquote>
         </blockquote>
         <p class="ind"><a href="kindle_split_013.html#part02" class="calibre4">2. Understanding functions</a><br class="calibre13"></p>
         <blockquote class="toc">
            <p class="ind"><a href="kindle_split_014.html#ch03" class="calibre4">Chapter 3. First-class functions for the novice: definitions and arguments</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_014.html#ch03lev1sec1" class="calibre4">3.1. What’s with the functional difference?</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_014.html#ch03lev2sec1" class="calibre4">3.1.1. Functions as first-class objects</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_014.html#ch03lev2sec2" class="calibre4">3.1.2. Callback functions</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_014.html#ch03lev1sec2" class="calibre4">3.2. Fun with functions as objects</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_014.html#ch03lev2sec3" class="calibre4">3.2.1. Storing functions</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_014.html#ch03lev2sec4" class="calibre4">3.2.2. Self-memoizing functions</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_014.html#ch03lev1sec3" class="calibre4">3.3. Defining functions</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_014.html#ch03lev2sec5" class="calibre4">3.3.1. Function declarations and function expressions</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_014.html#ch03lev2sec6" class="calibre4">3.3.2. Arrow functions</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_014.html#ch03lev1sec4" class="calibre4">3.4. Arguments and function parameters</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_014.html#ch03lev2sec7" class="calibre4">3.4.1. Rest parameters</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_014.html#ch03lev2sec8" class="calibre4">3.4.2. Default parameters</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_014.html#ch03lev1sec5" class="calibre4">3.5. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_014.html#ch03lev1sec6" class="calibre4">3.6. Exercises</a><br class="calibre13"></p>
            </blockquote>
            <p class="ind"><a href="kindle_split_015.html#ch04" class="calibre4">Chapter 4. Functions for the journeyman: understanding function invocation</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_015.html#ch04lev1sec1" class="calibre4">4.1. Using implicit function parameters</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_015.html#ch04lev2sec1" class="calibre4">4.1.1. The arguments parameter</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_015.html#ch04lev2sec2" class="calibre4">4.1.2. The this parameter: introducing the function context</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_015.html#ch04lev1sec2" class="calibre4">4.2. Invoking functions</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_015.html#ch04lev2sec3" class="calibre4">4.2.1. Invocation as a function</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_015.html#ch04lev2sec4" class="calibre4">4.2.2. Invocation as a method</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_015.html#ch04lev2sec5" class="calibre4">4.2.3. Invocation as a constructor</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_015.html#ch04lev2sec6" class="calibre4">4.2.4. Invocation with the apply and call methods</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_015.html#ch04lev1sec3" class="calibre4">4.3. Fixing the problem of function contexts</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_015.html#ch04lev2sec7" class="calibre4">4.3.1. Using arrow functions to get around function contexts</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_015.html#ch04lev2sec8" class="calibre4">4.3.2. Using the bind method</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_015.html#ch04lev1sec4" class="calibre4">4.4. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_015.html#ch04lev1sec5" class="calibre4">4.5. Exercises</a><br class="calibre13"></p>
            </blockquote>
            <p class="ind"><a href="kindle_split_016.html#ch05" class="calibre4">Chapter 5. Functions for the master: closures and scopes</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_016.html#ch05lev1sec1" class="calibre4">5.1. Understanding closures</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_016.html#ch05lev1sec2" class="calibre4">5.2. Putting closures to work</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_016.html#ch05lev2sec1" class="calibre4">5.2.1. Mimicking private variables</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_016.html#ch05lev2sec2" class="calibre4">5.2.2. Using closures with callbacks</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_016.html#ch05lev1sec3" class="calibre4">5.3. Tracking code execution with execution contexts</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_016.html#ch05lev1sec4" class="calibre4">5.4. Keeping track of identifiers with lexical environments</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_016.html#ch05lev2sec3" class="calibre4">5.4.1. Code nesting</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_016.html#ch05lev2sec4" class="calibre4">5.4.2. Code nesting and lexical environments</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_016.html#ch05lev1sec5" class="calibre4">5.5. Understanding types of JavaScript variables</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_016.html#ch05lev2sec5" class="calibre4">5.5.1. Variable mutability</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_016.html#ch05lev2sec6" class="calibre4">5.5.2. Variable definition keywords and lexical environments</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_016.html#ch05lev2sec7" class="calibre4">5.5.3. Registering identifiers within lexical environments</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_016.html#ch05lev1sec6" class="calibre4">5.6. Exploring how closures work</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_016.html#ch05lev2sec8" class="calibre4">5.6.1. Revisiting mimicking private variables with closures</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_016.html#ch05lev2sec9" class="calibre4">5.6.2. Private variables caveat</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_016.html#ch05lev2sec10" class="calibre4">5.6.3. Revisiting the closures and callbacks example</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_016.html#ch05lev1sec7" class="calibre4">5.7. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_016.html#ch05lev1sec8" class="calibre4">5.8. Exercises</a><br class="calibre13"></p>
            </blockquote>
            <p class="ind"><a href="kindle_split_017.html#ch06" class="calibre4">Chapter 6. Functions for the future: generators and promises</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_017.html#ch06lev1sec1" class="calibre4">6.1. Making our async code elegant with generators and promises</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_017.html#ch06lev1sec2" class="calibre4">6.2. Working with generator functions</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_017.html#ch06lev2sec1" class="calibre4">6.2.1. Controlling the generator through the iterator object</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_017.html#ch06lev2sec2" class="calibre4">6.2.2. Using generators</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_017.html#ch06lev2sec3" class="calibre4">6.2.3. Communicating with a generator</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_017.html#ch06lev2sec4" class="calibre4">6.2.4. Exploring generators under the hood</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_017.html#ch06lev1sec3" class="calibre4">6.3. Working with promises</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_017.html#ch06lev2sec5" class="calibre4">6.3.1. Understanding the problems with simple callbacks</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_017.html#ch06lev2sec6" class="calibre4">6.3.2. Diving into promises</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_017.html#ch06lev2sec7" class="calibre4">6.3.3. Rejecting promises</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_017.html#ch06lev2sec8" class="calibre4">6.3.4. Creating our first real-world promise</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_017.html#ch06lev2sec9" class="calibre4">6.3.5. Chaining promises</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_017.html#ch06lev2sec10" class="calibre4">6.3.6. Waiting for a number of promises</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_017.html#ch06lev1sec4" class="calibre4">6.4. Combining generators and promises</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_017.html#ch06lev2sec11" class="calibre4">6.4.1. Looking forward—the async function</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_017.html#ch06lev1sec5" class="calibre4">6.5. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_017.html#ch06lev1sec6" class="calibre4">6.6. Exercises</a><br class="calibre13"></p>
            </blockquote>
         </blockquote>
         <p class="ind"><a href="kindle_split_018.html#part03" class="calibre4">3. Digging into objects and fortifying your code</a><br class="calibre13"></p>
         <blockquote class="toc">
            <p class="ind"><a href="kindle_split_019.html#ch07" class="calibre4">Chapter 7. Object orientation with prototypes</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_019.html#ch07lev1sec1" class="calibre4">7.1. Understanding prototypes</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_019.html#ch07lev1sec2" class="calibre4">7.2. Object construction and prototypes</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_019.html#ch07lev2sec1" class="calibre4">7.2.1. Instance properties</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_019.html#ch07lev2sec2" class="calibre4">7.2.2. Side effects of the dynamic nature of JavaScript</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_019.html#ch07lev2sec3" class="calibre4">7.2.3. Object typing via constructors</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_019.html#ch07lev1sec3" class="calibre4">7.3. Achieving inheritance</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_019.html#ch07lev2sec4" class="calibre4">7.3.1. The problem of overriding the constructor property</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_019.html#ch07lev2sec5" class="calibre4">7.3.2. The instanceof operator</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_019.html#ch07lev1sec4" class="calibre4">7.4. Using JavaScript “classes” in ES6</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_019.html#ch07lev2sec6" class="calibre4">7.4.1. Using the class keyword</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_019.html#ch07lev2sec7" class="calibre4">7.4.2. Implementing inheritance</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_019.html#ch07lev1sec5" class="calibre4">7.5. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_019.html#ch07lev1sec6" class="calibre4">7.6. Exercises</a><br class="calibre13"></p>
            </blockquote>
            <p class="ind"><a href="kindle_split_020.html#ch08" class="calibre4">Chapter 8. Controlling access to objects</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_020.html#ch08lev1sec1" class="calibre4">8.1. Controlling access to properties with getters and setters</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_020.html#ch08lev2sec1" class="calibre4">8.1.1. Defining getters and setters</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_020.html#ch08lev2sec2" class="calibre4">8.1.2. Using getters and setters to validate property values</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_020.html#ch08lev2sec3" class="calibre4">8.1.3. Using getters and setters to define computed properties</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_020.html#ch08lev1sec2" class="calibre4">8.2. Using proxies to control access</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_020.html#ch08lev2sec4" class="calibre4">8.2.1. Using proxies for logging</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_020.html#ch08lev2sec5" class="calibre4">8.2.2. Using proxies for measuring performance</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_020.html#ch08lev2sec6" class="calibre4">8.2.3. Using proxies to autopopulate properties</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_020.html#ch08lev2sec7" class="calibre4">8.2.4. Using proxies to implement negative array indexes</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_020.html#ch08lev2sec8" class="calibre4">8.2.5. Performance costs of proxies</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_020.html#ch08lev1sec3" class="calibre4">8.3. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_020.html#ch08lev1sec4" class="calibre4">8.4. Exercises</a><br class="calibre13"></p>
            </blockquote>
            <p class="ind"><a href="kindle_split_021.html#ch09" class="calibre4">Chapter 9. Dealing with collections</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_021.html#ch09lev1sec1" class="calibre4">9.1. Arrays</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_021.html#ch09lev2sec1" class="calibre4">9.1.1. Creating arrays</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_021.html#ch09lev2sec2" class="calibre4">9.1.2. Adding and removing items at either end of an array</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_021.html#ch09lev2sec3" class="calibre4">9.1.3. Adding and removing items at any array location</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_021.html#ch09lev2sec4" class="calibre4">9.1.4. Common operations on arrays</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_021.html#ch09lev2sec5" class="calibre4">9.1.5. Reusing built-in array functions</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_021.html#ch09lev1sec2" class="calibre4">9.2. Maps</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_021.html#ch09lev2sec6" class="calibre4">9.2.1. Don’t use objects as maps</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_021.html#ch09lev2sec7" class="calibre4">9.2.2. Creating our first map</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_021.html#ch09lev2sec8" class="calibre4">9.2.3. Iterating over maps</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_021.html#ch09lev1sec3" class="calibre4">9.3. Sets</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_021.html#ch09lev2sec9" class="calibre4">9.3.1. Creating our first set</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_021.html#ch09lev2sec10" class="calibre4">9.3.2. Union of sets</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_021.html#ch09lev2sec11" class="calibre4">9.3.3. Intersection of sets</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_021.html#ch09lev2sec12" class="calibre4">9.3.4. Difference of sets</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_021.html#ch09lev1sec4" class="calibre4">9.4. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_021.html#ch09lev1sec5" class="calibre4">9.5. Exercises</a><br class="calibre13"></p>
            </blockquote>
            <p class="ind"><a href="kindle_split_022.html#ch10" class="calibre4">Chapter 10. Wrangling regular expressions</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_022.html#ch10lev1sec1" class="calibre4">10.1. Why regular expressions rock</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_022.html#ch10lev1sec2" class="calibre4">10.2. A regular expression refresher</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_022.html#ch10lev2sec1" class="calibre4">10.2.1. Regular expressions explained</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_022.html#ch10lev2sec2" class="calibre4">10.2.2. Terms and operators</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_022.html#ch10lev1sec3" class="calibre4">10.3. Compiling regular expressions</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_022.html#ch10lev1sec4" class="calibre4">10.4. Capturing matching segments</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_022.html#ch10lev2sec3" class="calibre4">10.4.1. Performing simple captures</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_022.html#ch10lev2sec4" class="calibre4">10.4.2. Matching using global expressions</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_022.html#ch10lev2sec5" class="calibre4">10.4.3. Referencing captures</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_022.html#ch10lev2sec6" class="calibre4">10.4.4. Noncapturing groups</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_022.html#ch10lev1sec5" class="calibre4">10.5. Replacing using functions</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_022.html#ch10lev1sec6" class="calibre4">10.6. Solving common problems with regular expressions</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_022.html#ch10lev2sec7" class="calibre4">10.6.1. Matching newlines</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_022.html#ch10lev2sec8" class="calibre4">10.6.2. Matching Unicode</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_022.html#ch10lev2sec9" class="calibre4">10.6.3. Matching escaped characters</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_022.html#ch10lev1sec7" class="calibre4">10.7. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_022.html#ch10lev1sec8" class="calibre4">10.8. Exercises</a><br class="calibre13"></p>
            </blockquote>
            <p class="ind"><a href="kindle_split_023.html#ch11" class="calibre4">Chapter 11. Code modularization techniques</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_023.html#ch11lev1sec1" class="calibre4">11.1. Modularizing code in pre-ES6 JavaScript</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_023.html#ch11lev2sec1" class="calibre4">11.1.1. Using objects, closures, and immediate functions to specify modules</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_023.html#ch11lev2sec2" class="calibre4">11.1.2. Modularizing JavaScript applications with AMD and CommonJS</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_023.html#ch11lev1sec2" class="calibre4">11.2. ES6 modules</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_023.html#ch11lev2sec3" class="calibre4">11.2.1. Exporting and importing functionality</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_023.html#ch11lev1sec3" class="calibre4">11.3. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_023.html#ch11lev1sec4" class="calibre4">11.4. Exercises</a><br class="calibre13"></p>
            </blockquote>
         </blockquote>
         <p class="ind"><a href="kindle_split_024.html#part04" class="calibre4">4. Browser reconnaissance</a><br class="calibre13"></p>
         <blockquote class="toc">
            <p class="ind"><a href="kindle_split_025.html#ch12" class="calibre4">Chapter 12. Working the DOM</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_025.html#ch12lev1sec1" class="calibre4">12.1. Injecting HTML into the DOM</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_025.html#ch12lev2sec1" class="calibre4">12.1.1. Converting HTML to DOM</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_025.html#ch12lev2sec2" class="calibre4">12.1.2. Inserting elements into the document</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_025.html#ch12lev1sec2" class="calibre4">12.2. Using DOM attributes and properties</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_025.html#ch12lev1sec3" class="calibre4">12.3. Styling attribute headaches</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_025.html#ch12lev2sec3" class="calibre4">12.3.1. Where are my styles?</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_025.html#ch12lev2sec4" class="calibre4">12.3.2. Style property naming</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_025.html#ch12lev2sec5" class="calibre4">12.3.3. Fetching computed styles</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_025.html#ch12lev2sec6" class="calibre4">12.3.4. Converting pixel values</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_025.html#ch12lev2sec7" class="calibre4">12.3.5. Measuring heights and widths</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_025.html#ch12lev1sec4" class="calibre4">12.4. Minimizing layout thrashing</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_025.html#ch12lev1sec5" class="calibre4">12.5. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_025.html#ch12lev1sec6" class="calibre4">12.6. Exercises</a><br class="calibre13"></p>
            </blockquote>
            <p class="ind"><a href="kindle_split_026.html#ch13" class="calibre4">Chapter 13. Surviving events</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_026.html#ch13lev1sec1" class="calibre4">13.1. Diving into the event loop</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_026.html#ch13lev2sec1" class="calibre4">13.1.1. An example with only macrotasks</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_026.html#ch13lev2sec2" class="calibre4">13.1.2. An example with both macro- and microtasks</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_026.html#ch13lev1sec2" class="calibre4">13.2. Taming timers: time-outs and intervals</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_026.html#ch13lev2sec3" class="calibre4">13.2.1. Timer execution within the event loop</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_026.html#ch13lev2sec4" class="calibre4">13.2.2. Dealing with computationally expensive processing</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_026.html#ch13lev1sec3" class="calibre4">13.3. Working with events</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_026.html#ch13lev2sec5" class="calibre4">13.3.1. Propagating events through the DOM</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_026.html#ch13lev2sec6" class="calibre4">13.3.2. Custom events</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_026.html#ch13lev1sec4" class="calibre4">13.4. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_026.html#ch13lev1sec5" class="calibre4">13.5. Exercises</a><br class="calibre13"></p>
            </blockquote>
            <p class="ind"><a href="kindle_split_027.html#ch14" class="calibre4">Chapter 14. Developing cross-browser strategies</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_027.html#ch14lev1sec1" class="calibre4">14.1. Cross-browser considerations</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_027.html#ch14lev1sec2" class="calibre4">14.2. The five major development concerns</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_027.html#ch14lev2sec1" class="calibre4">14.2.1. Browser bugs and differences</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_027.html#ch14lev2sec2" class="calibre4">14.2.2. Browser bug fixes</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_027.html#ch14lev2sec3" class="calibre4">14.2.3. External code and markup</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_027.html#ch14lev2sec4" class="calibre4">14.2.4. Regressions</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_027.html#ch14lev1sec3" class="calibre4">14.3. Implementation strategies</a><br class="calibre13"></p>
               <blockquote class="toc">
                  <p class="ind"><a href="kindle_split_027.html#ch14lev2sec5" class="calibre4">14.3.1. Safe cross-browser fixes</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_027.html#ch14lev2sec6" class="calibre4">14.3.2. Feature detection and polyfills</a><br class="calibre13"></p>
                  <p class="ind"><a href="kindle_split_027.html#ch14lev2sec7" class="calibre4">14.3.3. Untestable browser issues</a><br class="calibre13"></p>
               </blockquote>
               <p class="ind"><a href="kindle_split_027.html#ch14lev1sec4" class="calibre4">14.4. Reducing assumptions</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_027.html#ch14lev1sec5" class="calibre4">14.5. Summary</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_027.html#ch14lev1sec6" class="calibre4">14.6. Exercises</a><br class="calibre13"></p>
            </blockquote>
         </blockquote>
      </blockquote>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_028.html#app01" class="calibre4">Appendix A. Additional ES6 features</a><br class="calibre13"></p>
         <blockquote class="toc">
            <p class="ind"><a href="kindle_split_028.html#app01lev1sec1" class="calibre4">Template literals</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_028.html#app01lev1sec2" class="calibre4">Destructuring</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_028.html#app01lev1sec3" class="calibre4">Enhanced object literals</a><br class="calibre13"></p>
         </blockquote>
         <p class="ind"><a href="kindle_split_029.html#app02" class="calibre4">Appendix B. Arming with testing and debugging</a><br class="calibre13"></p>
         <blockquote class="toc">
            <p class="ind"><a href="kindle_split_029.html#app02lev1sec1" class="calibre4">Web developer tools</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec1" class="calibre4">Firebug</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec2" class="calibre4">Firefox Developer Tools</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec3" class="calibre4">F12 Developer Tools</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec4" class="calibre4">WebKit inspector</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec5" class="calibre4">Chrome DevTools</a><br class="calibre13"></p>
            </blockquote>
            <p class="ind"><a href="kindle_split_029.html#app02lev1sec2" class="calibre4">Debugging code</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec6" class="calibre4">Logging</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec7" class="calibre4">Breakpoints</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec8" class="calibre4">Stepping into a function</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec9" class="calibre4">Conditional breakpoints</a><br class="calibre13"></p>
            </blockquote>
            <p class="ind"><a href="kindle_split_029.html#app02lev1sec3" class="calibre4">Creating tests</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_029.html#app02lev1sec4" class="calibre4">The fundamentals of a testing framework</a><br class="calibre13"></p>
            <blockquote class="toc">
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec10" class="calibre4">The assertion</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec11" class="calibre4">Popular testing frameworks</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec12" class="calibre4">QUnit</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec13" class="calibre4">Jasmine</a><br class="calibre13"></p>
               <p class="ind"><a href="kindle_split_029.html#app02lev2sec14" class="calibre4">Measuring code coverage</a><br class="calibre13"></p>
            </blockquote>
         </blockquote>
         <p class="ind"><a href="kindle_split_030.html#app03" class="calibre4">Appendix C. Exercise answers</a><br class="calibre13"></p>
         <blockquote class="toc">
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec1" class="calibre4">Chapter 2. Building the page at runtime</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec2" class="calibre4">Chapter 3. First-class functions for the novice: definitions and arguments</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec3" class="calibre4">Chapter 4. Functions for the journeyman: understanding function invocation</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec4" class="calibre4">Chapter 5. Functions for the master: closures and scopes</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec5" class="calibre4">Chapter 6. Functions for the future: generators and promises</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec6" class="calibre4">Chapter 7. Object orientation with prototypes</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec7" class="calibre4">Chapter 8. Controlling access to objects</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec8" class="calibre4">Chapter 9. Dealing with collections</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec9" class="calibre4">Chapter 10. Wrangling regular expressions</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec10" class="calibre4">Chapter 11. Code modularization techniques</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec11" class="calibre4">Chapter 12. Working the DOM</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec12" class="calibre4">Chapter 13. Surviving events</a><br class="calibre13"></p>
            <p class="ind"><a href="kindle_split_030.html#app03lev1sec13" class="calibre4">Chapter 14. Developing cross-browser strategies</a><br class="calibre13"></p>
         </blockquote>
      </blockquote>
      <blockquote class="calibre14">
         <p class="ind"><a href="kindle_split_031.html#MainIndex" class="calibre4">Index</a><br class="calibre13"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="ind"><a href="kindle_split_032.html#lof" class="calibre4">List of Figures</a><br class="calibre13"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="ind"><a href="kindle_split_033.html#lot" class="calibre4">List of Tables</a><br class="calibre13"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="ind"><a href="kindle_split_034.html#loe" class="calibre4">List of Listings</a><br class="calibre13"></p>
      </blockquote>
      <h2 id="pref01" class="part"><a id="pref01__title" class="calibre3"></a>ES6 cheat sheet
      </h2>
      
      
      <p class="noind"><i class="calibre6">Template literals</i> embed expressions into strings: <kbd class="calibre15">`${ninja}`</kbd>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <p class="noind"><i class="calibre6">Block-scoped variables:</i></p>
         
         <p class="calibre18"></p>
         <ul class="calibre19">
            
            <li class="calibre20">Use the new <kbd class="calibre15">let</kbd> keyword to create block-level variables: <kbd class="calibre15">let ninja = "Yoshi"</kbd>.
            </li>
            
            <li class="calibre20">Use the new <kbd class="calibre15">const</kbd> keyword to create block-level constant variables whose value can’t be reassigned to a completely new value: <kbd class="calibre15">const ninja = "Yoshi"</kbd>.
            </li>
            
         </ul>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind"><i class="calibre6">Function parameters:</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><i class="calibre6">Rest parameters</i> create an array from arguments that weren’t matched to parameters:
            
            
            <div class="calibre13"></div><pre class="calibre5">function multiMax(first, ...remaining){ /*...*/}multiMax(2, 3, 4, 5); //first: 2;
     remaining: [3, 4, 5]</pre>
            </li>
         
         <li class="calibre20"><i class="calibre6">Default parameters</i> specify default parameter values that are used if no value is supplied during invocation:
            
            
            <div class="calibre13"></div><pre class="calibre5">function do(ninja, <b class="calibre21">action = "skulk"</b> ){ return ninja + " " + action;}
do("Fuma"); //"Fuma skulk"</pre>
            </li>
         
      </ul>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <p class="noind"><i class="calibre6">Spread operators</i> expand an expression where multiple items are needed: <kbd class="calibre15">[...items, 3, 4, 5]</kbd>.
         </p>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind"><i class="calibre6">Arrow functions</i> let us create functions with less syntactic clutter. They don’t have their own <kbd class="calibre15">this</kbd> parameter. Instead, they inherit it from the context in which they were created:
      </p>
      
      <pre id="PLd0e214" class="calibre5">const values = [0, 3, 2, 5, 7, 4, 8, 1];
values.sort((v1,v2) =&gt; v1  - v2); /*OR*/ values.sort((v1,v2) =&gt; { return v1  - v2;});
value.forEach(value =&gt; console.log(value));</pre>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <p class="noind"><i class="calibre6">Generators</i> generate sequences of values on a per-request basis. Once a value is generated, the generator suspends its execution without
            blocking. Use <kbd class="calibre15">yield</kbd> to generate values:
         </p>
         
         <pre id="PLd0e231" class="calibre5">function <b class="calibre21">*IdGenerator</b>(){
  let id = 0;
  while(true){ <b class="calibre21">yield</b> ++id; }
}</pre>
         
         </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind"><i class="calibre6">Promises</i> are placeholders for the result of a computation. A promise is a guarantee that eventually we’ll know the result of some
         computation. The promise can either succeed or fail, and once it has done so, there will be no more changes:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Create a new promise with <kbd class="calibre15">new Promise((resolve, reject) =&gt; {});</kbd>.
         </li>
         
         <li class="calibre20">Call the <kbd class="calibre15">resolve</kbd> function to explicitly resolve a promise. Call the <kbd class="calibre15">reject</kbd> function to explicitly reject a promise. A promise is implicitly rejected if an error occurs.
         </li>
         
         <li class="calibre20">The promise object has a <kbd class="calibre15">then</kbd> method that returns a promise and takes in two callbacks, a success callback and a failure callback:
            
            
            <div class="calibre13"></div><pre class="calibre5">myPromise.then(val =&gt; console.log("Success"), err =&gt; console.log("Error"));</pre>
            </li>
         
         <li class="calibre20">Chain in a <kbd class="calibre15">catch</kbd> method to catch promise failures: <kbd class="calibre15">myPromise.catch(e =&gt; alert(e));</kbd>.
         </li>
         
      </ul>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <p class="noind"><i class="calibre6">Classes</i> act as syntactic sugar around JavaScript’s prototypes:
         </p>
         
         <pre id="PLd0e300" class="calibre5"><b class="calibre21">class</b> Person {
  <b class="calibre21">constructor</b>(name){ this.name = name; }
  dance(){ return true; }
}
class Ninja <b class="calibre21">extends</b> Person {
  constructor(name, level){
    <b class="calibre21">super(name);</b>
    this.level = level;
  }
  <b class="calibre21">static</b> compare(ninja1, ninja2){
    return ninja1.level - ninja2.level;
  }
}</pre>
         
         </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind"><i class="calibre6">Proxies</i> control access to other objects. Custom actions can be executed when an object is interacted with (for example, when a property
         is read or a function is called):
      </p>
      
      <pre id="PLd0e326" class="calibre5">const p = <b class="calibre21">new Proxy</b>(target, {
  <b class="calibre21">get:</b> (target, key) =&gt; { /*Called when property accessed through proxy*/ },
  <b class="calibre21">set:</b> (target, key, value) =&gt; { /*Called when property set through proxy*/ }
});</pre>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <p class="noind"><i class="calibre6">Maps</i> are mappings between a key and a value:
         </p>
         
         <p class="calibre18"></p>
         <ul class="calibre19">
            
            <li class="calibre20"><kbd class="calibre15">new Map()</kbd> creates a new map.
            </li>
            
            <li class="calibre20">Use the <kbd class="calibre15">set</kbd> method to add a new mapping, the <kbd class="calibre15">get</kbd> method to fetch a mapping, the <kbd class="calibre15">has</kbd> method to check whether a mapping exists, and the <kbd class="calibre15">delete</kbd> method to remove a mapping.
            </li>
            
         </ul>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind"><i class="calibre6">Sets</i> are collections of unique items:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><kbd class="calibre15">new Set()</kbd> creates a new set.
         </li>
         
         <li class="calibre20">Use the <kbd class="calibre15">add</kbd> method to add a new item, the <kbd class="calibre15">delete</kbd> method to remove an item, and the <kbd class="calibre15">size</kbd> property to check the number of items in a set.
         </li>
         
      </ul>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <p class="noind"><b class="calibre21"><kbd class="calibre15">for...of</kbd></b> loops iterate over collections and generators.
         </p>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind"><i class="calibre6">Destructuring</i> extracts data from objects and arrays:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><b class="calibre21"><kbd class="calibre15">const {name: ninjaName}</kbd></b> <kbd class="calibre15">= ninja;</kbd></li>
         
         <li class="calibre20"><b class="calibre21"><kbd class="calibre15">const [firstNinja]</kbd></b> <kbd class="calibre15">= ["Yoshi"];</kbd></li>
         
      </ul>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <p class="noind"><i class="calibre6">Modules</i> are larger units of organizing code that allow us to divide programs into clusters:
         </p>
         
         <pre id="PLd0e446" class="calibre5"><b class="calibre21">export</b> class Ninja{}; //Export an item
<b class="calibre21">export default</b> class Ninja{} //Default export
export {ninja};//Export existing variables
export {ninja <b class="calibre21">as</b> samurai}; //Rename an export

<b class="calibre21">import</b> Ninja from "Ninja.js"; //Import a default export
import {ninja} from "Ninja.js"; //Import named exports
import <b class="calibre21">*</b> as Ninja from "Ninja.js"; //Import all named exports
import {ninja <b class="calibre21">as</b> iNinja} from "Ninja.js"; //Import with a new name</pre>
         
         </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <h2 id="pref02" class="part"><a id="pref02__title" class="calibre3"></a>Praise for the First Edition
      </h2>
      
      
      
      <blockquote class="calibre14">
         
         
         <p class="noind"><i class="calibre6">Finally, from a master, a book that delivers what an aspiring JavaScript developer requires to learn the art of crafting effective
               cross-browser JavaScript.</i></p>
         
         <p class="calibre22"><i class="calibre6">Glenn Stokol, Senior Principal Curriculum Developer, Oracle Corporation</i></p>
      </blockquote>
      
      <blockquote class="calibre14">
         
         
         <p class="noind"><i class="calibre6">Consistent with the jQuery motto, “Write less, do more.”</i></p>
         
         <p class="calibre22"><i class="calibre6">André Roberge, Université Saint-Anne</i></p>
      </blockquote>
      
      <blockquote class="calibre14">
         
         
         <p class="noind"><i class="calibre6">Interesting and original techniques.</i></p>
         
         <p class="calibre22"><i class="calibre6">Scott Sauyet, Four Winds Software</i></p>
      </blockquote>
      
      <blockquote class="calibre14">
         
         
         <p class="noind"><i class="calibre6">Read this book, and you’ll no longer blindly plug in a snippet of code and marvel at how it works—you’ll understand “why”
               it works.</i></p>
         
         <p class="calibre22"><i class="calibre6">Joe Litton, Collaborative Software Developer, <a href="http://JoeLitton.net" class="calibre4">JoeLitton.net</a></i></p>
      </blockquote>
      
      <blockquote class="calibre14">
         
         
         <p class="noind"><i class="calibre6">Will help you raise your JavaScript to the realm of the masters.</i></p>
         
         <p class="calibre22"><i class="calibre6">Christopher Haupt, <a href="http://greenstack.com" class="calibre4">greenstack.com</a></i></p>
      </blockquote>
      
      <blockquote class="calibre14">
         
         
         <p class="noind"><i class="calibre6">The stuff ninjas need to know.</i></p>
         
         <p class="calibre22"><i class="calibre6">Chad Davis, author of <i class="calibre6">Struts 2 in Action</i></i></p>
      </blockquote>
      
      <blockquote class="calibre14">
         
         
         <p class="noind"><i class="calibre6">Required reading for any JavaScript Master.</i></p>
         
         <p class="calibre22"><i class="calibre6">John J. Ryan III, Princigration LLC</i></p>
      </blockquote>
      
      <blockquote class="calibre14">
         
         
         <p class="noind"><i class="calibre6">This book is a must-have for any serious JS coder. Your knowledge of the language will dramatically expand.</i></p>
         
         <p class="calibre22"><i class="calibre6">S., Amazon reader</i></p>
      </blockquote>
      
      <h2 id="pref03" class="part"><a id="pref03__title" class="calibre3"></a>Author’s Introduction
      </h2>
      
      
      
      <p class="noind">It’s incredible to think of how much the world of JavaScript has changed since I first started writing <i class="calibre6">Secrets of the JavaScript Ninja</i> back in 2008. The world in which we write JavaScript now, while still being largely centered around the browser, is nearly
         unrecognizable.
      </p>
      
      <p class="noind">The popularity of JavaScript as a full-featured, cross-platform language has exploded. Node.js is a formidable platform against
         which countless production applications are developed. Developers are actually writing applications in one language—JavaScript—that
         are capable of running in a browser, on a server, and even in a native app on a mobile device.
      </p>
      
      <p class="noind">It’s more important now, than ever before, that a developer’s knowledge of the JavaScript language be at its absolute peak.
         Having a fundamental understanding of the language and the ways in which it can be best written will allow you to create applications
         that can work on virtually any platform, which is a claim that few other languages can legitimately boast.
      </p>
      
      <p class="noind">Unlike previous eras in the growth of JavaScript, there hasn’t been equal growth in platform incompatibilities. It used to
         be that you would salivate over the thought of using the most basic new browser features and yet be stymied by outdated browsers
         that had far too much market share. We’ve entered a harmonious time in which most users are on rapidly updated browsers that
         compete to be the most standards-compliant platform around. Browser vendors even go out of their way to develop features specifically
         targeted at developers, hoping to make their lives easier.
      </p>
      
      <p class="noind">The tools that we have now, provided by browsers and the open source community, are light years ahead of old practices. We
         have a plethora of testing frameworks to choose from, the ability to do continuous integration testing, generate code-coverage
         reports, performance-test on real mobile devices around the globe, and even automatically load up virtual browsers on any
         platform to test from.
      </p>
      
      <p class="noind">The first edition of the book benefited tremendously from the development insight that Bear Bibeault provided. This edition
         has received substantial help from Josip Maras to explore the concepts behind ECMAScript 6 and 7, dive into testing best practices,
         and understand the techniques employed by popular JavaScript frameworks.
      </p>
      
      <p class="noind">All of this is a long way of saying: how we write JavaScript has changed substantially. Fortunately, this book is here to
         help you keep on top of the current best practices. Not only that, but it’ll help you improve how you think about your development
         practices as a whole to ensure that you’ll be ready for writing JavaScript well into the future.
      </p>
      
      <p class="noind">J<span class="calibre23">OHN</span> R<span class="calibre23">ESIG</span></p>
      
      <h2 id="pref04" class="part"><a id="pref04__title" class="calibre3"></a>Acknowledgments
      </h2>
      
      
      
      <p class="noind">The number of people involved in writing a book would surprise most people. It took a collaborative effort on the part of
         many contributors with a variety of talents to bring the volume you are holding (or ebook that you are reading onscreen) to
         fruition.
      </p>
      
      <p class="noind">The staff at Manning worked tirelessly with us to make sure this book attained the level of quality we hoped for, and we thank
         them for their efforts. Without them, this book would not have been possible. The “end credits” for this book include not
         only our publisher, Marjan Bace, and editor Dan Maharry, but also the following contributors: Ozren Harlovic, Gregor Zurowski,
         Kevin Sullivan, Janet Vail, Tiffany Taylor, Sharon Wilkey, Alyson Brener, and Gordan Salinovic.
      </p>
      
      <p class="noind">Enough cannot be said to thank our peer reviewers who helped mold the final form of the book, from catching simple typos to
         correcting errors in terminology and code, and helping to organize the chapters in the book. Each pass through a review cycle
         ended up vastly improving the final product. For taking the time to review the book, we’d like to thank Jacob Andresen, Tidjani
         Belmansour, Francesco Bianchi, Matthew Halverson, Becky Huett, Daniel Lamb, Michael Lund, Kariem Ali Elkoush, Elyse Kolker
         Gordon, Christopher Haupt, Mike Hatfield, Gerd Klevesaat, Alex Lucas, Arun Noronha, Adam Scheller, David Starkey, and Gregor
         Zurowski.
      </p>
      
      <p class="noind">Special thanks go to Mathias Bynens and Jon Borgman, who served as the book’s technical proofreaders. In addition to checking
         each and every sample of example code in multiple environments, they also offered invaluable contributions to the technical
         accuracy of the text, located information that was originally missing, and kept abreast of the rapid changes to JavaScript
         and HTML5 support in the browsers.
      </p>
      
      
      
      <h3 id="pref04lev1sec1" class="calibre24"><a id="pref04lev1sec1__title" class="calibre3"></a>John Resig
      </h3>
      
      <p class="noind">I would like to thank my parents for their constant support and encouragement over the years. They provided me with the resources
         and tools that I needed to spark my initial interest in programming—and they have been encouraging me ever since.
      </p>
      
      
      
      <h3 id="pref04lev1sec2" class="calibre24"><a id="pref04lev1sec2__title" class="calibre3"></a>Bear Bibeault
      </h3>
      
      <p class="noind">The cast of characters I’d like to thank for this seventh go-around has a long list of “usual suspects,” including, once again,
         the membership and staff at <a href="http://coderanch.com" class="calibre4">coderanch.com</a> (formerly JavaRanch). Without my involvement in CodeRanch, I’d never have gotten the opportunity to begin writing in the
         first place, and so I sincerely thank Paul Wheaton and Kathy Sierra for starting the whole thing, as well as fellow staffers
         who gave me encouragement and support, including (but certainly not limited to) Eric Pascarello, Ernest Friedman-Hill, Andrew
         Monkhouse, Jeanne Boyarsky, Bert Bates, and Max Habibi.
      </p>
      
      <p class="noind">My husband, Jay, and my dogs, Little Bear and Cozmo, get the usual warm thanks for putting up with the shadowy presence who
         shared their home and rarely looked up from his keyboard except to curse Word, the browsers, my fat-fingered lack of typing
         skills, or anything else that attracted my ire while I was working on this project.
      </p>
      
      <p class="noind">And finally, I’d like to thank my coauthors, John Resig and Josip Maras, without whom this project would not exist.</p>
      
      
      
      <h3 id="pref04lev1sec3" class="calibre24"><a id="pref04lev1sec3__title" class="calibre3"></a>Josip Maras
      </h3>
      
      <p class="noind">The biggest thanks go to my wife, Josipa, for putting up with all the hours that went into writing this book.</p>
      
      <p class="noind">I would also like to thank Maja Stula, Darko Stipanicev, Ivica Crnkovic, Jan Carlson, and Bert Bates: all of them for guidance
         and useful advice, and some of them for being lenient on my “day job” assignments as book deadlines were approaching.
      </p>
      
      <p class="noind">Finally, I would like to thank the rest of my family—Jere, two Marijas, Vitomir, and Zdenka—for always being there for me.</p>
      
      
      <div class="calibre25" id="calibre_pb_8"></div>
<h2 id="pref05" class="part"><a id="pref05__title" class="calibre3"></a>About this Book
      </h2>
      
      
      
      <p class="noind">JavaScript is important. That wasn’t always so, but it’s true now. JavaScript has become one of the most important and most
         widely used programming languages today.
      </p>
      
      <p class="noind">Web applications are expected to give users a rich user interface experience, and without JavaScript, you might as well just
         be showing pictures of kittens. More than ever, web developers need to have a sound grasp of the language that brings life
         to web applications.
      </p>
      
      <p class="noind">And like orange juice and breakfast, JavaScript isn’t just for browsers anymore. The language has long ago knocked down the
         walls of the browser and is being used on the server thanks to Node.js, on desktop devices and mobiles through platforms such
         as Apache Cordova, and even on embedded devices with Espruino and Tessel.
      </p>
      
      <p class="noind">Although this book is primarily focused on JavaScript executed in the browser, the fundamentals of the language presented
         in this book are applicable across the board. Truly understanding the concepts and learning various tips and tricks will make
         you a better all-around JavaScript developer.
      </p>
      
      <p class="noind">With more and more developers using JavaScript in an increasingly JavaScript world, it’s more important than ever to grasp
         its fundamentals so you can become an expert ninja of the language.
      </p>
      
      
      <h3 id="pref05lev1sec1" class="calibre24"><a id="pref05lev1sec1__title" class="calibre3"></a>Audience
      </h3>
      
      <p class="noind">If you aren’t at all familiar with JavaScript, this probably shouldn’t be your first book. Even if it is, don’t worry too
         much; we try to present fundamental JavaScript concepts in a way that should be understandable even for relative beginners.
         But, to be honest, this book will probably best fit people who already know some JavaScript and who wish to deepen their understanding
         of JavaScript as a language, as well as the browser as the environment in which JavaScript code is executed.
      </p>
      
      
      
      <h3 id="pref05lev1sec2" class="calibre24"><a id="pref05lev1sec2__title" class="calibre3"></a>Roadmap
      </h3>
      
      <p class="noind">This book is organized to take you from an apprentice to a ninja in four parts.</p>
      
      <p class="noind"><a href="kindle_split_010.html#part01" class="calibre4">Part 1</a> introduces the topic and sets the stage so that you can easily progress through the rest of the book:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><a href="kindle_split_011.html#ch01" class="calibre4">Chapter 1</a> introduces JavaScript the language and its most important features, while suggesting current best practices we should follow
            when developing applications, including testing and performance analysis.
            
         </li>
         
         <li class="calibre20">Because our exploration of JavaScript is made in the context of browsers, in <a href="kindle_split_012.html#ch02" class="calibre4">chapter 2</a> we’ll set the stage by introducing the lifecycle of client-side web applications. That will help us understand JavaScript’s
            role in the process of developing web applications.
            
         </li>
         
      </ul>
      
      <p class="noind"><a href="kindle_split_013.html#part02" class="calibre4">Part 2</a> focuses on one of the pillars of JavaScript: functions. We’ll study why functions are so important in JavaScript, the different
         kinds of functions, as well as the nitty-gritty details of defining and invoking functions. We’ll put a special focus on a
         new type of function—generator functions—which are especially helpful when dealing with asynchronous code:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><a href="kindle_split_014.html#ch03" class="calibre4">Chapter 3</a> begins our foray into the fundamentals of the language, starting, perhaps to your surprise, with a thorough examination of
            the <i class="calibre6">function</i> as defined by JavaScript. Although you may have expected the <i class="calibre6">object</i> to be the target of our first focus, a solid understanding of the function, and JavaScript as a functional language, begins
            our transformation from run-of-the-mill JavaScript coders to JavaScript ninjas!
            
         </li>
         
         <li class="calibre20">We continue this functional thread in <a href="kindle_split_015.html#ch04" class="calibre4">chapter 4</a>, by exploring the exact mechanism of invoking functions, as well as the ins and outs of implicit function parameters.
            
         </li>
         
         <li class="calibre20">Not being done with functions quite yet, in <a href="kindle_split_016.html#ch05" class="calibre4">chapter 5</a> we take our discussion to the next level by studying two closely related concepts: <i class="calibre6">scopes</i> and <i class="calibre6">closures</i>. A key concept in functional programming, closures allow us to exert fine-grained control over the scope of objects that
            we declare and create in our programs. The control of these scopes is the key factor in writing code worthy of a ninja. Even
            if you stop reading after this chapter (but we hope you don’t), you’ll be a far better JavaScript developer than when you
            started.
            
         </li>
         
         <li class="calibre20">We conclude our exploration of functions in <a href="kindle_split_017.html#ch06" class="calibre4">chapter 6</a>, by taking a look at a completely new type of function (<i class="calibre6">generator functions</i>) and a new type of object (<i class="calibre6">promises)</i> that help us deal with asynchronous values. We’ll also show you how to combine generators and promises to achieve elegance
            when dealing with asynchronous code.
            
         </li>
         
      </ul>
      
      <p class="noind"><a href="kindle_split_018.html#part03" class="calibre4">Part 3</a> deals with the second pillar of JavaScript: objects. We’ll thoroughly explore object orientation in JavaScript, and we’ll
         study how to guard access to objects and how to deal with collections and regular expressions:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Objects are finally addressed in <a href="kindle_split_019.html#ch07" class="calibre4">chapter 7</a>, where we learn exactly how JavaScript’s slightly strange flavor of object orientation works. We’ll also introduce a new
            addition to JavaScript: classes, which, deep under the hood, may not be exactly what you expect.
            
         </li>
         
         <li class="calibre20">We’ll continue our exploration of objects in <a href="kindle_split_020.html#ch08" class="calibre4">chapter 8</a>, where we’ll study different techniques for guarding access to our objects.
            
         </li>
         
         <li class="calibre20">In <a href="kindle_split_021.html#ch09" class="calibre4">chapter 9</a>, we’ll put a special focus on different types of collections that exist in JavaScript; on arrays, which have been a part
            of JavaScript since its beginnings; and on maps and sets, which are recent addition to JavaScript.
            
         </li>
         
         <li class="calibre20"><a href="kindle_split_022.html#ch10" class="calibre4">Chapter 10</a> focuses on regular expressions, an often-overlooked feature of the language that can do the work of scores of lines of code
            when used correctly. We’ll learn how to construct and use regular expressions and how to solve some recurring problems elegantly,
            using regular expressions and the methods that work with them.
            
         </li>
         
         <li class="calibre20">In <a href="kindle_split_023.html#ch11" class="calibre4">chapter 11</a>, we’ll learn different techniques for organizing our code into modules: smaller, relatively loosely coupled segments that
            improve the structure and organization of our code.
            
         </li>
         
      </ul>
      
      <p class="noind">Finally, <a href="kindle_split_024.html#part04" class="calibre4">part 4</a> wraps up the book by studying how JavaScript interacts with our web pages and how events are processed by the browser. We’ll
         finish the book by looking at an important topic, cross-browser development:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><a href="kindle_split_025.html#ch12" class="calibre4">Chapter 12</a> explores how we can dynamically modify our pages through DOM-manipulation APIs, and how we can handle element attributes,
            properties, and styles, as well as some important performance considerations.
            
         </li>
         
         <li class="calibre20"><a href="kindle_split_026.html#ch13" class="calibre4">Chapter 13</a> discusses the importance of JavaScript’s single-threaded execution model and the consequences this model has on the event
            loop. We’ll also learn how timers and intervals work and how we can use them to improve the perceived performance of our web
            applications.
            
         </li>
         
         <li class="calibre20"><a href="kindle_split_027.html#ch14" class="calibre4">Chapter 14</a> concludes the book by examining the five key development concerns with regard to these cross-browser issues: browser differences,
            bugs and bug fixes, external code and markup, missing features, and regressions. Strategies such as feature simulation and
            object detection are discussed at length to help us deal with these cross-browser challenges.
            
         </li>
         
      </ul>
      
      
      
      <h3 id="pref05lev1sec3" class="calibre24"><a id="pref05lev1sec3__title" class="calibre3"></a>Code conventions
      </h3>
      
      <p class="noind">All source code in listings or in the text is in a <kbd class="calibre15">fixed-width font like this</kbd> to separate it from ordinary text. Method and function names, properties, XML elements, and attributes in the text are also
         presented in this same font.
      </p>
      
      <p class="noind">In some cases, the original source code has been reformatted to fit on the pages. In general, the original code was written
         with page-width limitations in mind, but sometimes you may find a slight formatting difference between the code in the book
         and that provided in the source download. In a few rare cases, where long lines could not be reformatted without changing
         their meaning, the book listings contain line-continuation markers.
      </p>
      
      <p class="noind">Code annotations accompany many of the listings; these highlight important concepts.</p>
      
      
      
      <h3 id="pref05lev1sec4" class="calibre24"><a id="pref05lev1sec4__title" class="calibre3"></a>Code downloads
      </h3>
      
      <p class="noind">Source code for all the working examples in this book (along with some extras that never made it into the text) is available
         for download from the book’s web page at <a href="https://manning.com/books/secrets-of-the-javascript-ninja-second-edition" class="calibre4">https://manning.com/books/secrets-of-the-javascript-ninja-second-edition</a>.
      </p>
      
      <p class="noind">The code examples for this book are organized by chapter, with separate folders for each chapter. The layout is ready to be
         served by a local web server, such as the Apache HTTP Server. Unzip the downloaded code into a folder of your choice, and
         make that folder the document root of the application.
      </p>
      
      <p class="noind">With a few exceptions, most of the examples don’t require the presence of a web server and can be loaded directly into a browser
         for execution, if you so desire.
      </p>
      
      
      
      <h3 id="pref05lev1sec5" class="calibre24"><a id="pref05lev1sec5__title" class="calibre3"></a>Author Online
      </h3>
      
      <p class="noind">The authors and Manning Publications invite you to the book’s forum, run by Manning Publications, where you can make comments
         about the book, ask technical questions, and receive help from the authors and other users. To access and subscribe to the
         forum, point your browser to <a href="https://manning.com/books/secrets-of-the-javascript-ninja-second-edition" class="calibre4">https://manning.com/books/secrets-of-the-javascript-ninja-second-edition</a> and click the Author Online link. This page provides information on how to get on the forum once you are registered, what
         kind of help is available, and the rules of conduct in the forum.
      </p>
      
      <p class="noind">Manning’s commitment to our readers is to provide a venue where a meaningful dialogue between individual readers and between
         readers and the authors can take place. It’s not a commitment to any specific amount of participation on the part of the authors,
         whose contribution to the book’s forum remains voluntary (and unpaid). We suggest you try asking the authors some challenging
         questions, lest their interest stray!
      </p>
      
      <p class="noind">The Author Online forum and the archives of previous discussions will be accessible from the publisher’s website as long as
         the book is in print.
      </p>
      
      
      
      
      <h3 id="pref05lev1sec6" class="calibre24"><a id="pref05lev1sec6__title" class="calibre3"></a>About the authors
      </h3>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/xixfig01.jpg" alt="" class="calibre2" width="150" height="150" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/xixfig01.jpg"></p>
      
      
      <p class="noind"><b class="calibre21">John Resig</b> is a staff engineer at Khan Academy and the creator of the jQuery JavaScript library. In addition to the first edition of
         <i class="calibre6">Secrets of the JavaScript Ninja</i>, he’s also the author of the book <i class="calibre6">Pro JavaScript Techniques</i>.
      </p>
      
      <p class="noind">John has developed a comprehensive Japanese woodblock print database and image search engine: Ukiyo-e.org. He’s a board member
         of the Japanese Art Society of America and is a Visiting Researcher at Ritsumeikan University working on the study of Ukiyo-e.
      </p>
      
      <p class="noind">John is located in Brooklyn, NY.</p>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/xixfig02.jpg" alt="" class="calibre2" width="150" height="150" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/xixfig02.jpg"></p>
      
      
      <p class="noind"><b class="calibre21">Bear Bibeault</b> has been writing software for well over three decades, starting with a Tic-Tac-Toe program written on a Control Data Cyber
         supercomputer via a 100-baud teletype. Having two degrees in electrical engineering, Bear should be designing antennas or
         something like that, but since his first job with Digital Equipment Corporation, he has always been much more fascinated with
         programming.
      </p>
      
      <p class="noind">Bear has also served stints with companies such as Dragon Systems, Works.com, Spredfast, Logitech, Caringo, and more than
         a handful of others. Bear even served in the U.S. military, leading and training a platoon of anti-tank infantry soldiers—skills
         that come in handy during scrum meetings. “That’s <i class="calibre6">Sergeant</i> Bear to you, trainee!”
      </p>
      
      <p class="noind">Bear is currently a senior front-end developer for a leading provider of object storage software that provides massive storage
         scalability and content protection.
      </p>
      
      <p class="noind">In addition to the first edition of this book, Bear is also the author of a number of other Manning books, including <i class="calibre6">jQuery in Action</i> (first, second, and third editions), <i class="calibre6">Ajax in Practice</i>, and <i class="calibre6">Prototype and Scriptaculous in Action</i>; and he has been a technical reviewer for many of the web-focused “Head First” books by O’Reilly Publishing, such as <i class="calibre6">Head First Ajax</i>, <i class="calibre6">Head Rush Ajax</i>, and <i class="calibre6">Head First Servlets and JSP</i>.
      </p>
      
      <p class="noind">In addition to his day job, Bear also writes books (duh!), runs a small business that creates web applications and offers
         other media services (but not wedding videography—never, ever wedding videography), and helps out at <a href="http://CodeRanch.com" class="calibre4">CodeRanch.com</a> as a “marshal” (uber moderator).
      </p>
      
      <p class="noind">When not planted in front of a computer, Bear likes to cook <i class="calibre6">big</i> food (which accounts for his jeans size), dabble in photography and video, ride his Yamaha V-Star, and wear tropical print
         shirts.
      </p>
      
      <p class="noind">He works and resides in Austin, Texas, a city he loves, except for the completely insane traffic and drivers.</p>
      
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/0xxfig01.jpg" alt="" class="calibre2" width="150" height="175" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/0xxfig01.jpg"></p>
      
      
      <p class="noind"><b class="calibre21">Josip Maras</b> is a post-doctoral researcher in the faculty of electrical engineering, mechanical engineering, and naval architecture, University
         of Split, Croatia. He has a PhD in software engineering, with the thesis “Automating Reuse in Web Application Development,”
         which among other things included implementing a JavaScript interpreter in JavaScript. During his research, he has published
         more than a dozen scientific conference and journal papers, mostly dealing with program analysis of client-side web applications.
      </p>
      
      <p class="noind">When not doing research, Josip spends his time teaching web development, systems analysis and design, and Windows development
         (a couple hundred students over the last six years). He also owns a small software development business.
      </p>
      
      <p class="noind">In his spare time, Josip enjoys reading, long runs, and, if the weather allows, swimming in the Adriatic.</p>
      
      
      <h2 id="pref06" class="part"><a id="pref06__title" class="calibre3"></a>About the Cover Illustration
      </h2>
      
      
      
      <p class="noind">The figure on the cover of <i class="calibre6">Secrets of the JavaScript Ninja, Second Edition</i> is captioned “Noh Actor, Samurai,” from a woodblock print by an unknown Japanese artist of the mid-19th century. Derived
         from the Japanese word for <i class="calibre6">talent</i> or <i class="calibre6">skill</i>, Noh is a form of classical Japanese musical drama that has been performed since the 14th century. Many characters are masked,
         with men playing male and female roles. The samurai, a hero figure in Japan for hundreds of years, was often featured in the
         performances, and in this print the artist renders with great skill the beauty of the costume and the ferocity of the samurai.
      </p>
      
      <p class="noind">Samurai and ninjas were both warriors excelling in the Japanese art of war, known for their bravery and cunning. Samurai were
         elite soldiers, well-educated men who knew how to read and write as well as fight, and they were bound by a strict code of
         honor called Bushido (The Way of the Warrior), which was passed down orally from generation to generation, starting in the
         10th century. Recruited from the aristocracy and upper classes, analogous to European knights, samurai went into battle in
         large formations, wearing elaborate armor and colorful dress meant to impress and intimidate. Ninjas were chosen for their
         martial arts skills rather than their social standing or education. Dressed in black and with their faces covered, they were
         sent on missions alone or in small groups to attack the enemy with subterfuge and stealth, using any tactics to assure success;
         their only code was one of secrecy.
      </p>
      
      <p class="noind">The cover illustration is from a set of three Japanese prints owned for many years by a Manning editor, and when we were looking
         for a ninja for the cover of this book, the striking samurai print came to our attention and was selected for its intricate
         details, vibrant colors, and vivid depiction of a ferocious warrior ready to strike—and win.
      </p>
      
      <p class="noind">At a time when it is hard to tell one computer book from another, Manning celebrates the inventiveness and initiative of the
         computer business with book covers based on two-hundred-year-old illustrations that depict the rich diversity of traditional
         costumes from around the world, brought back to life by prints such as this one.
      </p>
      
      
      
      <div class="calibre25" id="calibre_pb_11"></div>
<h2 id="part01" class="part">Part 1. <a id="part01__title" class="calibre3"></a>Warming up
      </h2>
      
      
      <p class="noind">This part of the book will set the stage for your JavaScript ninja training. In <a href="kindle_split_011.html#ch01" class="calibre4">chapter 1</a>, we’ll look at the current state of JavaScript and explore some of the environments in which JavaScript code can be executed.
         We’ll put a special focus on the environment where it all began—<i class="calibre6">the browser</i>—and we’ll discuss some of the best practices when developing JavaScript applications.
      </p>
      
      <p class="noind">Because our exploration of JavaScript will be done in the context of browsers, in <a href="kindle_split_012.html#ch02" class="calibre4">chapter 2</a> we’ll teach you about the lifecycle of client-side web applications and how executing JavaScript code fits into this lifecycle.
      </p>
      
      <p class="noind">When you’re finished with this part of the book, you’ll be ready to embark on your training as a JavaScript ninja!</p>
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_13"></div>
<h2 id="ch01" class="part">Chapter 1. <a id="ch01__title" class="calibre3"></a>JavaScript is everywhere
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The core language features of JavaScript
            
         </li>
         
         <li class="calibre20">The core items of a JavaScript engine
            
         </li>
         
         <li class="calibre20">Three best practices in JavaScript development
            
         </li>
         
      </ul>
      
      <p class="noind">Let’s talk about Bob. After spending a few years learning how to create desktop applications in C++, he graduated as a software
         developer in the early 2000s and then went out into the wide world. At that point, the web had just hit its stride, and everybody
         wanted to be the next Amazon. So the first thing he did was learn web development.
      </p>
      
      <p class="noind">He learned some PHP so that he could dynamically generate web pages, which he usually sprinkled with JavaScript in order to
         achieve complex functionality such as form validation and even dynamic on-page clocks! Fast-forward a couple of years, and
         smartphones had become a thing, so anticipating a large new market opening up, Bob went ahead and learned Objective-C and
         Java to develop mobile apps that run on iOS and Android.
      </p>
      
      <p class="noind">Over the years, Bob has created many successful applications that all have to be maintained and extended. Unfortunately, jumping
         daily between all these different programming languages and application frameworks has really started to wear down poor Bob.
      </p>
      
      <p class="noind"><a id="iddle1706" class="calibre4"></a>Now let’s talk about Ann. Two years ago, Ann graduated with a degree in software development, specializing in web- and cloud-based
         applications. She has created a few medium-sized web applications based on modern Model–view–controller (MVC) frameworks,
         along with accompanying mobile applications that run on iOS and Android. She has created a desktop application that runs on
         Linux, Windows, and OS X, and has even started building a serverless version of that application entirely based in the cloud.
         And <i class="calibre6">everything she has done has been written in JavaScript</i>.
      </p>
      
      <p class="noind">That’s extraordinary! What took Bob 10 years and 5 languages to do, Ann has achieved in 2 years and in <i class="calibre6">just one language</i>. Throughout the history of computing, it has been rare for a particular knowledge set to be so easily transferable and useful
         across so many different domains.
      </p>
      
      <p class="noind">What started as a humble 10-day project back in 1995 is now one of the most widely used programming languages in the world.
         JavaScript is quite literally <i class="calibre6">everywhere</i>, thanks to more-powerful JavaScript engines and the introduction of frameworks such as Node, Apache Cordova, Ionic, and Electron,
         which have taken the language beyond the humble web page. And, like HTML, the language itself is now getting long overdue
         upgrades intended to make JavaScript even more suitable for modern application development.
      </p>
      
      <p class="noind">In this book, we’re going to make sure you know all you need to know about JavaScript so that, whether you’re like Ann or
         like Bob, you can develop all sorts of applications on a green field or a brown field.
      </p>
      
      <h3 class="calibre24"><a id="ch01qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch01qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch01qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">What are Babel and Traceur, and why are they important to today’s JavaScript developers?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch01qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch01qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">What are the core parts of any web browser’s JavaScript API used by web applications?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch01lev1sec1" class="calibre24"><a id="ch01lev1sec1__title" class="calibre3"></a>1.1. Understanding the JavaScript language
      </h3>
      
      <p class="noind">As they advance through their careers, many JavaScript coders like Bob and Ann reach the point where they’re actively using
         the vast number of elements that form the language. In many cases, however, those skills may not be taken beyond fundamental
         levels. Our guess is that this is often because JavaScript, using a C-like syntax, bears a surface resemblance to other widespread
         C-like languages (such as C# and Java), and thus leaves the impression of familiarity.
      </p>
      
      <p class="noind">People often feel that if they know C# or Java, they already have a pretty solid understanding of how JavaScript works. But
         it’s a trap! When compared to other mainstream languages, JavaScript is much more <i class="calibre6">functionally</i> oriented. Some JavaScript concepts differ fundamentally from those of most other languages.
      </p>
      
      <p class="noind"><a id="iddle1046" class="calibre4"></a><a id="iddle1490" class="calibre4"></a><a id="iddle1516" class="calibre4"></a><a id="iddle1599" class="calibre4"></a><a id="iddle1904" class="calibre4"></a><a id="iddle1988" class="calibre4"></a>These differences include the following:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Functions are first-class objects—</i> </b>In JavaScript, functions coexist with, and can be treated like, any other JavaScript object. They can be created through literals,
            referenced by variables, passed around as function arguments, and even returned as function return values. We devote much
            of <a href="kindle_split_014.html#ch03" class="calibre4">chapter 3</a> to exploring some of the wonderful benefits that functions as first-class objects bring to our JavaScript code.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Function closures—</i> </b>The concept of function closures is generally poorly understood, but at the same time it fundamentally and irrevocably exemplifies
            the importance of functions to JavaScript. For now, it’s enough to know that a function is <i class="calibre6">a closure when it actively maintains (“closes over”) the external variables used in its body</i>. Don’t worry for now if you don’t see the many benefits of closures; we’ll make sure all is crystal clear in <a href="kindle_split_016.html#ch05" class="calibre4">chapter 5</a>. In addition to closures, we’ll thoroughly explore the many aspects of functions themselves in <a href="kindle_split_014.html#ch03" class="calibre4">chapters 3</a> and <a href="kindle_split_015.html#ch04" class="calibre4 totri-footnote">4</a>, as well as identifier scopes in <a href="kindle_split_016.html#ch05" class="calibre4">chapter 5</a>.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Scopes—</i> </b>Until recently, JavaScript didn’t have block-level variables (as in other C-like languages); instead, we had to rely only
            on global variables and function-level variables.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Prototype-based object orientation—</i> </b>Unlike other mainstream programming languages (such as C#, Java, and Ruby), which use class-based object orientation, JavaScript
            uses prototypes. Often, when developers come to JavaScript from class-based languages (such as Java), they try to use JavaScript
            as if it were Java, essentially writing Java’s class-based code using the syntax of JavaScript. Then, for some reason, they’re
            surprised when the results differ from what they expect. This is why we’ll go deep into prototypes, how prototype-based object-orientation
            works, and how it’s implemented in JavaScript.
            
         </li>
         
      </ul>
      
      <p class="noind">JavaScript consists of a close relationship between objects and prototypes, and functions and closures. Understanding the
         strong relationships between these concepts can vastly improve your JavaScript programming ability, giving you a strong foundation
         for any type of application development, regardless of whether your JavaScript code will be executed in a web page, in a desktop
         app, in a mobile app, or on the server.
      </p>
      
      <p class="noind">In addition to these fundamental concepts, other JavaScript features can help you write more elegant and more efficient code.
         Some of these are features that seasoned developers like Bob will recognize from other languages, such as Java and C++. In
         particular, we focus on the following:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><i class="calibre6">Generators</i>, which are functions that can generate multiple values on a per-request basis and can suspend their execution between requests
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Promises</i>, which give us better control over asynchronous code
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Proxies,</i> which allow us to control access to certain objects
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Advanced array methods,</i> which make array-handling code much more elegant
            
         </li>
         
         <li class="calibre20"><a id="iddle1705" class="calibre4"></a><a id="iddle1707" class="calibre4"></a><a id="iddle1748" class="calibre4"></a><a id="iddle2131" class="calibre4"></a><i class="calibre6">Maps</i>, which we can use to create dictionary collections; and <i class="calibre6">sets</i>, which allow us to deal with collections of unique items
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Regular expressions,</i> which let us simplify what would otherwise be complicated pieces of code
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Modules</i>, which we can use to break code into smaller, relatively self-contained pieces that make projects more manageable
            
         </li>
         
      </ul>
      
      <p class="noind">Having a deep understanding of the fundamentals and learning how to use advanced language features to their best advantage
         can elevate your code to higher levels. Honing your skills to tie these concepts and features together will give you a level
         of understanding that puts the creation of any type of JavaScript application within your reach.
      </p>
      
      
      <h4 id="ch01lev2sec1" class="calibre26">1.1.1. <a id="ch01lev2sec1__title" class="calibre4"></a>How will JavaScript evolve?
      </h4>
      
      <p class="noind">The ECMAScript committee, in charge of standardizing the language, has just finished the ES7/ES2016 version of JavaScript.
         The ES7 version is a relatively small upgrade to JavaScript (at least, when compared to ES6), because the committee’s goal
         going forward is to focus on smaller, yearly incremental changes to the language.
      </p>
      
      <p class="noind">In this book we thoroughly explore ES6 but also focus on ES7 features, such as the new async function, which will help you
         deal with asynchronous code (discussed in <a href="kindle_split_017.html#ch06" class="calibre4">chapter 6</a>).
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch01note01" class="notetitle">Note</h5>
      
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/006fig01.jpg" alt="" class="calibre2" width="219" height="86" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/006fig01.jpg"></p>
      
      
      <p class="noindclose">When we cover features of JavaScript defined in ES6/ES2015 or ES7/ES2016, you’ll see these icons alongside a link to information
         about whether they’re supported by your browser.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Yearly incremental updates to the language specification are excellent news, but this doesn’t mean that web developers will
         instantly have access to the new features after the specification has been released. JavaScript code has to be executed by
         a Java-Script engine, so we’re often left waiting impatiently for updates to our favorite JavaScript engines that incorporate
         these new and exciting features.
      </p>
      
      <p class="noind">Unfortunately, although the JavaScript engine developers are trying to keep up and are doing better all the time, there’s
         always a chance that you’ll run into features that you are dying to use but that are yet to be supported.
      </p>
      
      <p class="noind">Luckily, you can keep up with the state of feature support in the various browsers via the lists at <a href="https://kangax.github.io/compat-table/es6/" class="calibre4">https://kangax.github.io/compat-table/es6/</a>, <a href="http://kangax.github.io/compat-table/es2016plus/" class="calibre4">http://kangax.github.io/compat-table/es2016plus/</a>, and <a href="https://kangax.github.io/compat-table/esnext/" class="calibre4">https://kangax.github.io/compat-table/esnext/</a>.
      </p>
      
      
      
      <h4 id="ch01lev2sec2" class="calibre26">1.1.2. <a id="ch01lev2sec2__title" class="calibre4"></a>Transpilers give us access to tomorrow’s JavaScript today
      </h4>
      
      <p class="noind">Because of the rapid release cycles of browsers, we usually don’t have to wait long for a JavaScript feature to be supported.
         But what happens if we want to take advantage of <a id="iddle1115" class="calibre4"></a><a id="iddle1135" class="calibre4"></a><a id="iddle1357" class="calibre4"></a><a id="iddle1704" class="calibre4"></a><a id="iddle2129" class="calibre4"></a>all the benefits of the newest JavaScript features but are taken hostage by a harsh reality: The users of our web applications
         may still be using older browsers?
      </p>
      
      <p class="noind">One answer to this problem is to use <i class="calibre6">transpilers</i> (“transformation + compiling”), tools that take cutting-edge JavaScript code and transform it into equivalent (or, if that’s
         not possible, similar) code that works properly in most current browsers.
      </p>
      
      <p class="noind">Today’s most popular transpilers are Traceur (<a href="https://github.com/google/traceur-compiler" class="calibre4">https://github.com/google/traceur-compiler</a>) and Babel (<a href="https://babeljs.io/" class="calibre4">https://babeljs.io/</a>). Setting them up is easy; just follow one of the tutorials, such as <a href="https://github.com/google/traceur-compiler/wiki/Getting-Started" class="calibre4">https://github.com/google/traceur-compiler/wiki/Getting-Started</a> or <a href="http://babeljs.io/docs/setup/" class="calibre4">http://babeljs.io/docs/setup/</a>.
      </p>
      
      <p class="noind">In this book, we put a special focus on running JavaScript code in the browser. To effectively use the browser platform, you
         have to get your hands dirty and study the inner workings of browsers. Let’s get started!
      </p>
      
      
      
      
      <h3 id="ch01lev1sec2" class="calibre24"><a id="ch01lev1sec2__title" class="calibre3"></a>1.2. Understanding the browser
      </h3>
      
      <p class="noind">These days, JavaScript applications can be executed in many environments. But the environment from which it all began, the
         environment from which all other environments have taken ideas, and the environment on which we’ll focus, is the <i class="calibre6">browser</i>. The browser provides various concepts and APIs to thoroughly explore; see <a href="#ch01fig01" class="calibre4">figure 1.1</a>.
      </p>
      
      
      
      <h5 id="ch01fig01" class="notetitle">Figure 1.1. <a id="ch01fig01__title" class="calibre4"></a>Client-side web applications rely on the infrastructure provided by the browser. We’ll particularly focus on the DOM, events,
         timers, and browser APIs.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/01fig01_alt.jpg" alt="" class="calibre2" width="590" height="301" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/01fig01_alt.jpg"></p>
      
      
      <p class="noind">We’ll concentrate on the following:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">The Document Object Model (DOM)—</i> </b>The DOM is a structured representation of the UI of a client-side web application that is, at least initially, built from
            the HTML code of a web application. To develop great applications, you need to not only have a deep understanding of the core
            JavaScript mechanics, but also study how the DOM is constructed (<a href="kindle_split_012.html#ch02" class="calibre4">chapter 2</a>) and how to write effective code that manipulates the DOM (<a href="kindle_split_025.html#ch12" class="calibre4">chapter 12</a>). This will put the creation of advanced, highly dynamic UIs at your fingertips.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Events—</i> </b><a id="iddle1118" class="calibre4"></a><a id="iddle1131" class="calibre4"></a><a id="iddle1134" class="calibre4"></a><a id="iddle1286" class="calibre4"></a><a id="iddle1421" class="calibre4"></a><a id="iddle1699" class="calibre4"></a>A huge majority of JavaScript applications are <i class="calibre6">event-driven</i> applications, meaning that most of the code is executed in the context of a response to a particular event. Examples of events
            include network events, timers, and user-generated events such as clicks, mouse moves, keyboard presses, and so on. For this
            reason, we’ll thoroughly explore the mechanisms behind events in <a href="kindle_split_026.html#ch13" class="calibre4">chapter 13</a>. We’ll pay special attention to <i class="calibre6">timers</i>, which are frequently a mystery but let us tackle complex coding tasks such as long-running computations and smooth animations.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Browser API—</i> </b>To help us interact with the world, the browser offers an API that allows us to access information about devices, store data
            locally, or communicate with remote servers. We’ll explore some of these APIs throughout the book.
            
         </li>
         
      </ul>
      
      <p class="noind">Perfecting your JavaScript programming skills and achieving deep understanding of APIs offered by the browser will take you
         far. But sooner, rather than later, you’ll run face first into <i class="calibre6">the browsers</i> and their various issues and inconsistencies. In a perfect world, all browsers would be bug-free and would support web standards
         in a consistent fashion; unfortunately, we don’t live in that world.
      </p>
      
      <p class="noind">The quality of browsers has improved greatly as of late, but they all still have some bugs, missing APIs, and browser-specific
         quirks that we need to deal with. Developing a comprehensive strategy for tackling these browser issues, and becoming intimately
         familiar with their differences and quirks, can be almost as important as proficiency in JavaScript itself.
      </p>
      
      <p class="noind">When we’re writing browser applications or JavaScript libraries to be used in them, choosing which browsers to support is
         an important consideration. We’d like to support them all, but limitations on development and testing resources dictate otherwise.
         For this reason, we’ll thoroughly explore strategies for cross-browser development in <a href="kindle_split_027.html#ch14" class="calibre4">chapter 14</a>.
      </p>
      
      <p class="noind">Developing effective, cross-browser code can depend significantly on the skill and experience of the developers. This book
         is intended to boost that skill level, so let’s get to it by looking at current best practices.
      </p>
      
      
      
      <h3 id="ch01lev1sec3" class="calibre24"><a id="ch01lev1sec3__title" class="calibre3"></a>1.3. Using current best practices
      </h3>
      
      <p class="noind">Mastery of the JavaScript language and a grasp of cross-browser coding issues are important parts of becoming an expert web
         application developer, but they’re not the complete picture. To enter the big leagues, you also need to exhibit the traits
         that scores of previous developers have proven are beneficial to the development of quality code. These traits are known as
         <i class="calibre6">best practices</i>, and in addition to mastery of the language, they include such elements as
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Debugging skills
            
         </li>
         
         <li class="calibre20">Testing
            
         </li>
         
         <li class="calibre20">Performance analysis
            
         </li>
         
      </ul>
      
      <p class="noind"><a id="iddle1048" class="calibre4"></a><a id="iddle1097" class="calibre4"></a><a id="iddle1119" class="calibre4"></a><a id="iddle1121" class="calibre4"></a><a id="iddle1174" class="calibre4"></a><a id="iddle1323" class="calibre4"></a><a id="iddle1325" class="calibre4"></a><a id="iddle1471" class="calibre4"></a><a id="iddle1486" class="calibre4"></a><a id="iddle1488" class="calibre4"></a><a id="iddle1700" class="calibre4"></a><a id="iddle1702" class="calibre4"></a><a id="iddle2103" class="calibre4"></a><a id="iddle2185" class="calibre4"></a><a id="iddle2187" class="calibre4"></a>It’s vitally important to adhere to these practices when coding, and we’ll use them throughout the book. Let’s examine some
         of them next.
      </p>
      
      
      <h4 id="ch01lev2sec3" class="calibre26">1.3.1. <a id="ch01lev2sec3__title" class="calibre4"></a>Debugging
      </h4>
      
      <p class="noind">Debugging JavaScript used to mean using <kbd class="calibre15">alert</kbd> to verify the value of variables. Fortunately, the ability to debug JavaScript code has dramatically improved, in no small
         part because of the popularity of the Firebug developer extension for Firefox. Similar tools have been developed for all major
         browsers:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Firebug—</i> </b>The popular developer extension for Firefox that got the ball rolling (<a href="http://getfirebug.com/" class="calibre4">http://getfirebug.com/</a>)
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Chrome DevTools—</i> </b>Developed by the Chrome team and used in Chrome and Opera
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Firefox Developer Tools—</i> </b>A tool included in Firefox, built by the Firefox team
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">F12 Developer Tools—</i> </b>Included in Internet Explorer and Microsoft Edge
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">WebKit Inspector—</i> </b>Used by Safari
            
         </li>
         
      </ul>
      
      <p class="noind">As you can see, every major browser offers developer tools that we can use to debug our web applications. The days of using
         JavaScript alerts for debugging are long gone!
      </p>
      
      <p class="noind">All of these tools are based on similar ideas, which were mostly introduced by Firebug, so they offer similar functionality:
         exploring the DOM, debugging JavaScript, editing CSS styles, tracking network events, and so on. Any of them will do a fine
         job; use the one offered by your browser of choice, or in the browser in which you’re investigating bugs.
      </p>
      
      <p class="noind">In addition, you can use some of them, such as Chrome Dev Tools, to debug other kinds of applications, like Node.js apps.
         (We’ll introduce you to some debugging techniques in <a href="kindle_split_029.html#app02" class="calibre4">appendix B</a>.)
      </p>
      
      
      
      <h4 id="ch01lev2sec4" class="calibre26">1.3.2. <a id="ch01lev2sec4__title" class="calibre4"></a>Testing
      </h4>
      
      <p class="noind">Throughout this book, we’ll apply testing techniques to ensure that the example code operates as intended and to serve as
         examples of how to test code in general. The primary tool we’ll use for testing is an <kbd class="calibre15">assert</kbd> function, whose purpose is to assert that a premise is either true or false. By specifying assertions, we can check whether
         the code is behaving as expected.
      </p>
      
      <p class="noind">The general form of this function is as follows:</p>
      
      <pre id="PLd0e1878" class="calibre5">assert(condition, message);</pre>
      
      <p class="noind">The first parameter is a condition that should be true, and the second is a message that will be displayed if it’s not.</p>
      
      <p class="noind">Consider this, for example:</p>
      
      <pre id="PLd0e1890" class="calibre5">assert(a === 1, "Disaster! a is not 1!");</pre>
      
      <p class="noind"><a id="iddle1120" class="calibre4"></a><a id="iddle1244" class="calibre4"></a><a id="iddle1248" class="calibre4"></a><a id="iddle1250" class="calibre4"></a><a id="iddle1497" class="calibre4"></a><a id="iddle1701" class="calibre4"></a><a id="iddle1703" class="calibre4"></a><a id="iddle2120" class="calibre4"></a><a id="iddle2122" class="calibre4"></a>If the value of variable <kbd class="calibre15">a</kbd> isn’t equal to <kbd class="calibre15">1</kbd>, the assertion fails, and the somewhat overly dramatic message is displayed.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch01note02" class="notetitle">Note</h5>
      
      
      <p class="noindclose">The <kbd class="calibre15">assert</kbd> function isn’t a standard feature of the language, so we’ll implement it ourselves in <a href="kindle_split_029.html#app02" class="calibre4">appendix B</a>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      
      <h4 id="ch01lev2sec5" class="calibre26">1.3.3. <a id="ch01lev2sec5__title" class="calibre4"></a>Performance analysis
      </h4>
      
      <p class="noind">Another important practice is performance analysis. The JavaScript engines have made astounding strides in the performance
         of JavaScript, but that’s no excuse for writing sloppy and inefficient code.
      </p>
      
      <p class="noind">We’ll use code such as the following later in this book to collect performance information:</p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/010fig01_alt.jpg" alt="" class="calibre2" width="590" height="136" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/010fig01_alt.jpg"></p>
      
      <p class="noind">Here, we bracket the execution of the code to be measured with two calls to the <kbd class="calibre15">time</kbd> and <kbd class="calibre15">timeEnd</kbd> methods of the built-in <kbd class="calibre15">console</kbd> object.
      </p>
      
      <p class="noind">Before the operation begins executing, the call to <kbd class="calibre15">console.time</kbd> starts a timer with a name (in this case, <kbd class="calibre15">My operation</kbd>). Then we run the code in the <kbd class="calibre15">for</kbd> loop a certain number of times (in this case, <kbd class="calibre15">maxCount</kbd> times). Because a single operation of the code happens much too quickly to measure reliably, we need to perform the code
         many times to get a measurable value. Frequently, this count can be in the tens of thousands, or even millions, depending
         on the nature of the code being measured. A little trial and error lets us choose a reasonable value.
      </p>
      
      <p class="noind">When the operation ends, we call the <kbd class="calibre15">console.timeEnd</kbd> method with the same name. This causes the browser to output the time that elapsed since the timer was started.
      </p>
      
      <p class="noind">These best-practice techniques, along with others you’ll learn along the way, will greatly enhance your JavaScript development.
         Developing applications with the restricted resources that a browser provides, coupled with the increasingly complex world
         of browser capability and compatibility, requires a robust and complete set of skills.
      </p>
      
      
      
      
      <h3 id="ch01lev1sec4" class="calibre24"><a id="ch01lev1sec4__title" class="calibre3"></a>1.4. Boosting skill transferability
      </h3>
      
      <p class="noind">When Bob was first learning web development, each browser had its own way of interpreting script and UI styles, preaching
         that their way was the best way and making every developer grind their teeth in frustration. Fortunately, the browser wars
         ended with HTML, CSS, the DOM API, and JavaScript all being standardized, and developer focus turning toward effective cross-browser
         JavaScript applications. Indeed, this focus on <a id="iddle1055" class="calibre4"></a><a id="iddle1058" class="calibre4"></a><a id="iddle1320" class="calibre4"></a><a id="iddle1761" class="calibre4"></a><a id="iddle2010" class="calibre4"></a>treating websites as applications led to many ideas, tools, and techniques crossing over from desktop applications to web
         applications. And now, that knowledge and tools transfer has happened again as ideas, tools, and techniques that originated
         in client-side web development have also permeated other application domains.
      </p>
      
      <p class="noind">Achieving a deep understanding of fundamental JavaScript principles with the knowledge of core APIs can therefore make you
         a more versatile developer. By using the browsers and Node.js (an environment derived from the browser), you can develop almost
         any type of application imaginable:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><i class="calibre6">Desktop applications</i>, by using, for example, NW.js (<a href="http://nwjs.io/" class="calibre4">http://nwjs.io/</a>) or Electron (<a href="http://electron.atom.io/" class="calibre4">http://electron.atom.io/</a>). These technologies usually wrap the browser so that we can build desktop UIs with standard HTML, CSS, and JavaScript (that
            way, we can rely on our core JavaScript and browser knowledge), with additional support that makes it possible to interact
            with the filesystem. We can build truly platform-independent desktop applications that have the same look and feel on Windows,
            Mac, and Linux.
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Mobile apps with frameworks</i>, such as Apache Cordova (<a href="https://cordova.apache.org/" class="calibre4">https://cordova.apache.org/</a>). Similar to desktop apps built with web technologies, frameworks for mobile apps use a wrapped browser but with additional
            platform-specific APIs that let us interact with the mobile platform.
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Server-side applications and applications for embedded devices with Node.js</i>, an environment derived from the browser that uses many of the same underlying principles as the browser. For example, Node.js
            executes JavaScript code and relies on events.
            
         </li>
         
      </ul>
      
      <p class="noind">Ann doesn’t know how lucky she is (although Bob has a pretty good idea). It doesn’t matter whether she needs to build a standard
         desktop application, a mobile application, a server-side application, or even an embedded application—all these types of applications
         share some of the same underlying principles of standard client-side web applications. By understanding how the core mechanics
         of JavaScript work, and by understanding the core APIs provided by browsers (such as events, which also have a lot in common
         with mechanisms provided by Node.js), she can boost her development skills across the board. As can you. In the process, you’ll
         become a more versatile developer and gain the knowledge and understanding to tackle a wide variety of problems. You’ll even
         be able to build your own serverless applications based in the cloud by using JavaScript APIs for services such as AWS Lambda
         to deploy, maintain, and control your application’s cloud components.
      </p>
      
      
      
      <h3 id="ch01lev1sec5" class="calibre24"><a id="ch01lev1sec5__title" class="calibre3"></a>1.5. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Client-side web applications are among the most popular today, and the concepts, tools, and techniques once used only for
            their development have permeated other application domains. Understanding the foundations of client-side web applications
            will help you develop applications for a wide variety of domains.
            
         </li>
         
         <li class="calibre20">To improve your development skills, you have to gain a deep understanding of the core mechanics of JavaScript, as well as
            the infrastructure provided by the browsers.
            
         </li>
         
         <li class="calibre20">This book focuses on core JavaScript mechanisms such as functions, function closures, and prototypes, as well as on new JavaScript
            features such as generators, promises, proxies, maps, sets, and modules.
            
         </li>
         
         <li class="calibre20">JavaScript can be executed in a large number of environments, but the environment where it all began, and the environment
            we’ll concentrate on, is the browser.
            
         </li>
         
         <li class="calibre20">In addition to JavaScript, we’ll explore browser internals such as the DOM (a structured representation of the web page UI)
            and events, because client-side web applications are event-driven applications.
            
         </li>
         
         <li class="calibre20">We’ll do this exploration with best practices in mind: debugging, testing, and performance analysis.
            
         </li>
         
      </ul>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_15"></div>
<h2 id="ch02" class="part">Chapter 2. <a id="ch02__title" class="calibre3"></a>Building the page at runtime
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Steps in the lifecycle of a web application
            
         </li>
         
         <li class="calibre20">Processing HTML code to produce a web page
            
         </li>
         
         <li class="calibre20">Order of executing JavaScript code
            
         </li>
         
         <li class="calibre20">Achieving interactivity with events
            
         </li>
         
         <li class="calibre20">The event loop
            
         </li>
         
      </ul>
      
      <p class="noind">Our exploration of JavaScript is performed in the context of client-side web applications and the browser as the engine that
         executes JavaScript code. In order to have a strong base from which to continue exploring JavaScript as a language and the
         browser as a platform, first we have to understand the complete web application lifecycle, and especially how our JavaScript
         code fits into this lifecycle.
      </p>
      
      <p class="noind">In this chapter, we’ll thoroughly explore the lifecycle of client-side web applications from the moment the page is requested,
         through various interactions performed by the user, all the way until the page is closed down. First we’ll explore how the
         page is built by processing the HTML code. Then we’ll focus on the execution of JavaScript code, which adds much-needed dynamicity
         to our pages. And finally <a id="iddle1407" class="calibre4"></a><a id="iddle1418" class="calibre4"></a><a id="iddle1732" class="calibre4"></a><a id="iddle1849" class="calibre4"></a><a id="iddle1850" class="calibre4"></a>we’ll look into how events are handled in order to develop interactive applications that respond to users’ actions.
      </p>
      
      <p class="noind">During this process, we’ll explore some fundamental web application concepts such as the DOM (a structured representation
         of a web page) and the event loop (determines how events are handled by applications). Let’s dive in!
      </p>
      
      <h3 class="calibre24"><a id="ch02qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch02qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch02qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">Does the browser always build the page exactly according to the given HTML?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch02qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch02qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">How many events can a web application handle at once?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch02qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch02qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">Why must browsers use an event queue to process events?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch02lev1sec1" class="calibre24"><a id="ch02lev1sec1__title" class="calibre3"></a>2.1. The lifecycle overview
      </h3>
      
      <p class="noind">The lifecycle of a typical client-side web application begins with the user typing a URL into the browser’s address bar or
         clicking a link. Let’s say we want to look up a term and go to Google’s homepage. We type in the URL <a href="http://www.google.com" class="calibre4">www.google.com</a>, as shown at upper left in <a href="#ch02fig01" class="calibre4">figure 2.1</a>.
      </p>
      
      
      
      <h5 id="ch02fig01" class="notetitle">Figure 2.1. <a id="ch02fig01__title" class="calibre4"></a>The lifecycle of a client-side web application starts with the user specifying a website address (or clicking a link) and
         ends when the user leaves the web page. It’s composed of two steps: <i class="calibre6">page building</i> and <i class="calibre6">event handling</i>.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig01_alt.jpg" alt="" class="calibre2" width="590" height="580" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1782" class="calibre4"></a>On behalf of the user, the browser formulates a request that is sent to a server <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg">, which processes the request <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-03.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-03.jpg"> and formulates a response that is usually composed of HTML, CSS, and JavaScript code. The moment the browser receives this
         response <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-04.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-04.jpg"> is when our client-side web application truly starts coming to life.
      </p>
      
      <p class="noind">Because client-side web applications are Graphical User Interface (GUI) applications, their lifecycle follows similar phases
         as other GUI applications (think standard desktop applications or mobile applications) and is carried out in the following
         two steps:
      </p>
      
      <p class="calibre18"></p>
      <ol class="calibre27">
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Page building—</i> </b>Set up the user interface.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Event handling—</i> </b>Enter a loop <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-05.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-05.jpg"> waiting for events to occur <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-06.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-06.jpg">, and start invoking event handlers.
            
         </li>
         
      </ol>
      
      <p class="noind">The lifecycle of the application ends when the user closes or leaves the web page <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-07.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-07.jpg">.
      </p>
      
      <p class="noind">Now let’s look at an example web application with a simple UI that reacts to user actions: Every time a user moves a mouse
         or clicks the page, a message is displayed. We’ll use this application throughout the chapter.
      </p>
      
      <h5 id="ch02ex01" class="notetitle">Listing 2.1. <a id="ch02ex01__title" class="calibre4"></a>Small web application with a GUI reacting to events
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch02ex01-0.jpg" alt="" class="calibre2" width="590" height="283" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch02ex01-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch02ex01-1.jpg" alt="" class="calibre2" width="590" height="311" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch02ex01-1.jpg"></p>
      
      <p class="noind"><a id="iddle1186" class="calibre4"></a><a id="iddle1613" class="calibre4"></a><a href="#ch02ex01" class="calibre4">Listing 2.1</a> first defines two CSS rules, <kbd class="calibre15">#first</kbd> and <kbd class="calibre15">#second</kbd>, that specify the text color for the elements with the IDs <kbd class="calibre15">first</kbd> and <kbd class="calibre15">second</kbd> (so that we can easily distinguish between them). We continue by defining a list element with the id <kbd class="calibre15">first</kbd>:
      </p>
      
      <pre id="PLd0e2399" class="calibre5">&lt;ul id="first"&gt;&lt;/ul&gt;</pre>
      
      <p class="noind">Then we define an <kbd class="calibre15">addMessage</kbd> function that, when invoked, creates a new list item element, sets its text content, and appends it to an existing element:
      </p>
      
      <pre id="PLd0e2411" class="calibre5">function addMessage(element, message){
  var messageElement = document.createElement("li");
  messageElement.textContent = message;
  element.appendChild(messageElement);
}</pre>
      
      <p class="noind">We follow this by using the built-in <kbd class="calibre15">getElementById</kbd> method to fetch an element with the ID <kbd class="calibre15">first</kbd> from the document, and adding a message to it that notifies us that the page is loading:
      </p>
      
      <pre id="PLd0e2426" class="calibre5">var first = document.getElementById("first");
addMessage(first, "Page loading");</pre>
      
      <p class="noind">Next we define another list element, now with the attribute ID <kbd class="calibre15">second</kbd>:
      </p>
      
      <pre id="PLd0e2438" class="calibre5">&lt;ul id="second"&gt;&lt;/ul&gt;</pre>
      
      <p class="noind">Finally we attach two event handlers to the body of the web page. We start with the <kbd class="calibre15">mousemove</kbd> event handler, which is executed every time the user moves the mouse, and adds a message <kbd class="calibre15">"Event: mousemove"</kbd> to the <kbd class="calibre15">second</kbd> list element by calling the <kbd class="calibre15">addMessage</kbd> function:
      </p>
      
      <pre id="PLd0e2459" class="calibre5">document.body.addEventListener("mousemove", function() {
  var second = document.getElementById("second");
  addMessage(second, "Event: mousemove");
});</pre>
      
      <p class="noind">We also register a <kbd class="calibre15">click</kbd> event handler, which, whenever the user clicks the page, logs a message <kbd class="calibre15">"Event: click"</kbd>, also to the <kbd class="calibre15">second</kbd> list element:
      </p>
      
      <pre id="PLd0e2477" class="calibre5">document.body.addEventListener("click", function(){
  var second = document.getElementById("second");
  addMessage(second, "Event: click");
});</pre>
      
      <p class="noind"><a id="iddle1358" class="calibre4"></a><a id="iddle1991" class="calibre4"></a>The result of running and interacting with this application is shown in <a href="#ch02fig02" class="calibre4">figure 2.2</a>.
      </p>
      
      
      
      <h5 id="ch02fig02" class="notetitle">Figure 2.2. <a id="ch02fig02__title" class="calibre4"></a>When the code from <a href="#ch02ex01" class="calibre4">listing 2.1</a> runs, messages are logged depending on user actions.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig02.jpg" alt="" class="calibre2" width="368" height="196" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig02.jpg"></p>
      
      
      
      <p class="noind">We’ll use this example application to explore and illustrate the differences between different phases of the web application
         lifecycle. Let’s start with the page-building phase.
      </p>
      
      
      
      <h3 id="ch02lev1sec2" class="calibre24"><a id="ch02lev1sec2__title" class="calibre3"></a>2.2. The page-building phase
      </h3>
      
      <p class="noind">Before a web application can be interacted with or even displayed, the page must be built from the information in the response
         received from the server (usually HTML, CSS, and JavaScript code). The goal of this page-building phase is to set up the UI
         of a web application, and this is done in two distinct steps:
      </p>
      
      <p class="calibre18"></p>
      <ol class="calibre27">
         
         <li class="calibre20">Parsing the HTML and building the Document Object Model (DOM)
            
         </li>
         
         <li class="calibre20">Executing JavaScript code
            
         </li>
         
      </ol>
      
      <p class="noind">Step 1 is performed when the browser is processing HTML nodes, and step 2 is performed whenever a special type of HTML element—the
         <kbd class="calibre15">script</kbd> element (that contains or refers to JavaScript code)—is encountered. During the page-building phase, the browser can switch
         between these two steps as many times as necessary, as shown in <a href="#ch02fig03" class="calibre4">figure 2.3</a>.
      </p>
      
      
      
      <h5 id="ch02fig03" class="notetitle">Figure 2.3. <a id="ch02fig03__title" class="calibre4"></a>The page-building phase starts when the browser receives the code of the page. It’s performed in two steps: parsing the HTML
         and building the DOM, and executing JavaScript code.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig03_alt.jpg" alt="" class="calibre2" width="590" height="562" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig03_alt.jpg"></p>
      
      
      
      
      <h4 id="ch02lev2sec1" class="calibre26">2.2.1. <a id="ch02lev2sec1__title" class="calibre4"></a>Parsing the HTML and building the DOM
      </h4>
      
      <p class="noind"><a id="iddle1348" class="calibre4"></a><a id="iddle1633" class="calibre4"></a><a id="iddle1642" class="calibre4"></a><a id="iddle1643" class="calibre4"></a><a id="iddle1843" class="calibre4"></a><a id="iddle1851" class="calibre4"></a><a id="iddle2040" class="calibre4"></a>The page-building phase starts with the browser receiving the HTML code, which is used as a base on top of which the browser
         builds the page’s UI. The browser does this by parsing the HTML code, one HTML element at a time, and building a DOM, a structured
         representation of the HTML page in which every HTML element is represented as a node. For example, <a href="#ch02fig04" class="calibre4">figure 2.4</a> shows the DOM of the example page that’s built until the first <kbd class="calibre15">script</kbd> element is reached.
      </p>
      
      
      
      <h5 id="ch02fig04" class="notetitle">Figure 2.4. <a id="ch02fig04__title" class="calibre4"></a>By the time the browser encounters the first <kbd class="calibre15">script</kbd> element, it has already created a DOM with multiple HTML elements (the nodes on the right).
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig04_alt.jpg" alt="" class="calibre2" width="590" height="406" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig04_alt.jpg"></p>
      
      
      <p class="noind">Notice how the nodes in <a href="#ch02fig04" class="calibre4">figure 2.4</a> are organized such that each node except the first one (the root <kbd class="calibre15">html</kbd> node <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg">) has exactly one parent. For example, the <kbd class="calibre15">head</kbd> node <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg"> has the <kbd class="calibre15">html</kbd> node <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg"> as its parent. At the same time, a node can have any number of children. For example, the <kbd class="calibre15">html</kbd> node <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg"> has two children: the <kbd class="calibre15">head</kbd> node <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg"> and the <kbd class="calibre15">body</kbd> node <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-07.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-07.jpg">. Children of the same element are called <i class="calibre6">siblings</i>. (The <kbd class="calibre15">head</kbd> node <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg"> and the <kbd class="calibre15">body</kbd> node <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-07.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-07.jpg"> are siblings.)
      </p>
      
      <p class="noind">It’s important to emphasize that, although the HTML and the DOM are closely linked, with the DOM being constructed from HTML,
         they aren’t one and the same. You should think of the HTML code as a <i class="calibre6">blueprint</i> the browser follows when constructing the initial DOM—the UI—of the page. The browser can even fix problems that it <a id="iddle1371" class="calibre4"></a>finds with this blueprint in order to create a valid DOM. Let’s consider the example shown in <a href="#ch02fig05" class="calibre4">figure 2.5</a>.
      </p>
      
      
      
      <h5 id="ch02fig05" class="notetitle">Figure 2.5. <a id="ch02fig05__title" class="calibre4"></a>An example of invalid HTML that is fixed by the browser
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig05_alt.jpg" alt="" class="calibre2" width="590" height="342" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig05_alt.jpg"></p>
      
      
      <p class="noind"><a href="#ch02fig05" class="calibre4">Figure 2.5</a> gives a simple example of erroneous HTML code in which a paragraph element is placed in the <kbd class="calibre15">head</kbd> element. The intention of the <kbd class="calibre15">head</kbd> element is that it is used for providing general page information: for example, the page title, character encodings, and
         external styles and scripts. It isn’t intended for defining page content, as in this example. Because this is an error, the
         browser silently fixes it by constructing the correct DOM (at right in <a href="#ch02fig05" class="calibre4">figure 2.5</a>), in which the paragraph element is placed in the <kbd class="calibre15">body</kbd> element, where the page content ought to be.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <b id="ch02sb01" class="calibre21">HTML specification and DOM specification</b>
         
         <p class="noind">The current version of HTML is HTML5, whose specification is available at <a href="https://html.spec.whatwg.org/" class="calibre4">https://html.spec.whatwg.org/</a>. If you need something more readable, we recommend Mozilla’s HTML5 guide, available at <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5" class="calibre4">https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5</a>.
         </p>
         
         <p class="noind">The DOM, on the other hand, is evolving a bit more slowly. The current version is DOM3, whose specification is available at
            <a href="https://dom.spec.whatwg.org/" class="calibre4">https://dom.spec.whatwg.org/</a>. Again, Mozilla has prepared a report that can be found at <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model" class="calibre4">https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model</a>.
         </p>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind"><a id="iddle1132" class="calibre4"></a><a id="iddle1340" class="calibre4"></a><a id="iddle1847" class="calibre4"></a><a id="iddle1992" class="calibre4"></a><a id="iddle2199" class="calibre4"></a>During page construction, the browser can encounter a special type of HTML element, the <kbd class="calibre15">script</kbd> element, which is used for including JavaScript code. When this happens, the browser pauses the DOM construction from HTML
         code and starts executing JavaScript code.
      </p>
      
      
      
      <h4 id="ch02lev2sec2" class="calibre26">2.2.2. <a id="ch02lev2sec2__title" class="calibre4"></a>Executing JavaScript code
      </h4>
      
      <p class="noind">All JavaScript code contained in the <kbd class="calibre15">script</kbd> element is executed by the browser’s JavaScript engine; for example, Firefox’s Spidermonkey, Chrome and Opera’s V8, or Edge’s
         (IE’s) Chakra. Because the primary purpose of JavaScript code is to provide dynamicity to the page, the browser provides an
         API through a global object that can be used by the JavaScript engine to interact with and modify the page.
      </p>
      
      
      <h5 id="ch02lev3sec1" class="notetitle"><a id="ch02lev3sec1__title" class="calibre4"></a>Global objects in JavaScript
      </h5>
      
      <p class="noind">The primary global object that the browser exposes to the JavaScript engine is the <kbd class="calibre15">window</kbd> object, which represents the window in which a page is contained. The <kbd class="calibre15">window</kbd> object is <i class="calibre6">the</i> global object through which all other global objects, global variables (even user-defined ones), and browser APIs are accessible.
         One of the most important properties of the global <kbd class="calibre15">window</kbd> object is the <kbd class="calibre15">document</kbd>, which represents the DOM of the current page. By using this object, the JavaScript code can alter the DOM of the page to
         any degree, by modifying or removing existing elements, and even by creating and inserting new ones.
      </p>
      
      <p class="noind">Let’s look at a snippet of code from <a href="#ch02ex01" class="calibre4">listing 2.1</a>:
      </p>
      
      <pre id="PLd0e2857" class="calibre5">var first = document.getElementById("first");</pre>
      
      <p class="noind">This example uses the global <kbd class="calibre15">document</kbd> object to select an element with the ID <kbd class="calibre15">first</kbd> from the DOM and assign it to a variable <kbd class="calibre15">first</kbd>. We can then use JavaScript code to make all sorts of modifications to that element, such as changing its textual content,
         modifying its attributes, dynamically creating and adding new children to it, and even removing the element from the DOM.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <b id="ch02sb02" class="calibre21">Browser APIs</b>
         
         <p class="noind">Throughout the book, we use a number of browser built-in objects and functions (for example, <kbd class="calibre15">window</kbd> and <kbd class="calibre15">document</kbd>). Unfortunately, covering everything supported by the browser lies beyond the scope of a JavaScript book. Luckily, Mozilla
            again has our backs with <a href="https://developer.mozilla.org/en-US/docs/Web/API" class="calibre4">https://developer.mozilla.org/en-US/docs/Web/API</a>, where you can find the current status of the Web API Interfaces.
         </p>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">With this basic understanding of the global objects provided by the browser, let’s look at two different types of JavaScript
         code that define exactly when that code is executed.
      </p>
      
      
      
      
      <h5 id="ch02lev3sec2" class="notetitle"><a id="ch02lev3sec2__title" class="calibre4"></a>Different types of JavaScript code
      </h5>
      
      <p class="noind"><a id="iddle1517" class="calibre4"></a><a id="iddle1614" class="calibre4"></a><a id="iddle1624" class="calibre4"></a><a id="iddle1846" class="calibre4"></a><a id="iddle1848" class="calibre4"></a>We broadly differentiate between two different types of JavaScript code: <i class="calibre6">global code</i> and <i class="calibre6">function code</i>. The following listing will help you understand the differences between these two types of code.
      </p>
      
      
      
      <h5 id="ch02ex02" class="notetitle">Listing 2.2. <a id="ch02ex02__title" class="calibre4"></a>Global and function JavaScript code
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/021fig01_alt.jpg" alt="" class="calibre2" width="590" height="160" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/021fig01_alt.jpg"></p>
      
      
      <p class="noind">The main difference between these two types of code is their placement: the code contained in a function is called <i class="calibre6">function code</i>, whereas the code placed outside all functions is called <i class="calibre6">global code</i>.
      </p>
      
      <p class="noind">These two code types also differ in their execution (you’ll see some additional differences later on, especially in <a href="kindle_split_016.html#ch05" class="calibre4">chapter 5</a>). Global code is executed automatically by the JavaScript engine (more on that soon) in a straightforward fashion, line by
         line, as it’s encountered. For example, in <a href="#ch02ex02" class="calibre4">listing 2.2</a>, the pieces of global code that define the <kbd class="calibre15">addMessage</kbd> function use the built-in <kbd class="calibre15">getElementById</kbd> method to fetch the element with ID <kbd class="calibre15">first</kbd> and call the <kbd class="calibre15">addMessage</kbd> function; they are executed one after another as they’re encountered, as shown in <a href="#ch02fig06" class="calibre4">figure 2.6</a>.
      </p>
      
      
      
      <h5 id="ch02fig06" class="notetitle">Figure 2.6. <a id="ch02fig06__title" class="calibre4"></a>Program execution flow when executing JavaScript code
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig06_alt.jpg" alt="" class="calibre2" width="590" height="195" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig06_alt.jpg"></p>
      
      
      <p class="noind">On the other hand, function code, in order to be executed, has to be called by something else: either by global code (for
         example, the <kbd class="calibre15">addMessage</kbd> function call in the global code causes the execution of the <kbd class="calibre15">addMessage</kbd> function code), by some other function, or by the browser (more on this soon).
      </p>
      
      
      
      <h5 id="ch02lev3sec3" class="notetitle"><a id="ch02lev3sec3__title" class="calibre4"></a>Executing JavaScript code in the page-building phase
      </h5>
      
      <p class="noind">When the browser reaches the <kbd class="calibre15">script</kbd> node in the page-building phase, it pauses the DOM construction based on HTML code and starts executing JavaScript code instead.
         <a id="iddle1341" class="calibre4"></a><a id="iddle1993" class="calibre4"></a>This means executing the global JavaScript code contained in the <kbd class="calibre15">script</kbd> element (and functions called by the global code are also executed). Let’s go back to the example from <a href="#ch02ex01" class="calibre4">listing 2.1</a>.
      </p>
      
      <p class="noind"><a href="#ch02fig07" class="calibre4">Figure 2.7</a> shows the state of the DOM after the global JavaScript code has been executed. Let’s walk slowly through its execution. First
         a function <kbd class="calibre15">addMessage</kbd> is defined:
      </p>
      
      <pre id="PLd0e3052" class="calibre5">function addMessage(element, message){
  var messageElement = document.createElement("li");
  messageElement.textContent = message;
  element.appendChild(messageElement);
 }</pre>
      
      
      
      <h5 id="ch02fig07" class="notetitle">Figure 2.7. <a id="ch02fig07__title" class="calibre4"></a>The DOM of the page after executing the JavaScript code contained in the <kbd class="calibre15">script</kbd> element
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig07_alt.jpg" alt="" class="calibre2" width="590" height="465" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig07_alt.jpg"></p>
      
      
      <p class="noind">Then an existing element is fetched from the DOM by using the global <kbd class="calibre15">document</kbd> object and its <kbd class="calibre15">getElementById</kbd> method:
      </p>
      
      <pre id="PLd0e3081" class="calibre5">var first = document.getElementById("first");</pre>
      
      <p class="noind"><a id="iddle1408" class="calibre4"></a><a id="iddle1730" class="calibre4"></a><a id="iddle1844" class="calibre4"></a><a id="iddle2148" class="calibre4"></a><a id="iddle2200" class="calibre4"></a>This is followed by a call to the <kbd class="calibre15">addMessage</kbd> function
      </p>
      
      <pre id="PLd0e3125" class="calibre5">addMessage(first, "Page loading");</pre>
      
      <p class="noind">which causes the creation of a new <kbd class="calibre15">li</kbd> element, the modification of its text content, and finally its insertion into the DOM.
      </p>
      
      <p class="noind">In this example, the JavaScript code modifies the current DOM by creating a new element and inserting it into the DOM. But
         in general, JavaScript code can modify the DOM to any degree: It can create new nodes and modify or remove existing DOM nodes.
         But there are also some things it can’t do, such as select and modify elements that haven’t yet been created. For example,
         we can’t select and modify the <kbd class="calibre15">ul</kbd> element with the ID <kbd class="calibre15">second</kbd>, because that element is found after the current <kbd class="calibre15">script</kbd> node and hasn’t yet been reached and created. That’s one of the reasons people tend to put their <kbd class="calibre15">script</kbd> elements at the bottom of the page. That way, we don’t have to worry about whether a particular HTML element has been reached.
      </p>
      
      <p class="noind">Once the JavaScript engine executes the last line of JavaScript code in the <kbd class="calibre15">script</kbd> element (in <a href="#ch02fig05" class="calibre4">figure 2.5</a>, this means returning from the <kbd class="calibre15">addMessage</kbd> function), the browser exits the JavaScript execution mode and continues building DOM nodes by processing the remaining HTML
         code. If, during that processing, the browser again encounters a <kbd class="calibre15">script</kbd> element, the DOM creation from HTML code is again paused, and the JavaScript runtime starts executing the contained JavaScript
         code. It’s important to note that the global state of the JavaScript application persists in the meantime. All user-defined
         global variables created during the execution of JavaScript code in one <kbd class="calibre15">script</kbd> element are normally accessible to JavaScript code in other <kbd class="calibre15">script</kbd> elements. This happens because the global <kbd class="calibre15">window</kbd> object, which stores all global JavaScript variables, is alive and accessible during the entire lifecycle of the page.
      </p>
      
      <p class="noind">These two steps</p>
      
      <p class="calibre18"></p>
      <ol class="calibre27">
         
         <li class="calibre20">Building the DOM from HTML
            
         </li>
         
         <li class="calibre20">Executing JavaScript code
            
         </li>
         
      </ol>
      
      <p class="noind">are repeated as long as there are HTML elements to process and JavaScript code to execute.</p>
      
      <p class="noind">Finally, when the browser runs out of HTML elements to process, the page-building phase is complete. The browser then moves
         on to the second part of the web application lifecycle: <i class="calibre6">event handling</i>.
      </p>
      
      
      
      
      
      <h3 id="ch02lev1sec3" class="calibre24"><a id="ch02lev1sec3__title" class="calibre3"></a>2.3. Event handling
      </h3>
      
      <p class="noind">Client-side web applications are GUI applications, which means they react to different kinds of events: mouse moves, clicks,
         keyboard presses, and so on. For this reason, the JavaScript code executed during the page-building phase, in addition to
         influencing the global application state and modifying the DOM, can also register event listeners (or handlers): functions
         that are executed by the browser when an event occurs. With these event handlers, we provide interactivity to our applications.
         But before taking a closer look at registering event handlers, let’s go through the general ideas behind event handling.
      </p>
      
      
      
      <h4 id="ch02lev2sec3" class="calibre26">2.3.1. <a id="ch02lev2sec3__title" class="calibre4"></a>Event-handling overview
      </h4>
      
      <p class="noind"><a id="iddle1419" class="calibre4"></a><a id="iddle2043" class="calibre4"></a>The browser execution environment is, at its core, based on the idea that only a single piece of code can be executed at once:
         the so-called <i class="calibre6">single-threaded</i> execution model. Think of a line at the bank. Everyone gets into a single line and has to wait their turn to be “processed”
         by the tellers. But with JavaScript, only <i class="calibre6">one</i> teller window is open! Customers (events) are processed only one at a time, as their turn comes. All it takes is one person
         who thinks it’s appropriate to do their financial planning for the entire fiscal year while they’re at the teller’s window
         (we’ve all run into them!) to gum up the works.
      </p>
      
      <p class="noind">Whenever an event occurs, the browser should execute the associated event-handler function. But there’s no guarantee that
         we have extremely patient users who will always wait an appropriate amount of time before triggering another event. For this
         reason, the browser needs a way to keep track of the events that have occurred but have yet to be processed. To do this, the
         browser uses an <i class="calibre6">event queue,</i> as shown in <a href="#ch02fig08" class="calibre4">figure 2.8</a>.
      </p>
      
      
      
      <h5 id="ch02fig08" class="notetitle">Figure 2.8. <a id="ch02fig08__title" class="calibre4"></a>In the event-handling phase, all events (whether coming from the user, such as mouse clicks and key presses, or coming from
         the server, such as Ajax events) are queued up as they occur and are processed as the single thread of execution allows.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig08_alt.jpg" alt="" class="calibre2" width="590" height="685" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig08_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1105" class="calibre4"></a><a id="iddle1136" class="calibre4"></a><a id="iddle1630" class="calibre4"></a><a id="iddle1792" class="calibre4"></a><a id="iddle2123" class="calibre4"></a><a id="iddle2162" class="calibre4"></a>All generated events (it doesn’t matter if they’re user-generated, like mouse moves or key presses, or server-generated, such
         as Ajax events) are placed in the same event queue, in the order in which they’re detected by the browser. As shown in the
         middle of <a href="#ch02fig08" class="calibre4">figure 2.8</a>, the event-handling process can then be described with a simple flowchart:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The browser checks the head of the event queue.
            
         </li>
         
         <li class="calibre20">If there are no events, the browser keeps checking.
            
         </li>
         
         <li class="calibre20">If there’s an event at the head of the event queue, the browser takes it and executes the associated handler (if one exists).
            During this execution, the rest of the events patiently wait in the event queue for their turn to be processed.
            
         </li>
         
      </ul>
      
      <p class="noind">Because only one event is handled at a time, we have to be extra careful about the amount of time needed for handling events;
         writing event handlers that take a lot of time to execute leads to unresponsive web applications! (Don’t worry if this sounds
         a bit vague; we’ll come back to the event loop in <a href="kindle_split_026.html#ch13" class="calibre4">chapter 13</a> and see exactly how it impacts the perceived performance of web applications).
      </p>
      
      <p class="noind">It’s important to note that the browser mechanism that puts events <i class="calibre6">onto</i> the queue is external to the page-building and event-handling phases. The processing that’s necessary to determine when events
         have occurred and that pushes them onto the event queue doesn’t participate in the thread that’s <i class="calibre6">handling</i> the events.
      </p>
      
      
      <h5 id="ch02lev3sec4" class="notetitle"><a id="ch02lev3sec4__title" class="calibre4"></a>Events are asynchronous
      </h5>
      
      <p class="noind">Events, when they happen, can occur at unpredictable times and in an unpredictable order (it’s tricky to force users to press
         keys or click in some particular order). We say that the handling of events, and therefore the invocation of their handling
         functions, is <i class="calibre6">asynchronous</i>.
      </p>
      
      <p class="noind">The following types of events can occur, among others:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Browser events, such as when a page is finished loading or when it’s to be unloaded
            
         </li>
         
         <li class="calibre20">Network events, such as responses coming from the server (Ajax events, server-side events)
            
         </li>
         
         <li class="calibre20">User events, such as mouse clicks, mouse moves, and key presses
            
         </li>
         
         <li class="calibre20">Timer events, such as when a timeout expires or an interval fires
            
         </li>
         
      </ul>
      
      <p class="noind">The vast majority of code executes as a result of such events!</p>
      
      <p class="noind">The concept of event handling is central to web applications, and it’s something you’ll see again and again throughout the
         examples in this book: Code is set up in advance in order to be executed at a later time. Except for global code, the vast
         majority of the code we place on a page will execute as the result of some event.
      </p>
      
      <p class="noind">Before events can be handled, our code has to notify the browser that we’re interested in handling particular events. Let’s
         look at how to register event handlers.
      </p>
      
      
      
      
      <h4 id="ch02lev2sec4" class="calibre26">2.3.2. <a id="ch02lev2sec4__title" class="calibre4"></a>Registering event handlers
      </h4>
      
      <p class="noind">As we’ve already mentioned, event handlers are functions that we want executed whenever a particular event occurs. In order
         for this to happen, we have to notify the browser <a id="iddle1040" class="calibre4"></a><a id="iddle1187" class="calibre4"></a><a id="iddle1422" class="calibre4"></a><a id="iddle1839" class="calibre4"></a><a id="iddle2201" class="calibre4"></a>that we’re interested in an event. This is called <i class="calibre6">event-handler registration</i>. In client-side web applications, there are two ways to register events:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">By assigning functions to special properties
            
         </li>
         
         <li class="calibre20">By using the built-in <kbd class="calibre15">addEventListener</kbd> method
            
         </li>
         
      </ul>
      
      <p class="noind">For example, writing the following code assigns a function to the special <kbd class="calibre15">onload</kbd> property of the <kbd class="calibre15">window</kbd> object:
      </p>
      
      <pre id="PLd0e3440" class="calibre5">window.onload = function(){};</pre>
      
      <p class="noind">An event handler for the <kbd class="calibre15">load</kbd> event (when the DOM is ready and fully built) is registered. (Don’t worry if the notation on the right side of the assignment
         operator looks a bit funky; we’ll talk at great length about functions in later chapters.) Similarly, if we want to register
         a handler for the <kbd class="calibre15">click</kbd> event on the document’s body, we can write something along these lines:
      </p>
      
      <pre id="PLd0e3455" class="calibre5">document.body.onclick = function(){};</pre>
      
      <p class="noind">Assigning functions to special properties is an easy and straightforward way of registering event handlers, and you’ve probably
         run into it already. But we don’t recommend that you register event handlers this way, because doing so comes with a drawback:
         It’s only possible to register one function handler for a particular event. This means it’s easy to overwrite previous event-handler
         functions, which can be a little frustrating. Luckily, there’s an alternative: The <kbd class="calibre15">addEventListener</kbd> method enables us to register as many event-handler functions as we need. To show you an example, the following listing goes
         back to an excerpt of the example from <a href="#ch02ex01" class="calibre4">listing 2.1</a>.
      </p>
      
      
      
      <h5 id="ch02ex03" class="notetitle">Listing 2.3. <a id="ch02ex03__title" class="calibre4"></a>Registering event handlers
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/026fig01_alt.jpg" alt="" class="calibre2" width="590" height="167" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/026fig01_alt.jpg"></p>
      
      
      <p class="noind">This example uses the built-in <kbd class="calibre15">addEventListener</kbd> method on an HTML element to specify the type of event (<kbd class="calibre15">mousemove</kbd> or <kbd class="calibre15">click</kbd>) and the event-handler function. This means whenever the mouse is moved over the page, the browser calls a function that
         adds a message, <kbd class="calibre15">"Event: mousemove"</kbd>, to the list element with the ID <kbd class="calibre15">second</kbd> (a similar message, <kbd class="calibre15">"Event: click"</kbd>, is added to the same element whenever the body is clicked).
      </p>
      
      <p class="noind">Now that you know how to set up event handlers, let’s recall the simple flowchart you saw earlier and take a closer look at
         how events are handled.
      </p>
      
      
      
      
      <h4 id="ch02lev2sec5" class="calibre26">2.3.3. <a id="ch02lev2sec5__title" class="calibre4"></a>Handling events
      </h4>
      
      <p class="noind"><a id="iddle1783" class="calibre4"></a>The main idea behind event handling is that when an event occurs, the browser calls the associated event handler. As we’ve
         already mentioned, due to the single-threaded execution model, only a single event handler can be executed at once. Any following
         events are processed only after the execution of the current event handler is fully complete!
      </p>
      
      <p class="noind">Let’s go back to the application from <a href="#ch02ex01" class="calibre4">listing 2.1</a>. <a href="#ch02fig09" class="calibre4">Figure 2.9</a> shows an example execution in which a quick user has moved and clicked a mouse.
      </p>
      
      
      
      <h5 id="ch02fig09" class="notetitle">Figure 2.9. <a id="ch02fig09__title" class="calibre4"></a>Example of an event-handling phase in which two events—<kbd class="calibre15">mousemove</kbd> and <kbd class="calibre15">click</kbd>—are handled
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig09_alt.jpg" alt="" class="calibre2" width="590" height="665" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig09_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1188" class="calibre4"></a><a id="iddle1420" class="calibre4"></a>Let’s examine what’s going on here. As a response to these user actions, the browser puts the <kbd class="calibre15">mousemove</kbd> and <kbd class="calibre15">click</kbd> events onto the event queue in the order in which they have occurred: first the <kbd class="calibre15">mousemove</kbd> event and then the <kbd class="calibre15">click</kbd> event <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg">.
      </p>
      
      <p class="noind">In the event-handling phase, the event loop then checks the queue, sees that there’s a <kbd class="calibre15">mousemove</kbd> event at the front of the queue, and executes the associated event handler <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg">. While the <kbd class="calibre15">mousemove</kbd> handler is being processed, the <kbd class="calibre15">click</kbd> event waits in the queue for its turn. When the last line of the <kbd class="calibre15">mousemove</kbd> handler function has finished executing and the JavaScript engine exits the handler function, the <kbd class="calibre15">mousemove</kbd> event is fully processed <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-03.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-03.jpg">, and the event loop again checks the queue. This time, at the front of the queue, the event loop finds the <kbd class="calibre15">click</kbd> event and processes it. Once the <kbd class="calibre15">click</kbd> handler has finished executing, there are no new events in the queue, and the event loop keeps looping, waiting for new events
         to handle. This loop will continue executing until the user closes the web application.
      </p>
      
      <p class="noind">Now that we have a sense of the overall steps that happen in the event-handling phase, let’s see how this execution influences
         the DOM (<a href="#ch02fig10" class="calibre4">figure 2.10</a>). The execution of <a id="iddle1845" class="calibre4"></a>the <kbd class="calibre15">mousemove</kbd> handler selects the second list element with ID <kbd class="calibre15">second</kbd> and, by using the <kbd class="calibre15">addMessage</kbd> function, adds a new list item element <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg"> with the text <kbd class="calibre15">"Event: mousemove"</kbd>. Once the execution of the <kbd class="calibre15">mousemove</kbd> handler is finished, the event loop executes the <kbd class="calibre15">click</kbd> handler, which leads to the creation of another list item element <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg">, which is also appended to the second list element with the ID <kbd class="calibre15">second</kbd>.
      </p>
      
      
      
      <h5 id="ch02fig10" class="notetitle">Figure 2.10. <a id="ch02fig10__title" class="calibre4"></a>The DOM of the example application after handling the <kbd class="calibre15">mousemove</kbd> and <kbd class="calibre15">click</kbd> events
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig10_alt.jpg" alt="" class="calibre2" width="590" height="516" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/02fig10_alt.jpg"></p>
      
      
      <p class="noind">Armed with this solid understanding of the lifecycle of client-side web applications, in the next part of the book, we’ll
         start focusing on JavaScript the language, by learning the ins and outs of functions.
      </p>
      
      
      
      
      <h3 id="ch02lev1sec4" class="calibre24"><a id="ch02lev1sec4__title" class="calibre3"></a>2.4. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The HTML code received by the browser is used as a blueprint for creating the DOM, an internal representation of the structure
            of a client-side web application.
            
         </li>
         
         <li class="calibre20">We use JavaScript code to dynamically modify the DOM to bring dynamic behavior to web applications.
            
         </li>
         
         <li class="calibre20">The execution of client-side web applications is performed in two phases:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20"><b class="calibre21"><i class="calibre6">Page building—</i> </b>HTML code is processed to create the DOM, and global JavaScript code is executed when script nodes are encountered. During
                  this execution, the JavaScript code can modify the current DOM to any degree and can even register event handlers—functions
                  that are executed when a particular event occurs (for example, a mouse click or a keyboard press). Registering event handlers
                  is easy: Use the built-in <kbd class="calibre15">addEventListener</kbd> method.
                  
               </li>
               
               <li class="calibre20"><b class="calibre21"><i class="calibre6">Event handling—</i> </b>Various events are processed one at a time, in the order in which they were generated. The event-handling phase relies heavily
                  on the event queue, in which all events are stored in the order in which they occurred. The event loop always checks the top
                  of the queue for events, and if an event is found, the matching event-handler function is invoked.
                  
               </li>
               
            </ul>
            
         </li>
         
      </ul>
      
      
      
      <h3 id="ch02lev1sec5" class="calibre24"><a id="ch02lev1sec5__title" class="calibre3"></a>2.5. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch02qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch02qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch02qa2q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">What are the two phases in the lifecycle of a client-side web application?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch02qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch02qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind">What is the main advantage of using the <kbd class="calibre15">addEventListener</kbd> method to register an event handler versus assigning a handler to a specific element property?
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch02qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch02qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">How many events can be processed at once?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch02qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch02qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">In what order are events from the event queue processed?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_17"></div>
<h2 id="part02" class="part">Part 2. <a id="part02__title" class="calibre3"></a>Understanding functions
      </h2>
      
      
      <p class="noind">Now that you’re mentally prepared and you understand the environment in which JavaScript code is executed, you’re ready to
         learn the fundamentals of the JavaScript features available to you.
      </p>
      
      <p class="noind">In <a href="kindle_split_014.html#ch03" class="calibre4">chapter 3</a>, you’ll learn all about the most important basic concept of JavaScript: no, not the object, but the function. This chapter
         will teach you why understanding JavaScript functions is the key to unlocking the secrets of the language.
      </p>
      
      <p class="noind"><a href="kindle_split_015.html#ch04" class="calibre4">Chapter 4</a> continues our in-depth exploration of functions by studying how functions are invoked, alongside all the ins and outs of
         implicit parameters that are accessible when executing function code.
      </p>
      
      <p class="noind"><a href="kindle_split_016.html#ch05" class="calibre4">Chapter 5</a> takes functions to the next level with closures—probably one of the most misunderstood (and even unknown) aspects of the
         JavaScript language. As you’ll soon see, closures are closely tied to scopes. In this chapter, in addition to closures, we
         put a special focus on the scoping mechanisms in JavaScript.
      </p>
      
      <p class="noind">Our exploration of functions will be completed in <a href="kindle_split_017.html#ch06" class="calibre4">chapter 6</a>, where we discuss a completely new type of function—the generator function—that has some special properties and is especially
         useful when dealing with asynchronous code.
      </p>
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_19"></div>
<h2 id="ch03" class="part">Chapter 3. <a id="ch03__title" class="calibre3"></a>First-class functions for the novice: definitions and arguments
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Why understanding functions is so crucial
            
         </li>
         
         <li class="calibre20">How functions are first-class objects
            
         </li>
         
         <li class="calibre20">The ways to define a function
            
         </li>
         
         <li class="calibre20">The secrets of how parameters are assigned
            
         </li>
         
      </ul>
      
      <p class="noind">You might be surprised, upon turning to this part of the book dedicated to JavaScript fundamentals, to see that the first
         topic of discussion is <i class="calibre6">functions</i> rather than <i class="calibre6">objects</i>. We’ll certainly be paying plenty of attention to objects in <a href="kindle_split_018.html#part03" class="calibre4">part 3</a> of the book, but when it comes down to brass tacks, the main difference between writing JavaScript code like the average
         Jill (or Joe) and writing it like a JavaScript ninja is understanding JavaScript as a <i class="calibre6">functional language</i>. The level of sophistication of all the code you’ll ever write in JavaScript hinges on this realization.
      </p>
      
      <p class="noind">If you’re reading this book, you’re not a rank beginner. We’re assuming that you know enough object fundamentals to get by
         (and we’ll be taking a look at <a id="iddle1090" class="calibre4"></a><a id="iddle1491" class="calibre4"></a>more-advanced object concepts in <a href="kindle_split_019.html#ch07" class="calibre4">chapter 7</a>), but <i class="calibre6">really</i> understanding functions in JavaScript is the single most important weapon you can wield. So important, in fact, that this
         and the following three chapters are devoted to thoroughly understanding functions in JavaScript.
      </p>
      
      <p class="noind">Most important, in JavaScript, functions are <i class="calibre6">first-class objects,</i> or <i class="calibre6">first-class citizens</i> as they’re often called. They coexist with, and can be treated like, any other JavaScript object. Just like the more mundane
         JavaScript data types, they can be referenced by variables, declared with literals, and even passed as function parameters.
         In this chapter, we’ll first take a look at the difference that this orientation to functions brings, and you’ll see how this
         can help us write more compact and easy-to-understand code, by allowing us to define functions right where we need them. We’ll
         also explore how to take advantage of functions as first-class objects in order to write better-performing functions. You’ll
         see various ways of defining functions, even including some new types, such as <i class="calibre6">arrow</i> functions, which will help you write more elegant code. Finally, we’ll look at the difference between function parameters
         and function arguments, with a special focus on ES6 additions, such as the rest and default parameters.
      </p>
      
      <p class="noind">Let’s start by going through some of the benefits of functional programming.</p>
      
      <h3 class="calibre24"><a id="ch03qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch03qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch03qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">In what situations might callback functions be used synchronously? Asynchronously?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch03qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch03qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">What’s the difference between an arrow function and a function expression?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch03qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch03qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">Why might you need to use default parameter values in a function?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch03lev1sec1" class="calibre24"><a id="ch03lev1sec1__title" class="calibre3"></a>3.1. What’s with the functional difference?
      </h3>
      
      <p class="noind">One of the reasons that functions and functional concepts are so important in JavaScript is that functions are primary modular
         units of execution. Except for the global JavaScript code executed in the page-building phase, all of the script code that
         we’ll write for our pages will be within a function.
      </p>
      
      <p class="noind">Because most of our code will run as the result of a function invocation, you’ll see that having functions that are versatile
         and powerful constructs gives us a great deal of flexibility and sway when writing code. Significant chunks of this book explain
         just how the nature of functions as first-class objects can be exploited to our great benefit. But first, let’s take a look
         at some of the actions we can take with objects. In JavaScript, objects enjoy certain capabilities:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">They can be created via literals: <kbd class="calibre15">{}</kbd>
            
         </li>
         
         <li class="calibre20">They can be assigned to variables, array entries, and properties of other objects:
            
            
            
            
            <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/035fig01.jpg" alt="" class="calibre2" width="491" height="160" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/035fig01.jpg"></p>
            
            
         </li>
         
         <li class="calibre20"><a id="iddle1542" class="calibre4"></a>They can be passed as arguments to functions:
            
            
            
            <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/035fig02.jpg" alt="" class="calibre2" width="491" height="74" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/035fig02.jpg"></p>
            
            
         </li>
         
         <li class="calibre20">They can be returned as values from functions:
            
            
            
            <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/035fig03.jpg" alt="" class="calibre2" width="477" height="63" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/035fig03.jpg"></p>
            
            
         </li>
         
         <li class="calibre20">They can possess properties that can be dynamically created and assigned:
            
            
            
            <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/035fig04.jpg" alt="" class="calibre2" width="465" height="42" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/035fig04.jpg"></p>
            
            
         </li>
         
      </ul>
      
      <p class="noind">It turns out that, unlike in many other programming languages, in JavaScript we can do almost the exact same things with functions
         also.
      </p>
      
      
      <h4 id="ch03lev2sec1" class="calibre26">3.1.1. <a id="ch03lev2sec1__title" class="calibre4"></a>Functions as first-class objects
      </h4>
      
      <p class="noind">Functions in JavaScript possess all the capabilities of objects and are thus treated like any other object in the language.
         We say that functions are <i class="calibre6">first-class</i> objects, which can also be
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Created via literals
            
            
            <div class="calibre13"></div><pre class="calibre5">function ninjaFunction() {}</pre>
            
            </li>
         
         <li class="calibre20">Assigned to variables, array entries, and properties of other objects
            
            <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/035fig05_alt.jpg" alt="" class="calibre2" width="590" height="145" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/035fig05_alt.jpg"></p>
            
         </li>
         
         <li class="calibre20"><a id="iddle1151" class="calibre4"></a><a id="iddle1154" class="calibre4"></a><a id="iddle1537" class="calibre4"></a><a id="iddle1547" class="calibre4"></a><a id="iddle1564" class="calibre4"></a>Passed as arguments to other functions
            
            
            
            <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/036fig01.jpg" alt="" class="calibre2" width="500" height="72" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/036fig01.jpg"></p>
            
            
         </li>
         
         <li class="calibre20">Returned as values from functions
            
            <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/036fig02_alt.jpg" alt="" class="calibre2" width="567" height="73" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/036fig02_alt.jpg"></p>
            
         </li>
         
         <li class="calibre20">They can possess properties that can be dynamically created and assigned:
            
            <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/036fig03_alt.jpg" alt="" class="calibre2" width="590" height="49" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/036fig03_alt.jpg"></p>
            
         </li>
         
      </ul>
      
      <p class="noind">Whatever we can do with objects, we can do with functions as well. Functions <i class="calibre6">are</i> objects, just with an additional, special capability of being <i class="calibre6">invokable:</i> Functions can be called or invoked in order to perform an action.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <b id="ch03sb01" class="calibre21">Functional programming in JavaScript</b>
         
         <p class="noind">Having functions as first-class objects is the first step toward <i class="calibre6">functional programming</i>, a style of programming that’s focused on solving problems by composing functions (instead of specifying sequences of steps,
            as in more mainstream, imperative programming). Functional programming can help us write code that’s easier to test, extend,
            and modularize. But it’s a big topic, and in this book we only give it a nod (for example, in <a href="kindle_split_021.html#ch09" class="calibre4">chapter 9</a>). If you’re interested in learning how to take advantage of functional programming concepts and apply them to your JavaScript
            programs, we recommend <i class="calibre6">Functional Programming in JavaScript</i> by Luis Atencio (Manning, 2016), available at <a href="http://www.manning.com/books/functional-programming-in-javascript" class="calibre4">www.manning.com/books/functional-programming-in-javascript</a>.
         </p>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">One of the characteristics of first-class objects is that they can be passed to functions as arguments. In the case of functions,
         this means that we pass a function as an argument to another function that might, at a later point in application execution,
         call the passed-in function. This is an example of a more general concept known as a <i class="calibre6">callback function</i>. Let’s explore this important concept.
      </p>
      
      
      
      <h4 id="ch03lev2sec2" class="calibre26">3.1.2. <a id="ch03lev2sec2__title" class="calibre4"></a>Callback functions
      </h4>
      
      <p class="noind">Whenever we set up a function to be called at a later time, whether by the browser in the event-handling phase or by other
         code, we’re setting up a <i class="calibre6">callback</i>. The term stems from the fact that we’re establishing a function that other code will later “call back” at an appropriate
         point of execution.
      </p>
      
      <p class="noind"><a id="iddle1098" class="calibre4"></a>Callbacks are an essential part of using JavaScript effectively, and we’re willing to bet that you already use them in your
         code a lot—whether executing code on a button click, receiving data from a server, or animating parts of your UI.
      </p>
      
      <p class="noind">In this section, we’re about to look at how to use callbacks to handle events or to easily sort collections—typical real-world
         examples of how callbacks are used. But it’s a tad complex, so before diving in, let’s strip the callback concept completely
         naked and examine it in its simplest form. We’ll start with an illuminating example of a completely useless function that
         accepts a reference to another function as a parameter and calls that function as a callback:
      </p>
      
      <pre id="PLd0e4170" class="calibre5">function useless(ninjaCallback) {
  return ninjaCallback();
}</pre>
      
      <p class="noind">As useless as this function is, it demonstrates the ability to pass a function as an argument to another function, and to
         subsequently invoke that function through the passed parameter.
      </p>
      
      <p class="noind">We can test this useless function with the code in the following listing.</p>
      
      
      
      <h5 id="ch03ex01" class="notetitle">Listing 3.1. <a id="ch03ex01__title" class="calibre4"></a>A simple callback example
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/037fig01_alt.jpg" alt="" class="calibre2" width="590" height="283" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/037fig01_alt.jpg"></p>
      
      
      <p class="noind">In this listing, we use a custom <kbd class="calibre15">report</kbd> function to output several messages as our code is being executed, so that we can track the execution of our program. We
         also use the <kbd class="calibre15">assert</kbd> testing function that we mentioned in <a href="kindle_split_011.html#ch01" class="calibre4">chapter 1</a>. The <kbd class="calibre15">assert</kbd> function usually takes two arguments. The first argument is an expression whose premise is asserted. In this case, we want
         to establish whether the result of invoking our <kbd class="calibre15">useless</kbd> function with the argument <kbd class="calibre15">getText</kbd> returns a value that’s equal to the value of the variable <kbd class="calibre15">text</kbd> (<kbd class="calibre15">useless(getText) === text</kbd>). If the first argument evaluates to <kbd class="calibre15">true,</kbd> the assertion passes; otherwise, it’s considered a failure. The second argument is the associated message, which is usually
         logged with an appropriate pass/fail indicator. (<a href="kindle_split_030.html#app03" class="calibre4">Appendix C</a> <a id="iddle1153" class="calibre4"></a><a id="iddle1492" class="calibre4"></a>discusses testing in general, as well as our own little implementation of the <kbd class="calibre15">assert</kbd> and <kbd class="calibre15">report</kbd> functions).
      </p>
      
      <p class="noind">When we run this code, we end up with the result shown in <a href="#ch03fig01" class="calibre4">figure 3.1</a>. As you can see, calling the <kbd class="calibre15">useless</kbd> function with our <kbd class="calibre15">getText</kbd> callback function as an argument returns the expected value.
      </p>
      
      
      
      <h5 id="ch03fig01" class="notetitle">Figure 3.1. <a id="ch03fig01__title" class="calibre4"></a>The result of running the code from <a href="#ch03ex01" class="calibre4">listing 3.1</a></h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig01.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig01.jpg"></p>
      
      
      
      <p class="noind">We can also take a look at how exactly this simple callback example is executed. As <a href="#ch03fig02" class="calibre4">figure 3.2</a> shows, we pass in the <kbd class="calibre15">getText</kbd> function to the <kbd class="calibre15">useless</kbd> function as an argument. This means that within the body of the <kbd class="calibre15">useless</kbd> function, the <kbd class="calibre15">getText</kbd> function can be referenced through the <kbd class="calibre15">callback</kbd> parameter. Then, by making the <kbd class="calibre15">callback()</kbd> call, we cause the execution of the <kbd class="calibre15">getText</kbd> function; the <kbd class="calibre15">getText</kbd> function, which we passed in as an argument, is called back by the <kbd class="calibre15">useless</kbd> function.
      </p>
      
      
      
      <h5 id="ch03fig02" class="notetitle">Figure 3.2. <a id="ch03fig02__title" class="calibre4"></a>The flow of execution when making the <kbd class="calibre15">useless(getText)</kbd> call. The <kbd class="calibre15">useless</kbd> function is called with <kbd class="calibre15">getText</kbd> as an argument. In the body of the <kbd class="calibre15">useless</kbd> function is a call to the passed-in function, which in this case triggers the execution of the <kbd class="calibre15">getText</kbd> function (we’ve “called back” to the <kbd class="calibre15">getText</kbd> function).
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig02_alt.jpg" alt="" class="calibre2" width="590" height="212" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig02_alt.jpg"></p>
      
      
      <p class="noind">This is easy, because JavaScript’s functional nature lets us deal with functions as first-class objects. We can even take
         the whole thing a step further, by rewriting our code in the following manner:
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/038fig01_alt.jpg" alt="" class="calibre2" width="590" height="119" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/038fig01_alt.jpg"></p>
      
      <p class="noind"><a id="iddle1053" class="calibre4"></a><a id="iddle1087" class="calibre4"></a><a id="iddle1152" class="calibre4"></a><a id="iddle1237" class="calibre4"></a><a id="iddle1563" class="calibre4"></a><a id="iddle1784" class="calibre4"></a><a id="iddle2047" class="calibre4"></a><a id="iddle2050" class="calibre4"></a>One of the most important features of JavaScript is the ability to create functions in the code anywhere an expression can
         appear. In addition to making the code more compact and easy to understand (by putting function definitions near where they’re
         used), this feature can also eliminate the need to pollute the global namespace with unnecessary names when a function isn’t
         going to be referenced from multiple places within the code.
      </p>
      
      <p class="noind">In the preceding example of a callback, we called our own callback. But callbacks can also be called by the browser. Think
         back to <a href="kindle_split_012.html#ch02" class="calibre4">chapter 2</a>, which has an example with the following snippet:
      </p>
      
      <pre id="PLd0e4403" class="calibre5">document.body.addEventListener("mousemove", <b class="calibre21">function() {</b>
  var second = document.getElementById("second");
  addMessage(second, "Event: mousemove");
});</pre>
      
      <p class="noind">That’s also a callback function, one that’s defined as an event handler to the <kbd class="calibre15">mousemove</kbd> event, and that will be called by the browser when that event occurs.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch03note01" class="notetitle">Note</h5>
      
      
      <p class="noindclose">This section introduces callbacks as functions that other code will later “call back” at an appropriate point of execution.
         You’ve seen an example in which our own code immediately calls the provided callback (the <kbd class="calibre15">useless</kbd> function example), as well as an example in which the browser makes the call (the <kbd class="calibre15">mousemove</kbd> example) whenever a particular event happens. It’s important to note that, unlike us, some people believe that a callback
         has to be called asynchronously, and therefore that the first example isn’t really a callback. We mention this just in case
         you stumble upon some heated discussion.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Now let’s consider a use of callbacks that will greatly simplify how we sort collections.</p>
      
      
      <h5 id="ch03lev3sec1" class="notetitle"><a id="ch03lev3sec1__title" class="calibre4"></a>Sorting with a comparator
      </h5>
      
      <p class="noind">Almost as soon as we <i class="calibre6">have</i> a collection of data, odds are we’re going to need to sort it. Let’s say that we have an array of numbers in a random order:
         0, 3, 2, 5, 7, 4, 8, 1. That order might be just fine, but chances are that, sooner or later, we’ll want to rearrange it.
      </p>
      
      <p class="noind">Usually, implementing sorting algorithms isn’t the most trivial of programming tasks; we have to select the best algorithm
         for the job at hand, implement it, adapt it to our current need (so that the items are sorted in a particular order), and
         be careful not to introduce bugs. Out of these tasks, the only one that’s application specific is the sorting order. Luckily,
         all JavaScript arrays have access to the <kbd class="calibre15">sort</kbd> method that requires us only to define a comparison algorithm that tells the sort algorithm how the values should be ordered.
      </p>
      
      <p class="noind">This is where callbacks jump in! Instead of letting the sort algorithm decide what values go before other values, <i class="calibre6">we’ll</i> provide a function that performs the comparison. We’ll give the sort algorithm access to this function as a callback, and
         the algorithm will call the callback whenever it needs to make a comparison. The callback is expected to return a positive
         number if the order of the passed values should be <a id="iddle1544" class="calibre4"></a><a id="iddle1546" class="calibre4"></a><a id="iddle1755" class="calibre4"></a><a id="iddle1825" class="calibre4"></a><a id="iddle1827" class="calibre4"></a><a id="iddle2058" class="calibre4"></a>reversed, a negative number if not, and zero if the values are equal; subtracting the compared values produces the desired
         return value to sort the array:
      </p>
      
      <pre id="PLd0e4508" class="calibre5">var values = [0, 3, 2, 5, 7, 4, 8, 1];

values.sort(<b class="calibre21">function(value1, value2){</b>
  return value1 - value2;
<b class="calibre21">}</b>);</pre>
      
      <p class="noind">There’s no need to think about the low-level details of a sorting algorithm (or even which sorting algorithm to choose). We
         provide a callback that the JavaScript engine will call every time it needs to compare two items.
      </p>
      
      <p class="noind">The <i class="calibre6">functional</i> approach allows us to create a function as a standalone entity, just as we can any other object type, and to pass it as an
         argument to a method, just like any other object type, which can accept it as a parameter, just like any other object type.
         It’s that first-class status coming into play.
      </p>
      
      
      
      
      
      <h3 id="ch03lev1sec2" class="calibre24"><a id="ch03lev1sec2__title" class="calibre3"></a>3.2. Fun with functions as objects
      </h3>
      
      <p class="noind">In this section, we’ll examine ways to exploit the similarities that functions share with other object types. One capability
         that might be surprising is that there’s nothing stopping us from attaching properties to functions:
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/040fig01_alt.jpg" alt="" class="calibre2" width="590" height="97" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/040fig01_alt.jpg"></p>
      
      <p class="noind">Let’s look at a couple of the more interesting things that can be done with this capability:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><i class="calibre6">Storing functions in a collection</i> allows us to easily manage related functions—for example, callbacks that have to be invoked when something of interest occurs.
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Memoization</i> allows the function to remember previously computed values, thereby improving the performance of subsequent invocations.
            
         </li>
         
      </ul>
      
      <p class="noind">Let’s get cracking.</p>
      
      
      <h4 id="ch03lev2sec3" class="calibre26">3.2.1. <a id="ch03lev2sec3__title" class="calibre4"></a>Storing functions
      </h4>
      
      <p class="noind">In certain cases (for example, when we need to manage collections of callbacks that should be invoked when a certain event
         occurs), we want to store collections of unique functions. When adding functions to such a collection, a challenge we can
         face is determining which functions are new to the collection and should be added, and which are already resident and shouldn’t
         be added. In general, when managing callback collections, we don’t want any duplicates, because a single event would result
         in multiple calls to the same callback.
      </p>
      
      <p class="noind"><a id="iddle1651" class="calibre4"></a><a id="iddle2057" class="calibre4"></a>An obvious, but naïve, technique is to store all the functions in an array and loop through the array, checking for duplicate
         functions. Unfortunately, this performs poorly, and as a ninja, we want to make things work <i class="calibre6">well</i>, not merely work. We can use function properties to achieve this with an appropriate level of sophistication, as shown in
         the next listing.
      </p>
      
      
      
      <h5 id="ch03ex02" class="notetitle">Listing 3.2. <a id="ch03ex02__title" class="calibre4"></a>Storing a collection of unique functions
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/041fig01_alt.jpg" alt="" class="calibre2" width="590" height="397" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/041fig01_alt.jpg"></p>
      
      
      <p class="noind">In this listing, we create an object assigned to the variable <kbd class="calibre15">store</kbd>, in which we’ll store a unique set of functions. This object has two data properties: one that stores a next available <kbd class="calibre15">id</kbd> value, and one within which we’ll <kbd class="calibre15">cache</kbd> the stored functions. Functions are added to this cache via the <kbd class="calibre15">add()</kbd> method:
      </p>
      
      <pre id="PLd0e4620" class="calibre5">add: function(fn) {
  if (!fn.id) {
    fn.id = this.nextId++;
    this.cache[fn.id] = fn;
    return true;
  }
 ...</pre>
      
      <p class="noind">Within <kbd class="calibre15">add</kbd>, we first check to see whether the function has already been added to the collection by looking for the existence of the
         <kbd class="calibre15">id</kbd> property. If the current function has an <kbd class="calibre15">id</kbd> property, we assume that the function has already been processed and we ignore it. Otherwise, we assign an <kbd class="calibre15">id</kbd> property to the function (incrementing the <kbd class="calibre15">nextId</kbd> property along the way) and add the function as a property of the <kbd class="calibre15">cache</kbd>, using the <kbd class="calibre15">id</kbd> value as the property name. We then return the value <kbd class="calibre15">true</kbd>, so that we can tell when the function was added after a call to <kbd class="calibre15">add()</kbd>.
      </p>
      
      <p class="noind"><a id="iddle1545" class="calibre4"></a><a id="iddle1581" class="calibre4"></a><a id="iddle1584" class="calibre4"></a><a id="iddle1826" class="calibre4"></a><a id="iddle2009" class="calibre4"></a>Running the page in the browser shows that when our tests try to add the <kbd class="calibre15">ninja()</kbd> function twice, the function is added only once, as shown in <a href="#ch03fig03" class="calibre4">figure 3.3</a>. <a href="kindle_split_021.html#ch09" class="calibre4">Chapter 9</a> shows an even better technique for working with collections of unique items that utilize sets, a new type of object available
         in ES6.
      </p>
      
      
      
      <h5 id="ch03fig03" class="notetitle">Figure 3.3. <a id="ch03fig03__title" class="calibre4"></a>By tacking a property onto a function, we can keep track of it. In that way, we can be sure that our function has been added
         only once.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig03.jpg" alt="" class="calibre2" width="375" height="235" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig03.jpg"></p>
      
      
      
      <p class="noind">Another useful trick to pull out of our sleeves when using function properties is giving a function the ability to modify
         itself. This technique can be used to remember previously computed values, saving time during future computations.
      </p>
      
      
      
      <h4 id="ch03lev2sec4" class="calibre26">3.2.2. <a id="ch03lev2sec4__title" class="calibre4"></a>Self-memoizing functions
      </h4>
      
      <p class="noind">As noted earlier, <i class="calibre6">memoization</i> (no, that’s not a typo) is the process of building a function that’s capable of remembering its previously computed values.
         In a nutshell, whenever a function computes its result, we store that result alongside the function arguments. In this way,
         when another invocation occurs for the same set of arguments, we can return the previously stored result, instead of calculating
         it anew. This can markedly increase performance by avoiding needless complex computations that have already been performed.
         Memoization is particularly useful when performing calculations for animations, searching data that doesn’t change that often,
         or any time-consuming math.
      </p>
      
      <p class="noind">As an example, let’s look at a simplistic (and certainly not particularly efficient) algorithm for computing prime numbers.
         Although this is a simple example of a complex calculation, this technique is readily applicable to other expensive computations
         (such as deriving the MD5 hash for a string) that are too complex to present here.
      </p>
      
      <p class="noind">From the outside, the function appears to be just like any normal function, but we’ll surreptitiously build in an answer cache
         in which the function will save the answers to the computations it performs. Look over the following code.
      </p>
      
      
      
      <h5 id="ch03ex03" class="notetitle">Listing 3.3. <a id="ch03ex03__title" class="calibre4"></a>Memoizing previously computed values
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/042fig01_alt.jpg" alt="" class="calibre2" width="590" height="337" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/042fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1876" class="calibre4"></a>Within the <kbd class="calibre15">isPrime</kbd> function, we start by checking whether the <kbd class="calibre15">answers</kbd> property that we’ll use as a cache has been created, and if not, we create it:
      </p>
      
      <pre id="PLd0e4776" class="calibre5">if (!isPrime.answers) {
    isPrime.answers = {};
}</pre>
      
      <p class="noind">The creation of this initially empty object will occur only on the first call to the function; after that, the cache will
         exist.
      </p>
      
      <p class="noind">Then we check whether the result for the passed value has already been cached in <kbd class="calibre15">answers</kbd>:
      </p>
      
      <pre id="PLd0e4791" class="calibre5">if (isPrime.answers[value] !== undefined) {
  return isPrime.answers[value];
}</pre>
      
      <p class="noind">Within this cache, we’ll store the computed answer (<kbd class="calibre15">true</kbd> or <kbd class="calibre15">false</kbd>) using the argument <kbd class="calibre15">value</kbd> as the property key. If we find a cached answer, we return it.
      </p>
      
      <p class="noind">If no cached value is found, we go ahead and perform the calculations needed to determine whether the value is <kbd class="calibre15">prime</kbd> (which can be an expensive operation for larger values) and store the result in the cache as we return it:
      </p>
      
      <pre id="PLd0e4815" class="calibre5">return isPrime.answers[value] = prime;</pre>
      
      <p class="noind">Our cache is a property of the function itself, so it’s kept alive for as long as the function itself is alive.</p>
      
      <p class="noind">Finally, we test that the memoization is working!</p>
      
      <pre id="PLd0e4827" class="calibre5">assert(isPrime(5), "5 is prime!" );
assert(isPrime.answers[5], "The answer was cached!" );</pre>
      
      <p class="noind">This approach has two major advantages:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The end user enjoys performance benefits for function calls asking for a previously computed value.
            
         </li>
         
         <li class="calibre20">It happens seamlessly and behind the scenes; neither the end user nor the page author needs to perform any special requests
            or do any extra initialization in order to make it all work.
            
         </li>
         
      </ul>
      
      <p class="noind"><a id="iddle1091" class="calibre4"></a><a id="iddle1493" class="calibre4"></a><a id="iddle1519" class="calibre4"></a><a id="iddle1527" class="calibre4"></a><a id="iddle1529" class="calibre4"></a><a id="iddle1535" class="calibre4"></a><a id="iddle1550" class="calibre4"></a><a id="iddle1551" class="calibre4"></a><a id="iddle1587" class="calibre4"></a><a id="iddle1714" class="calibre4"></a>But it’s not all roses and violins; its disadvantages may need to be weighed against its advantages:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Any sort of caching will certainly sacrifice memory in favor of performance.
            
         </li>
         
         <li class="calibre20">Purists may consider that caching is a concern that shouldn’t be mixed with the business logic; a function or a method should
            do one thing and do it well. But don’t worry; in <a href="kindle_split_020.html#ch08" class="calibre4">chapter 8</a>, you’ll see how to tackle this complaint.
            
         </li>
         
         <li class="calibre20">It’s difficult to load-test or measure the performance of an algorithm such as this one, because our results depend on the
            previous inputs to the function.
            
         </li>
         
      </ul>
      
      <p class="noind">Now that you’ve seen some of the practical use cases of first-class functions, let’s explore the various ways of defining
         functions.
      </p>
      
      
      
      
      <h3 id="ch03lev1sec3" class="calibre24"><a id="ch03lev1sec3__title" class="calibre3"></a>3.3. Defining functions
      </h3>
      
      <p class="noind">JavaScript functions are usually defined by using a <i class="calibre6">function literal</i> that creates a function value in the same way that, for example, a numeric literal creates a numeric value. Remember that
         as first-class objects, functions are values that can be used in the language just like other values, such as strings and
         numbers. And whether you realize it or not, you’ve been doing that all along.
      </p>
      
      <p class="noind">JavaScript provides a couple of ways to define functions, which can be divided into four groups:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><i class="calibre6">Function declarations</i> and <i class="calibre6">function expressions</i>—The two most common, yet subtly different ways of defining functions. Often people don’t even consider them as separate,
            but as you’ll see, being aware of their differences can help us understand when our functions are available for invocation:
            
            
            <div class="calibre13"></div><pre class="calibre5">function myFun(){ return 1;}</pre>
            
            </li>
         
         <li class="calibre20"><i class="calibre6">Arrow functions</i> (often called <i class="calibre6">lambda functions</i>)—A recent, ES6 addition to the JavaScript standard that enables us to define functions with far less syntactic clutter. They
            even solve one common problem with callback functions, but more on that later:
            
            
            <div class="calibre13"></div><pre class="calibre5">myArg =&gt; myArg*2</pre>
            
            </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Function constructors—</i> </b>A not-so-often used way of defining functions that enables us to dynamically construct a new function from a string that can
            also be dynamically generated. This example dynamically creates a function with two parameters, <kbd class="calibre15">a</kbd> and <kbd class="calibre15">b</kbd>, that returns the sum of those two parameters:
            
            
            <div class="calibre13"></div><pre class="calibre5">new Function('a', 'b', 'return a + b')</pre>
            
            </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Generator functions—</i> </b>This ES6 addition to JavaScript enable us to create functions that, unlike normal functions, can be exited and reentered later
            in the application execution, while keeping the values of their variables across these re-entrances. We can define generator
            versions of <i class="calibre6">function declarations</i>, <i class="calibre6">function expressions</i>, and <i class="calibre6">function constructors</i>:
            
            
            <div class="calibre13"></div><pre class="calibre5">function* myGen(){ yield 1; }</pre>
            
            </li>
         
      </ul>
      
      <p class="noind"><a id="iddle1313" class="calibre4"></a><a id="iddle1531" class="calibre4"></a><a id="iddle1553" class="calibre4"></a>It’s important that you understand these differences, because the way in which a function is defined significantly influences
         when the function is available to be invoked and how it behaves, as well as on which object the function can be invoked.
      </p>
      
      <p class="noind">In this chapter, we’ll explore function declarations, function expressions, and arrow functions. You’ll learn their syntax
         and how they work, and we’ll come back to them multiple times throughout the book to explore their specifics. Generator functions,
         on the other hand, are rather peculiar and are significantly different from the standard functions. We’ll revisit them in
         detail in <a href="kindle_split_017.html#ch06" class="calibre4">chapter 6</a>.
      </p>
      
      <p class="noind">That leaves us with function constructors, a JavaScript feature that we’ll skip entirely. Although it has some interesting
         applications, especially when dynamically creating and evaluating code, we consider it a corner feature of the JavaScript
         language. If you want to know more about function constructors, visit <a href="http://mng.bz/ZN8e" class="calibre4">http://mng.bz/ZN8e</a>.
      </p>
      
      <p class="noind">Let’s start with the simplest, most traditional ways of defining functions: <i class="calibre6">function declarations</i> and <i class="calibre6">function expressions</i>.
      </p>
      
      
      <h4 id="ch03lev2sec5" class="calibre26">3.3.1. <a id="ch03lev2sec5__title" class="calibre4"></a>Function declarations and function expressions
      </h4>
      
      <p class="noind">The two most common ways of defining functions in JavaScript are by using function declarations and function expressions.
         These two techniques are so similar that often we don’t even make a distinction between them, but as you’ll see in the following
         chapters, subtle differences exist.
      </p>
      
      
      <h5 id="ch03lev3sec2" class="notetitle"><a id="ch03lev3sec2__title" class="calibre4"></a>Function declarations
      </h5>
      
      <p class="noind">The most basic way of defining a function in JavaScript is by using function declarations (see <a href="#ch03fig04" class="calibre4">figure 3.4</a>). As you can see, every function declaration starts with a mandatory <kbd class="calibre15">function</kbd> keyword, followed by a mandatory function name and a list of optional comma-separated parameter names enclosed within mandatory
         parentheses. The function body, which is a potentially empty list of statements, must be enclosed within an opening and a
         closing brace. In addition to this form, which every function declaration must satisfy, there’s one more condition: A function
         declaration must be placed on its own, as a separate JavaScript statement (but can be <a id="iddle1464" class="calibre4"></a><a id="iddle1554" class="calibre4"></a>contained within another function or a block of code; you’ll see exactly what we mean by that in the next section).
      </p>
      
      
      
      <h5 id="ch03fig04" class="notetitle">Figure 3.4. <a id="ch03fig04__title" class="calibre4"></a>The function declaration stands on its own, as a separate block of JavaScript code! (It can be contained within other functions.)
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig04_alt.jpg" alt="" class="calibre2" width="590" height="202" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig04_alt.jpg"></p>
      
      
      <p class="noind">A couple of function declaration examples are shown in the following listing.</p>
      
      
      
      <h5 id="ch03ex04" class="notetitle">Listing 3.4. <a id="ch03ex04__title" class="calibre4"></a>Examples of function declarations
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/046fig01.jpg" alt="" class="calibre2" width="477" height="246" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/046fig01.jpg"></p>
      
      
      
      <p class="noind">If you take a closer look, you’ll see something that you might not be accustomed to, if you haven’t had much exposure to functional
         languages: a function defined within another function!
      </p>
      
      <pre id="PLd0e5148" class="calibre5">function ninja() {
  function hiddenNinja() {
    return "ninja here";
  }
  return hiddenNinja();
}</pre>
      
      <p class="noind">In JavaScript, this is perfectly normal, and we’ve used it here to again emphasize the importance of functions in JavaScript.</p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch03note02" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Having functions contained in other functions might raise some tricky questions regarding scope and identifier resolution,
         but save them for now, because we’ll revisit this case in detail in <a href="kindle_split_016.html#ch05" class="calibre4">chapter 5</a>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      
      <h5 id="ch03lev3sec3" class="notetitle"><a id="ch03lev3sec3__title" class="calibre4"></a>Function expressions
      </h5>
      
      <p class="noind">As we’ve already mentioned multiple times, functions in JavaScript are first-class objects, which, among other things, means
         that they can be created via literals, assigned to variables and properties, and used as arguments and return values to and
         from other functions. Because functions are such fundamental constructs, JavaScript enables us to treat them as any other
         expressions. So, just as we can use number literals, for example
      </p>
      
      <pre id="PLd0e5177" class="calibre5">var a = 3;
myFunction(4);</pre>
      
      <p class="noind"><a id="iddle1530" class="calibre4"></a>so too we can use function literals, in the same locations
      </p>
      
      <pre id="PLd0e5192" class="calibre5">var a = function() {};
myFunction(function(){});</pre>
      
      <p class="noind">Such functions that are always a part of another statement (for example, as the right side of an assignment expression, or
         as an argument to another function) are called <i class="calibre6">function expressions</i>. Function expressions are great because they allow us to define functions exactly where we need them, in the process making
         our code easier to understand.
      </p>
      
      <p class="noind">The following listing shows the differences between function declarations and function expressions.</p>
      
      
      
      <h5 id="ch03ex05" class="notetitle">Listing 3.5. <a id="ch03ex05__title" class="calibre4"></a>Function declarations and function expressions
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/047fig01_alt.jpg" alt="" class="calibre2" width="590" height="258" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/047fig01_alt.jpg"></p>
      
      
      <p class="noind">This example code begins with a standard function declaration that contains another inner function declaration:</p>
      
      <pre id="PLd0e5221" class="calibre5">function myFunctionDeclaration(){
  function innerFunction() {}
}</pre>
      
      <p class="noind">Here you can see how function declarations are separate statements of JavaScript code, but can be contained within the body
         of other functions.
      </p>
      
      <p class="noind">In contrast are function expressions, which are always a part of another statement. They’re placed on the expression level,
         as the right side of a variable declaration (or an assignment):
      </p>
      
      <pre id="PLd0e5233" class="calibre5">var myFunc = function(){};</pre>
      
      <p class="noind"><a id="iddle1555" class="calibre4"></a><a id="iddle1664" class="calibre4"></a>Or as an argument to another function call, or as a function return value:
      </p>
      
      <pre id="PLd0e5259" class="calibre5">myFunc(function() {
  return function(){};
});</pre>
      
      <p class="noind">Besides the position in code where they’re placed, there’s one more difference between function declarations and function
         expressions: For function declarations, the function name is <i class="calibre6">mandatory</i>, whereas for function expressions it’s completely <i class="calibre6">optional</i>.
      </p>
      
      <p class="noind">Function declarations must have a name defined because they stand on their own. Because one of the basic requirements for
         a function is that it has to be invokable, we have to have a way to reference it, and the only way to do this is through its
         name.
      </p>
      
      <p class="noind">Function expressions, on the other hand, are parts of other JavaScript expressions, so we have alternative ways to invoke
         them. For example, if a function expression is assigned to a variable, we can use that variable to invoke the function:
      </p>
      
      <pre id="PLd0e5280" class="calibre5">var doNothing = function(){};
doNothing();</pre>
      
      <p class="noind">Or, if it’s an argument to another function, we can invoke it within that function through the matching parameter name:</p>
      
      <pre id="PLd0e5289" class="calibre5">function doSomething(action) {
  action();
}</pre>
      
      
      
      <h5 id="ch03lev3sec4" class="notetitle"><a id="ch03lev3sec4__title" class="calibre4"></a>Immediate Functions
      </h5>
      
      <p class="noind">Function expressions can even be placed in positions where they look a bit weird at first, such as at a location where we’d
         normally expect a function identifier. Let’s stop and take a closer look at that construct (see <a href="#ch03fig05" class="calibre4">figure 3.5</a>).
      </p>
      
      
      
      <h5 id="ch03fig05" class="notetitle">Figure 3.5. <a id="ch03fig05__title" class="calibre4"></a>A comparison of a standard function call and an immediate call to a function expression
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig05_alt.jpg" alt="" class="calibre2" width="590" height="251" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig05_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1536" class="calibre4"></a><a id="iddle1663" class="calibre4"></a>When we want to make a function call, we use an expression that evaluates to a function, followed by a pair of function call
         parentheses, which might contain arguments. In the most basic function call, we put an identifier that evaluates to a function,
         as on the left side of <a href="#ch03fig05" class="calibre4">figure 3.5</a>. But the expression to the left of the calling parenthesis doesn’t have to be a simple identifier; it can be <i class="calibre6">any</i> expression that evaluates to a function. For example, a simple way to specify an expression that evaluates to a function
         is to use a function expression. So on the right side of <a href="#ch03fig05" class="calibre4">figure 3.5</a>, we first create a function, and then we immediately invoke that newly created function. This, by the way, is called an <i class="calibre6">immediately invoked function expression</i> (IIFE), or <i class="calibre6">immediate function</i> for short, and is an important concept in JavaScript development because it allows us to mimic modules in JavaScript. We’ll
         focus on this application of IIFEs in <a href="kindle_split_023.html#ch11" class="calibre4">chapter 11</a>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <b id="ch03sb02" class="calibre21">Parentheses around function expressions</b>
         
         <p class="noind">One more thing might be nagging you about the way we’ve immediately called our function expression: the parentheses around
            the function expression itself. Why do we even need those? The reason is purely syntactical. The JavaScript parser has to
            be able to easily differentiate between function declarations and function expressions. If we leave out the parentheses around
            the function expression, and put our immediate call as a separate statement <kbd class="calibre15">function(){}(3)</kbd>, the JavaScript parser will start processing it, and will conclude, because it’s a separate statement starting with the keyword
            <kbd class="calibre15">function</kbd>, that it’s dealing with a function declaration. Because every function declaration has to have a name (and here we didn’t
            specify one), an error will be thrown. To avoid this, we place the function expression within parentheses, signaling to the
            JavaScript parser that it’s dealing with an expression, and not a statement.
         </p>
         
         <p class="noind">There’s also an alternative, even simpler way (yet, strangely, a little less often used) of achieving the same goal: (<kbd class="calibre15">function(){}(3))</kbd>. By wrapping the immediate function definition and call within parentheses, you can also notify the JavaScript parser that
            it’s dealing with an expression.
         </p>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">The last four expressions in <a href="#ch03ex05" class="calibre4">listing 3.5</a> are variations of the same theme of immediately invoked function expressions often found in various JavaScript libraries:
      </p>
      
      <pre id="PLd0e5377" class="calibre5">+function(){}();
-function(){}();
!function(){}();
~function(){}();</pre>
      
      <p class="noind">This time, instead of using parentheses around the function expressions to differentiate them from function declarations,
         we can use unary operators: <kbd class="calibre15">+</kbd>, <kbd class="calibre15">-</kbd>, <kbd class="calibre15">!</kbd>, and <kbd class="calibre15">~</kbd>. We do this to signal to the JavaScript engine that it’s dealing with expressions and not statements. Notice how the results
         of applying these unary operators aren’t stored anywhere; from a computational perspective, they don’t really matter; only
         the calls to our IIFEs matter.
      </p>
      
      <p class="noind"><a id="iddle1018" class="calibre4"></a><a id="iddle1092" class="calibre4"></a><a id="iddle1477" class="calibre4"></a><a id="iddle1532" class="calibre4"></a><a id="iddle1552" class="calibre4"></a><a id="iddle1980" class="calibre4"></a><a id="iddle2048" class="calibre4"></a>Now that we’ve studied the ins and outs of the two most basic ways of defining functions in JavaScript (function declarations
         and function expressions), let’s explore a new addition to the JavaScript standard: <i class="calibre6">arrow functions</i>.
      </p>
      
      
      
      
      <h4 id="ch03lev2sec6" class="calibre26">3.3.2. <a id="ch03lev2sec6__title" class="calibre4"></a>Arrow functions
      </h4>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch03note03" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Arrow functions are an ES6 addition to the JavaScript standard (for browser compatibility, see <a href="http://mng.bz/8bnH" class="calibre4">http://mng.bz/8bnH</a>).
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Because in our JavaScript we use <i class="calibre6">a lot</i> of functions, it makes sense to add some syntactic sugar that enables us to create functions in a shorter, more succinct
         way, thus making our lives as developers more pleasant.
      </p>
      
      <p class="noind">In a lot of ways, arrow functions are a simplification of function expressions. Let’s revisit our sorting example from the
         first section of this chapter:
      </p>
      
      <pre id="PLd0e5473" class="calibre5">var values = [0, 3, 2, 5, 7, 4, 8, 1];
values.sort(function(value1,value2){
  return value1 – value2;
});</pre>
      
      <p class="noind">This example uses a callback function expression sent to the sort method of the array object; this callback will be invoked
         by the JavaScript engine to sort the values of the array in descending order.
      </p>
      
      <p class="noind">Now let’s see how to do the exact same thing with arrow functions:</p>
      
      <pre id="PLd0e5485" class="calibre5">var values = [0, 3, 2, 5, 7, 4, 8, 1];
values.sort(<b class="calibre21">(value1,value2) =&gt; value1 – value2</b>);</pre>
      
      <p class="noind">See how much more succinct this is?</p>
      
      <p class="noind">There’s no clutter caused by the <kbd class="calibre15">function</kbd> keyword, the braces, or the <kbd class="calibre15">return</kbd> statement. In a much simpler way than a function expression can, the arrow function states: here’s a function that takes
         two arguments and returns their difference. Notice the introduction of a new operator, <kbd class="calibre15">=&gt;</kbd>, the so-called <i class="calibre6">fat-arrow</i> operator (an equals sign immediately followed by a greater-than sign), that’s at the core of defining an arrow function.
      </p>
      
      <p class="noind">Now let’s deconstruct the syntax of an arrow function, starting with the simplest possible way:</p>
      
      <pre id="PLd0e5515" class="calibre5">param =&gt; expression</pre>
      
      <p class="noind">This arrow function takes a parameter and returns the value of an expression. We can use this syntax as shown in the following
         listing.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch03ex06" class="notetitle">Listing 3.6. <a id="ch03ex06__title" class="calibre4"></a>Comparing an arrow function and a function expression
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/051fig01_alt.jpg" alt="" class="calibre2" width="590" height="131" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/051fig01_alt.jpg"></p>
      
      
      <p class="noind">Take a while to appreciate how arrow functions make code more succinct, without sacrificing clarity. That’s the simplest version
         of the arrow function syntax, but in general, the arrow function can be defined in two ways, as shown in <a href="#ch03fig06" class="calibre4">figure 3.6</a>.
      </p>
      
      
      
      <h5 id="ch03fig06" class="notetitle">Figure 3.6. <a id="ch03fig06__title" class="calibre4"></a>The syntax of an arrow function
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig06_alt.jpg" alt="" class="calibre2" width="590" height="370" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig06_alt.jpg"></p>
      
      
      <p class="noind">As you can see, the arrow function definition starts with an optional comma-separated list of parameter names. If there are
         no parameters, or more than one parameter, this list must be enclosed within parentheses. But if we have only a single parameter,
         the parentheses are optional. This list of parameters is followed by a mandatory fat-arrow operator, which tells us and the
         JavaScript engine that we’re dealing with an arrow function.
      </p>
      
      <p class="noind">After the fat-arrow operator, we have two options. If it’s a simple function, we put an expression there (a mathematical operation,
         another function invocation, whatever), and the result of the function invocation will be the value of that expression. For
         instance, our first arrow function example has the following arrow function:
      </p>
      
      <pre id="PLd0e5560" class="calibre5">var greet = name =&gt; "Greetings " + name;</pre>
      
      <p class="noind"><a id="iddle1063" class="calibre4"></a><a id="iddle1066" class="calibre4"></a><a id="iddle1538" class="calibre4"></a><a id="iddle1981" class="calibre4"></a>The return value of the function is a concatenation of the string “<kbd class="calibre15">Greetings</kbd>” with the value of the <kbd class="calibre15">name</kbd> parameter.
      </p>
      
      <p class="noind">In other cases, when our arrow functions aren’t that simple and require more code, we can include a block of code after the
         arrow operator. For example:
      </p>
      
      <pre id="PLd0e5608" class="calibre5">var greet = name =&gt; {
  var helloString = 'Greetings ';
  return helloString + name;
};</pre>
      
      <p class="noind">In this case, the return value of the arrow function behaves as in a standard function. If there’s no return statement, the
         result of the function invocation will be <kbd class="calibre15">undefined</kbd>, and if there is, the result will be the value of the return expression.
      </p>
      
      <p class="noind">We’ll revisit arrow functions multiple times throughout this book. Among other things, we’ll present additional features of
         arrow functions that will help us evade subtle bugs that can occur with more standard functions.
      </p>
      
      <p class="noind">Arrow functions, like all other functions, can receive arguments in order to use them to perform their task. Let’s see what
         happens with the values that we pass to a function.
      </p>
      
      
      
      
      <h3 id="ch03lev1sec4" class="calibre24"><a id="ch03lev1sec4__title" class="calibre3"></a>3.4. Arguments and function parameters
      </h3>
      
      <p class="noind">When discussing functions, we often use the terms <i class="calibre6">argument</i> and <i class="calibre6">parameter</i> almost interchangeably, as if they were more or less the same thing. But now, let’s be more formal:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">A <i class="calibre6">parameter</i> is a variable that we list as part of a function definition.
            
         </li>
         
         <li class="calibre20">An <i class="calibre6">argument</i> is a value that we pass to the function when we invoke it.
            
         </li>
         
      </ul>
      
      <p class="noind"><a href="#ch03fig07" class="calibre4">Figure 3.7</a> illustrates the difference.
      </p>
      
      
      
      <h5 id="ch03fig07" class="notetitle">Figure 3.7. <a id="ch03fig07__title" class="calibre4"></a>The difference between function parameters and function arguments
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig07_alt.jpg" alt="" class="calibre2" width="590" height="423" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig07_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1577" class="calibre4"></a><a id="iddle1852" class="calibre4"></a>As you can see, a function parameter is specified with the definition of the function, and all types of functions can have
         parameters:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Function declarations (the <kbd class="calibre15">ninja</kbd> parameter to the <kbd class="calibre15">skulk</kbd> function)
            
         </li>
         
         <li class="calibre20">Function expressions (the <kbd class="calibre15">person</kbd> and <kbd class="calibre15">action</kbd> parameters to the <kbd class="calibre15">perform-Action</kbd> function)
            
         </li>
         
         <li class="calibre20">Arrow functions (the <kbd class="calibre15">daimyo</kbd> parameter)
            
         </li>
         
      </ul>
      
      <p class="noind">Arguments, on the other hand, are linked with the invocation of the function; they’re values passed to a function at the time
         of its invocation:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The string <kbd class="calibre15">Hattori</kbd> is passed as an argument to the <kbd class="calibre15">skulk</kbd> function.
            
         </li>
         
         <li class="calibre20">The string <kbd class="calibre15">Oda Nobunaga</kbd> is passed as an argument to the <kbd class="calibre15">rule</kbd> function.
            
         </li>
         
         <li class="calibre20">The parameter <kbd class="calibre15">ninja</kbd> of the <kbd class="calibre15">skulk</kbd> function is passed as an argument to the <kbd class="calibre15">performAction</kbd> function.
            
         </li>
         
      </ul>
      
      <p class="noind">When a list of arguments is supplied as a part of a function invocation, these arguments are assigned to the parameters in
         the function definition in the order specified. The first argument gets assigned to the first parameter, the second argument
         to the second parameter, and so on.
      </p>
      
      <p class="noind">If we have a different number of arguments than parameters, no error is raised. JavaScript is perfectly fine with this situation
         and deals with it in the following way. If more arguments are supplied than there are parameters, the “excess” arguments aren’t
         assigned to parameter names. For example, see <a href="#ch03fig08" class="calibre4">figure 3.8</a>.
      </p>
      
      
      
      <h5 id="ch03fig08" class="notetitle">Figure 3.8. <a id="ch03fig08__title" class="calibre4"></a>Arguments are assigned to function parameters in the order specified. Excess arguments aren’t assigned to any parameters.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig08_alt.jpg" alt="" class="calibre2" width="590" height="370" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/03fig08_alt.jpg"></p>
      
      
      <p class="noind"><a href="#ch03fig08" class="calibre4">Figure 3.8</a> shows that if we were to call the <kbd class="calibre15">practice</kbd> function with <kbd class="calibre15">practice("Yoshi", "sword", "shadow sword", "katana")</kbd>, the arguments <kbd class="calibre15">Yoshi</kbd>, <kbd class="calibre15">sword</kbd>, and <kbd class="calibre15">shadow sword</kbd> would be assigned to the parameters <kbd class="calibre15">ninja</kbd>, <kbd class="calibre15">weapon</kbd>, and <kbd class="calibre15">technique</kbd>, <a id="iddle1065" class="calibre4"></a><a id="iddle1067" class="calibre4"></a><a id="iddle1381" class="calibre4"></a><a id="iddle1540" class="calibre4"></a><a id="iddle1541" class="calibre4"></a><a id="iddle1979" class="calibre4"></a><a id="iddle2046" class="calibre4"></a>respectively. The argument <kbd class="calibre15">katana</kbd> is an excess argument, and wouldn’t be assigned to any parameter. In the next chapter, you’ll see that even though some arguments
         aren’t assigned to parameter names, we still have a way to access them.
      </p>
      
      <p class="noind">On the other hand, if we have more parameters than arguments, the parameters that have no corresponding argument are set to
         <kbd class="calibre15">undefined</kbd>. For example, if we were to make the call <kbd class="calibre15">practice("Yoshi")</kbd>, the parameter <kbd class="calibre15">ninja</kbd> would be assigned the value <kbd class="calibre15">Yoshi</kbd>, while the parameters <kbd class="calibre15">weapon</kbd> and <kbd class="calibre15">technique</kbd> would be set to <kbd class="calibre15">undefined</kbd>.
      </p>
      
      <p class="noind">Dealing with function arguments and parameters is as old as JavaScript itself, but now let’s explore two new features of JavaScript
         bestowed by ES6: rest and default parameters.
      </p>
      
      
      <h4 id="ch03lev2sec7" class="calibre26">3.4.1. <a id="ch03lev2sec7__title" class="calibre4"></a>Rest parameters
      </h4>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch03note04" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Rest parameters are added by the ES6 standard (for browser compatibility, see <a href="http://mng.bz/3go1" class="calibre4">http://mng.bz/3go1</a>).
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">For our next example, we’ll build a function that multiplies the first argument with the largest of the remaining arguments.
         This probably isn’t something that’s particularly applicable in our applications, but it’s an example of yet more techniques
         for dealing with arguments within a function.
      </p>
      
      <p class="noind">This might seem simple enough: We’ll grab the first argument and multiply it by the biggest of the remaining argument values.
         In the old versions of JavaScript, this would require some workarounds (which we’ll look at in the next chapter). Luckily,
         in ES6, we don’t need to jump through any hoops. We can use <i class="calibre6">rest parameters,</i> as shown in the following listing.
      </p>
      
      
      
      <h5 id="ch03ex07" class="notetitle">Listing 3.7. <a id="ch03ex07__title" class="calibre4"></a>Using rest parameters
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/054fig01_alt.jpg" alt="" class="calibre2" width="590" height="135" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/054fig01_alt.jpg"></p>
      
      
      <p class="noind">By prefixing the last-named argument of a function with an ellipsis (...), we turn it into an array called <i class="calibre6">the rest parameters</i>, which contains the remaining passed-in arguments.
      </p>
      
      <pre id="PLd0e5952" class="calibre5">function multiMax(first, <b class="calibre21">...</b>remainingNumbers){
  ...
}</pre>
      
      <p class="noind"><a id="iddle1064" class="calibre4"></a><a id="iddle1316" class="calibre4"></a><a id="iddle1539" class="calibre4"></a>For example, in this case, the <kbd class="calibre15">multiMax</kbd> function is called with four arguments: <kbd class="calibre15">multiMax(3, 1, 2, 3)</kbd>. In the body of the <kbd class="calibre15">multiMax</kbd> function, the value of the first argument, <kbd class="calibre15">3</kbd>, is assigned to the first <kbd class="calibre15">multiMax</kbd> function parameter, <kbd class="calibre15">first</kbd>. Because the second parameter of the function is the rest parameter, all remaining arguments (<kbd class="calibre15">1, 2, 3</kbd>) are placed in a new array: <kbd class="calibre15">remainingNumbers</kbd>. We then obtain the biggest number by sorting the array in descending order (notice how it’s simple to change the sorting
         order) and picking the largest number, which is in the first place of our sorted array. (This is far from the most efficient
         way of determining the largest number, but why not take advantage of the skills we gained earlier in the chapter?)
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch03note05" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Only the last function parameter can be a rest parameter. Trying to put the ellipsis in front of any parameter that isn’t
         last will bring us only sorrow, in the form of <kbd class="calibre15">SyntaxError: parameter after rest parameter</kbd>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">In the next section, we’ll continue adding to our JavaScript tool belt with additional ES6 functionality: default parameters.</p>
      
      
      
      <h4 id="ch03lev2sec8" class="calibre26">3.4.2. <a id="ch03lev2sec8__title" class="calibre4"></a>Default parameters
      </h4>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch03note06" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Default parameters are added by the ES6 standard (for browser compatibility, see <a href="http://mng.bz/wI8w" class="calibre4">http://mng.bz/wI8w</a>).
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Many web UI components (especially jQuery plugins) can be configured. For example, if we’re developing a slider component,
         we might want to give our users an option to specify a timer interval after which one item is replaced with another, as well
         as an animation that will be used as the change occurs. At the same time, maybe some users don’t care and are happy to use
         whatever settings we offer. Default parameters are ideal for such situations!
      </p>
      
      <p class="noind">Our little example with slider component settings is just a specific case of a situation in which <i class="calibre6">almost</i> all function calls use the same value for a particular parameter (notice the emphasis on <i class="calibre6">almost)</i>. Consider a simpler case in which most of our ninjas are used to skulking around, but not Yagyu, who cares only about simple
         sneaking:
      </p>
      
      <pre id="PLd0e6059" class="calibre5">function  performAction(ninja, action) {
  return ninja + " " + action;
}
performAction("Fuma", "skulking");
performAction("Yoshi", "skulking");
performAction("Hattori", "skulking");
performAction("Yagyu", "sneaking");</pre>
      
      <p class="noind">Doesn’t it seem tedious to always have to repeat the same argument, <kbd class="calibre15">skulking</kbd>, simply because Yagyu is obstinate and refuses to act like a proper ninja?
      </p>
      
      <p class="noind"><a id="iddle2143" class="calibre4"></a><a id="iddle2149" class="calibre4"></a>In other programming languages, this problem is most often solved with function overloading (specifying additional functions
         with the same name but a different set of parameters). Unfortunately, JavaScript doesn’t support function overloading, so
         when faced with this situation in the past, developers often resorted to something like the following listing.
      </p>
      
      
      
      <h5 id="ch03ex08" class="notetitle">Listing 3.8. <a id="ch03ex08__title" class="calibre4"></a>Tackling default parameters before ES6
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/056fig01_alt.jpg" alt="" class="calibre2" width="590" height="338" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/056fig01_alt.jpg"></p>
      
      
      <p class="noind">Here we define a <kbd class="calibre15">performAction</kbd> function, which checks whether the value of the <kbd class="calibre15">action</kbd> parameter is <kbd class="calibre15">undefined</kbd> (by using the <kbd class="calibre15">typeof</kbd> operator), and if it is, the function sets the value of the <kbd class="calibre15">action</kbd> variable to <kbd class="calibre15">skulking</kbd>. If the <kbd class="calibre15">action</kbd> parameter is sent through a function call (it’s not <kbd class="calibre15">undefined</kbd>), we keep the value.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch03note07" class="notetitle">Note</h5>
      
      
      <p class="noindclose">The <kbd class="calibre15">typeof</kbd> operator returns a string indicating the type of the operand. If the operand isn’t defined (for example, if we haven’t supplied
         a matching argument for a function parameter), the return value is the string <kbd class="calibre15">undefined</kbd>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">This is a commonly occurring pattern that’s tedious to write, so the ES6 standard has added support for <i class="calibre6">default parameters</i>, as shown in the following listing.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch03ex09" class="notetitle">Listing 3.9. <a id="ch03ex09__title" class="calibre4"></a>Tackling default parameters in ES6
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/057fig01_alt.jpg" alt="" class="calibre2" width="590" height="251" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/057fig01_alt.jpg"></p>
      
      
      <p class="noind">Here you can see the syntax of default function parameters in JavaScript. To create a default parameter, we assign a value
         to a function parameter:
      </p>
      
      <pre id="PLd0e6159" class="calibre5">function performAction(ninja, <b class="calibre21">action = "skulking"</b>){
   return ninja + " " + action;
}</pre>
      
      <p class="noind">Then, when we make a function call and the matching argument value is left out, as with <kbd class="calibre15">Fuma</kbd>, <kbd class="calibre15">Yoshi</kbd>, and <kbd class="calibre15">Hattori</kbd>, the default value (in this case, <kbd class="calibre15">skulking</kbd>), is used:
      </p>
      
      <pre id="PLd0e6183" class="calibre5">assert(performAction("Fuma") === "Fuma skulking",
      "The default value is used for Fuma");

assert(performAction("Yoshi") === "Yoshi skulking",
      "The default value is used for Yoshi");

assert(performAction("Hattori") === "Hattori skulking",
      "The default value is used for Hattori");</pre>
      
      <p class="noind">If, on the other hand, we specify the value, the default value is overridden:</p>
      
      <pre id="PLd0e6192" class="calibre5">assert(performAction("Yagyu", "sneaking") === "Yagyu sneaking",
       "Yagyu can do whatever he pleases, even sneak!");</pre>
      
      <p class="noind">We can assign any values to default parameters: simple, primitive values such as numbers or strings, but also complex types
         such as objects, arrays, and even functions. The values are evaluated on each function call, from left to right, and when
         assigning values to later default parameters, we can reference previous parameters, as in the following listing.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch03ex10" class="notetitle">Listing 3.10. <a id="ch03ex10__title" class="calibre4"></a>Referencing previous default parameters
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/058fig01_alt.jpg" alt="" class="calibre2" width="590" height="126" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/058fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1494" class="calibre4"></a>Even though JavaScript allows you to do something like this, we urge caution. In our opinion, this doesn’t enhance code readability
         and should be avoided, whenever possible. But moderate use of default parameters—as a means of avoiding null values, or as
         relatively simple flags that configure the behaviors of our functions—can lead to much simpler and more elegant code.
      </p>
      
      
      
      
      <h3 id="ch03lev1sec5" class="calibre24"><a id="ch03lev1sec5__title" class="calibre3"></a>3.5. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Writing sophisticated code hinges upon learning JavaScript as a functional language.
            
         </li>
         
         <li class="calibre20">Functions are first-class objects that are treated just like any other objects within JavaScript. Similar to any other object
            type, they can be
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">Created via literals
                  
               </li>
               
               <li class="calibre20">Assigned to variables or properties
                  
               </li>
               
               <li class="calibre20">Passed as parameters
                  
               </li>
               
               <li class="calibre20">Returned as function results
                  
               </li>
               
               <li class="calibre20">Assigned properties and methods
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">Callback functions are functions that other code will later “call back,” and are often used, especially with event handling.
            
         </li>
         
         <li class="calibre20">We can take advantage of the fact that functions can have properties and that those properties can be used to store any information;
            for example
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">We can store functions in function properties for later reference and invocation.
                  
               </li>
               
               <li class="calibre20">We can use function properties to create a cache (memoization), thereby avoiding unnecessary computations.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">There are different types of functions: function declarations, function expressions, arrow functions, and function generators.
            
         </li>
         
         <li class="calibre20">Function declarations and function expressions are the two most common types of functions. Function declarations must have
            a name, and must be placed as separate statements in our code. Function expressions don’t have to be named, but do have to
            be a part of another code statement.
            
         </li>
         
         <li class="calibre20">Arrow functions are a new addition to JavaScript, enabling us to define functions in a much more succinct way than with standard
            functions.
            
         </li>
         
         <li class="calibre20">A parameter is a variable that we list as a part of a function definition, whereas an argument is a value that we pass to
            the function when we invoke it.
            
         </li>
         
         <li class="calibre20">A function’s parameter list and its argument list can be different lengths:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">Unassigned parameters evaluate as <kbd class="calibre15">undefined</kbd>.
                  
               </li>
               
               <li class="calibre20">Extra arguments aren’t bound to parameter names.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">Rest parameters and default parameters are new additions to JavaScript:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">Rest parameters enable us to reference the remaining arguments that don’t have matching parameter names.
                  
               </li>
               
               <li class="calibre20">Default parameters enable us to specify default parameter values that will be used if no value is supplied during function
                  invocation.
                  
               </li>
               
            </ul>
            
         </li>
         
      </ul>
      
      
      
      <h3 id="ch03lev1sec6" class="calibre24"><a id="ch03lev1sec6__title" class="calibre3"></a>3.6. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch03qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch03qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch03qa2q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">In the following code snippet, which functions are callback functions?</p>
            
            <pre id="PLd0e6370" class="calibre5">numbers.sort(function <b class="calibre21">sortAsc</b>(a,b){
  return a – b;
});

function <b class="calibre21">ninja</b>(){}
ninja();

var myButton = document.getElementById("myButton");
myButton.addEventListener("click", function <b class="calibre21">handleClick</b>(){
  alert("Clicked");
});</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch03qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch03qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind">In the following snippet, categorize functions according to their type (function declaration, function expression, or arrow
               function).
            </p>
            
            <pre id="PLd0e6392" class="calibre5">numbers.sort(function <b class="calibre21">sortAsc</b>(a,b){
  return a – b;
});

numbers.sort(<b class="calibre21">(a,b) =&gt; b – a</b>);

(<b class="calibre21">function(){}</b>)();

<b class="calibre21">function outer(){</b>
  <b class="calibre21">function inner(){}</b>
  return inner;
<b class="calibre21">}</b>

(<b class="calibre21">function(){}</b>());

(<b class="calibre21">()=&gt;"Yoshi"</b>)();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch03qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch03qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">After executing the following code snippet, what are the values of variables <kbd class="calibre15">samurai</kbd> and <kbd class="calibre15">ninja</kbd>?
            </p>
            
            <pre id="PLd0e6435" class="calibre5">var samurai = (() =&gt; "Tomoe")();
var ninja = (() =&gt; {"Yoshi"})();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch03qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch03qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">Within the body of the <kbd class="calibre15">test</kbd> function, what are the values of parameters <kbd class="calibre15">a</kbd>, <kbd class="calibre15">b</kbd>, and <kbd class="calibre15">c</kbd> for the two function calls?
            </p>
            
            <pre id="PLd0e6461" class="calibre5">function test(a, b, ...c){ /*a, b, c*/}

test(1, 2, 3, 4, 5);
test();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch03qa2qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch03qa2q5" class="calibre4"></a><b class="calibre21">5 </b></p><p class="noind">After executing the following code snippet, what are the values of the <kbd class="calibre15">message1</kbd> and <kbd class="calibre15">message2</kbd> variables?
            </p>
            
            <pre id="PLd0e6480" class="calibre5">function getNinjaWieldingWeapon(ninja, weapon = "katana"){
  return ninja + " " + katana;
}

var message1 = getNinjaWieldingWeapon("Yoshi");
var message2 = getNinjaWieldingWeapon("Yoshi", "wakizashi");</pre>
            <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_21"></div>
<h2 id="ch04" class="part">Chapter 4. <a id="ch04__title" class="calibre3"></a>Functions for the journeyman: understanding function invocation
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Two implicit function parameters: arguments and this
            
         </li>
         
         <li class="calibre20">Ways of invoking functions
            
         </li>
         
         <li class="calibre20">Dealing with problems of function contexts
            
         </li>
         
      </ul>
      
      <p class="noind">In the previous chapter, you saw that JavaScript is a programming language with significant functionally oriented characteristics.
         We explored the differences between function call arguments and function parameters, and how the values are transferred from
         call arguments to function parameters.
      </p>
      
      <p class="noind">This chapter continues in a similar vein, by first discussing something that we kept from you in the previous chapter: the
         implicit function parameters <kbd class="calibre15">this</kbd> and <kbd class="calibre15">arguments</kbd>. These are silently passed to functions and can be accessed just like any other explicitly named function parameter within
         the function’s body.
      </p>
      
      <p class="noind"><a id="iddle1068" class="calibre4"></a><a id="iddle1560" class="calibre4"></a><a id="iddle1561" class="calibre4"></a><a id="iddle1665" class="calibre4"></a><a id="iddle1666" class="calibre4"></a><a id="iddle1668" class="calibre4"></a>The <kbd class="calibre15">this</kbd> parameter represents the function context, the object on which our function is invoked, whereas the <kbd class="calibre15">arguments</kbd> parameter represents all arguments that are passed in through a function call. Both parameters are vital in JavaScript code.
         The <kbd class="calibre15">this</kbd> parameter is one of the fundamental ingredients of object-oriented JavaScript, and the <kbd class="calibre15">arguments</kbd> parameter allows us to be creative with the arguments that are accepted by our functions. For this reason, we’ll explore
         some of the common pitfalls related to these implicit arguments.
      </p>
      
      <p class="noind">We’ll then continue by exploring ways of invoking functions in JavaScript. The way in which we invoke a function has a great
         influence on how the implicit function parameters are determined.
      </p>
      
      <p class="noind">Finally, we’ll conclude the chapter by learning about common gotchas related to the function context, the <kbd class="calibre15">this</kbd> parameter. Without further ado, let’s start exploring!
      </p>
      
      <h3 class="calibre24"><a id="ch04qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch04qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch04qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">Why is the <kbd class="calibre15">this</kbd> parameter known as the function <i class="calibre6">context</i>?
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch04qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch04qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">What’s the difference between a function and a method?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch04qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch04qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">What would happen if a constructor function explicitly returned an object?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch04lev1sec1" class="calibre24"><a id="ch04lev1sec1__title" class="calibre3"></a>4.1. Using implicit function parameters
      </h3>
      
      <p class="noind">In the preceding chapter, we explored the differences between function <i class="calibre6">parameters</i> (variables listed as part of a function definition) and function <i class="calibre6">arguments</i> (values passed to the function when we invoke it). But we didn’t mention that in addition to the parameters that we’ve explicitly
         stated in the function definition, function invocations are usually passed two implicit parameters: <kbd class="calibre15">arguments</kbd> and <kbd class="calibre15">this</kbd>.
      </p>
      
      <p class="noind">By <i class="calibre6">implicit</i>, we mean that these parameters aren’t explicitly listed in the function signature, but are silently passed to the function
         and accessible within the function. They can be referenced within the function just like any other explicitly named parameter.
         Let’s take a look at each of these implicit parameters in turn.
      </p>
      
      
      <h4 id="ch04lev2sec1" class="calibre26">4.1.1. <a id="ch04lev2sec1__title" class="calibre4"></a>The arguments parameter
      </h4>
      
      <p class="noind">The <kbd class="calibre15">arguments</kbd> parameter is a collection of all arguments passed to a function. It’s useful because it allows us to access all function
         arguments, regardless of whether the matching parameter is explicitly defined. This allows us to implement function overloading,
         a feature that JavaScript doesn’t natively support, and variadic functions that accept a variable number of arguments. To
         be honest, with <kbd class="calibre15">rest</kbd> parameters, introduced in the preceding chapter, the need for the <kbd class="calibre15">arguments</kbd> parameter has been greatly reduced. Still, it’s important to understand how the <kbd class="calibre15">arguments</kbd> parameter works, because you’re bound to run into it when dealing with legacy code.
      </p>
      
      <p class="noind"><a id="iddle1072" class="calibre4"></a><a id="iddle1717" class="calibre4"></a>The <kbd class="calibre15">arguments</kbd> object has a property named <kbd class="calibre15">length</kbd> that indicates the exact number of arguments. The individual argument values can be obtained by using array indexing notation;
         for example, <kbd class="calibre15">arguments[2]</kbd> would fetch the third parameter. Take a look at the following listing.
      </p>
      
      
      
      <h5 id="ch04ex01" class="notetitle">Listing 4.1. <a id="ch04ex01__title" class="calibre4"></a>Using the arguments parameter
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/063fig01_alt.jpg" alt="" class="calibre2" width="590" height="390" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/063fig01_alt.jpg"></p>
      
      
      <p class="noind">Here we have a <kbd class="calibre15">whatever</kbd> function that gets called with five arguments, <kbd class="calibre15">whatever (1,2,3,4,5)</kbd>, even though it has only three declared parameters, <kbd class="calibre15">a, b, c</kbd>:
      </p>
      
      <pre id="PLd0e6723" class="calibre5">function whatever(a, b, c){
  ...
}</pre>
      
      <p class="noind">We can access the first three arguments through their respective function parameters, <kbd class="calibre15">a</kbd>, <kbd class="calibre15">b</kbd>, and <kbd class="calibre15">c</kbd>:
      </p>
      
      <pre id="PLd0e6741" class="calibre5">assert(a === 1, 'The value of a is 1');
assert(b === 2, 'The value of b is 2');
assert(c === 3, 'The value of c is 3');</pre>
      
      <p class="noind">We can also check how many arguments in total were passed to the function by using the <kbd class="calibre15">arguments.length</kbd> property.
      </p>
      
      <p class="noind">The <kbd class="calibre15">arguments</kbd> parameter can also be used to access each individual argument through array notation. It’s important to note that this also
         includes the excess arguments that aren’t associated with any function parameters:
      </p>
      
      
      <pre id="PLd0e6761" class="calibre5">assert(arguments[0] === a, 'The first argument is assigned to a');
assert(arguments[1] === b, 'The second argument is assigned to b');
assert(arguments[2] === c, 'The third argument is assigned to c');
assert(<b class="calibre21">arguments[3] === 4</b>, 'We can access the fourth argument');
assert(<b class="calibre21">arguments[4] === 5</b>, 'We can access the fifth argument');</pre>
      
      <p class="noind"><a id="iddle1716" class="calibre4"></a>Throughout this section, we go out of our way to avoid calling the <kbd class="calibre15">arguments</kbd> parameter an <i class="calibre6">array</i>. You may be fooled into thinking that it’s an array; after all, it has a <kbd class="calibre15">length</kbd> parameter and its entries can be fetched using array notation. But it’s <i class="calibre6">not</i> a JavaScript array, and if you try to use array methods on <kbd class="calibre15">arguments</kbd> (for example, the <kbd class="calibre15">sort</kbd> method used in the previous chapter), you’ll find nothing but heartbreak and disappointment. Just think of <kbd class="calibre15">arguments</kbd> as an <i class="calibre6">array-like</i> construct, and exhibit restraint in its use.
      </p>
      
      <p class="noind">As we’ve already mentioned, the main point of the <kbd class="calibre15">arguments</kbd> object is to allow us to access all arguments that were passed to the function, regardless of whether a particular argument
         is associated with a function parameter. Let’s see how to do this by implementing a function that can calculate the sum of
         an arbitrary number of arguments.
      </p>
      
      
      
      <h5 id="ch04ex02" class="notetitle">Listing 4.2. <a id="ch04ex02__title" class="calibre4"></a>Using the arguments object to perform operations on all function arguments
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/064fig01_alt.jpg" alt="" class="calibre2" width="590" height="181" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/064fig01_alt.jpg"></p>
      
      
      <p class="noind">Here we first define a <kbd class="calibre15">sum</kbd> function that doesn’t explicitly list any parameters. Regardless of this, we can still access all function arguments through
         the <kbd class="calibre15">arguments</kbd> object. We iterate through all the arguments and calculate their sum.
      </p>
      
      <p class="noind">Now comes the payoff. We can call the function with any number of arguments, so we test a couple of cases to see if everything
         works. This is the true power of the <kbd class="calibre15">arguments</kbd> object. It allows us to write more versatile and flexible functions that can easily deal with different situations.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch04note01" class="notetitle">Note</h5>
      
      
      <p class="noindclose">We mentioned earlier that in a lot of cases we can use the <kbd class="calibre15">rest</kbd> parameter instead of the <kbd class="calibre15">arguments</kbd> parameter. The <kbd class="calibre15">rest</kbd> parameter is a real array, which means that we can use all our favorite array methods on it. This gives it a certain advantage
         over the <kbd class="calibre15">arguments</kbd> object. As an exercise, rewrite <a href="#ch04ex02" class="calibre4">listing 4.2</a> to use the <kbd class="calibre15">rest</kbd> parameter instead of the <kbd class="calibre15">arguments</kbd> parameter.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind"><a id="iddle1049" class="calibre4"></a><a id="iddle1069" class="calibre4"></a>Now that we understand how the <kbd class="calibre15">arguments</kbd> object works, let’s explore some of its gotchas.
      </p>
      
      
      <h5 id="ch04lev3sec1" class="notetitle"><a id="ch04lev3sec1__title" class="calibre4"></a>Arguments object as an alias to function parameters
      </h5>
      
      <p class="noind">The <kbd class="calibre15">arguments</kbd> parameter has one curious feature: It aliases function parameters. If we set a new value to, for example, <kbd class="calibre15">arguments[0]</kbd>, the value of the first parameter will also be changed. Take a look at the following listing.
      </p>
      
      
      
      <h5 id="ch04ex03" class="notetitle">Listing 4.3. <a id="ch04ex03__title" class="calibre4"></a>The arguments object aliases function parameters
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/065fig01_alt.jpg" alt="" class="calibre2" width="590" height="394" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/065fig01_alt.jpg"></p>
      
      
      <p class="noind">You can see how the <kbd class="calibre15">arguments</kbd> object is an alias for the function parameters. We define a function, <kbd class="calibre15">infiltrate</kbd>, that takes a single parameter, <kbd class="calibre15">person</kbd>, and we invoke it with the argument <kbd class="calibre15">gardener</kbd>. We can access the value <kbd class="calibre15">gardener</kbd> through the function parameter <kbd class="calibre15">person</kbd> and through the <kbd class="calibre15">arguments</kbd> object:
      </p>
      
      <pre id="PLd0e6938" class="calibre5">assert(person === 'gardener', 'The person is a gardener');
assert(arguments[0] === 'gardener', 'The first argument is a gardener');</pre>
      
      <p class="noind">Because the <kbd class="calibre15">arguments</kbd> object is an alias for the function parameters, if we change the <kbd class="calibre15">arguments</kbd> object, the change is also reflected in the matching function parameter:
      </p>
      
      <pre id="PLd0e6953" class="calibre5">arguments[0] = 'ninja';

assert(person === 'ninja', 'The person is a ninja now');
assert(arguments[0] === 'ninja', 'The first argument is a ninja');</pre>
      
      <p class="noind">The same holds true in the other direction. If we change a parameter, the change can be observed in both the parameter and
         the <kbd class="calibre15">arguments</kbd> object:
      </p>
      
      
      <pre id="PLd0e6967" class="calibre5">person = 'gardener';

assert(person === 'gardener',
    'The person is a gardener once more');
assert(arguments[0] === 'gardener',
    'The first argument is a gardener again');</pre>
      
      
      
      <h5 id="ch04lev3sec2" class="notetitle"><a id="ch04lev3sec2__title" class="calibre4"></a>Avoiding aliases
      </h5>
      
      <p class="noind"><a id="iddle1050" class="calibre4"></a><a id="iddle1070" class="calibre4"></a><a id="iddle2059" class="calibre4"></a>The concept of aliasing function parameters through the <kbd class="calibre15">arguments</kbd> object can be confusing, so JavaScript provides a way to opt out of it by using <i class="calibre6">strict mode</i>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <b id="ch04sb01" class="calibre21">Strict mode</b>
         
         <p class="noind">Strict mode is an ES5 addition to JavaScript that changes the behavior of JavaScript engines so that errors are thrown instead
            of silently picked up. The behavior of some language features is changed, and some unsafe language features are even completely
            banned (more on this later). One of the things that strict mode changes is that it disables <kbd class="calibre15">arguments</kbd> aliasing.
         </p>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">As always, let’s take a look at a simple example.</p>
      
      
      
      <h5 id="ch04ex04" class="notetitle">Listing 4.4. <a id="ch04ex04__title" class="calibre4"></a>Using strict mode to avoid arguments aliasing
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/066fig01_alt.jpg" alt="" class="calibre2" width="590" height="337" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/066fig01_alt.jpg"></p>
      
      
      <p class="noind">Here we start by placing the simple string <kbd class="calibre15">use strict</kbd> as the first line of code. This tells the JavaScript engine that we want to execute the following code in strict mode. In
         this example, strict mode changes the semantics of our program in a way that the <kbd class="calibre15">person</kbd> parameter and the first <kbd class="calibre15">argument</kbd> start with the same value:
      </p>
      
      <pre id="PLd0e7047" class="calibre5">assert(person === 'gardener', 'The person is a gardener');
assert(arguments[0] === 'gardener', 'The first argument is a gardener');</pre>
      
      <p class="noind"><a id="iddle1525" class="calibre4"></a><a id="iddle1562" class="calibre4"></a><a id="iddle1565" class="calibre4"></a><a id="iddle1578" class="calibre4"></a><a id="iddle1667" class="calibre4"></a><a id="iddle1686" class="calibre4"></a><a id="iddle1807" class="calibre4"></a><a id="iddle1853" class="calibre4"></a>But, unlike in nonstrict mode, this time around the <kbd class="calibre15">arguments</kbd> object doesn’t alias the parameters. If we change the value of the first argument, <kbd class="calibre15">arguments[0] = 'ninja'</kbd>, the first argument is changed, but the <kbd class="calibre15">person</kbd> parameter isn’t:
      </p>
      
      <pre id="PLd0e7124" class="calibre5">assert(arguments[0] === 'ninja', 'The first argument is now a ninja');
assert(person === 'gardener', 'The person is still a gardener');</pre>
      
      <p class="noind">We’ll revisit the <kbd class="calibre15">arguments</kbd> object later in this book, but for now, let’s focus on another implicit parameter: <kbd class="calibre15">this</kbd>, which is in some ways even more interesting.
      </p>
      
      
      
      
      <h4 id="ch04lev2sec2" class="calibre26">4.1.2. <a id="ch04lev2sec2__title" class="calibre4"></a>The this parameter: introducing the function context
      </h4>
      
      <p class="noind">When a function is invoked, in addition to the parameters that represent the explicit arguments provided in the function call,
         an implicit parameter named <kbd class="calibre15">this</kbd> is passed to the function. The <kbd class="calibre15">this</kbd> parameter, a vital ingredient in object-oriented JavaScript, refers to an object that’s associated with the function invocation.
         For this reason, it’s often termed the <i class="calibre6">function context</i>.
      </p>
      
      <p class="noind">The function context is a notion that those coming from object-oriented languages such as Java might think that they understand.
         In such languages, <kbd class="calibre15">this</kbd> usually points to an instance of the class within which the method is defined.
      </p>
      
      <p class="noind">But beware! As we’ll soon see, in JavaScript, invoking a function as a <i class="calibre6">method</i> is only one way that a function can be invoked. And as it turns out, what the <kbd class="calibre15">this</kbd> parameter points to isn’t (as in Java or C#) defined only by how and where the function is defined; it can also be heavily
         influenced by how the function is <i class="calibre6">invoked</i>. Because understanding the exact nature of the <kbd class="calibre15">this</kbd> parameter is one of the most important pillars of object-oriented JavaScript, we’re about to look at various ways of invoking
         functions. You’ll see that one of the primary differences between them is how the value of <kbd class="calibre15">this</kbd> is determined. And then we’ll take a long and hard look at function contexts again in several following chapters, so don’t
         worry if things don’t gel right away.
      </p>
      
      <p class="noind">Now let’s see, in great detail, how functions can be invoked.</p>
      
      
      
      
      <h3 id="ch04lev1sec2" class="calibre24"><a id="ch04lev1sec2__title" class="calibre3"></a>4.2. Invoking functions
      </h3>
      
      <p class="noind">We’ve all called JavaScript functions, but have you ever stopped to wonder what really happens when a function is called?
         As it turns out, the manner in which a function is invoked has a huge impact on how the code within it operates, primarily
         in how the <kbd class="calibre15">this</kbd> parameter, the function context, is established. This difference is much more important than it might seem at first. We’ll
         examine it within this section and exploit it throughout the rest of this book to help elevate our code to the ninja level.
      </p>
      
      <p class="noind">We can invoke a function in four ways, each with its own nuances:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><i class="calibre6">As a function</i>—<kbd class="calibre15">skulk()</kbd>, in which the function is invoked in a straightforward manner
            
         </li>
         
         <li class="calibre20"><i class="calibre6">As a method</i>—<kbd class="calibre15">ninja.skulk()</kbd>, which ties the invocation to an object, enabling object-oriented programming
            
         </li>
         
         <li class="calibre20"><a id="iddle1007" class="calibre4"></a><a id="iddle1147" class="calibre4"></a><a id="iddle1572" class="calibre4"></a><a id="iddle1692" class="calibre4"></a><a id="iddle2202" class="calibre4"></a><i class="calibre6">As a constructor</i>—<kbd class="calibre15">new Ninja()</kbd>, in which a new object is brought into being
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Via the function’s</i> <kbd class="calibre15">apply</kbd> <i class="calibre6">or</i> <kbd class="calibre15">call</kbd> <i class="calibre6">methods</i>—<kbd class="calibre15">skulk.call(ninja)</kbd>or <kbd class="calibre15">skulk.apply(ninja)</kbd>
            
         </li>
         
      </ul>
      
      <p class="noind">Here are examples:</p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/068fig01_alt.jpg" alt="" class="calibre2" width="590" height="314" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/068fig01_alt.jpg"></p>
      
      <p class="noind">For all but the <kbd class="calibre15">call</kbd> and <kbd class="calibre15">apply</kbd> approaches, the function invocation operator is a set of parentheses following any expression that evaluates to a function
         reference.
      </p>
      
      <p class="noind">Let’s start our exploration with the simplest form, invoking functions as functions.</p>
      
      
      <h4 id="ch04lev2sec3" class="calibre26">4.2.1. <a id="ch04lev2sec3__title" class="calibre4"></a>Invocation as a function
      </h4>
      
      <p class="noind">Invocation as a function? Well, of course functions are invoked as <i class="calibre6">functions</i>. How silly to think otherwise. But in reality, we say that a function is invoked “as a function” to distinguish it from the
         other invocation mechanisms: methods, constructors, and <kbd class="calibre15">apply</kbd>/<kbd class="calibre15">call</kbd>. If a function isn’t invoked as a method, as a constructor, or via <kbd class="calibre15">apply</kbd> or <kbd class="calibre15">call</kbd>, it’s invoked as a function.
      </p>
      
      <p class="noind">This type of invocation occurs when a function is invoked using the <kbd class="calibre15">()</kbd> operator, and the expression to which the <kbd class="calibre15">()</kbd> operator is applied doesn’t reference the function as a property of an object. (In that case, we’d have a method invocation,
         but we discuss that next.) Here are some simple examples:
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/068fig02_alt.jpg" alt="" class="calibre2" width="590" height="101" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/068fig02_alt.jpg"></p>
      
      <p class="noind">When invoked in this manner, the function context (the value of the <kbd class="calibre15">this</kbd> keyword) can be two things: In nonstrict mode, it will be the global context (the <kbd class="calibre15">window</kbd> object), whereas in strict mode, it will be <kbd class="calibre15">undefined</kbd>.
      </p>
      
      <p class="noind"><a id="iddle1569" class="calibre4"></a><a id="iddle1687" class="calibre4"></a><a id="iddle1756" class="calibre4"></a>The following listing illustrates the difference in behavior between strict and nonstrict modes.
      </p>
      
      
      
      <h5 id="ch04ex05" class="notetitle">Listing 4.5. <a id="ch04ex05__title" class="calibre4"></a>Invocation as a function
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/069fig01_alt.jpg" alt="" class="calibre2" width="590" height="278" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/069fig01_alt.jpg"></p>
      
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch04note02" class="notetitle">Note</h5>
      
      
      <p class="noindclose">As you can see, strict mode is, in most cases, much more straightforward than nonstrict mode. For example, when <a href="#ch04ex05" class="calibre4">listing 4.5</a> invokes a function as a function (as opposed to as a method), it hasn’t specified an object on which the function should
         be invoked. So, in our opinion, it makes more sense that the <kbd class="calibre15">this</kbd> keyword should be set to <kbd class="calibre15">undefined</kbd> (as in strict mode), as opposed to the global <kbd class="calibre15">window</kbd> object (as in nonstrict mode). In general, strict mode fixes a lot of these small JavaScript oddities. (Remember arguments
         aliasing from the beginning of the chapter?)
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">You’ve likely written code such as this many times without giving it much thought. Now let’s step it up a notch by looking
         at how functions are invoked as <i class="calibre6">methods</i>.
      </p>
      
      
      
      <h4 id="ch04lev2sec4" class="calibre26">4.2.2. <a id="ch04lev2sec4__title" class="calibre4"></a>Invocation as a method
      </h4>
      
      <p class="noind">When a function is assigned to a property of an object <i class="calibre6">and</i> the invocation occurs by referencing the function using that property, then the function is invoked as a <i class="calibre6">method</i> of that object. Here’s an example:
      </p>
      
      <pre id="PLd0e7443" class="calibre5">var ninja = {};
ninja.skulk = function(){};
ninja.skulk();</pre>
      
      <p class="noind">Okay; so what? The function is called a <i class="calibre6">method</i> in this case, but what makes that interesting or useful? Well, if you come from an object-oriented background, you’ll remember
         that the object to which a method belongs is available within the body of the method as <kbd class="calibre15">this</kbd>. The same thing happens here. When we invoke a function as a <i class="calibre6">method</i> of an object, that object becomes the function context and is available within <a id="iddle1275" class="calibre4"></a>the function via the <kbd class="calibre15">this</kbd> parameter. This is one of the primary means by which JavaScript allows object-oriented code to be written. (Constructors
         are another, and we’ll get to them in short order.)
      </p>
      
      <p class="noind">Let’s consider some test code in the next listing to illustrate the differences and similarities between invocation as a function
         and invocation as a method.
      </p>
      
      <h5 id="ch04ex06" class="notetitle">Listing 4.6. <a id="ch04ex06__title" class="calibre4"></a>The differences between function and method invocations
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch04ex06-0.jpg" alt="" class="calibre2" width="590" height="215" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch04ex06-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch04ex06-1.jpg" alt="" class="calibre2" width="590" height="153" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch04ex06-1.jpg"></p>
      
      <p class="noind">This test sets up a function named <kbd class="calibre15">whatsMyContext</kbd> that we’ll use throughout the rest of the listing. The only thing that this function does is to return its function context
         so that we can see, from outside the function, what the function context for the invocation is. (Otherwise, we’d have a hard
         time knowing.)
      </p>
      
      <pre id="PLd0e7492" class="calibre5">function whatsMyContext() {
  return this;
}</pre>
      
      <p class="noind">When we call the function directly by name, this is a case of invoking the function as a function, so we expect that the function
         context will be the global context (<kbd class="calibre15">window</kbd>), because we’re in nonstrict mode. We assert that this is so:
      </p>
      
      <pre id="PLd0e7504" class="calibre5">assert(whatsMyContext() === window, <b class="calibre21">...</b>)</pre>
      
      <p class="noind">Then we create a reference to the function <kbd class="calibre15">whatsMyContext</kbd> in a variable named <kbd class="calibre15">getMyThis: var getMyThis = whatsMyContext</kbd>. This doesn’t create a second instance of the function; it merely creates a reference to the same function (you know, first-class
         object and all).
      </p>
      
      <p class="noind">When we invoke the function via the variable—something we can do because the function invocation operator can be applied to
         any expression that evaluates to a function—we’re once again invoking the function as a function. As such, we again expect
         that the function context is <kbd class="calibre15">window</kbd>, and it is:
      </p>
      
      <pre id="PLd0e7529" class="calibre5">assert(getMyThis() === window,
       "Another function call in window");</pre>
      
      <p class="noind">Now, we get a bit trickier and define an object in variable <kbd class="calibre15">ninja1</kbd> with a property named <kbd class="calibre15">getMyThis</kbd> that receives a reference to the <kbd class="calibre15">whatsMyContext</kbd> function. By doing so, we say that we’ve created a <i class="calibre6">method</i> named <kbd class="calibre15">getMyThis</kbd> on the object. We don’t say that <kbd class="calibre15">whatsMyContext</kbd> has <i class="calibre6">become</i> a method of <kbd class="calibre15">ninja1</kbd>; it hasn’t. You’ve already seen that <kbd class="calibre15">whatsMyContext</kbd> is its own independent function that can be invoked in numerous ways:
      </p>
      
      <pre id="PLd0e7565" class="calibre5">var ninja1 = {
  <b class="calibre21">getMyThis: whatsMyContext</b>
};</pre>
      
      <p class="noind">According to what we stated earlier, when we invoke the function via a method reference, we expect the function context to
         be the method’s object (in this case, <kbd class="calibre15">ninja1</kbd>) and we assert as much:
      </p>
      
      <pre id="PLd0e7580" class="calibre5">assert(ninja1.getMyThis() === ninja1,
      "Working with 1st ninja");</pre>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch04note03" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Invoking functions as methods is crucial to writing JavaScript in an object-oriented manner. Doing so enables you to use <kbd class="calibre15">this</kbd> within any method to reference the method’s “owning” object—a fundamental concept in object-oriented programming.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">To drive that point home, we continue testing by creating yet another object, <kbd class="calibre15">ninja2</kbd>, also with a property named <kbd class="calibre15">getMyThis</kbd> that references the <kbd class="calibre15">whatsMyContext</kbd> function. Upon invoking this function through the <kbd class="calibre15">ninja2</kbd> object, we correctly assert that its function context is <kbd class="calibre15">ninja2</kbd>:
      </p>
      
      <pre id="PLd0e7615" class="calibre5">var ninja2 = {
  getMyThis: whatsMyContext
};

assert(ninja2.getMyThis() === ninja2,
  "Working with 2nd ninja");</pre>
      
      <p class="noind">Even though the <i class="calibre6">same</i> function—<kbd class="calibre15">whatsMyContext</kbd>—is used throughout the example, the function context returned by <kbd class="calibre15">this</kbd> changes depending on how <kbd class="calibre15">whatsMyContext</kbd> is invoked. For example, the exact same function is shared by both <kbd class="calibre15">ninja1</kbd> and <kbd class="calibre15">ninja2</kbd>, <a id="iddle1093" class="calibre4"></a><a id="iddle1263" class="calibre4"></a><a id="iddle1266" class="calibre4"></a><a id="iddle1520" class="calibre4"></a><a id="iddle1566" class="calibre4"></a><a id="iddle1568" class="calibre4"></a><a id="iddle1573" class="calibre4"></a><a id="iddle1688" class="calibre4"></a><a id="iddle1690" class="calibre4"></a>yet when it’s executed, the function has access to, and can perform operations on, the object through which the method was
         invoked. We don’t need to create separate copies of a function to perform the exact same processing on different objects.
         This is a tenet of object-oriented programming.
      </p>
      
      <p class="noind">Though a powerful capability, the manner in which it’s used in this example has limitations. Foremost, when we create the
         two ninja objects, we’re able to share the same function to be used as a method in each, but we have to use a bit of repeated
         code to set up the separate objects and their methods.
      </p>
      
      <p class="noind">But that’s nothing to despair over—JavaScript provides mechanisms to make creating objects from a single pattern much easier
         than in this example. We’ll explore those capabilities in depth in <a href="kindle_split_019.html#ch07" class="calibre4">chapter 7</a>. But for now, let’s consider a part of that mechanism that relates to function invocations: the <i class="calibre6">constructor</i>.
      </p>
      
      
      
      <h4 id="ch04lev2sec5" class="calibre26">4.2.3. <a id="ch04lev2sec5__title" class="calibre4"></a>Invocation as a constructor
      </h4>
      
      <p class="noind">There’s nothing special about a function that’s going to be used as a constructor. <i class="calibre6">Constructor functions</i> are declared just like any other functions, and we can easily use function declarations and function expressions for constructing
         new objects. The only exception is the arrow function, which as you’ll see later in the chapter, works a bit differently.
         But, in any case, the main difference is in how the function is invoked.
      </p>
      
      <p class="noind">To invoke the function as a constructor, we precede the function invocation with the keyword <kbd class="calibre15">new</kbd>. For example, recall the <kbd class="calibre15">whatsMyContext</kbd> function from the previous section:
      </p>
      
      <pre id="PLd0e7755" class="calibre5">function whatsMyContext(){ return this; }</pre>
      
      <p class="noind">If we want to invoke the <kbd class="calibre15">whatsMyContext</kbd> function as a constructor, we write this:
      </p>
      
      <pre id="PLd0e7767" class="calibre5">new whatsMyContext();</pre>
      
      <p class="noind">But even though we can invoke <kbd class="calibre15">whatsMyContext</kbd> as a constructor, that function isn’t a particularly useful constructor. Let’s find out why by discussing what makes constructors
         special.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch04note04" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Remember in <a href="kindle_split_014.html#ch03" class="calibre4">chapter 3</a>, when we discussed ways of defining functions? Among function declarations, function expressions, arrow functions, and generator
         functions, we also mentioned <i class="calibre6">function constructors</i>, which enable us to construct new functions from strings. For example: <kbd class="calibre15">new Function('a', 'b', 'return a + b')</kbd> creates a new function with two parameters, <kbd class="calibre15">a</kbd> and <kbd class="calibre15">b</kbd>, that returns their sum. Be careful not to confuse these <i class="calibre6">function constructors</i> with <i class="calibre6">constructor functions</i>! The difference is subtle, yet significant. A function constructor enables us to create functions from dynamically created
         strings. On the other hand, <i class="calibre6">constructor functions,</i> the topic of this section, are functions that we use to create and initialize object instances.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      <h5 id="ch04lev3sec3" class="notetitle"><a id="ch04lev3sec3__title" class="calibre4"></a>The superpowers of constructors
      </h5>
      
      <p class="noind">Invoking a function as a constructor is a powerful feature of JavaScript that we’ll explore in the following listing.</p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch04ex07" class="notetitle">Listing 4.7. <a id="ch04ex07__title" class="calibre4"></a>Using a constructor to set up common objects
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/073fig01_alt.jpg" alt="" class="calibre2" width="590" height="201" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/073fig01_alt.jpg"></p>
      
      
      <p class="noind">In this example, we create a function named <kbd class="calibre15">Ninja</kbd> that we’ll use to construct, well, ninjas. When invoked with the keyword <kbd class="calibre15">new</kbd>, an empty object instance is created and passed to the function as its function context, the <kbd class="calibre15">this</kbd> parameter. The constructor creates a property named <kbd class="calibre15">skulk</kbd> on this object, which is assigned a function, making that function a method of the newly created object.
      </p>
      
      <p class="noind">In general, when a constructor is invoked, a couple of special actions take place, as shown in <a href="#ch04fig01" class="calibre4">figure 4.1</a>. Calling a function with the keyword <kbd class="calibre15">new</kbd> triggers the following steps:
      </p>
      
      <p class="calibre18"></p>
      <ol class="calibre27">
         
         <li class="calibre20">A new empty object is created.
            
         </li>
         
         <li class="calibre20">This object is passed to the constructor as the <kbd class="calibre15">this</kbd> parameter, and thus becomes the constructor’s function context.
            
         </li>
         
         <li class="calibre20">The newly constructed object is returned as the <kbd class="calibre15">new</kbd> operator’s value (with an exception that we’ll get to in short order).
            
         </li>
         
      </ol>
      
      
      
      <h5 id="ch04fig01" class="notetitle">Figure 4.1. <a id="ch04fig01__title" class="calibre4"></a>When calling a function with a keyword <kbd class="calibre15">new</kbd>, a new empty object is created and set as the context of the constructor function, the <kbd class="calibre15">this</kbd> parameter.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig01_alt.jpg" alt="" class="calibre2" width="590" height="307" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1268" class="calibre4"></a><a id="iddle1691" class="calibre4"></a><a id="iddle1986" class="calibre4"></a>The last two points touch on why <kbd class="calibre15">whatsMyContext</kbd> in <kbd class="calibre15">new whatsMyContext()</kbd> makes for a lousy constructor. The purpose of a constructor is to cause a new object to be created, to set it up, and to
         return it as the constructor value. Anything that interferes with that intent isn’t appropriate for constructors.
      </p>
      
      <p class="noind">Let’s consider a more appropriate constructor, <kbd class="calibre15">Ninja</kbd>, that sets up skulking ninjas, as shown in <a href="#ch04ex07" class="calibre4">listing 4.7</a>:
      </p>
      
      <pre id="PLd0e7943" class="calibre5">function Ninja() {
  this.skulk = function() {
    return this;
  };
}</pre>
      
      <p class="noind">The <kbd class="calibre15">skulk</kbd> method performs the same operation as <kbd class="calibre15">whatsMyContext</kbd> in the previous sections, returning the function context so that we can test it externally.
      </p>
      
      <p class="noind">With the constructor defined, we create two new <kbd class="calibre15">Ninja</kbd> objects by invoking the constructor twice. Note that the returned values from the invocations are stored in variables that
         become references to the newly created <kbd class="calibre15">Ninja</kbd>s:
      </p>
      
      <pre id="PLd0e7967" class="calibre5">var ninja1 = new Ninja();
var ninja2 = new Ninja();</pre>
      
      <p class="noind">Then we run the tests that ensure that each invocation of the method operates on the expected object:</p>
      
      <pre id="PLd0e7976" class="calibre5">assert(ninja1.skulk() === ninja1,
  "The 1st ninja is skulking");
assert(ninja2.skulk() === ninja2,
  "The 2nd ninja is skulking");</pre>
      
      <p class="noind">That’s it! Now you know how to create and initialize new objects with constructor functions. Calling a function with the keyword
         <kbd class="calibre15">new</kbd> returns the newly created object. But let’s check whether that’s always exactly true.
      </p>
      
      
      
      <h5 id="ch04lev3sec4" class="notetitle"><a id="ch04lev3sec4__title" class="calibre4"></a>Constructor return values
      </h5>
      
      <p class="noind">We mentioned earlier that constructors are intended to initialize newly created objects, and that the newly constructed object
         is returned as a result of a constructor invocation (via the <kbd class="calibre15">new</kbd> operator). But what happens when the constructor returns a value of its own? Let’s explore that situation in the following
         listing.
      </p>
      
      
      
      <h5 id="ch04ex08" class="notetitle">Listing 4.8. <a id="ch04ex08__title" class="calibre4"></a>Constructors returning primitive values
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/074fig01_alt.jpg" alt="" class="calibre2" width="590" height="289" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/074fig01_alt.jpg"></p>
      
      
      <p class="noind">If we run this listing, we’ll see that all is fine and well. The fact that this <kbd class="calibre15">Ninja</kbd> function returns a simple number <kbd class="calibre15">1</kbd> has no significant influence on how the code behaves. If we call the <kbd class="calibre15">Ninja</kbd> function as a function, it returns <kbd class="calibre15">1</kbd> (just as we’d expect); and if we call it as a constructor, with the keyword <kbd class="calibre15">new</kbd>, a new <kbd class="calibre15">ninja</kbd> object is constructed and returned. So far, so good.
      </p>
      
      <p class="noind">But now let’s try something different, a constructor function that returns another object, as shown in the following listing.</p>
      
      
      
      <h5 id="ch04ex09" class="notetitle">Listing 4.9. <a id="ch04ex09__title" class="calibre4"></a>Constructors explicitly returning object values
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/075fig01_alt.jpg" alt="" class="calibre2" width="590" height="238" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/075fig01_alt.jpg"></p>
      
      
      <p class="noind">This listing takes a slightly different approach. We start by creating a <kbd class="calibre15">puppet</kbd> object with the property <kbd class="calibre15">rules</kbd> set to <kbd class="calibre15">false</kbd>:
      </p>
      
      <pre id="PLd0e8064" class="calibre5">var puppet = {
  rules: false
};</pre>
      
      <p class="noind">Then we define an <kbd class="calibre15">Emperor</kbd> function that adds a <kbd class="calibre15">rules</kbd> property to the newly constructed object and sets it to <kbd class="calibre15">true</kbd>. In addition, the <kbd class="calibre15">Emperor</kbd> function has one quirk; it returns the global <kbd class="calibre15">puppet</kbd> object:
      </p>
      
      
      <pre id="PLd0e8090" class="calibre5">function Emperor() {
  this.rules = true;
  return puppet;
}</pre>
      
      <p class="noind"><a id="iddle1264" class="calibre4"></a><a id="iddle1265" class="calibre4"></a><a id="iddle1267" class="calibre4"></a><a id="iddle1570" class="calibre4"></a><a id="iddle1574" class="calibre4"></a><a id="iddle1689" class="calibre4"></a>Later, we call the <kbd class="calibre15">Emperor</kbd> function as a constructor, with the keyword <kbd class="calibre15">new</kbd>:
      </p>
      
      <pre id="PLd0e8171" class="calibre5">var emperor = new Emperor();</pre>
      
      <p class="noind">With this, we’ve set up an ambiguous situation: We get one object passed to the constructor as the function context in <kbd class="calibre15">this</kbd>, which we initialize, but then we return a completely different <kbd class="calibre15">puppet</kbd> object. Which object will reign supreme?
      </p>
      
      <p class="noind">Let’s test it:</p>
      
      <pre id="PLd0e8189" class="calibre5">assert(emperor === puppet, "The emperor is merely a puppet!");
assert(emperor.rules === false,
      "The puppet does not know how to rule!");</pre>
      
      <p class="noind">It turns out that our tests indicate that the <kbd class="calibre15">puppet</kbd> object is returned as the value of constructor invocation, and that the initialization that we performed on the function
         context in the constructor was all for naught. The <kbd class="calibre15">puppet</kbd> has been exposed!
      </p>
      
      <p class="noind">Now that we’ve gone through some tests, let’s summarize our findings:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">If the constructor returns an object, that object is returned as the value of the whole <kbd class="calibre15">new</kbd> expression, and the newly constructed object passed as <kbd class="calibre15">this</kbd> to the constructor is discarded.
            
         </li>
         
         <li class="calibre20">If, however, a nonobject is returned from the constructor, the returned value is ignored, and the newly created object is
            returned.
            
         </li>
         
      </ul>
      
      <p class="noind">Because of these peculiarities, functions intended for use as constructors are generally coded differently from other functions.
         Let’s explore that in greater detail.
      </p>
      
      
      
      <h5 id="ch04lev3sec5" class="notetitle"><a id="ch04lev3sec5__title" class="calibre4"></a>Coding considerations for constructors
      </h5>
      
      <p class="noind">The intent of constructors is to initialize the new object that will be created by the function invocation to initial conditions.
         And although such functions <i class="calibre6">can</i> be called as “normal” functions, or even assigned to object properties in order to be invoked as methods, they’re generally
         not useful as such. For example
      </p>
      
      <pre id="PLd0e8241" class="calibre5">function Ninja() {
    this.skulk = function() {
      return this;
    };
}
var whatever = Ninja();</pre>
      
      <p class="noind">We can call <kbd class="calibre15">Ninja</kbd> as a simple function, but the <kbd class="calibre15">skulk</kbd> property would be created on <kbd class="calibre15">window</kbd> in nonstrict mode—not a particularly useful operation. Things go even more awry in strict mode, as <kbd class="calibre15">this</kbd> would be undefined and our JavaScript application would crash. But this is a good thing; if we make this mistake in nonstrict
         mode, it might <a id="iddle1062" class="calibre4"></a><a id="iddle1567" class="calibre4"></a><a id="iddle1575" class="calibre4"></a><a id="iddle1693" class="calibre4"></a>escape our notice (unless we had good tests), but there’s no missing the mistake in strict mode. This is a good example of
         why strict mode was introduced.
      </p>
      
      <p class="noind">Because constructors are generally coded and used in a manner that’s different from other functions, and aren’t all that useful
         unless invoked as constructors, a naming convention has arisen to distinguish constructors from run-of-the-mill functions
         and methods. If you’ve been paying attention, you may have already noticed it.
      </p>
      
      <p class="noind">Functions and methods are generally named starting with a verb that describes what they do (<kbd class="calibre15">skulk</kbd>, <kbd class="calibre15">creep</kbd>, <kbd class="calibre15">sneak</kbd>, <kbd class="calibre15">doSomethingWonderful</kbd>, and so on) and start with a lowercase letter. Constructors, on the other hand, are usually named as a noun that describes
         the object that’s being constructed and start with an uppercase character: <kbd class="calibre15">Ninja</kbd>, <kbd class="calibre15">Samurai</kbd>, <kbd class="calibre15">Emperor</kbd>, <kbd class="calibre15">Ronin</kbd>, and so on.
      </p>
      
      <p class="noind">It’s easy to see how a constructor makes it more elegant to create multiple objects that conform to the same pattern without
         having to repeat the same code over and over. The common code is written just once, as the body of the constructor. In <a href="kindle_split_019.html#ch07" class="calibre4">chapter 7</a>, you’ll see more about using constructors and about the other object-oriented mechanisms that JavaScript provides to make
         it even easier to set up object patterns.
      </p>
      
      <p class="noind">But we’re not finished with function invocations yet. There’s still another way that JavaScript lets us invoke functions that
         provides a great deal of control over the invocation details.
      </p>
      
      
      
      
      <h4 id="ch04lev2sec6" class="calibre26">4.2.4. <a id="ch04lev2sec6__title" class="calibre4"></a>Invocation with the apply and call methods
      </h4>
      
      <p class="noind">So far, you’ve seen that one of the major differences between the types of function invocation is what object ends up as the
         function context referenced by the implicit <kbd class="calibre15">this</kbd> parameter that’s passed to the executing function. For methods, it’s the method’s owning object; for top-level functions,
         it’s either <kbd class="calibre15">window</kbd> or <kbd class="calibre15">undefined</kbd> (depending on the current strictness); for constructors, it’s a newly created object instance.
      </p>
      
      <p class="noind">But what if we want to make the function context whatever we want? What if we want to set it explicitly? What if...well, why
         would we want to do such a thing?
      </p>
      
      <p class="noind">To get a glimpse of why we’d care about this ability, we’ll look at a practical example that illustrates a surprisingly common
         bug related to event handling. For now, consider that when an event handler is called, the function context is set to the
         object to which the event was bound. (Don’t worry if this seems vague; you’ll learn about event handling in great detail in
         <a href="kindle_split_026.html#ch13" class="calibre4">chapter 13</a>.) Take a look at the following listing.
      </p>
      
      
      
      <h5 id="ch04ex10" class="notetitle">Listing 4.10. <a id="ch04ex10__title" class="calibre4"></a>Binding a specific context to a function
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/077fig01_alt.jpg" alt="" class="calibre2" width="590" height="254" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/077fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1142" class="calibre4"></a><a id="iddle1144" class="calibre4"></a><a id="iddle1189" class="calibre4"></a>In this example, we have a button, <kbd class="calibre15">&lt;button id="test"&gt;Click Me!&lt;/button&gt;</kbd>, and we want to know whether it has ever been clicked. To retain that state information, we use a constructor function to
         create a backing object named <kbd class="calibre15">button</kbd>, in which we’ll store the clicked state:
      </p>
      
      <pre id="PLd0e8406" class="calibre5">function Button(){
  this.clicked = false;
  this.click = function(){
    this.clicked = true;
    assert(button.clicked, "The button has been clicked");
  };
}
var button = new Button();</pre>
      
      <p class="noind">In that object, we also define a <kbd class="calibre15">click</kbd> method that will serve as an event handler that fires when the button is clicked. The method sets the clicked property to
         <kbd class="calibre15">true</kbd> and then tests that the state was properly recorded in the backing object (we’ve intentionally used the <kbd class="calibre15">button</kbd> identifier instead of the <kbd class="calibre15">this</kbd> keyword—after all, they should refer to the same thing, or should they?). Finally, we establish the <kbd class="calibre15">button.click</kbd> method as a click handler for the button:
      </p>
      
      <pre id="PLd0e8430" class="calibre5">var elem = document.getElementById("test");
elem.addEventListener("click", button.click);</pre>
      
      <p class="noind">When we load the example into a browser and click the button, we see by the display of <a href="#ch04fig02" class="calibre4">figure 4.2</a> that something is amiss; the stricken text indicates that the test has failed. The code in <a href="#ch04ex10" class="calibre4">listing 4.10</a> fails because the context of the <kbd class="calibre15">click</kbd> function <i class="calibre6">isn’t</i> referring to the <kbd class="calibre15">button</kbd> object as we intended.
      </p>
      
      
      
      <h5 id="ch04fig02" class="notetitle">Figure 4.2. <a id="ch04fig02__title" class="calibre4"></a>Why did our test fail? Where did the change of state go? Usually, the event callback’s context is the object raising the event
         (in this case, the HTML button, and not the button object).
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig02.jpg" alt="" class="calibre2" width="375" height="256" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig02.jpg"></p>
      
      
      
      <p class="noind">Recalling the lessons of earlier in the chapter, if we had called the function via <kbd class="calibre15">button.click()</kbd>, the context <i class="calibre6">would</i> have been the button, because the function would be invoked as a method on the <a id="iddle1141" class="calibre4"></a><a id="iddle1148" class="calibre4"></a><a id="iddle1710" class="calibre4"></a><kbd class="calibre15">button</kbd> object. But in this example, the event-handling system of the browser defines the context of the invocation to be the target
         element of the event, which causes the context to be the <kbd class="calibre15">&lt;button&gt;</kbd> element, not the <kbd class="calibre15">button</kbd> object. So we set our <kbd class="calibre15">click</kbd> state on the wrong object!
      </p>
      
      <p class="noind">This is a surprisingly common problem, and later in the chapter, you’ll see techniques for completely evading it. For now,
         let’s explore how to tackle it by examining how to explicitly set the function context by using the <kbd class="calibre15">apply</kbd> and <kbd class="calibre15">call</kbd> methods.
      </p>
      
      
      <h5 id="ch04lev3sec6" class="notetitle"><a id="ch04lev3sec6__title" class="calibre4"></a>Using the apply and call methods
      </h5>
      
      <p class="noind">JavaScript provides a means for us to invoke a function and to explicitly specify any object we want as the function context.
         We do this through the use of one of two methods that exist for every function: <kbd class="calibre15">apply</kbd> and <kbd class="calibre15">call</kbd>.
      </p>
      
      <p class="noind">Yes, we said methods of functions. As first-class objects (created, by the way, by the built-in <kbd class="calibre15">Function</kbd> constructor), functions can have properties just like any other object type, including methods.
      </p>
      
      <p class="noind">To invoke a function by using its <kbd class="calibre15">apply</kbd> method, we pass two parameters to <kbd class="calibre15">apply</kbd>: the object to be used as the function context, and an array of values to be used as the invocation arguments. The <kbd class="calibre15">call</kbd> method is used in a similar manner, except that the arguments are passed directly in the argument list rather than as an
         array.
      </p>
      
      <p class="noind">The following listing shows both of these methods in action.</p>
      
      
      
      <h5 id="ch04ex11" class="notetitle">Listing 4.11. <a id="ch04ex11__title" class="calibre4"></a>Using the apply and call methods to supply the function context
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/079fig01_alt.jpg" alt="" class="calibre2" width="590" height="268" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/079fig01_alt.jpg"></p>
      
      
      <p class="noind">In this example, we set up a function named <kbd class="calibre15">juggle</kbd>, in which we define juggling as adding up all the arguments and storing them as a property named <kbd class="calibre15">result</kbd> on the function context (referenced by the <kbd class="calibre15">this</kbd> keyword). That may be a rather lame definition of juggling, but it <i class="calibre6">will</i> allow us to determine whether arguments were passed to the function correctly, and which object ended up as the function
         context.
      </p>
      
      <p class="noind"><a id="iddle1272" class="calibre4"></a><a id="iddle1524" class="calibre4"></a>We then set up two objects, <kbd class="calibre15">ninja1</kbd> and <kbd class="calibre15">ninja2</kbd>, that we’ll use as function contexts, passing the first to the function’s <kbd class="calibre15">apply</kbd> method, along with an <i class="calibre6">array</i> of arguments, and passing the second to the function’s <kbd class="calibre15">call</kbd> method, along with a <i class="calibre6">list</i> of other arguments:
      </p>
      
      <pre id="PLd0e8609" class="calibre5">juggle.apply(ninja1,[1,2,3,4]);
juggle.call(ninja2, 5,6,7,8);</pre>
      
      <p class="noind">Notice that the only difference between <kbd class="calibre15">apply</kbd> and <kbd class="calibre15">call</kbd> is how the arguments are supplied. In the case of <kbd class="calibre15">apply</kbd>, we use an array of arguments, and in the case of <kbd class="calibre15">call</kbd>, we list them as call arguments, after the function context. See <a href="#ch04fig03" class="calibre4">figure 4.3</a>.
      </p>
      
      
      
      <h5 id="ch04fig03" class="notetitle">Figure 4.3. <a id="ch04fig03__title" class="calibre4"></a>As the first argument, both the <kbd class="calibre15">call</kbd> and <kbd class="calibre15">apply</kbd> methods take the object that will be used as the function context. The difference is in the following arguments. <kbd class="calibre15">apply</kbd> takes only one additional argument, an array of argument values; <kbd class="calibre15">call</kbd> takes any number of arguments, which will be used as function arguments.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig03.jpg" alt="" class="calibre2" width="462" height="371" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig03.jpg"></p>
      
      
      
      <p class="noind">After we’ve supplied our function contexts and arguments, we continue by testing! First, we check that <kbd class="calibre15">ninja1</kbd>, which was called via <kbd class="calibre15">apply</kbd>, received a <kbd class="calibre15">result</kbd> property that’s the result of adding up all the argument values (<kbd class="calibre15">1</kbd>, <kbd class="calibre15">2</kbd>, <kbd class="calibre15">3</kbd>, <kbd class="calibre15">4</kbd>) in the passed array. Then we do the same for <kbd class="calibre15">ninja2</kbd>, which was called via <kbd class="calibre15">call</kbd>, where we check the result for arguments <kbd class="calibre15">5</kbd>, <kbd class="calibre15">6</kbd>, <kbd class="calibre15">7</kbd>, and <kbd class="calibre15">8</kbd>:
      </p>
      
      <pre id="PLd0e8700" class="calibre5">assert(ninja1.result === 10, "juggled via apply");
assert(ninja2.result === 26, "juggled via call");</pre>
      
      <p class="noind"><a href="#ch04fig04" class="calibre4">Figure 4.4</a> provides a closer look at what’s going on in <a href="#ch04ex11" class="calibre4">listing 4.11</a>.
      </p>
      
      
      
      <h5 id="ch04fig04" class="notetitle">Figure 4.4. <a id="ch04fig04__title" class="calibre4"></a>Manually setting a function context by using built-in <kbd class="calibre15">call</kbd> and <kbd class="calibre15">apply</kbd> from <a href="#ch04ex11" class="calibre4">listing 4.11</a> results in these combinations of function contexts (the <kbd class="calibre15">this</kbd> parameter) and <kbd class="calibre15">arguments</kbd>.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig04_alt.jpg" alt="" class="calibre2" width="590" height="359" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig04_alt.jpg"></p>
      
      
      <p class="noind">These two methods, <kbd class="calibre15">call</kbd> and <kbd class="calibre15">apply</kbd>, can come in handy whenever it’s expedient to usurp what would normally be the function context with an object of our own
         choosing—something that can be particularly useful when invoking callback functions.
      </p>
      
      
      
      <h5 id="ch04lev3sec7" class="notetitle"><a id="ch04lev3sec7__title" class="calibre4"></a>Forcing the function context in callbacks
      </h5>
      
      <p class="noind">Let’s consider a concrete example of forcing the function context to be an object of our own choosing. We’ll use a simple
         function to perform an operation on every entry of an array.
      </p>
      
      <p class="noind"><a id="iddle1502" class="calibre4"></a><a id="iddle1510" class="calibre4"></a>In imperative programming, it’s common to pass the array to a method and use a <kbd class="calibre15">for</kbd> loop to iterate over every entry, performing the operation on each entry:
      </p>
      
      <pre id="PLd0e8777" class="calibre5">function(collection) {
  for (var n = 0; n &lt; collection.length; n++) {
    /* do something to collection[n] */
  }
}</pre>
      
      <p class="noind">In contrast, the functional approach is to create a function that operates on a single element and passes each entry to that
         function:
      </p>
      
      <pre id="PLd0e8786" class="calibre5">function(item){
  /* do something to item */
}</pre>
      
      <p class="noind">The difference lies in thinking at a level where functions are the main building blocks of the program. You might think that
         it’s moot, and that all you’re doing is moving the <kbd class="calibre15">for</kbd> loop out one level, but we’re not done massaging this example yet.
      </p>
      
      <p class="noind">To facilitate a more functional style, all array objects have access to a <kbd class="calibre15">forEach</kbd> function that invokes a callback on each element within an array. This is often more succinct, and this style is preferred
         over the traditional <kbd class="calibre15">for</kbd> statement by those familiar with functional programming. Its organizational benefits will become even more evident (<i class="calibre6">cough</i>, code reuse, <i class="calibre6">cough</i>) after covering closures in <a href="kindle_split_016.html#ch05" class="calibre4">chapter 5</a>. Such an iteration <a id="iddle1149" class="calibre4"></a>function <i class="calibre6">could</i> pass the current element to the callback as a parameter, but most make the current element the function context of the callback.
      </p>
      
      <p class="noind">Even though all modern JavaScript engines now support a <kbd class="calibre15">forEach</kbd> method on arrays, we’ll build our own (simplified) version of such a function in the next listing.
      </p>
      
      
      
      <h5 id="ch04ex12" class="notetitle">Listing 4.12. <a id="ch04ex12__title" class="calibre4"></a>Building a forEach function to demonstrate setting a function context
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/082fig01_alt.jpg" alt="" class="calibre2" width="590" height="200" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/082fig01_alt.jpg"></p>
      
      
      <p class="noind">The iteration function sports a simple signature that expects the array of objects to be iterated over as the first argument,
         and a callback function as the second. The function iterates over the array entries, invoking the callback function for each
         entry:
      </p>
      
      <pre id="PLd0e8846" class="calibre5">function forEach(list,callback) {
  for (var n = 0; n &lt; list.length; n++) {
    callback.call(list[n], n);
  }
}</pre>
      
      <p class="noind">We use the <kbd class="calibre15">call</kbd> method of the callback function, passing the current iteration entry as the first parameter and the loop index as the second.
         This <i class="calibre6">should</i> cause the current entry to become the function context, and the index to be passed as the single parameter to the callback.
      </p>
      
      <p class="noind">Now to test that! We set up a simple <kbd class="calibre15">weapons</kbd> array. Then we call the <kbd class="calibre15">forEach</kbd> function, passing the test array and a callback within which we test that the expected entry is set as the function context
         for each invocation of the callback:
      </p>
      
      <pre id="PLd0e8870" class="calibre5">forEach(weapons, function(index){
  assert(this === weapons[index],
        "Got the expected value of " + weapons[index].type);
});</pre>
      
      <p class="noind"><a href="#ch04fig05" class="calibre4">Figure 4.5</a> shows that our function works splendidly.
      </p>
      
      
      
      <h5 id="ch04fig05" class="notetitle">Figure 4.5. <a id="ch04fig05__title" class="calibre4"></a>The test results show that we have the ability to make any object we please the function context of a callback invocation.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig05.jpg" alt="" class="calibre2" width="400" height="273" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig05.jpg"></p>
      
      
      
      <p class="noind">In a production-ready implementation of such a function, there’d be a lot more work to do. For example, what if the first
         <a id="iddle1061" class="calibre4"></a><a id="iddle1094" class="calibre4"></a><a id="iddle1123" class="calibre4"></a><a id="iddle1155" class="calibre4"></a><a id="iddle1273" class="calibre4"></a><a id="iddle1521" class="calibre4"></a><a id="iddle1523" class="calibre4"></a><a id="iddle1556" class="calibre4"></a><a id="iddle1558" class="calibre4"></a>argument isn’t an array? What if the second argument isn’t a function? How would you allow the page author to terminate the
         loop at any point? As an exercise, you can augment the function to handle these situations. Another exercise you could task
         yourself with is to enhance the function so that the page author can pass an arbitrary number of arguments to the callback
         in addition to the iteration index.
      </p>
      
      <p class="noind">Given that <kbd class="calibre15">apply</kbd> and <kbd class="calibre15">call</kbd> do pretty much the same thing, here’s something you might be asking yourself at this point: How do we decide which to use?
         The high-level answer is the same as for many such questions: We use whichever one improves code clarity. A more practical
         answer is to use the one that best matches the arguments we have handy. If we have a bunch of unrelated values in variables
         or specified as literals, <kbd class="calibre15">call</kbd> lets us list them directly in its argument list. But if we already have the argument values in an array, or if it’s convenient
         to collect them as such, <kbd class="calibre15">apply</kbd> could be the better choice.
      </p>
      
      
      
      
      
      <h3 id="ch04lev1sec3" class="calibre24"><a id="ch04lev1sec3__title" class="calibre3"></a>4.3. Fixing the problem of function contexts
      </h3>
      
      <p class="noind">In the preceding section, you saw some of the problems that can happen when dealing with function context in JavaScript. In
         callback functions (such as event handlers), the function context might not be exactly what we expect, but we can use the
         <kbd class="calibre15">call</kbd> and <kbd class="calibre15">apply</kbd> methods to get around it. In this section, you’ll see two other options: arrow functions and the <kbd class="calibre15">bind</kbd> method, which can, in certain cases, achieve the same effect, but in a much more elegant way.
      </p>
      
      
      <h4 id="ch04lev2sec7" class="calibre26">4.3.1. <a id="ch04lev2sec7__title" class="calibre4"></a>Using arrow functions to get around function contexts
      </h4>
      
      <p class="noind">Besides allowing us to create functions in a more elegant way than standard function declarations and function expressions,
         the arrow functions introduced in the previous chapter have one feature that makes them particularly good as callback functions:
         Arrow functions don’t have their own <kbd class="calibre15">this</kbd> value. Instead, they remember the value of the <kbd class="calibre15">this</kbd> parameter at the time of their definition. Let’s revisit our problem with button-click callbacks in the following listing.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch04ex13" class="notetitle">Listing 4.13. <a id="ch04ex13__title" class="calibre4"></a>Using arrow functions to work around callback function contexts
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/084fig01_alt.jpg" alt="" class="calibre2" width="590" height="239" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/084fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1143" class="calibre4"></a>The only change, when compared to <a href="#ch04ex10" class="calibre4">listing 4.10</a>, is that <a href="#ch04ex13" class="calibre4">listing 4.13</a> uses an arrow function:
      </p>
      
      <pre id="PLd0e9050" class="calibre5">this.click = () = &gt; {
  this.clicked = true;
  assert(button.clicked, "The button has been clicked");
};</pre>
      
      <p class="noind">Now, if we run the code, we’ll get the output shown in <a href="#ch04fig06" class="calibre4">figure 4.6</a>.
      </p>
      
      
      
      <h5 id="ch04fig06" class="notetitle">Figure 4.6. <a id="ch04fig06__title" class="calibre4"></a>Arrow functions don’t have their own context. Instead, the context is inherited from the function in which they’re defined.
         The <kbd class="calibre15">this</kbd> parameter in our arrow function callback refers to the button object.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig06.jpg" alt="" class="calibre2" width="388" height="244" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig06.jpg"></p>
      
      
      
      <p class="noind">As you can see, all is well now. The button object keeps track of the <kbd class="calibre15">clicked</kbd> state. What happened is that our click handler was created inside the <kbd class="calibre15">Button</kbd> constructor as an arrow function:
      </p>
      
      <pre id="PLd0e9087" class="calibre5">function Button(){
    this.clicked = false;
    this.click = <b class="calibre21">() =&gt;</b> {
      this.clicked = true;
      assert(button.clicked, "The button has been clicked");
    };
}</pre>
      
      <p class="noind"><a id="iddle1190" class="calibre4"></a><a id="iddle1810" class="calibre4"></a>As we already mentioned, arrow functions don’t get their own implicit <kbd class="calibre15">this</kbd> parameter when we call them; instead they remember the value of the <kbd class="calibre15">this</kbd> parameter at the time they were created. In our case, the <kbd class="calibre15">click</kbd> arrow function was created inside a constructor function, where the <kbd class="calibre15">this</kbd> parameter is the newly constructed object, so whenever we (or the browser) call the <kbd class="calibre15">click</kbd> function, the value of the <kbd class="calibre15">this</kbd> parameter will always be bound to the newly constructed button object.
      </p>
      
      
      <h5 id="ch04lev3sec8" class="notetitle"><a id="ch04lev3sec8__title" class="calibre4"></a>Caveat: Arrow functions and object literals
      </h5>
      
      <p class="noind">Because the value of the <kbd class="calibre15">this</kbd> parameter is picked up at the moment that the arrow function is created, some seemingly strange behaviors can result. Let’s
         go back to our button-click handler example. Let’s say we’ve come to the conclusion that we don’t need a constructor function,
         because we have only one button. We replace it with a simple object literal, in the following way.
      </p>
      
      
      
      <h5 id="ch04ex14" class="notetitle">Listing 4.14. <a id="ch04ex14__title" class="calibre4"></a>Arrow functions and object literals
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/085fig01_alt.jpg" alt="" class="calibre2" width="590" height="246" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/085fig01_alt.jpg"></p>
      
      
      <p class="noind">If we run <a href="#ch04ex14" class="calibre4">listing 4.14</a>, we’ll again be disappointed, because the <kbd class="calibre15">button</kbd> object has once more failed to track the <kbd class="calibre15">clicked</kbd> state. See <a href="#ch04fig07" class="calibre4">figure 4.7</a>.
      </p>
      
      
      
      <h5 id="ch04fig07" class="notetitle">Figure 4.7. <a id="ch04fig07__title" class="calibre4"></a>If an arrow function is defined within an object literal that’s defined in global code, the value of the <kbd class="calibre15">this</kbd> parameter associated with the arrow function is the global <kbd class="calibre15">window</kbd> object.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig07.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/04fig07.jpg"></p>
      
      
      
      <p class="noind"><a id="iddle1122" class="calibre4"></a><a id="iddle1522" class="calibre4"></a><a id="iddle1557" class="calibre4"></a>Luckily, we’ve scattered a couple of assertions throughout our code that will help. For example, we’ve placed the following
         directly in global code, in order to check the value of the <kbd class="calibre15">this</kbd> parameter:
      </p>
      
      <pre id="PLd0e9224" class="calibre5">assert(this === window, "this === window");</pre>
      
      <p class="noind">Because the assertion passes, we can be sure that in global code <kbd class="calibre15">this</kbd> refers to the global <kbd class="calibre15">window</kbd> object.
      </p>
      
      <p class="noind">We follow this by specifying that the <kbd class="calibre15">button</kbd> object literal has a <kbd class="calibre15">click</kbd> arrow function property:
      </p>
      
      <pre id="PLd0e9248" class="calibre5">var button = {
  clicked: false,
  click: () =&gt; {
    this.clicked = true;
    assert(button.clicked,"The button has been clicked");
    assert(this === window, "In arrow function this === window");
    assert(window.clicked, "Clicked is stored in window");
  };
}</pre>
      
      <p class="noind">Now, we’ll again revisit our little rule: <i class="calibre6">Arrow functions pick up the value of the</i> <kbd class="calibre15">this</kbd> <i class="calibre6">parameter at the moment of their creation</i>. Because the <kbd class="calibre15">click</kbd> arrow function is created as a property value on an object literal, and the object literal is created in global code, the
         <kbd class="calibre15">this</kbd> value of the arrow function will be the <kbd class="calibre15">this</kbd> value of the global code. And, as we’ve seen from the first assertion placed in our global code
      </p>
      
      <pre id="PLd0e9275" class="calibre5">assert(this === window, "this === window");</pre>
      
      <p class="noind">the value of the <kbd class="calibre15">this</kbd> parameter in global code is the global <kbd class="calibre15">window</kbd> object. Therefore, our <kbd class="calibre15">clicked</kbd> property will be defined on the global <kbd class="calibre15">window</kbd> object, and not on our <kbd class="calibre15">button</kbd> object. Just to be sure, in the end, we check that the <kbd class="calibre15">window</kbd> object has been assigned a <kbd class="calibre15">clicked</kbd> property:
      </p>
      
      <pre id="PLd0e9305" class="calibre5">assert(window.clicked, "Clicked is stored in window");</pre>
      
      <p class="noind">As you can see, failing to keep in mind all the consequences of arrow functions can lead to some subtle bugs, so be careful!</p>
      
      <p class="noind">Now that we’ve explored how arrow functions can be used to circumvent the problem of function contexts, let’s continue with
         another method for fixing the same problem.
      </p>
      
      
      
      
      <h4 id="ch04lev2sec8" class="calibre26">4.3.2. <a id="ch04lev2sec8__title" class="calibre4"></a>Using the bind method
      </h4>
      
      <p class="noind">In this chapter, you’ve already met two methods that every function has access to, <kbd class="calibre15">call</kbd> and <kbd class="calibre15">apply</kbd>, and you’ve seen how to use them for greater control over the context and arguments of our function invocations.
      </p>
      
      <p class="noind">In addition to these methods, every function has access to the <kbd class="calibre15">bind</kbd> method that, in short, creates a new function. This function has the same body, but its context is <i class="calibre6">always</i> bound to a certain object, <i class="calibre6">regardless</i> of the way we invoke it.
      </p>
      
      <p class="noind">Let’s revisit our little problem with button-click handlers one last time.</p>
      
      
      
      <h5 id="ch04ex15" class="notetitle">Listing 4.15. <a id="ch04ex15__title" class="calibre4"></a>Binding a specific context to an event handler
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/087fig01_alt.jpg" alt="" class="calibre2" width="590" height="266" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/087fig01_alt.jpg"></p>
      
      
      <p class="noind">The secret sauce added here is the <kbd class="calibre15">bind()</kbd> method:
      </p>
      
      <pre id="PLd0e9366" class="calibre5">elem.addEventListener("click", <b class="calibre21">button.click.bind(button)</b>);</pre>
      
      <p class="noind">The <kbd class="calibre15">bind</kbd> method is available to all functions, and is designed to <i class="calibre6">create</i> and return a <i class="calibre6">new</i> function that’s bound to the passed-in object (in this case, the <kbd class="calibre15">button</kbd> object). The value of the <kbd class="calibre15">this</kbd> parameter is always set to that object, regardless of the way the bound function was invoked. Apart from that, the bound
         function behaves like the originating function, because it has the same code in its body.
      </p>
      
      <p class="noind">Whenever the button is clicked, that bound function will be invoked with the <kbd class="calibre15">button</kbd> object as its context, because we’ve used that <kbd class="calibre15">button</kbd> object as an argument to <kbd class="calibre15">bind</kbd>.
      </p>
      
      <p class="noind">Note that calling the <kbd class="calibre15">bind</kbd> method doesn’t modify the original function. It creates a completely new function, a fact asserted at the end of the example:
      </p>
      
      <pre id="PLd0e9411" class="calibre5">var boundFunction = button.click.bind(button);
assert(boundFunction != button.click,
           "Calling bind creates a completly new function");</pre>
      
      <p class="noind">With this, we’ll end our exploration of the function context. Rest for now, because in the next chapter, we’ll be dealing
         with one of the most important concepts in JavaScript: closures.
      </p>
      
      
      
      
      
      <h3 id="ch04lev1sec4" class="calibre24"><a id="ch04lev1sec4__title" class="calibre3"></a>4.4. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">When invoking a function, in addition to the parameters explicitly stated in the function definition, function invocations
            are passed in two implicit parameters: <kbd class="calibre15">arguments</kbd> and <kbd class="calibre15">this</kbd>:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">The <kbd class="calibre15">arguments</kbd> parameter is a collection of arguments passed to the function. It has a <kbd class="calibre15">length</kbd> property that indicates how many arguments were passed in, and it enables us to access the values of arguments that don’t
                  have matching parameters. In nonstrict mode, the <kbd class="calibre15">arguments</kbd> object aliases the function parameters (changing the argument changes the value of the parameter, and vice versa). This can
                  be avoided by using strict mode.
                  
               </li>
               
               <li class="calibre20">The <kbd class="calibre15">this</kbd> parameter represents the function context, an object to which the function invocation is associated. How <kbd class="calibre15">this</kbd> is determined can depend on the way a function is defined as well as on how it’s invoked.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">A function can be invoked in four ways:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">As a function: <kbd class="calibre15">skulk()</kbd>
                  
               </li>
               
               <li class="calibre20">As a method: <kbd class="calibre15">ninja.skulk()</kbd>
                  
               </li>
               
               <li class="calibre20">As a constructor: <kbd class="calibre15">new Ninja()</kbd>
                  
               </li>
               
               <li class="calibre20">Via its <kbd class="calibre15">apply</kbd> and <kbd class="calibre15">call</kbd> methods: <kbd class="calibre15">skulk.call(ninja)</kbd> or <kbd class="calibre15">skulk.apply(ninja)</kbd>
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">The way a function is invoked influences the value of the <kbd class="calibre15">this</kbd> parameter:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">If a function is invoked as a function, the value of the <kbd class="calibre15">this</kbd> parameter is usually the global <kbd class="calibre15">window</kbd> object in nonstrict mode, and <kbd class="calibre15">undefined</kbd> in strict mode.
                  
               </li>
               
               <li class="calibre20">If a function is invoked as a method, the value of the <kbd class="calibre15">this</kbd> parameter is usually the object on which the function was invoked.
                  
               </li>
               
               <li class="calibre20">If a function is invoked as a constructor, the value of the <kbd class="calibre15">this</kbd> parameter is the newly constructed object.
                  
               </li>
               
               <li class="calibre20">If a function is invoked through <kbd class="calibre15">call</kbd> and <kbd class="calibre15">apply</kbd>, the value of the <kbd class="calibre15">this</kbd> parameter is the first argument supplied to <kbd class="calibre15">call</kbd> and <kbd class="calibre15">apply</kbd>.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">Arrow functions don’t have their own value of the <kbd class="calibre15">this</kbd> parameter. Instead, they pick it up at the moment of their creation.
            
         </li>
         
         <li class="calibre20">Use the <kbd class="calibre15">bind</kbd> method, available to all functions, to create a new function that’s always bound to the argument of the <kbd class="calibre15">bind</kbd> method. In all other aspects, the bound function behaves as the original function.
            
         </li>
         
      </ul>
      
      
      
      <h3 id="ch04lev1sec5" class="calibre24"><a id="ch04lev1sec5__title" class="calibre3"></a>4.5. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch04qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch04qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch04qa2q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">The following function calculates the sum of the passed-in arguments by using the <kbd class="calibre15">arguments</kbd> object:
            </p>
            
            <pre id="PLd0e9615" class="calibre5">function sum(){
  var sum = 0;
  for(var i = 0; i &lt; arguments.length; i++){
     sum += arguments[i];
  }
  return sum;
}

assert(sum(1, 2, 3) === 6, 'Sum of first three numbers is 6');
assert(sum(1, 2, 3, 4) === 10, 'Sum of first four numbers is 10');</pre>
            
            <p class="noind">By using the rest parameters introduced in the previous chapter, rewrite the <kbd class="calibre15">sum</kbd> function so that it doesn’t use the <kbd class="calibre15">arguments</kbd> object.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch04qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch04qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind">After running the following code, what are the values of variables <kbd class="calibre15">ninja</kbd> and <kbd class="calibre15">samurai</kbd>?
            </p>
            
            <pre id="PLd0e9645" class="calibre5">function getSamurai(samurai){
  "use strict"

  arguments[0] = "Ishida";

  return samurai;
}

function getNinja(ninja){
  arguments[0] = "Fuma";
  return ninja;
}

var samurai = getSamurai("Toyotomi");
var ninja = getNinja("Yoshi");</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch04qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch04qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">When running the following code, which of the assertions will pass?</p>
            
            <pre id="PLd0e9658" class="calibre5">function whoAmI1(){
  "use strict";
  return this;
}

function whoAmI2(){
  return this;
}

assert(whoAmI1() === window, "Window?");
assert(whoAmI2() === window, "Window?");</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch04qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch04qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">When running the following code, which of the assertions will pass?</p>
            
            <pre id="PLd0e9671" class="calibre5">var ninja1 = {
   whoAmI: function(){
     return this;
   }
};

var ninja2 = {
  whoAmI: ninja1.whoAmI
};
var identify = ninja2.whoAmI;

assert(ninja1.whoAmI() === ninja1, "ninja1?");
assert(ninja2.whoAmI() === ninja1, " ninja1 again?");

assert(identify() === ninja1, "ninja1 again?");

assert(ninja1.whoAmI.call(ninja2) === ninja2, "ninja2 here?");</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch04qa2qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch04qa2q5" class="calibre4"></a><b class="calibre21">5 </b></p><p class="noind">When running the following code, which of the assertions will pass?</p>
            
            <pre id="PLd0e9686" class="calibre5">function Ninja(){
  this.whoAmI = () =&gt; this;
}

var ninja1 = new Ninja();
var ninja2 = {
  whoAmI: ninja1.whoAmI
};


assert(ninja1.whoAmI() === ninja1, "ninja1 here?");
assert(ninja2.whoAmI() === ninja2, "ninja2 here?");</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch04qa2qe6" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch04qa2q6" class="calibre4"></a><b class="calibre21">6 </b></p><p class="noind">Which of the following assertions will pass?</p>
            
            <pre id="PLd0e9699" class="calibre5">function Ninja(){
  this.whoAmI = function(){
    return this;
  }.bind(this);
}

var ninja1 = new Ninja();
var ninja2 = {
  whoAmI: ninja1.whoAmI
};


assert(ninja1.whoAmI() === ninja1, "ninja1 here?");
assert(ninja2.whoAmI() === ninja2, "ninja2 here?");</pre>
            <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_23"></div>
<h2 id="ch05" class="part">Chapter 5. <a id="ch05__title" class="calibre3"></a>Functions for the master: closures and scopes
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Using closures to simplify development
            
         </li>
         
         <li class="calibre20">Tracking the execution of JavaScript programs with execution contexts
            
         </li>
         
         <li class="calibre20">Tracking variable scopes with lexical environments
            
         </li>
         
         <li class="calibre20">Understanding types of variables
            
         </li>
         
         <li class="calibre20">Exploring how closures work
            
         </li>
         
      </ul>
      
      <p class="noind">Closely tied to the functions we learned about in previous chapters, closures are a defining feature of JavaScript. Although
         scores of JavaScript developers can write code without understanding the benefits of closures, their use can not only help
         us reduce the amount and complexity of code needed to add advanced features, but also enable us to do things that otherwise
         wouldn’t be possible, or would be too complex to be feasible. For example, any tasks involving callbacks, such as event handling
         or animations, would be significantly more complex without closures. Others, such as providing support for private object
         variables, would be outright <a id="iddle1200" class="calibre4"></a><a id="iddle1989" class="calibre4"></a>impossible. The landscape of the language and the way we write our code is forever shaped by the inclusion of closures.
      </p>
      
      <p class="noind">Traditionally, closures have been a feature of purely functional programming languages. Seeing them cross over into mainstream
         development is encouraging. It’s common to find closures permeating JavaScript libraries, along with other advanced code bases,
         because of their ability to drastically simplify complex operations.
      </p>
      
      <p class="noind">Closures are a side effect of how scopes work in JavaScript. For this reason, we’ll explore the scoping rules of JavaScript,
         with a special focus on recent additions. This will help you understand how closures work behind the scenes. Let’s jump right
         in!
      </p>
      
      <h3 class="calibre24"><a id="ch05qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch05qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch05qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">How many different scopes can a variable or method have, and what are they?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch05qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch05qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">How are identifiers and their values tracked?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch05qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch05qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">What is a mutable variable, and how do you define one in JavaScript?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch05lev1sec1" class="calibre24"><a id="ch05lev1sec1__title" class="calibre3"></a>5.1. Understanding closures
      </h3>
      
      <p class="noind">A <i class="calibre6">closure</i> allows a function to access and manipulate variables that are external to that function. Closures allow a function to access
         all the variables, as well as other functions, that are in scope when the function itself is defined.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch05note01" class="notetitle">Note</h5>
      
      
      <p class="noindclose">You’re probably familiar with the concept of scopes, but just in case, a <i class="calibre6">scope</i> refers to the visibility of identifiers in certain parts of a program. A scope is a part of the program in which a certain
         name is bound to a certain variable.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">That may seem intuitive until you remember that a declared function can be called at any later time, even <i class="calibre6">after</i> the scope in which it was declared has gone away. This concept is probably best explained through code. But before we get
         into concrete examples that will help you develop more elegant animations in code or to define private object properties,
         let’s start small, with the following listing.
      </p>
      
      
      
      <h5 id="ch05ex01" class="notetitle">Listing 5.1. <a id="ch05ex01__title" class="calibre4"></a>A simple closure
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/092fig01_alt.jpg" alt="" class="calibre2" width="590" height="78" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/092fig01_alt.jpg"></p>
      
      
      <p class="noind">In this code example, we declare a variable <kbd class="calibre15">outerValue</kbd> and a function <kbd class="calibre15">outerFunction</kbd> in the same scope—in this case, the global scope. Afterward, we call <kbd class="calibre15">outerFunction</kbd>.
      </p>
      
      <p class="noind">As you can see in <a href="#ch05fig01" class="calibre4">figure 5.1</a>, the function is able to “see” and access the <kbd class="calibre15">outerValue</kbd> variable. You’ve likely written code such as this hundreds of times without realizing that you were creating a closure!
      </p>
      
      
      
      <h5 id="ch05fig01" class="notetitle">Figure 5.1. <a id="ch05fig01__title" class="calibre4"></a>Our function has found the ninja, who was hiding in plain sight.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig01.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig01.jpg"></p>
      
      
      
      <p class="noind">Not impressed? Guess that’s not surprising. Because both <kbd class="calibre15">outerValue</kbd> and <kbd class="calibre15">outerFunction</kbd> are declared in global scope, that scope (which is a closure) never goes away (as long as our application is running). It’s
         not surprising that the function can access the variable, because it’s still in scope and viable.
      </p>
      
      <p class="noind">Even though the closure exists, its benefits aren’t yet clear. Let’s spice it up in the next listing.</p>
      
      
      
      <h5 id="ch05ex02" class="notetitle">Listing 5.2. <a id="ch05ex02__title" class="calibre4"></a>Another closure example
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/093fig01_alt.jpg" alt="" class="calibre2" width="590" height="280" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/093fig01_alt.jpg"></p>
      
      
      <p class="noind">Let’s overanalyze the code in <kbd class="calibre15">innerFunction</kbd> and see whether we can predict what might happen:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The first <kbd class="calibre15">assert</kbd> is certain to pass; <kbd class="calibre15">outerValue</kbd> is in the global scope and is visible to everything. But what about the second <kbd class="calibre15">assert</kbd>?
            
         </li>
         
         <li class="calibre20">We’re executing <kbd class="calibre15">innerFunction</kbd> <i class="calibre6">after</i> <kbd class="calibre15">outerFunction</kbd> has been executed via the trick of copying a reference to the function to the global variable <kbd class="calibre15">later</kbd>.
            
         </li>
         
         <li class="calibre20">When <kbd class="calibre15">innerFunction</kbd> executes, the scope inside the outer function is long gone and not visible at the point at which we’re invoking the function
            through <kbd class="calibre15">later</kbd>.
            
         </li>
         
         <li class="calibre20">So we could very well expect <kbd class="calibre15">assert</kbd> to fail, as <kbd class="calibre15">innerValue</kbd> is sure to be <kbd class="calibre15">undefined</kbd>. Right?
            
         </li>
         
      </ul>
      
      <p class="noind">But when we run the test, we see the display in <a href="#ch05fig02" class="calibre4">figure 5.2</a>.
      </p>
      
      
      
      <h5 id="ch05fig02" class="notetitle">Figure 5.2. <a id="ch05fig02__title" class="calibre4"></a>Despite trying to hide inside a function, the ninja has been detected!
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig02.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig02.jpg"></p>
      
      
      
      <p class="noind">How can that be? What magic allows the <kbd class="calibre15">innerValue</kbd> variable to still be “alive” when we execute the inner function, long after the scope in which it was created has gone away?
         The answer is closures.
      </p>
      
      <p class="noind">When we declare <kbd class="calibre15">innerFunction</kbd> inside the outer function, not only is the function declaration defined, but a closure is created that encompasses the function
         definition as well as all variables in scope <i class="calibre6">at the point of function definition</i>. When <kbd class="calibre15">innerFunction</kbd> eventually executes, even if it’s executed <i class="calibre6">after</i> the scope in which it was declared goes away, it has access to the original scope in which it was declared through its closure,
         as shown in <a href="#ch05fig03" class="calibre4">figure 5.3</a>.
      </p>
      
      
      
      <h5 id="ch05fig03" class="notetitle">Figure 5.3. <a id="ch05fig03__title" class="calibre4"></a>Like a protective bubble, the closure for <kbd class="calibre15">innerFunction</kbd> keeps the variables in the function’s scope alive for as long as the function exists.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig03.jpg" alt="" class="calibre2" width="432" height="431" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig03.jpg"></p>
      
      
      
      <p class="noind">That’s what closures are all about. They create a “safety bubble” of the function and the variables in scope at the point
         of the function’s definition, so that the function has all it needs to execute. This bubble, containing the function and its
         variables, stays around as long as the function does.
      </p>
      
      <p class="noind">Although all this structure isn’t readily visible (there’s no “closure” object holding all of this information that you can
         inspect), storing and referencing information in this way has a direct cost. It’s important to remember that each function
         that accesses information via a closure has a “ball and chain” attached to it, carrying this information around. So although
         closures are incredibly useful, they aren’t free of overhead. All that information needs to be held in memory until it’s <a id="iddle1037" class="calibre4"></a><a id="iddle1201" class="calibre4"></a><a id="iddle1877" class="calibre4"></a>absolutely clear to the JavaScript engine that it’s no longer needed (and is safe to garbage-collect), or until the page unloads.
      </p>
      
      <p class="noind">Don’t worry; this isn’t all that we have to say about how closures work. But before exploring the mechanisms that enable closures,
         let’s look at their practical uses.
      </p>
      
      
      
      <h3 id="ch05lev1sec2" class="calibre24"><a id="ch05lev1sec2__title" class="calibre3"></a>5.2. Putting closures to work
      </h3>
      
      <p class="noind">Now that we have a high-level understanding of closures, let’s see how to put them to work in our JavaScript applications.
         For now, we’ll focus on their practical aspects and benefits. Later in the chapter, we’ll revisit the same examples to see
         exactly what’s going on behind the scenes.
      </p>
      
      
      <h4 id="ch05lev2sec1" class="calibre26">5.2.1. <a id="ch05lev2sec1__title" class="calibre4"></a>Mimicking private variables
      </h4>
      
      <p class="noind">Many programming languages use <i class="calibre6">private variables</i>—properties of an object that are hidden from outside parties. This is a useful feature, because we don’t want to overburden
         the users of our objects with unnecessary implementation details when accessing those objects from other parts of the code.
         Unfortunately, JavaScript doesn’t have native support for private variables. But by using a closure, we can achieve an acceptable
         approximation, as demonstrated by the following code.
      </p>
      
      <h5 id="ch05ex03" class="notetitle">Listing 5.3. <a id="ch05ex03__title" class="calibre4"></a>Using closures to approximate private variables
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex03-0.jpg" alt="" class="calibre2" width="590" height="171" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex03-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex03-1.jpg" alt="" class="calibre2" width="590" height="217" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex03-1.jpg"></p>
      
      <p class="noind"><a id="iddle1158" class="calibre4"></a><a id="iddle1204" class="calibre4"></a><a id="iddle1623" class="calibre4"></a>Here we create a function, <kbd class="calibre15">Ninja</kbd>, to serve as a constructor. We introduced using a function as a constructor in <a href="kindle_split_014.html#ch03" class="calibre4">chapter 3</a> (and we’ll take an in-depth look in <a href="kindle_split_019.html#ch07" class="calibre4">chapter 7</a>). For now, recall that when using the <kbd class="calibre15">new</kbd> keyword on a function, a new object instance is created, and the function is called with that new object as its context,
         to serve as a constructor to that object. So <kbd class="calibre15">this</kbd> within the function refers to a newly instantiated object.
      </p>
      
      <p class="noind">Within the constructor, we define a variable to hold state, <kbd class="calibre15">feints</kbd>. The JavaScript scoping rules for this variable limit its accessibility to <i class="calibre6">within</i> the constructor. To give access to the value of the variable from code that’s outside the scope, we define an <i class="calibre6">accessor</i> method: <kbd class="calibre15">getFeints</kbd>, which can be used to read the private variable. (Accessor methods are frequently called <i class="calibre6">getters</i>.)
      </p>
      
      <pre id="PLd0e10144" class="calibre5">function Ninja() {
  var feints = 0;
  this.getFeints = function(){
    return feints;
  };
  this.feint = function(){
    feints++;
  };
 }</pre>
      
      <p class="noind">An implementation method, <kbd class="calibre15">feint</kbd>, is then created to give us control over the value of the variable. In a real-world application, this might be a business
         method, but in this example, it merely increments the value of <kbd class="calibre15">feints</kbd>.
      </p>
      
      <p class="noind">After the constructor has done its duty, we can call the <kbd class="calibre15">feint</kbd> method on the newly created <kbd class="calibre15">ninja1</kbd> object:
      </p>
      
      <pre id="PLd0e10168" class="calibre5">var ninja1 = new Ninja();
ninja1.feint();</pre>
      
      <p class="noind">Our tests show that we can use the accessor method to obtain the value of the private variable but that we can’t access it
         directly. This prevents us from being able to make uncontrolled changes to the value of the variable, just as if it were a
         true private variable. This situation is depicted in <a href="#ch05fig04" class="calibre4">figure 5.4</a>.
      </p>
      
      
      
      <h5 id="ch05fig04" class="notetitle">Figure 5.4. <a id="ch05fig04__title" class="calibre4"></a>Hiding the variable inside the constructor keeps it invisible to the outer scope, but where it counts, the variable is alive
         and well, protected by the closure.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig04_alt.jpg" alt="" class="calibre2" width="590" height="501" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig04_alt.jpg"></p>
      
      
      <p class="noind">Using closures allows the state of the ninja to be maintained within a method, without letting it be directly accessed by
         a user of the method—because the variable is available to the inner methods via their closures, but not to code that lies
         outside the constructor.
      </p>
      
      <p class="noind">This is a glimpse into the world of object-oriented JavaScript, which we’ll explore in greater depth in <a href="kindle_split_019.html#ch07" class="calibre4">chapter 7</a>. For now, let’s focus on another common use of closures.
      </p>
      
      
      
      <h4 id="ch05lev2sec2" class="calibre26">5.2.2. <a id="ch05lev2sec2__title" class="calibre4"></a>Using closures with callbacks
      </h4>
      
      <p class="noind">Another common use of closures occurs when dealing with callbacks—when a function is called at an unspecified later time.
         Often, within such functions, we frequently need to access outside data. The following listing shows an example that creates
         a simple animation with callback timers.
      </p>
      
      <h5 id="ch05ex04" class="notetitle">Listing 5.4. <a id="ch05ex04__title" class="calibre4"></a>Using a closure in a timer interval callback
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex04-0.jpg" alt="" class="calibre2" width="590" height="131" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex04-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex04-1.jpg" alt="" class="calibre2" width="590" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex04-1.jpg"></p>
      
      <p class="noind"><a id="iddle1380" class="calibre4"></a><a id="iddle2018" class="calibre4"></a><a id="iddle2124" class="calibre4"></a>What’s especially important about this code is that it uses a single anonymous function, placed as a <kbd class="calibre15">setInterval</kbd> argument, to accomplish the animation of the target <kbd class="calibre15">div</kbd> element. That function accesses three variables: <kbd class="calibre15">elem</kbd>, <kbd class="calibre15">tick</kbd>, and <kbd class="calibre15">timer</kbd>, via a closure, to control the animation process. The three variables (the reference to the DOM element, <kbd class="calibre15">elem;</kbd> the tick counter, <kbd class="calibre15">tick;</kbd> and the timer reference, <kbd class="calibre15">timer</kbd>) all must be maintained <i class="calibre6">across</i> the steps of the animation. And we need to keep them out of the global scope.
      </p>
      
      <p class="noind">But the example will still work fine if we move the variables out of the <kbd class="calibre15">animateIt</kbd> function and into the global scope. So why all the arm flailing about not polluting the global scope?
      </p>
      
      <p class="noind">Go ahead and move the variables into the global scope and verify that the example still works. Now modify the example to animate
         two elements: Add another element with a unique ID, and call the <kbd class="calibre15">animateIt</kbd> function with that ID right after the original call.
      </p>
      
      <p class="noind">The problem immediately becomes obvious. If we keep the variables in the global scope, we need a set of three variables for
         <i class="calibre6">each</i> animation. Otherwise, they’ll step all over each other, trying to use the same set of variables to keep track of multiple
         states.
      </p>
      
      <p class="noind">By defining the variables <i class="calibre6">inside</i> the function, and by relying on closures to make them available to the timer callback invocations, each animation gets its
         own private “bubble” of variables, as shown in <a href="#ch05fig05" class="calibre4">figure 5.5</a>.
      </p>
      
      
      
      <h5 id="ch05fig05" class="notetitle">Figure 5.5. <a id="ch05fig05__title" class="calibre4"></a>By keeping the variables for multiple instances of the function separate, we can do many things at once.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig05_alt.jpg" alt="" class="calibre2" width="590" height="686" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig05_alt.jpg"></p>
      
      
      <p class="noind">Without closures, doing multiple things at once, whether event handling, animations, or even server requests, would be incredibly
         difficult. If you’ve been waiting for a reason to care about closures, this is it!
      </p>
      
      <p class="noind">This example is a particularly good one for demonstrating how closures are capable of producing some surprisingly intuitive
         and concise code. By including the variables in the <kbd class="calibre15">animateIt</kbd> function, we create an implied closure without needing any complex syntax.
      </p>
      
      <p class="noind">There’s another important concept that this example makes clear. Not only can we see the values that these variables had at
         the time the closure was created, but we can update them within the closure while the function within the closure executes.
         The closure isn’t just a snapshot of the state of the scope at the time of creation, but an active encapsulation of that state
         that we can modify as long as the closure exists.
      </p>
      
      <p class="noind"><a id="iddle1203" class="calibre4"></a><a id="iddle1440" class="calibre4"></a><a id="iddle1518" class="calibre4"></a><a id="iddle1528" class="calibre4"></a><a id="iddle1625" class="calibre4"></a>Closures are closely related to scopes, so we’ll spend a good deal of this chapter exploring scoping rules in JavaScript.
         But first, we’ll start with the details of how code execution is tracked in JavaScript.
      </p>
      
      
      
      
      <h3 id="ch05lev1sec3" class="calibre24"><a id="ch05lev1sec3__title" class="calibre3"></a>5.3. Tracking code execution with execution contexts
      </h3>
      
      <p class="noind">In JavaScript, the fundamental unit of execution is a function. We use them all the time, to calculate something, to perform
         side effects such as changing the UI, to achieve code reuse, or to make our code easier to understand. To fulfill its purpose,
         a function can call another function, which in turn can call another function, and so on. And when a function does its thing,
         our program execution has to return to the position from which the function was called. But have you ever wondered how the
         JavaScript engine keeps track of all these executing functions and return positions?
      </p>
      
      <p class="noind">As we mentioned in <a href="kindle_split_012.html#ch02" class="calibre4">chapter 2</a>, there are two main types of JavaScript code: <i class="calibre6">global code</i>, placed outside all functions, and <i class="calibre6">function code</i>, contained in functions. When our code is being executed by the JavaScript engine, each statement is executed in a certain
         <i class="calibre6">execution context.</i></p>
      
      <p class="noind">And just as we have two types of code, we have two types of execution contexts: a <i class="calibre6">global execution context</i> and a <i class="calibre6">function execution context</i>. Here’s the significant difference: <a id="iddle1145" class="calibre4"></a><a id="iddle1526" class="calibre4"></a><a id="iddle2055" class="calibre4"></a>There’s only <i class="calibre6">one</i> global execution context, created when our JavaScript program starts executing, whereas a <i class="calibre6">new</i> function execution context is created on <i class="calibre6">each</i> function invocation.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch05note02" class="notetitle">Note</h5>
      
      
      <p class="noindclose">You may recall from <a href="kindle_split_015.html#ch04" class="calibre4">chapter 4</a> that <i class="calibre6">function context</i> is the object on which our function is invoked, which can be accessed through the <kbd class="calibre15">this</kbd> keyword. An execution context, although it has a similar name, is a completely different thing. It’s an internal JavaScript
         concept that the JavaScript engine uses to track the execution of our functions.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">As we mentioned in <a href="kindle_split_012.html#ch02" class="calibre4">chapter 2</a>, JavaScript is based on a single-threaded execution model: Only one piece of code can be executed at a time. Every time a
         function is invoked, the current execution context has to be stopped, and a new function execution context, in which the function
         code will be evaluated, has to be created. After the function performs its task, its function execution context is usually
         discarded, and the caller execution context restored. So there’s a need to keep track of all these execution contexts—both
         the one that’s executing and the ones that are patiently waiting. The easiest way to do this is by using a <i class="calibre6">stack</i>, called the <i class="calibre6">execution context stack</i> (or often called a <i class="calibre6">call stack</i>).
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch05note03" class="notetitle">Note</h5>
      
      
      <p class="noindclose">A stack is a fundamental data structure in which you can put new items only to the top and can take existing items only from
         the top. Think of a stack of trays in a cafeteria. When you want to take one, you pick one from the top. And a cafeteria worker
         who has a new clean one also puts it on the top.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">This might seem vague, so let’s look at the following code, which reports the activity of two skulking ninjas.</p>
      
      
      
      <h5 id="ch05ex05" class="notetitle">Listing 5.5. <a id="ch05ex05__title" class="calibre4"></a>The creation of execution contexts
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/100fig01_alt.jpg" alt="" class="calibre2" width="590" height="206" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/100fig01_alt.jpg"></p>
      
      
      <p class="noind">This code is straightforward; we define the <kbd class="calibre15">skulk</kbd> function, which calls the <kbd class="calibre15">report</kbd> function, which outputs a message. Then, from global code, we make two separate calls to the <kbd class="calibre15">skulk</kbd> function: <kbd class="calibre15">skulk("Kuma")</kbd> and <kbd class="calibre15">skulk("Yoshi")</kbd>. By using this code as a basis, we’ll explore the creation of execution contexts, as shown in <a href="#ch05fig06" class="calibre4">figure 5.6</a>.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch05fig06" class="notetitle">Figure 5.6. <a id="ch05fig06__title" class="calibre4"></a>The behavior of the execution context stack
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig06_alt.jpg" alt="" class="calibre2" width="590" height="441" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig06_alt.jpg"></p>
      
      
      <p class="noind">When executing the example code, the execution context behaves as follows:</p>
      
      <p class="calibre18"></p>
      <ol class="calibre27">
         
         <li class="calibre20">The execution context stack starts with the global execution context that’s created only once per JavaScript program (once
            per page in the case of web pages). The global execution context is the active execution context when executing global code.
            
         </li>
         
         <li class="calibre20">In global code, the program first defines two functions: <kbd class="calibre15">skulk</kbd> and <kbd class="calibre15">report</kbd>, and then calls the <kbd class="calibre15">skulk</kbd> function with <kbd class="calibre15">skulk("Kuma")</kbd>. Because only one piece of code can be executed at once, the JavaScript engine pauses the execution of the global code, and
            goes to execute the <kbd class="calibre15">skulk</kbd> function code with <kbd class="calibre15">Kuma</kbd> as an argument. This is done by creating a <i class="calibre6">new</i> function execution context and pushing it on top of the stack.
            
         </li>
         
         <li class="calibre20">The <kbd class="calibre15">skulk</kbd> function, in turn, calls the <kbd class="calibre15">report</kbd> function with the argument <kbd class="calibre15">Kuma skulking</kbd>. Again, because only one piece of code can be executed at a time, the <kbd class="calibre15">skulk</kbd> execution context is paused, and a new function execution context for the <kbd class="calibre15">report</kbd> function, with the argument <kbd class="calibre15">Kuma skulking,</kbd> is created and pushed onto the stack.
            
         </li>
         
         <li class="calibre20"><a id="iddle1146" class="calibre4"></a><a id="iddle1175" class="calibre4"></a><a id="iddle1326" class="calibre4"></a><a id="iddle1654" class="calibre4"></a>After the <kbd class="calibre15">report</kbd> function logs the message by using the built-in <kbd class="calibre15">console.log</kbd> function (see <a href="kindle_split_030.html#app03" class="calibre4">appendix C</a>) and finishes its execution, we have to go back to the <kbd class="calibre15">skulk</kbd> function. This is done by popping the <kbd class="calibre15">report</kbd> function execution context from the stack. The <kbd class="calibre15">skulk</kbd> function execution context is then reactivated, and the execution of the <kbd class="calibre15">skulk</kbd> function continues.
            
         </li>
         
         <li class="calibre20">A similar thing happens when the <kbd class="calibre15">skulk</kbd> function finishes its execution: The function execution context of the <kbd class="calibre15">skulk</kbd> function is removed from the stack, and the global execution context, which has been patiently waiting this whole time, is
            restored as the active execution context. The execution of global JavaScript code is restored.
            
         </li>
         
      </ol>
      
      <p class="noind">This whole process is repeated in a similar way for the second call to the <kbd class="calibre15">skulk</kbd> function, now with the argument <kbd class="calibre15">Yoshi</kbd>. Two new function execution contexts are created and pushed to the stack, <kbd class="calibre15">skulk("Yoshi")</kbd> and <kbd class="calibre15">report("Yoshi skulking")</kbd>, when the respective functions are called. These execution contexts are also popped off the stack when the program returns
         from the matching function.
      </p>
      
      <p class="noind">Even though the execution context stack is an internal JavaScript concept, you can explore it in any JavaScript debugger,
         where it’s referred to as a <i class="calibre6">call stack.</i> <a href="#ch05fig07" class="calibre4">Figure 5.7</a> shows the call stack in Chrome DevTools.
      </p>
      
      
      
      <h5 id="ch05fig07" class="notetitle">Figure 5.7. <a id="ch05fig07__title" class="calibre4"></a>The current state of the execution context stack in Chrome DevTools
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig07_alt.jpg" alt="" class="calibre2" width="590" height="326" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig07_alt.jpg"></p>
      
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch05note04" class="notetitle">Note</h5>
      
      
      <p class="noindclose"><a href="kindle_split_030.html#app03" class="calibre4">Appendix C</a> gives a closer look at the debugging tools available in various browsers.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Besides keeping track of the position in the application execution, the execution context is vital in <i class="calibre6">identifier resolution</i>, the process of figuring out which variable a certain identifier refers to. The execution context does this via the <i class="calibre6">lexical environment.</i></p>
      
      
      
      
      <h3 id="ch05lev1sec4" class="calibre24"><a id="ch05lev1sec4__title" class="calibre3"></a>5.4. Keeping track of identifiers with lexical environments
      </h3>
      
      <p class="noind"><a id="iddle1199" class="calibre4"></a><a id="iddle1206" class="calibre4"></a><a id="iddle1246" class="calibre4"></a><a id="iddle1659" class="calibre4"></a><a id="iddle1725" class="calibre4"></a><a id="iddle2135" class="calibre4"></a>A <i class="calibre6">lexical environment</i> is an internal JavaScript engine construct used to keep track of the mapping from identifiers to specific variables. For
         example, consider the following code:
      </p>
      
      <pre id="PLd0e10733" class="calibre5">var ninja = "Hattori";
console.log(ninja);</pre>
      
      <p class="noind">The lexical environment is consulted when the <kbd class="calibre15">ninja</kbd> variable is accessed in the <kbd class="calibre15">console.log</kbd> statement.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch05note05" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Lexical environments are an internal implementation of the JavaScript scoping mechanism, and people often colloquially refer
         to them as <i class="calibre6">scopes</i>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Usually, a lexical environment is associated with a specific structure of JavaScript code. It can be associated with a function,
         a block of code, or the <kbd class="calibre15">catch</kbd> part of a <kbd class="calibre15">try-catch</kbd> statement. Each of these structures (functions, blocks, and <kbd class="calibre15">catch</kbd> parts) can have its own separate identifier mappings.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch05note06" class="notetitle">Note</h5>
      
      
      <p class="noindclose">In pre-ES6 versions of JavaScript, a lexical environment could be associated with only a function. Variables could be only
         function scoped. This caused a lot of confusion. Because JavaScript is a C-like language, people coming from other C-like
         languages (such as C++, C#, or Java) naturally expected some low-level concepts, such as the existence of block scopes, to
         be the same. With ES6, this is finally fixed.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      <h4 id="ch05lev2sec3" class="calibre26">5.4.1. <a id="ch05lev2sec3__title" class="calibre4"></a>Code nesting
      </h4>
      
      <p class="noind">Lexical environments are heavily based on <i class="calibre6">code nesting</i>, which enables one code structure to be contained within another. <a href="#ch05fig08" class="calibre4">Figure 5.8</a> shows various types of code nesting.
      </p>
      
      
      
      <h5 id="ch05fig08" class="notetitle">Figure 5.8. <a id="ch05fig08__title" class="calibre4"></a>Types of code nesting
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig08_alt.jpg" alt="" class="calibre2" width="590" height="237" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig08_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1376" class="calibre4"></a><a id="iddle1498" class="calibre4"></a><a id="iddle1841" class="calibre4"></a>In this example, we can see the following:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The <kbd class="calibre15">for</kbd> loop is nested within the <kbd class="calibre15">report</kbd> function.
            
         </li>
         
         <li class="calibre20">The <kbd class="calibre15">report</kbd> function is nested within the <kbd class="calibre15">skulk</kbd> function.
            
         </li>
         
         <li class="calibre20">The <kbd class="calibre15">skulk</kbd> function is nested within global code.
            
         </li>
         
      </ul>
      
      <p class="noind">In terms of scopes, each of these code structures gets an associated lexical environment <i class="calibre6">every</i> time the code is evaluated. For example, on every invocation of the <kbd class="calibre15">skulk</kbd> function, a new function lexical environment is created.
      </p>
      
      <p class="noind">In addition, it’s important to emphasize that an inner code structure has access to the variables defined in outer code structures;
         for example, the <kbd class="calibre15">for</kbd> loop can access variables from the <kbd class="calibre15">report</kbd> function, the <kbd class="calibre15">skulk</kbd> function, and the global code; the <kbd class="calibre15">report</kbd> function can access variables from the <kbd class="calibre15">skulk</kbd> function and the global code; and the <kbd class="calibre15">skulk</kbd> function can access only additional variables from the global code.
      </p>
      
      <p class="noind">There’s nothing special about this way of accessing variables; all of us have probably done it many times. But how does the
         JavaScript engine keep track of all these variables, and what’s accessible from where? This is where lexical environments
         jump in.
      </p>
      
      
      
      <h4 id="ch05lev2sec4" class="calibre26">5.4.2. <a id="ch05lev2sec4__title" class="calibre4"></a>Code nesting and lexical environments
      </h4>
      
      <p class="noind">In addition to keeping track of local variables, function declarations, and function parameters, each lexical environment
         has to keep track of its <i class="calibre6">outer</i> (parent) lexical environment. This is necessary because we have to be able to access variables defined in outer code structures;
         if an identifier can’t be found in the current environment, the outer environment is searched. This stops either when the
         matching variable is found, or with a reference error if we’ve reached the global environment and there’s no sign of the searched-for
         identifier. <a href="#ch05fig09" class="calibre4">Figure 5.9</a> shows an example; you can see how the identifiers <kbd class="calibre15">intro</kbd>, <kbd class="calibre15">action</kbd>, and <kbd class="calibre15">ninja</kbd> are resolved when executing the <kbd class="calibre15">report</kbd> function.
      </p>
      
      
      
      <h5 id="ch05fig09" class="notetitle">Figure 5.9. <a id="ch05fig09__title" class="calibre4"></a>How JavaScript engines resolve the values of variables
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig09_alt.jpg" alt="" class="calibre2" width="590" height="693" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig09_alt.jpg"></p>
      
      
      <p class="noind">In this example, the <kbd class="calibre15">report</kbd> function is called by the <kbd class="calibre15">skulk</kbd> function, which in turn is called by global code. Each execution context has a lexical environment associated with it that
         contains the mapping for all identifiers defined directly in that context. For example, the global environment holds the mapping
         for identifiers <kbd class="calibre15">ninja</kbd> and <kbd class="calibre15">skulk</kbd>, the <kbd class="calibre15">skulk</kbd> environment holds the mapping for the identifiers <kbd class="calibre15">action</kbd> and <kbd class="calibre15">report</kbd>, and the <kbd class="calibre15">report</kbd> environment holds the mapping for the <kbd class="calibre15">intro</kbd> identifier (the right side of <a href="#ch05fig09" class="calibre4">figure 5.9</a>).
      </p>
      
      <p class="noind">In a particular execution context, besides accessing identifiers defined directly in the matching lexical environment, our
         programs often access other variables defined in outer environments. For example, in the body of the <kbd class="calibre15">report</kbd> function, we access the variable <kbd class="calibre15">action</kbd> of the outer <kbd class="calibre15">skulk</kbd> function, as well as the global <kbd class="calibre15">ninja</kbd> variable. To do this, we have to somehow keep track of these outer environments. JavaScript does this by taking advantage
         of functions as first-class objects.
      </p>
      
      <p class="noind">Whenever a function is created, a reference to the lexical environment in which the function was created is stored in an internal
         (meaning that you can’t access or manipulate it directly) property named <kbd class="calibre15">[[Environment]]</kbd>; double brackets is the notation that we’ll use to mark these internal properties. In our case, the <kbd class="calibre15">skulk</kbd> function will keep a reference to the global environment, and the <kbd class="calibre15">report</kbd> function will keep a reference to the <kbd class="calibre15">skulk</kbd> environment, because these were the environments in which the functions were created.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch05note07" class="notetitle">Note</h5>
      
      
      <p class="noindclose">This might seem odd at first. Why don’t we just traverse the whole stack of execution contexts and search their matching environments
         for identifier mappings? Technically, this would work in our example. But remember, a JavaScript function can be passed around
         as any other object, so the position of the function definition and the position from where the function is called generally
         aren’t related (remember closures).
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind"><a id="iddle1389" class="calibre4"></a><a id="iddle2169" class="calibre4"></a><a id="iddle2171" class="calibre4"></a>Whenever a function is called, a new function execution context is created and pushed onto the execution context stack. In
         addition, a new associated lexical environment is created. Now comes the crucial part: For the outer environment of the newly
         created lexical environment, the JavaScript engine puts the environment referenced by the called function’s internal <kbd class="calibre15">[[Environment]]</kbd> property, the environment in which the now-called function was created!
      </p>
      
      <p class="noind">In our case, when the <kbd class="calibre15">skulk</kbd> function is called, the outer environment of the newly created <kbd class="calibre15">skulk</kbd> environment becomes the global environment (because it’s the environment in which the <kbd class="calibre15">skulk</kbd> function was created). Similarly, when calling the <kbd class="calibre15">report</kbd> function, the outer environment of the newly created <kbd class="calibre15">report</kbd> environment is set to the <kbd class="calibre15">skulk</kbd> environment.
      </p>
      
      <p class="noind">Now let’s take a look at the <kbd class="calibre15">report</kbd> function:
      </p>
      
      <pre id="PLd0e11054" class="calibre5">function report() {
  var intro = "Aha!";
  assert(intro === "Aha!", "Local");
  assert(action === "Skulking", "Outer");
  assert(action === "Muneyoshi", "Global");
}</pre>
      
      <p class="noind">When the first <kbd class="calibre15">assert</kbd> statement is being evaluated, we have to resolve the <kbd class="calibre15">intro</kbd> identifier. To do this, the JavaScript engine starts by checking the environment of the currently running execution context,
         the <kbd class="calibre15">report</kbd> environment. Because the <kbd class="calibre15">report</kbd> environment contains a reference to <kbd class="calibre15">intro</kbd>, the identifier is resolved.
      </p>
      
      <p class="noind">Next, the second <kbd class="calibre15">assert</kbd> statement has to resolve the <kbd class="calibre15">action</kbd> identifier. Again, the environment of the currently running execution context is checked. But the <kbd class="calibre15">report</kbd> environment doesn’t contain a reference to the <kbd class="calibre15">action</kbd> identifier, so the JavaScript engine has to check the outer environment of the <kbd class="calibre15">report</kbd> environment: the <kbd class="calibre15">skulk</kbd> environment. Luckily, the <kbd class="calibre15">skulk</kbd> environment contains a reference to the <kbd class="calibre15">action</kbd> identifier, and the identifier is resolved. A similar process is followed when trying to resolve the <kbd class="calibre15">ninja</kbd> identifier (a little hint: the identifier can be found in the global environment).
      </p>
      
      <p class="noind">Now that you understand the fundamentals of identifier resolution, let’s look at the various ways a variable can be declared.</p>
      
      
      
      
      <h3 id="ch05lev1sec5" class="calibre24"><a id="ch05lev1sec5__title" class="calibre3"></a>5.5. Understanding types of JavaScript variables
      </h3>
      
      <p class="noind">In JavaScript, we can use three keywords for defining variables: <kbd class="calibre15">var</kbd>, <kbd class="calibre15">let</kbd>, and <kbd class="calibre15">const</kbd>. They differ in two aspects: <i class="calibre6">mutability</i> and their relationship toward the lexical environment.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch05note08" class="notetitle">Note</h5>
      
      
      <p class="noindclose">The keyword <kbd class="calibre15">var</kbd> has been part of JavaScript since its beginning, whereas <kbd class="calibre15">let</kbd> and <kbd class="calibre15">const</kbd> are ES6 additions. You can check whether your browser supports <kbd class="calibre15">let</kbd> and <kbd class="calibre15">const</kbd> at the following links: <a href="http://mng.bz/CGJ6" class="calibre4">http://mng.bz/CGJ6</a> and <a href="http://mng.bz/uUIT" class="calibre4">http://mng.bz/uUIT</a>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      
      <h4 id="ch05lev2sec5" class="calibre26">5.5.1. <a id="ch05lev2sec5__title" class="calibre4"></a>Variable mutability
      </h4>
      
      <p class="noind"><a id="iddle1252" class="calibre4"></a><a id="iddle2170" class="calibre4"></a><a id="iddle2178" class="calibre4"></a>If we were to divide variable declaration keywords by mutability, we’d put <kbd class="calibre15">const</kbd> on one side and <kbd class="calibre15">var</kbd> and <kbd class="calibre15">let</kbd> on the other side. All variables defined with <kbd class="calibre15">const</kbd> are immutable, meaning that their value can be set only once. On the other hand, variables defined with keywords <kbd class="calibre15">var</kbd> and <kbd class="calibre15">let</kbd> are typical run-of-the-mill variables, whose value we can change as many times as necessary.
      </p>
      
      <p class="noind">Now, let’s delve into how <kbd class="calibre15">const</kbd> variables work and behave.
      </p>
      
      
      <h5 id="ch05lev3sec1" class="notetitle"><a id="ch05lev3sec1__title" class="calibre4"></a>const variables
      </h5>
      
      <p class="noind">A <kbd class="calibre15">const</kbd> “variable” is similar to a normal variable, with the exception that we have to provide an initialization value when it’s
         declared, and we can’t assign a completely new value to it afterward. Hmmm, not very <i class="calibre6">variable</i>, is it?
      </p>
      
      <p class="noind"><kbd class="calibre15">Const</kbd> variables are often used for two slightly different purposes:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Specifying variables that shouldn’t be reassigned (and in the rest of the book, we use them mostly in this regard).
            
         </li>
         
         <li class="calibre20">Referencing a fixed value, for example, the maximum number of ronin in a squad, <kbd class="calibre15">MAX_RONIN_COUNT</kbd>, by name, instead of using a literal number such as 234. This makes our programs easier to understand and maintain. Our code
            isn’t filled with seemingly arbitrary literals (<kbd class="calibre15">234</kbd>), but with meaningful names (<kbd class="calibre15">MAX_RONIN_COUNT</kbd>) whose values are specified in only one place.
            
         </li>
         
      </ul>
      
      <p class="noind">In either case, because <kbd class="calibre15">const</kbd> variables aren’t meant to be reassigned during program execution, we’ve safeguarded our code against unwanted or accidental
         modifications and we’ve even made it possible for the JavaScript engine to do some performance optimizations.
      </p>
      
      <p class="noind">The following listing illustrates the behavior of <kbd class="calibre15">const</kbd> variables.
      </p>
      
      <h5 id="ch05ex06" class="notetitle">Listing 5.6. <a id="ch05ex06__title" class="calibre4"></a>The behavior of const variables
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex06-0.jpg" alt="" class="calibre2" width="590" height="163" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex06-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex06-1.jpg" alt="" class="calibre2" width="590" height="198" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex06-1.jpg"></p>
      
      <p class="noind"><a id="iddle1099" class="calibre4"></a><a id="iddle1169" class="calibre4"></a><a id="iddle1474" class="calibre4"></a>Here we first define a <kbd class="calibre15">const</kbd> variable named <kbd class="calibre15">firstConst</kbd> with a value <kbd class="calibre15">samurai</kbd> and test that the variable has been initialized, as expected:
      </p>
      
      <pre id="PLd0e11311" class="calibre5">const firstConst = "samurai";
assert(firstConst === "samurai", "firstConst is a samurai");</pre>
      
      <p class="noind">We continue by trying to assign a completely new value, <kbd class="calibre15">ninja</kbd>, to our <kbd class="calibre15">firstConst</kbd> variable:
      </p>
      
      <pre id="PLd0e11326" class="calibre5">try{
  firstConst = "ninja";
  fail("Shouldn't be here");
} catch(e){
  pass("An exception has occurred");
}</pre>
      
      <p class="noind">Because the <kbd class="calibre15">firstConst</kbd> variable is, well, a constant, we can’t assign a new value to it, so the JavaScript engine throws an exception without modifying
         the variable’s value. Notice that we’re using two functions that we haven’t used so far: <kbd class="calibre15">fail</kbd> and <kbd class="calibre15">pass</kbd>. These two methods behave similarly to the <kbd class="calibre15">assert</kbd> method, except <kbd class="calibre15">fail</kbd> always fails and <kbd class="calibre15">pass</kbd> always passes. Here we use them to check whether an exception has occurred: If an exception occurs, the <kbd class="calibre15">catch</kbd> statement is activated and the <kbd class="calibre15">pass</kbd> method is executed. If there’s no exception, the <kbd class="calibre15">fail</kbd> method is executed, and we’ll be notified that something isn’t as it should be. We can check to verify that the exception
         happens, as shown in <a href="#ch05fig10" class="calibre4">figure 5.10</a>.
      </p>
      
      
      
      <h5 id="ch05fig10" class="notetitle">Figure 5.10. <a id="ch05fig10__title" class="calibre4"></a>Checking the behavior of <kbd class="calibre15">const</kbd> variables. An exception occurs when we try to assign a completely new value to a <kbd class="calibre15">const</kbd> variable.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig10.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig10.jpg"></p>
      
      
      
      <p class="noind">Next, we define another <kbd class="calibre15">const</kbd> variable, this time initializing it to an empty object:
      </p>
      
      <pre id="PLd0e11390" class="calibre5">const secondConst = {};</pre>
      
      <p class="noind">Now we’ll discuss an important feature of <kbd class="calibre15">const</kbd> variables. As you’ve already seen, we can’t assign a completely new value to a <kbd class="calibre15">const</kbd> variable. But there’s nothing stopping us from <i class="calibre6">modifying</i> the current one. For example, we can add new properites to the current object:
      </p>
      
      
      <pre id="PLd0e11410" class="calibre5">secondConst.weapon = "wakizashi";
assert(secondConst.weapon === "wakizashi",
       "We can add new properties");</pre>
      
      <p class="noind"><a id="iddle2167" class="calibre4"></a><a id="iddle2177" class="calibre4"></a>Or, if our <kbd class="calibre15">const</kbd> variable refers to an array, we can modify that array to any degree:
      </p>
      
      <pre id="PLd0e11435" class="calibre5">const thirdConst = [];
assert(thirdConst.length === 0, "No items in our array");

thirdConst.push("Yoshi");

assert(thirdConst.length === 1, "The array has changed");</pre>
      
      <p class="noind">And that’s about it. <kbd class="calibre15">const</kbd> variables aren’t that complicated to begin with. You only have to remember that a value of a <kbd class="calibre15">const</kbd> variable can be set only on initialization and that we can’t assign a completely new value later. We can still modify the
         existing value; we just can’t completely override it.
      </p>
      
      <p class="noind">Now that we’ve explored variable mutability, let’s consider the details of the relationships between various types of variables
         and lexical environments.
      </p>
      
      
      
      
      <h4 id="ch05lev2sec6" class="calibre26">5.5.2. <a id="ch05lev2sec6__title" class="calibre4"></a>Variable definition keywords and lexical environments
      </h4>
      
      <p class="noind">The three types of variable definitions—<kbd class="calibre15">var</kbd>, <kbd class="calibre15">let</kbd>, and <kbd class="calibre15">const</kbd>—can also be categorized by their relationship with the lexical environment (in other words, by their scope). In that case,
         we can put <kbd class="calibre15">var</kbd> on one side, and <kbd class="calibre15">let</kbd> and <kbd class="calibre15">const</kbd> on the other.
      </p>
      
      
      <h5 id="ch05lev3sec2" class="notetitle"><a id="ch05lev3sec2__title" class="calibre4"></a>Using the var keyword
      </h5>
      
      <p class="noind">When we use the <kbd class="calibre15">var</kbd> keyword, the variable is defined in the closest function or global lexical environment. (Note that blocks are ignored!) This
         is a long-standing detail of JavaScript that has tripped up many developers coming from other languages.
      </p>
      
      <p class="noind">Consider the following listing.</p>
      
      
      
      <h5 id="ch05ex07" class="notetitle">Listing 5.7. <a id="ch05ex07__title" class="calibre4"></a>Using the var keyword
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/109fig01_alt.jpg" alt="" class="calibre2" width="590" height="352" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/109fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1499" class="calibre4"></a><a id="iddle1647" class="calibre4"></a>We start by defining a global variable, <kbd class="calibre15">globalNinja</kbd>, which is followed by defining a <kbd class="calibre15">reportActivity</kbd> function that loops two times and notifies us about the jumping activity of our <kbd class="calibre15">globalNinja</kbd>. As you can see, within the body of the <kbd class="calibre15">for</kbd> loop, we can normally access both the block variables (<kbd class="calibre15">i</kbd> and <kbd class="calibre15">forMessage</kbd>), the function variables (<kbd class="calibre15">functionActivity</kbd>), and the global variables (<kbd class="calibre15">globalNinja</kbd>).
      </p>
      
      <p class="noind">But what’s strange with JavaScript, and what confuses a lot of developers coming from other languages, is that we can access
         the variables defined with code blocks even outside those blocks:
      </p>
      
      <pre id="PLd0e11552" class="calibre5">assert(i === 3 &amp;&amp; forMessage === "Yoshi jumping",
       "Loop variables accessible outside of the loop");</pre>
      
      <p class="noind">This stems from the fact that variables declared with the keyword <kbd class="calibre15">var</kbd> are always registered in the closest function or global lexical environment, without paying any attention to blocks. <a href="#ch05fig11" class="calibre4">Figure 5.11</a> depicts this situation, by showing the state of lexical environments after the second iteration of the <kbd class="calibre15">for</kbd> loop in the <kbd class="calibre15">reportActivity</kbd> function.
      </p>
      
      
      
      <h5 id="ch05fig11" class="notetitle">Figure 5.11. <a id="ch05fig11__title" class="calibre4"></a>When defining variables with the keyword <kbd class="calibre15">var</kbd>, a variable is defined in the closest function or global environment (while ignoring block environments). In our case, the
         variables <kbd class="calibre15">forMessage</kbd> and <kbd class="calibre15">i</kbd> are registered in the <kbd class="calibre15">reportActivity</kbd> environment (the closest functional environment), even though they’re contained within a <kbd class="calibre15">for</kbd> loop.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig11_alt.jpg" alt="" class="calibre2" width="590" height="520" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig11_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1124" class="calibre4"></a><a id="iddle1251" class="calibre4"></a><a id="iddle1723" class="calibre4"></a><a id="iddle2176" class="calibre4"></a>Here we have three lexical environments:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The global environment in which the <kbd class="calibre15">globalNinja</kbd> variable is registered (because this is the closest function or global lexical environment)
            
         </li>
         
         <li class="calibre20">The <kbd class="calibre15">reportActivity</kbd> environment, created on the <kbd class="calibre15">reportActivity</kbd> function invocation, which contains the <kbd class="calibre15">functionActivity</kbd>, <kbd class="calibre15">i</kbd>, and <kbd class="calibre15">forMessage</kbd> variables, because they’re defined with the keyword <kbd class="calibre15">var</kbd>, and this is their closest function environment
            
         </li>
         
         <li class="calibre20">The <kbd class="calibre15">for</kbd> block environment, which is empty, because <kbd class="calibre15">var</kbd>-defined variables ignore blocks (even when contained within them)
            
         </li>
         
      </ul>
      
      <p class="noind">Because this behavior is a bit strange, the ES6 version of JavaScript offers two new variable declaration keywords: <kbd class="calibre15">let</kbd> and <kbd class="calibre15">const</kbd>.
      </p>
      
      
      
      <h5 id="ch05lev3sec3" class="notetitle"><a id="ch05lev3sec3__title" class="calibre4"></a>Using let and const to specify block-scoped variables
      </h5>
      
      <p class="noind">Unlike <kbd class="calibre15">var</kbd>, which defines the variable in the closest function or global lexical environment, the <kbd class="calibre15">let</kbd> and <kbd class="calibre15">const</kbd> keywords are more straightforward. They define variables in the closest lexical environment (which can be a block environment,
         a loop environment, a function environment, or even the global environment). We can use <kbd class="calibre15">let</kbd> and <kbd class="calibre15">const</kbd> to define block-scoped, function-scoped, and global-scoped variables.
      </p>
      
      <p class="noind">Let’s rewrite our previous example to use <kbd class="calibre15">const</kbd> and <kbd class="calibre15">let</kbd>.
      </p>
      
      <h5 id="ch05ex08" class="notetitle">Listing 5.8. <a id="ch05ex08__title" class="calibre4"></a>Using const and let keywords
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex08-0.jpg" alt="" class="calibre2" width="590" height="206" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex08-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex08-1.jpg" alt="" class="calibre2" width="590" height="159" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex08-1.jpg"></p>
      
      <p class="noind"><a id="iddle1500" class="calibre4"></a><a href="#ch05fig12" class="calibre4">Figure 5.12</a> illustrates the current situation, when finishing the execution of the second iteration of the <kbd class="calibre15">for</kbd> loop in the <kbd class="calibre15">reportActivity</kbd> function. We again have three lexical environments: the global environment (for global code outside all functions and blocks),
         the <kbd class="calibre15">reportActivity</kbd> environment bound to the <kbd class="calibre15">reportActivity</kbd> function, and the block environment for the <kbd class="calibre15">for</kbd> loop body. But because we’re using <kbd class="calibre15">let</kbd> and <kbd class="calibre15">const</kbd> keywords, the variables are defined in their closest lexical environment; the <kbd class="calibre15">GLOBAL_NINJA</kbd> variable is defined in the global environment, the <kbd class="calibre15">functionActivity</kbd> variable in the <kbd class="calibre15">reportActivity</kbd> environment, and the <kbd class="calibre15">i</kbd> and <kbd class="calibre15">forMessage</kbd> variables in the <kbd class="calibre15">for</kbd> block environment.
      </p>
      
      
      
      <h5 id="ch05fig12" class="notetitle">Figure 5.12. <a id="ch05fig12__title" class="calibre4"></a>When defining variables with keywords <kbd class="calibre15">let</kbd> and <kbd class="calibre15">const</kbd>, a variable is defined in the closest environment. In our case, variables <kbd class="calibre15">forMessage</kbd> and <kbd class="calibre15">i</kbd> are registered in the <kbd class="calibre15">for</kbd> block environment, the variable <kbd class="calibre15">functionActivity</kbd> in the <kbd class="calibre15">reportActivity</kbd> environment, and the <kbd class="calibre15">GLOBAL_NINJA</kbd> variable in the global environment (in every case, the closest environment to the respective variable).
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig12_alt.jpg" alt="" class="calibre2" width="590" height="543" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig12_alt.jpg"></p>
      
      
      <p class="noind">Now that <kbd class="calibre15">const</kbd> and <kbd class="calibre15">let</kbd> have been introduced, scores of new JavaScript developers who have recently come from other programming languages can be
         at peace. JavaScript <a id="iddle1172" class="calibre4"></a><a id="iddle1655" class="calibre4"></a><a id="iddle1658" class="calibre4"></a><a id="iddle1726" class="calibre4"></a><a id="iddle1729" class="calibre4"></a><a id="iddle2172" class="calibre4"></a><a id="iddle2175" class="calibre4"></a>finally supports the same scoping rules as other C-like languages. For this reason, from this point in this book, we almost
         always use <kbd class="calibre15">const</kbd> and <kbd class="calibre15">let</kbd> instead of <kbd class="calibre15">var</kbd>.
      </p>
      
      <p class="noind">Now that we understand how identifier mappings are kept within lexical environments and how lexical environments are linked
         to program execution, let’s discuss the exact process by which identifiers are defined within lexical environments. This will
         help us better understand some commonly occurring bugs.
      </p>
      
      
      
      
      <h4 id="ch05lev2sec7" class="calibre26">5.5.3. <a id="ch05lev2sec7__title" class="calibre4"></a>Registering identifiers within lexical environments
      </h4>
      
      <p class="noind">One of the driving principles behind the design of JavaScript as a programming language was its ease of use. That’s one of
         the main reasons for not specifying function return types, function parameter types, variable types, and so on. And you already
         know that JavaScript code is executed line by line, in a straightforward fashion. Consider the following:
      </p>
      
      <pre id="PLd0e11908" class="calibre5">firstRonin = "Kiyokawa";
secondRonin = "Kondo";</pre>
      
      <p class="noind">The value <kbd class="calibre15">Kiyokawa</kbd> is assigned to the identifier <kbd class="calibre15">firstRonin</kbd>, and then the value <kbd class="calibre15">Kondo</kbd> is assigned to the identifier <kbd class="calibre15">secondRonin</kbd>. There’s nothing weird about that, right? But take a look at another example:
      </p>
      
      <pre id="PLd0e11929" class="calibre5">const firstRonin = "Kiyokawa";
check(firstRonin);
function check(ronin) {
  assert(ronin === "Kiyokawa", "The ronin was checked! ");
}</pre>
      
      <p class="noind">In this case, we assign the value <kbd class="calibre15">Kiyokawa</kbd> to the identifier <kbd class="calibre15">firstRonin</kbd>, and then we call the <kbd class="calibre15">check</kbd> function with the identifier <kbd class="calibre15">firstRonin</kbd> as a parameter. But hold on a second—if the code is executed line by line, should we be able to call the <kbd class="calibre15">check</kbd> function? Our program execution hasn’t reached its declaration, so the JavaScript engine shouldn’t even know about it.
      </p>
      
      <p class="noind">But if we check, as shown in <a href="#ch05fig13" class="calibre4">figure 5.13</a>, you see that all is fine and well. JavaScript isn’t too picky about where we define our functions. We can choose to place
         function declarations before or even after their respective calls. This isn’t something that the developer should need to
         fuss about.
      </p>
      
      
      
      <h5 id="ch05fig13" class="notetitle">Figure 5.13. <a id="ch05fig13__title" class="calibre4"></a>The function is indeed visible, even before the execution reaches its definition.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig13.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig13.jpg"></p>
      
      
      
      
      <h5 id="ch05lev3sec4" class="notetitle"><a id="ch05lev3sec4__title" class="calibre4"></a>The process of registering identifiers
      </h5>
      
      <p class="noind">But ease of use aside, if code is executed line by line, how did the JavaScript engine know that a function named <kbd class="calibre15">check</kbd> exists? It turns out that the JavaScript engine “cheats” a little, and that execution of JavaScript code occurs in two phases.
      </p>
      
      <p class="noind">The first phase is activated whenever a new lexical environment is created. In this phase, the code isn’t executed, but the
         JavaScript engine visits and registers all declared variables and functions within the current lexical environment. The second
         phase, JavaScript execution, starts after this has been accomplished; the exact behavior depends on the type of variable (<kbd class="calibre15">let</kbd>, <kbd class="calibre15">var</kbd>, <kbd class="calibre15">const</kbd>, function declaration) and the type of environment (global, function, or block).
      </p>
      
      <p class="noind">The process is as follows:</p>
      
      <p class="calibre18"></p>
      <ol class="calibre27">
         
         <li class="calibre20">If we’re creating a function environment, the implicit <kbd class="calibre15">arguments</kbd> identifier is created, along with all formal function parameters and their argument values. If we’re dealing with a nonfunction
            environment, this step is skipped.
            
         </li>
         
         <li class="calibre20">If we’re creating a global or a function environment, the current code is scanned (without going into the body of other functions)
            for function declarations (but not function expressions or arrow functions!). For each discovered function declaration, a
            new function is created and bound to an identifier in the environment with the function’s name. If that identifier name already
            exists, its value is overwritten. If we’re dealing with block environments, this step is skipped.
            
         </li>
         
         <li class="calibre20">The current code is scanned for variable declarations. In function and global environments, all variables declared with the
            keyword <kbd class="calibre15">var</kbd> and defined outside other functions (but they can be placed within blocks!) are found, and all variables declared with the
            keywords <kbd class="calibre15">let</kbd> and <kbd class="calibre15">const</kbd> defined outside other functions and blocks are found. In block environments, the code is scanned only for variables declared
            with the keywords <kbd class="calibre15">let</kbd> and <kbd class="calibre15">const</kbd>, directly in the current block. For each discovered variable, if the identifier doesn’t exist in the environment, the identifier
            is registered and its value initialized to <kbd class="calibre15">undefined</kbd>. But if the identifier exists, it’s left with its value.
            
         </li>
         
      </ol>
      
      <p class="noind">These steps are summarized in <a href="#ch05fig14" class="calibre4">figure 5.14</a>.
      </p>
      
      
      
      <h5 id="ch05fig14" class="notetitle">Figure 5.14. <a id="ch05fig14__title" class="calibre4"></a>The process of registering identifiers, depending on the type of environment
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig14_alt.jpg" alt="" class="calibre2" width="590" height="552" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig14_alt.jpg"></p>
      
      
      <p class="noind">Now we’ll go through the implications of these rules. You’ll see some common JavaScript conundrums that can lead to weird
         bugs that are easy to <a id="iddle1548" class="calibre4"></a><a id="iddle1576" class="calibre4"></a><a id="iddle1656" class="calibre4"></a><a id="iddle1657" class="calibre4"></a><a id="iddle1727" class="calibre4"></a><a id="iddle1728" class="calibre4"></a><a id="iddle1842" class="calibre4"></a><a id="iddle2173" class="calibre4"></a><a id="iddle2174" class="calibre4"></a>create but tricky to understand. Let’s start with why we’re able to call a function before it’s even declared.
      </p>
      
      
      
      <h5 id="ch05lev3sec5" class="notetitle"><a id="ch05lev3sec5__title" class="calibre4"></a>Calling functions before their declarations
      </h5>
      
      <p class="noind">One of the features that makes JavaScript pleasant to use is that the order of function definitions doesn’t matter. Those
         who have used Pascal may not remember its rigid structural requirements fondly. In JavaScript, we can call a function even
         before it’s formally declared. Check out the following listing.
      </p>
      
      
      
      <h5 id="ch05ex09" class="notetitle">Listing 5.9. <a id="ch05ex09__title" class="calibre4"></a>Accessing a function before its declaration
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/115fig01_alt.jpg" alt="" class="calibre2" width="590" height="251" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/115fig01_alt.jpg"></p>
      
      
      <p class="noind">We can access the function <kbd class="calibre15">fun</kbd> even before we’ve defined it. We can do this because <kbd class="calibre15">fun</kbd> is defined as a function declaration, and the second step (listed previously in this section) indicates that functions created
         with function declarations are created and their identifiers registered when the current lexical environment is created, <i class="calibre6">before</i> any JavaScript code is executed. So even before we start executing our <kbd class="calibre15">assert</kbd> call, the <kbd class="calibre15">fun</kbd> function already exists.
      </p>
      
      <p class="noind">The JavaScript engine does this to make things easier for us as developers, allowing us to forward-reference functions and
         not burdening us with an exact order for placing functions. Functions already exist at the time our code starts executing.
      </p>
      
      <p class="noind">Notice that this holds only for function declarations. Function expressions and arrow functions aren’t part of this process,
         and are created when the program execution reaches their definitions. This is why we can’t access the <kbd class="calibre15">myFunExp</kbd> and <kbd class="calibre15">myArrow</kbd> functions.
      </p>
      
      
      
      <h5 id="ch05lev3sec6" class="notetitle"><a id="ch05lev3sec6__title" class="calibre4"></a>Overriding functions
      </h5>
      
      <p class="noind">The next conundrum to tackle is the problem of overriding function identifiers. Let’s take a look at another example.</p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch05ex10" class="notetitle">Listing 5.10. <a id="ch05ex10__title" class="calibre4"></a>Overriding function identifiers
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/116fig01_alt.jpg" alt="" class="calibre2" width="590" height="138" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/116fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1636" class="calibre4"></a><a id="iddle2168" class="calibre4"></a>In this example, a variable declaration and a function declaration have the same name: <kbd class="calibre15">fun</kbd>. If you run this code, you’ll see that both <kbd class="calibre15">assert</kbd>s pass. In the first <kbd class="calibre15">assert</kbd>, the identifier <kbd class="calibre15">fun</kbd> refers to a function; and in the second and third, <kbd class="calibre15">fun</kbd> refers to a number.
      </p>
      
      <p class="noind">This behavior follows as a direct consequence of the steps taken when registering identifiers. In the second step of the outlined
         process, functions defined with function declarations are created and associated to their identifiers before any code is evaluated;
         and in the third step, variable declarations are processed, and the value <kbd class="calibre15">undefined</kbd> is associated to identifiers that haven’t yet been encountered in the current environment.
      </p>
      
      <p class="noind">In this case, because the identifier <kbd class="calibre15">fun</kbd> has been encountered in the second step when function declarations are registered, the value <kbd class="calibre15">undefined</kbd> isn’t assigned to the variable <kbd class="calibre15">fun</kbd>. This is why the first assertion, testing whether <kbd class="calibre15">fun</kbd> is a function, passes. After that, we have an assignment statement, <kbd class="calibre15">var fun = 3</kbd>, which assigns the number 3 to the identifier <kbd class="calibre15">fun</kbd>. By doing this, we lose the reference to the function, and from then on, the identifier <kbd class="calibre15">fun</kbd> refers to a number.
      </p>
      
      <p class="noind">During the actual program execution, function declarations are skipped, so the definition of the <kbd class="calibre15">fun</kbd> function doesn’t have any impact on the value of the <kbd class="calibre15">fun</kbd> identifier.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <b id="ch05sb01" class="calibre21">Variable hoisting</b>
         
         <p class="noind">If you’ve read a bunch of JavaScript blogs or books explaining identifier resolution, you’ve probably run into the term <i class="calibre6">hoisting</i>—for example, variable and function declarations are hoisted, or <i class="calibre6">lifted,</i> to the top of a function or global scope.
         </p>
         
         <p class="noind">As you’ve seen, though, that’s a simplistic view. Variables and function declarations are technically not “moved” anywhere.
            They’re visited and registered in lexical environments before any code is executed. Although <i class="calibre6">hoisting,</i> as it’s most often defined, is enough to provide a basic understanding of how JavaScript scoping works, we’ve gone much deeper
            than that by looking at lexical environments, taking another step on the path of becoming a true JavaScript ninja.
         </p>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">In the next section, all the concepts that we’ve explored so far in this chapter will help you better understand closures.</p>
      
      
      
      
      
      
      <h3 id="ch05lev1sec6" class="calibre24"><a id="ch05lev1sec6__title" class="calibre3"></a>5.6. Exploring how closures work
      </h3>
      
      <p class="noind"><a id="iddle1202" class="calibre4"></a>We started this chapter with closures, a mechanism that allows a function to access all variables that are in scope when the
         function itself is created. You’ve also seen some of the ways closures can help you—for example, by allowing us to mimic private
         object variables or by making our code more elegant when dealing with callbacks.
      </p>
      
      <p class="noind">Closures are irrevocably tightly coupled with scopes. Closures are a straightforward side effect of the way scoping rules
         work in JavaScript. So in this section, we’ll revisit the closure examples from the beginning of the chapter. But this time
         you’ll take advantage of execution contexts and lexical environments that will enable you to grasp how closures work under
         the hood.
      </p>
      
      
      <h4 id="ch05lev2sec8" class="calibre26">5.6.1. <a id="ch05lev2sec8__title" class="calibre4"></a>Revisiting mimicking private variables with closures
      </h4>
      
      <p class="noind">As you’ve already seen, closures can help us mimic private variables. Now that we have a solid understanding of how scoping
         rules work in JavaScript, let’s revisit the private variables example. This time, we’ll focus on execution contexts and lexical
         environments. Just to make things easier, let’s repeat the listing.
      </p>
      
      <h5 id="ch05ex11" class="notetitle">Listing 5.11. <a id="ch05ex11__title" class="calibre4"></a>Approximate private variables with closures
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex11-0.jpg" alt="" class="calibre2" width="590" height="197" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex11-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex11-1.jpg" alt="" class="calibre2" width="590" height="205" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch05ex11-1.jpg"></p>
      
      <p class="noind"><a id="iddle1390" class="calibre4"></a>Now we’ll analyze the state of the application after the first <kbd class="calibre15">Ninja</kbd> object has been created, as shown in <a href="#ch05fig15" class="calibre4">figure 5.15</a>. We can use our knowledge of the intricacies of identifier resolution to better understand how closures come into play in
         this situation. JavaScript constructors are functions invoked with the keyword <kbd class="calibre15">new</kbd>. Therefore, <i class="calibre6">every</i> time we invoke a constructor function, we create a <i class="calibre6">new</i> lexical environment, which keeps track of variables local to the constructor. In this example, a new <kbd class="calibre15">Ninja</kbd> environment that keeps track of the <kbd class="calibre15">feints</kbd> variable is created.
      </p>
      
      
      
      <h5 id="ch05fig15" class="notetitle">Figure 5.15. <a id="ch05fig15__title" class="calibre4"></a>Private variables are realized as closures that are created by object methods defined in the constructor.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig15_alt.jpg" alt="" class="calibre2" width="590" height="494" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig15_alt.jpg"></p>
      
      
      <p class="noind">In addition, whenever a function is created, it keeps a reference to the lexical environment in which it was created (through
         an internal <kbd class="calibre15">[[Environment]]</kbd> property). In this case, within the <kbd class="calibre15">Ninja</kbd> constructor function, we create two new functions: <kbd class="calibre15">getFeints</kbd> and <kbd class="calibre15">feint</kbd>, which get a reference to the <kbd class="calibre15">Ninja</kbd> environment, because this is the environment in which they were created.
      </p>
      
      <p class="noind">The <kbd class="calibre15">getFeints</kbd> and <kbd class="calibre15">feint</kbd> functions are assigned as methods of the newly created <kbd class="calibre15">ninja</kbd> object (which, if you remember from the previous chapter, is accessible through the <kbd class="calibre15">this</kbd> keyword). Therefore, <kbd class="calibre15">getFeints</kbd> and <kbd class="calibre15">feint</kbd> will be accessible from outside the <kbd class="calibre15">Ninja</kbd> constructor function, which in turn leads to the fact that you’ve effectively created a closure around the <kbd class="calibre15">feints</kbd> variable.
      </p>
      
      <p class="noind">When we create another <kbd class="calibre15">Ninja</kbd> object, the <kbd class="calibre15">ninja2</kbd> object, the whole process is repeated. <a href="#ch05fig16" class="calibre4">Figure 5.16</a> shows the state of the application after creating the second <kbd class="calibre15">Ninja</kbd> object.
      </p>
      
      
      
      <h5 id="ch05fig16" class="notetitle">Figure 5.16. <a id="ch05fig16__title" class="calibre4"></a>The methods of each instance create closures around the “private” instance variables.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig16_alt.jpg" alt="" class="calibre2" width="590" height="308" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig16_alt.jpg"></p>
      
      
      <p class="noind">Every object created with the <kbd class="calibre15">Ninja</kbd> constructor gets its own methods (the <kbd class="calibre15">ninja1.getFeints</kbd> method is different from the <kbd class="calibre15">ninja2.getFeints</kbd> method) that close around the variables defined when the constructor was invoked. These “private” variables are accessible
         only through object methods created within the constructor, and not directly!
      </p>
      
      <p class="noind">Now let’s see how things play out when making the <kbd class="calibre15">ninja2.getFeints()</kbd> call. <a href="#ch05fig17" class="calibre4">Figure 5.17</a> shows the details.
      </p>
      
      
      
      <h5 id="ch05fig17" class="notetitle">Figure 5.17. <a id="ch05fig17__title" class="calibre4"></a>The state of execution contexts and lexical environments when performing the <kbd class="calibre15">ninja2.getFeints()</kbd> call. A new <kbd class="calibre15">getFeints</kbd> environment is created that has the environment of the constructor function in which <kbd class="calibre15">ninja2</kbd> was created as its outer environment. <kbd class="calibre15">getFeints</kbd> can access the “private” <kbd class="calibre15">feints</kbd> variable.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig17_alt.jpg" alt="" class="calibre2" width="590" height="706" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig17_alt.jpg"></p>
      
      
      <p class="noind">Before making the <kbd class="calibre15">ninja2.getFeints()</kbd> call, our JavaScript engine is executing global code. Our program execution is in the global execution context, which is
         also the only context in the execution stack. At the same time, the only active lexical environment is the global environment,
         the environment associated with the global execution context.
      </p>
      
      <p class="noind">When making the <kbd class="calibre15">ninja2.getFeints()</kbd> call, we’re calling the <kbd class="calibre15">getFeints</kbd> method of the <kbd class="calibre15">ninja2</kbd> object. Because every function call causes the creation of a new execution context, a new <kbd class="calibre15">getFeints</kbd> execution context is created and pushed to the execution stack. This also leads to the creation of a new <kbd class="calibre15">getFeints</kbd> lexical environment, which is normally used to keep track of variables defined in this function. In addition, the <kbd class="calibre15">getFeints</kbd> lexical environment, as its outer environment, gets the environment in which the <kbd class="calibre15">getFeints</kbd> function was created, the <kbd class="calibre15">Ninja</kbd> environment that was active when the <kbd class="calibre15">ninja2</kbd> object was constructed.
      </p>
      
      <p class="noind">Now let’s see how things play out when we try to get the value of the <kbd class="calibre15">feints</kbd> variable. First, the currently active <kbd class="calibre15">getFeints</kbd> lexical environment is consulted. Because we haven’t defined any variables in the <kbd class="calibre15">getFeints</kbd> function, this lexical environment is empty and our targeted <kbd class="calibre15">feints</kbd> variable won’t be found in there. Next, the search continues in the <i class="calibre6">outer</i> environment of the current lexical environment—in our case, the <kbd class="calibre15">Ninja</kbd> environment is active when constructing the <kbd class="calibre15">ninja2</kbd> object. This time around, the <kbd class="calibre15">Ninja</kbd> environment has a reference to the <kbd class="calibre15">feints</kbd> variable, and the search is done. It’s as simple as that.
      </p>
      
      <p class="noind">Now that we understand the role that execution contexts and lexical environments play when dealing with closures, we’d like
         to turn our attention to “private” variables and why we keep putting quotes around them. As you might have figured out by
         now, these “private” variables aren’t private properties of the object, but are variables kept alive by the object methods
         created in the constructor. Let’s take a look at one interesting side effect of this.
      </p>
      
      
      
      <h4 id="ch05lev2sec9" class="calibre26">5.6.2. <a id="ch05lev2sec9__title" class="calibre4"></a>Private variables caveat
      </h4>
      
      <p class="noind">In JavaScript, there’s nothing stopping us from assigning properties created on one object to another object. For example,
         we can easily rewrite the code from <a href="#ch05ex11" class="calibre4">listing 5.11</a> into something like the following.
      </p>
      
      
      
      <h5 id="ch05ex12" class="notetitle">Listing 5.12. <a id="ch05ex12__title" class="calibre4"></a>Private variables are accessed through functions, not through objects!
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/121fig01_alt.jpg" alt="" class="calibre2" width="590" height="281" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/121fig01_alt.jpg"></p>
      
      
      <p class="noind">This listing modifies the source code in a way that it assigns the <kbd class="calibre15">ninja1.getFeints</kbd> method to a completely new <kbd class="calibre15">imposter</kbd> object. Then, when we call the <kbd class="calibre15">getFeints</kbd> function on the <kbd class="calibre15">imposter</kbd> object, we test that we can access the value of the variable <kbd class="calibre15">feints</kbd> created when <kbd class="calibre15">ninja1</kbd> was instantiated, thus proving that we’re faking this whole “private” variable thing. See <a href="#ch05fig18" class="calibre4">figure 5.18</a>.
      </p>
      
      
      
      <h5 id="ch05fig18" class="notetitle">Figure 5.18. <a id="ch05fig18__title" class="calibre4"></a>We can access the “private” variables through functions, even if that function is attached to another object!
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig18.jpg" alt="" class="calibre2" width="394" height="331" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig18.jpg"></p>
      
      
      
      <p class="noind">This example illustrates that there aren’t any private object variables in JavaScript, but that we can use closures created
         by object methods to have a “good enough” alternative. Still, even though it isn’t the real thing, lots of developers find
         this way of hiding information useful.
      </p>
      
      
      
      
      <h4 id="ch05lev2sec10" class="calibre26">5.6.3. <a id="ch05lev2sec10__title" class="calibre4"></a>Revisiting the closures and callbacks example
      </h4>
      
      <p class="noind"><a id="iddle1183" class="calibre4"></a><a id="iddle1197" class="calibre4"></a><a id="iddle2019" class="calibre4"></a>Let’s go back to our simple animations example with callback timers. This time, we’ll animate two objects, as shown in the
         following listing.
      </p>
      
      
      
      <h5 id="ch05ex13" class="notetitle">Listing 5.13. <a id="ch05ex13__title" class="calibre4"></a>Using a closure in a timer interval callback
      </h5>
      <pre id="PLd0e12683" class="calibre5"><b class="calibre21">&lt;div id="box1"&gt;First Box&lt;/div&gt;</b>
<b class="calibre21">&lt;div id="box2"&gt;Second Box&lt;/div&gt;</b>
&lt;script&gt;
  function animateIt(elementId) {
    var elem = document.getElementById(elementId);
    var tick = 0;
    var timer = setInterval(function(){
      if (tick &lt; 100) {
        elem.style.left = elem.style.top = tick + "px";
        tick++;
      }
      else {
        clearInterval(timer);
        assert(tick === 100,
               "Tick accessed via a closure.");
        assert(elem,
               "Element also accessed via a closure.");
        assert(timer,
               "Timer reference also obtained via a closure." );
      }
    }, 10);
  }
  <b class="calibre21">animateIt("box1");</b>
  <b class="calibre21">animateIt("box2");</b>
<b class="calibre21">&lt;/script&gt;</b></pre>
      
      <p class="noind">As you saw earlier in the chapter, we use closures to simplify animating multiple objects on our pages. But now we’ll consider
         lexical environments, as shown in <a href="#ch05fig19" class="calibre4">figure 5.19</a>.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch05fig19" class="notetitle">Figure 5.19. <a id="ch05fig19__title" class="calibre4"></a>By creating multiple closures, we can do many things at once. Every time an interval expires, the callback function reactivates
         the environment that was active at the time of callback creation. The closure of each callback automatically keeps track of
         its own set of variables.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig19_alt.jpg" alt="" class="calibre2" width="590" height="733" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/05fig19_alt.jpg"></p>
      
      
      <p class="noind">Every time we call the <kbd class="calibre15">animateIt</kbd> function, a new function lexical environment is created <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg"> <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg"> that keeps track of the set of variables important for that animation (the <kbd class="calibre15">elementId</kbd>; <kbd class="calibre15">elem</kbd>, the element that’s being animated; <kbd class="calibre15">tick</kbd>, the current number of ticks; and <kbd class="calibre15">timer</kbd>, the ID of the timer doing the animation). That environment will be kept alive as long as there’s at least one function that
         works with its variables through closures. In this case, the browser will keep alive the <kbd class="calibre15">setInterval</kbd> callback until we call the <kbd class="calibre15">clearInterval</kbd> function. Later, when an interval expires, the browser calls the matching callback—and with it, through closures, come the
         variables defined when the callback was created. This enables us to avoid the trouble of manually mapping the callback and
         the active variables <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-03.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-03.jpg"> <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-04.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-04.jpg"> <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-05.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-05.jpg">, thereby significantly simplifying our code.
      </p>
      
      <p class="noind">That’s all we have to say about closures and scopes. Now recap this chapter and meet us in the next one, where we’ll explore
         two completely new ES6 concepts, generators and promises, that can help when writing asynchronous code.
      </p>
      
      
      
      
      
      <h3 id="ch05lev1sec7" class="calibre24"><a id="ch05lev1sec7__title" class="calibre3"></a>5.7. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Closures allow a function to access all variables that are in scope when the function itself was defined. They create a “safety
            bubble” of the function and the variables that are in scope at the point of the function’s definition. This way, the function
            has all it needs to execute, even if the scope in which the function was created is long gone.
            
         </li>
         
         <li class="calibre20">We can use function closures for these advanced uses:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">Mimic private object variables, by closing over constructor variables through method closures
                  
               </li>
               
               <li class="calibre20">Deal with callbacks, in a way that significantly simplifies our code
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">JavaScript engines track function execution through an execution context stack (or a call stack). Every time a function is
            called, a new function execution context is created and placed on the stack. When a function is done executing, the matching
            execution context is popped from the stack.
            
         </li>
         
         <li class="calibre20">JavaScript engines track identifiers with lexical environments (or colloquially, scopes).
            
         </li>
         
         <li class="calibre20">In JavaScript, we can define globally-scoped, function-scoped, and even-block scoped variables.
            
         </li>
         
         <li class="calibre20">To define variables, we use <kbd class="calibre15">var</kbd>, <kbd class="calibre15">let</kbd>, and <kbd class="calibre15">const</kbd> keywords:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">The <kbd class="calibre15">var</kbd> keyword defines a variable in the closest function or global scope (while ignoring blocks).
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">let</kbd> and <kbd class="calibre15">const</kbd> keywords define a variable in the closest scope (including blocks), allowing us to create block-scoped variables, something
                  that wasn’t possible in pre-ES6 JavaScript. In addition, the keyword <kbd class="calibre15">const</kbd> allows us to define “variables” whose value can be assigned only once.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">Closures are merely a side effect of JavaScript scoping rules. A function can be called even when the scope in which it was
            created is long gone.
            
         </li>
         
      </ul>
      
      
      
      <h3 id="ch05lev1sec8" class="calibre24"><a id="ch05lev1sec8__title" class="calibre3"></a>5.8. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch05qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch05qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch05qa2q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">Closures allow functions to</p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20">Access external variables that are in scope when the function is defined
                  
               </li>
               
               <li class="calibre20">Access external variables that are in scope when the function is called
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch05qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch05qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind">Closures come with</p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20">Code-size costs
                  
               </li>
               
               <li class="calibre20">Memory costs
                  
               </li>
               
               <li class="calibre20">Processing costs
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch05qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch05qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">In the following code example, mark the identifiers accessed through closures:</p>
            
            <pre id="PLd0e12922" class="calibre5">function Samurai(name) {
  var weapon = "katana";
  this.getWeapon = function(){
    return weapon;
  };

  this.getName = function(){
    return name;
  }

  this.message = name + " wielding a " + weapon;

  this.getMessage = function(){
    return this.message;
  }
}

var samurai = new Samurai("Hattori");

samurai.getWeapon();
samurai.getName();
samurai.getMessage();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch05qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch05qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">In the following code, how many execution contexts are created, and what’s the largest size of the execution context stack?</p>
            
            <pre id="PLd0e12937" class="calibre5">function perform(ninja) {
  sneak(ninja);
  infiltrate(ninja);
}

function sneak(ninja) {
  return ninja + " skulking";
}

function infiltrate(ninja) {
  return ninja + " infiltrating";
}

perfom("Kuma");</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch05qa2qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch05qa2q5" class="calibre4"></a><b class="calibre21">5 </b></p><p class="noind">Which keyword in JavaScript allows us to define variables that can’t be reassigned to a completely new value?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch05qa2qe6" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch05qa2q6" class="calibre4"></a><b class="calibre21">6 </b></p><p class="noind">What’s the difference between <kbd class="calibre15">var</kbd> and <kbd class="calibre15">let</kbd>?
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch05qa2qe7" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch05qa2q7" class="calibre4"></a><b class="calibre21">7 </b></p><p class="noind">Where and why will the following code throw an exception?</p>
            
            <pre id="PLd0e12970" class="calibre5">getNinja();
getSamurai();

function getNinja() {
  return "Yoshi";
}

var getSamurai = () =&gt; "Hattori";</pre>
            <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_25"></div>
<h2 id="ch06" class="part">Chapter 6. <a id="ch06__title" class="calibre3"></a>Functions for the future: generators and promises
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Continuing function execution with generators
            
         </li>
         
         <li class="calibre20">Handling asynchronous tasks with promises
            
         </li>
         
         <li class="calibre20">Achieving elegant asynchronous code by combining generators and promises
            
         </li>
         
      </ul>
      
      <p class="noind">In the previous three chapters, we focused on functions, specifically on how to define functions and how to use them to great
         effect. Although we’ve introduced some ES6 features, such as arrow functions and block scopes, we’ve mostly been exploring
         features that have been part of JavaScript for quite some time. This chapter tackles the cutting edge of ES6 by presenting
         <i class="calibre6">generators</i> and <i class="calibre6">promises</i>, two completely new JavaScript features.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch06note01" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Generators and promises are both introduced by ES6. You can check out current browser support at <a href="http://mng.bz/sOs4" class="calibre4">http://mng.bz/sOs4</a> and <a href="http://mng.bz/Du38" class="calibre4">http://mng.bz/Du38</a>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind"><a id="iddle1598" class="calibre4"></a><a id="iddle1887" class="calibre4"></a><i class="calibre6">Generators</i> are a special type of function. Whereas a standard function produces at most a single value while running its code from start
         to finish, generators produce multiple values, on a per request basis, while suspending their execution between these requests.
         Although new in JavaScript, generators have existed for quite some time in Python, PHP, and C#.
      </p>
      
      <p class="noind">Generators are often considered an almost weird or fringe language feature not often used by the average programmer. Though
         most of this chapter’s examples are designed to teach you how generator functions work, we’ll also explore some practical
         aspects of generators. You’ll see how to use generators to simplify convoluted loops and how to take advantage of generators’
         capability to suspend and resume their execution, which can help you write simpler and more elegant asynchronous code.
      </p>
      
      <p class="noind"><i class="calibre6">Promises</i>, on the other hand, are a new, built-in type of object that help you work with asynchronous code. A promise is a placeholder
         for a value that we don’t have yet but will at some later point. They’re especially good for working with multiple asynchronous
         steps.
      </p>
      
      <p class="noind">In this chapter, you’ll see how both generators and promises work, and we’ll finish off by exploring how to combine them to
         greatly simplify our dealings with asynchronous code. But before going into the specifics, let’s take a sneak peek into how
         much more elegant our asynchronous code can be.
      </p>
      
      <h3 class="calibre24"><a id="ch06qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch06qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch06qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">What are some common uses for a generator function?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch06qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch06qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">Why are promises better than simple callbacks for asynchronous code?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch06qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch06qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">You start a number of long-running tasks with Promise.race. When does the promise resolve? When would it fail to resolve?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch06lev1sec1" class="calibre24"><a id="ch06lev1sec1__title" class="calibre3"></a>6.1. Making our async code elegant with generators and promises
      </h3>
      
      <p class="noind">Imagine that you’re a developer working at <a href="http://freelanceninja.com" class="calibre4">freelanceninja.com</a>, a popular freelance ninja recruitment site enabling customers to hire ninjas for stealth missions. Your task is to implement
         a functionality that lets users get details about the highest-rated mission done by the most popular ninja. The data representing
         the ninjas, the summaries of their missions, as well as the details of the missions are stored on a remote server, encoded
         in JSON. You might write something like this:
      </p>
      
      <pre id="PLd0e13103" class="calibre5">try {
   var ninjas = syncGetJSON("ninjas.json");
   var missions = syncGetJSON(ninjas[0].missionsUrl);
   var missionDetails = syncGetJSON(missions[0].detailsUrl);
   //Study the mission description
}
catch(e){
  //Oh no, we weren't able to get the mission details
}</pre>
      
      <p class="noind"><a id="iddle1164" class="calibre4"></a><a id="iddle1533" class="calibre4"></a><a id="iddle2213" class="calibre4"></a>This code is relatively easy to understand, and if an error occurs in any of the steps, we can easily catch it in the <kbd class="calibre15">catch</kbd> block. But unfortunately, this code has a big problem. Getting data from a server is a long-running operation, and because
         JavaScript relies on a single-threaded execution model, we’ve just blocked our UI until the long-running operations finish.
         This leads to unresponsive applications and disappointed users. To solve this problem, we can rewrite it with callbacks, which
         will be invoked when a task finishes, without blocking the UI:
      </p>
      
      <pre id="PLd0e13131" class="calibre5">getJSON("ninjas.json", function(err, ninjas){
  if(err) {
    console.log("Error fetching list of ninjas", err);
    return;
  }
  getJSON(ninjas[0].missionsUrl, function(err, missions) {
    if(err) {
      console.log("Error locating ninja missions", err);
      return;
    }
  getJSON(missions[0].detailsUrl, function(err, missionDetails){
    if(err) {
      console.log("Error locating mission details", err);
      return;
    }
    //Study the intel plan
    });
  });
});</pre>
      
      <p class="noind">Although this code will be much better received by our users, you’ll probably agree that it’s messy, it adds a lot of boilerplate
         error-handling code, and it’s plain ugly. This is where generators and promises jump in. By combining them, we can turn the
         nonblocking but awkward callback code into something much more elegant:
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/128fig01_alt.jpg" alt="" class="calibre2" width="590" height="241" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/128fig01_alt.jpg"></p>
      
      <p class="noind">Don’t worry if this example doesn’t make much sense or if you find some of the syntax (such as <kbd class="calibre15">function*</kbd> or <kbd class="calibre15">yield</kbd>) unfamiliar. By the end of this chapter, you’ll meet all <a id="iddle1008" class="calibre4"></a><a id="iddle1103" class="calibre4"></a><a id="iddle1505" class="calibre4"></a><a id="iddle1588" class="calibre4"></a><a id="iddle1800" class="calibre4"></a><a id="iddle1801" class="calibre4"></a>the necessary ingredients. For now, it’s enough that you compare the elegance (or the lack thereof) of the nonblocking callback
         code and the nonblocking generators and promises code.
      </p>
      
      <p class="noind">Let’s start slowly by exploring generator functions, the first stepping stone toward elegant asynchronous code.</p>
      
      
      
      <h3 id="ch06lev1sec2" class="calibre24"><a id="ch06lev1sec2__title" class="calibre3"></a>6.2. Working with generator functions
      </h3>
      
      <p class="noind">Generators are a completely new type of function and are significantly different from standard, run-of-the-mill functions.
         A <i class="calibre6">generator</i> is a function that generates a sequence of values, but not all at once, as a standard function would, but on a per request
         basis. We have to explicitly ask the generator for a new value, and the generator will either respond with a value or notify
         us that it has no more values to produce. What’s even more curious is that after a value is produced, a generator function
         doesn’t end its execution, as a normal function would. Instead, a generator is merely suspended. Then, when a request for
         another value comes along, the generator resumes where it left off.
      </p>
      
      <p class="noind">The following listing provides a simple example of using a generator to generate a sequence of weapons.</p>
      
      
      
      <h5 id="ch06ex01" class="notetitle">Listing 6.1. <a id="ch06ex01__title" class="calibre4"></a>Using a generator function to generate a sequence of values
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/129fig01_alt.jpg" alt="" class="calibre2" width="590" height="206" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/129fig01_alt.jpg"></p>
      
      
      <p class="noind">We start by defining a generator that will produce a sequence of weapons. Creating a generator function is simple: We append
         an asterisk (<kbd class="calibre15">*</kbd>) after the <kbd class="calibre15">function</kbd> keyword. This enables us to use the new <kbd class="calibre15">yield</kbd> keyword within the body of the generator to produce individual values. <a href="#ch06fig01" class="calibre4">Figure 6.1</a> illustrates the syntax.
      </p>
      
      
      
      <h5 id="ch06fig01" class="notetitle">Figure 6.1. <a id="ch06fig01__title" class="calibre4"></a>Add an asterisk (*) after the function keyword to define a generator.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig01.jpg" alt="" class="calibre2" width="333" height="330" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig01.jpg"></p>
      
      
      
      <p class="noind">In this example, we create a generator called <kbd class="calibre15">WeaponGenerator</kbd> that produces a sequence of weapons: <kbd class="calibre15">Katana</kbd>, <kbd class="calibre15">Wakizashi</kbd>, and <kbd class="calibre15">Kusarigama</kbd>. One way of consuming that sequence of weapons is by using a new kind of loop, the <kbd class="calibre15">for-of</kbd> loop:
      </p>
      
      <pre id="PLd0e13264" class="calibre5">for(let weapon of WeaponGenerator()) {
  assert(weapon, weapon);
}</pre>
      
      <p class="noind">The result of invoking this <kbd class="calibre15">for-of</kbd> loop is shown in <a href="#ch06fig02" class="calibre4">figure 6.2</a>. (For now, don’t worry much about the <kbd class="calibre15">for-of</kbd> loop, as we’ll explore it later.)
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch06fig02" class="notetitle">Figure 6.2. <a id="ch06fig02__title" class="calibre4"></a>The result of iterating over our <kbd class="calibre15">WeaponGenerator()</kbd></h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig02.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig02.jpg"></p>
      
      
      
      <p class="noind"><a id="iddle1594" class="calibre4"></a><a id="iddle1695" class="calibre4"></a><a id="iddle1795" class="calibre4"></a><a id="iddle1982" class="calibre4"></a>On the right side of the <kbd class="calibre15">for-of</kbd> loop, we’ve placed the result of invoking our generator. But if you take a closer look at the body of the <kbd class="calibre15">WeaponGenerator</kbd> function, you’ll see that there’s no <kbd class="calibre15">return</kbd> statement. What’s up with that? In this case, shouldn’t the right side of the <kbd class="calibre15">for-of loop</kbd> evaluate to <kbd class="calibre15">undefined</kbd>, as would be the case if we were dealing with a standard function?
      </p>
      
      <p class="noind">The truth is that generators are quite unlike standard functions. For starters, calling a generator doesn’t execute the generator
         function; instead it creates an object called an <i class="calibre6">iterator</i>. Let’s explore that object.
      </p>
      
      
      <h4 id="ch06lev2sec1" class="calibre26">6.2.1. <a id="ch06lev2sec1__title" class="calibre4"></a>Controlling the generator through the iterator object
      </h4>
      
      <p class="noind">Making a call to a generator doesn’t mean that the body of the generator function will be executed. Instead, an iterator object
         is created, an object through which we can communicate with the generator. For example, we can use the iterator to request
         additional values. Let’s adjust our previous example to explore how the iterator object works.
      </p>
      
      <h5 id="ch06ex02" class="notetitle">Listing 6.2. <a id="ch06ex02__title" class="calibre4"></a>Controlling a generator through an iterator object
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex02-0.jpg" alt="" class="calibre2" width="590" height="208" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex02-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex02-1.jpg" alt="" class="calibre2" width="590" height="164" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex02-1.jpg"></p>
      
      <p class="noind"><a id="iddle2208" class="calibre4"></a><a id="iddle2214" class="calibre4"></a>As you can see, when we call a generator, a new <i class="calibre6">iterator</i> is created:
      </p>
      
      <pre id="PLd0e13383" class="calibre5">const weaponsIterator = WeaponGenerator();</pre>
      
      <p class="noind">The iterator is used to control the execution of the generator. One of the fundamental things that the iterator object exposes
         is the <kbd class="calibre15">next</kbd> method, which we can use to control the generator by requesting a value from it:
      </p>
      
      <pre id="PLd0e13395" class="calibre5">const result1 = weaponsIterator.next();</pre>
      
      <p class="noind">As a response to that call, the generator executes its code until it reaches a <kbd class="calibre15">yield</kbd> keyword that produces an intermediary result (one item in the generated sequence of items), and returns a <i class="calibre6">new</i> object that encapsulates that result and tells us whether its work is done.
      </p>
      
      <p class="noind">As soon as the current value is produced, the generator suspends its execution without blocking and patiently waits for another
         value request. This is an incredibly powerful feature that standard functions don’t have, a feature that we’ll use later to
         great effect.
      </p>
      
      <p class="noind">In this case, the first call to the iterator’s <kbd class="calibre15">next</kbd> method executes the generator code to the first <kbd class="calibre15">yield</kbd> expression, <kbd class="calibre15">yield "Katana"</kbd>, and returns an object with the property <kbd class="calibre15">value</kbd> set to <kbd class="calibre15">Katana</kbd> and the property <kbd class="calibre15">done</kbd> set to <kbd class="calibre15">false</kbd>, signaling that there are more values to produce.
      </p>
      
      <p class="noind">Later, we request another value from the generator, by making another call to the <kbd class="calibre15">weaponIterator</kbd>’s <kbd class="calibre15">next</kbd> method:
      </p>
      
      <pre id="PLd0e13446" class="calibre5">const result2 = weaponsIterator.next();</pre>
      
      <p class="noind">This wakes up the generator from suspension, and the generator continues where it left off, executing its code until another
         intermediary value is reached: <kbd class="calibre15">yield "Wakizashi"</kbd>. This suspends the generator and produces an object carrying <kbd class="calibre15">Wakizashi</kbd>.
      </p>
      
      <p class="noind">Finally, when we call the <kbd class="calibre15">next</kbd> method for the third time, the generator resumes its execution. But this time there’s no more code to execute, so the generator
         returns an object with <kbd class="calibre15">value</kbd> set to <kbd class="calibre15">undefined</kbd>, and <kbd class="calibre15">done</kbd> set to <kbd class="calibre15">true</kbd>, signaling that it’s done with its work.
      </p>
      
      <p class="noind">Now that you’ve seen how to control generators through iterators, you’re ready to learn how to iterate over the produced values.</p>
      
      
      
      <h5 id="ch06lev3sec1" class="notetitle"><a id="ch06lev3sec1__title" class="calibre4"></a>Iterating the iterator
      </h5>
      
      <p class="noind"><a id="iddle1373" class="calibre4"></a><a id="iddle1506" class="calibre4"></a><a id="iddle1595" class="calibre4"></a><a id="iddle1696" class="calibre4"></a><a id="iddle2189" class="calibre4"></a>The iterator, created by calling a generator, exposes a <kbd class="calibre15">next</kbd> method through which we can request a new value from the generator. The <kbd class="calibre15">next</kbd> method returns an object that carries the value produced by the generator, as well as the information stored in the <kbd class="calibre15">done</kbd> property that tells us whether the generator has additional values to produce.
      </p>
      
      <p class="noind">Now we’ll take advantage of these facts to use a plain old <kbd class="calibre15">while</kbd> loop to iterate over values produced by a generator. See the following listing.
      </p>
      
      
      
      <h5 id="ch06ex03" class="notetitle">Listing 6.3. <a id="ch06ex03__title" class="calibre4"></a>Iterating over generator results with a while loop
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/132fig01_alt.jpg" alt="" class="calibre2" width="590" height="141" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/132fig01_alt.jpg"></p>
      
      
      <p class="noind">Here we again create an iterator object by calling a generator function:</p>
      
      <pre id="PLd0e13555" class="calibre5">const weaponsIterator = WeaponGenerator();</pre>
      
      <p class="noind">We also create an <kbd class="calibre15">item</kbd> variable in which we’ll store individual values produced by the generator. We continue by specifying a <kbd class="calibre15">while</kbd> loop with a slightly complicated looping condition, which we’ll break down a bit:
      </p>
      
      <pre id="PLd0e13570" class="calibre5">while(!(item = weaponsIterator.next()).done) {
  assert(item !== null, item.value)
}</pre>
      
      <p class="noind">On each loop iteration, we fetch a value from the generator by calling the <kbd class="calibre15">next</kbd> method of our <kbd class="calibre15">weaponsIterator</kbd>, and we store that value in the <kbd class="calibre15">item</kbd> variable. Like all such objects, the object referenced by the <kbd class="calibre15">item</kbd> variable has a <kbd class="calibre15">value</kbd> property that stores the value returned from the generator, and a <kbd class="calibre15">done</kbd> property that signals whether the generator is finished producing values. If the generator isn’t done with its work, we go
         into another iteration of the loop; and if it is, we stop looping.
      </p>
      
      <p class="noind">And that’s how the <kbd class="calibre15">for-of</kbd> loop, from our first generator example, works. The <kbd class="calibre15">for-of</kbd> loop is syntactic sugar for iterating over iterators:
      </p>
      
      <pre id="PLd0e13606" class="calibre5">for(var item of WeaponGenerator ()){
  assert(item !== null, item);
}</pre>
      
      <p class="noind">Instead of manually calling the <kbd class="calibre15">next</kbd> method of the matching iterator and always checking whether we’re finished, we can use the <kbd class="calibre15">for-of</kbd> loop to do the exact same thing, only behind the scenes.
      </p>
      
      
      
      
      <h5 id="ch06lev3sec2" class="notetitle"><a id="ch06lev3sec2__title" class="calibre4"></a>Yielding to another generator
      </h5>
      
      <p class="noind"><a id="iddle1596" class="calibre4"></a><a id="iddle1601" class="calibre4"></a><a id="iddle1661" class="calibre4"></a><a id="iddle1697" class="calibre4"></a><a id="iddle2216" class="calibre4"></a>Just as we often call one standard function from another standard function, in certain cases we want to be able to delegate
         the execution of one generator to another. Let’s take a look at an example that generates both warriors and ninjas.
      </p>
      
      
      
      <h5 id="ch06ex04" class="notetitle">Listing 6.4. <a id="ch06ex04__title" class="calibre4"></a>Using yield* to delegate to another generator
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/133fig01_alt.jpg" alt="" class="calibre2" width="590" height="232" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/133fig01_alt.jpg"></p>
      
      
      <p class="noind">If you run this code, you’ll see that the output is <kbd class="calibre15">Sun Tzu</kbd>, <kbd class="calibre15">Hattori</kbd>, <kbd class="calibre15">Yoshi</kbd>, <kbd class="calibre15">Genghis Khan</kbd>. Generating <kbd class="calibre15">Sun Tzu</kbd> probably doesn’t catch you off guard; it’s the first value yielded by the <kbd class="calibre15">WarriorGenerator</kbd>. But the second output, <kbd class="calibre15">Hattori</kbd>, deserves an explanation.
      </p>
      
      <p class="noind">By using the <kbd class="calibre15">yield*</kbd> operator on an iterator, we yield to another generator. In this example, from a <kbd class="calibre15">WarriorGenerator</kbd> we’re yielding to a new <kbd class="calibre15">NinjaGenerator</kbd>; all calls to the current <kbd class="calibre15">WarriorGenerator</kbd> iterator’s <kbd class="calibre15">next</kbd> method are rerouted to the <kbd class="calibre15">NinjaGenerator</kbd>. This holds until the <kbd class="calibre15">NinjaGenerator</kbd> has no work left to do. So in our example, after <kbd class="calibre15">Sun Tzu</kbd>, the program generates <kbd class="calibre15">Hattori</kbd> and <kbd class="calibre15">Yoshi.</kbd> Only when the <kbd class="calibre15">NinjaGenerator</kbd> is done with its work will the execution of the original iterator continue by outputting <kbd class="calibre15">Genghis Khan</kbd>. Notice that this is happening transparently to the code that calls the original generator. The <kbd class="calibre15">for-of</kbd> loop doesn’t care that the <kbd class="calibre15">WarriorGenerator</kbd> yields to another generator; it keeps calling <kbd class="calibre15">next</kbd> until it’s done.
      </p>
      
      <p class="noind">Now that you have a grasp of how generators work in general and how delegating to another generator works, let’s look at a
         couple of practical examples.
      </p>
      
      
      
      
      <h4 id="ch06lev2sec2" class="calibre26">6.2.2. <a id="ch06lev2sec2__title" class="calibre4"></a>Using generators
      </h4>
      
      <p class="noind">Generating sequences of items is all nice and dandy, but let’s get more practical, starting with a simple case of generating
         unique IDs.
      </p>
      
      
      <h5 id="ch06lev3sec3" class="notetitle"><a id="ch06lev3sec3__title" class="calibre4"></a>Using generators to generate IDs
      </h5>
      
      <p class="noind">When creating certain objects, often we need to assign a unique ID to each object. The easiest way to do this is through a
         global counter variable, but that’s kind of ugly because the variable can be accidently messed up from anywhere in our code.
         Another option is to use a generator, as shown in the following listing.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch06ex05" class="notetitle">Listing 6.5. <a id="ch06ex05__title" class="calibre4"></a>Using generators for generating IDs
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/134fig01_alt.jpg" alt="" class="calibre2" width="590" height="238" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/134fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1652" class="calibre4"></a><a id="iddle2190" class="calibre4"></a>This example starts with a generator that has one local variable, <kbd class="calibre15">id</kbd>, which represents our ID counter. The <kbd class="calibre15">id</kbd> variable is local to our generator; there’s no fear that someone will accidently modify it from somewhere else in the code.
         This is followed by an infinite <kbd class="calibre15">while</kbd> loop, which at each iteration yields a new <kbd class="calibre15">id</kbd> value and suspends its execution until a request for another ID comes along:
      </p>
      
      <pre id="PLd0e13811" class="calibre5">function *IdGenerator(){
  let id = 0;
  while(true){
    yield ++id;
  }
}</pre>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch06note02" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Writing infinite loops isn’t something that we generally want to do in a standard function. But with generators, everything
         is fine! Whenever the generator encounters a <kbd class="calibre15">yield</kbd> statement, the generator execution is suspended until the <kbd class="calibre15">next</kbd> method is called again. So every <kbd class="calibre15">next</kbd> call executes only one iteration of our infinite <kbd class="calibre15">while</kbd> loop and sends back the next ID value.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">After defining the generator, we create an iterator object:</p>
      
      <pre id="PLd0e13840" class="calibre5">const idIterator = IdGenerator();</pre>
      
      <p class="noind">This allows us to control the generator with calls to the <kbd class="calibre15">idIterator.next()</kbd> method. This executes the generator until a <kbd class="calibre15">yield</kbd> is encountered, returning a new ID value that we can use for our objects:
      </p>
      
      <pre id="PLd0e13855" class="calibre5">const ninja1 = { id: idIterator.next().value };</pre>
      
      <p class="noind">See how simple this is? No messy global variables whose value can be accidentally changed. Instead, we use an iterator to
         request values from a generator. In addition, if <a id="iddle1366" class="calibre4"></a><a id="iddle1602" class="calibre4"></a><a id="iddle2133" class="calibre4"></a>later we need another iterator for tracking the IDs of, for example, <kbd class="calibre15">samurai</kbd>, we can initialize a new generator for that.
      </p>
      
      
      
      <h5 id="ch06lev3sec4" class="notetitle"><a id="ch06lev3sec4__title" class="calibre4"></a>Using generators to traverse the DOM
      </h5>
      
      <p class="noind">As you saw in <a href="kindle_split_012.html#ch02" class="calibre4">chapter 2</a>, the layout of a web page is based on the DOM, a tree-like structure of HTML nodes, in which every node, except the root
         one, has exactly one parent, and can have zero or more children. Because the DOM is such a fundamental structure in web development,
         a lot of our code is based around traversing it. One relatively easy way to do this is by implementing a recursive function
         that will be executed for each visited node. See the following code.
      </p>
      
      
      
      <h5 id="ch06ex06" class="notetitle">Listing 6.6. <a id="ch06ex06__title" class="calibre4"></a>Recursive DOM traversal
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/135fig01_alt.jpg" alt="" class="calibre2" width="590" height="325" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/135fig01_alt.jpg"></p>
      
      
      <p class="noind">In this example, we use a recursive function to traverse all descendants of the element with the <kbd class="calibre15">id subtree</kbd>, in the process logging each type of node that we visit. In this case, the code outputs <kbd class="calibre15">DIV</kbd>, <kbd class="calibre15">FORM</kbd>, <kbd class="calibre15">INPUT</kbd>, <kbd class="calibre15">P</kbd>, and <kbd class="calibre15">SPAN</kbd>.
      </p>
      
      <p class="noind">We’ve been writing such DOM traversal code for a while now, and it has served us perfectly fine. But now that we have generators
         at our disposal, we can do it differently; see the following code.
      </p>
      
      
      
      <h5 id="ch06ex07" class="notetitle">Listing 6.7. <a id="ch06ex07__title" class="calibre4"></a>Iterating over a DOM tree with generators
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/135fig02_alt.jpg" alt="" class="calibre2" width="590" height="215" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/135fig02_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1233" class="calibre4"></a><a id="iddle1234" class="calibre4"></a><a id="iddle1507" class="calibre4"></a><a id="iddle1590" class="calibre4"></a><a id="iddle1591" class="calibre4"></a><a id="iddle1796" class="calibre4"></a>This listing shows that we can achieve DOM traversals with generators, just as easily as with standard recursion, but with
         the aditional benefit of not having to use the slightly awkward syntax of callbacks. Instead of processing the subtree of
         each visited node by recursing another level, we create one generator function for each visited node and yield to it. This
         enables us to write what’s conceptually recursive code in iterable fashion. The benefit is that we can consume the generated
         sequence of nodes with a simple <kbd class="calibre15">for-of</kbd> loop, without resorting to nasty callbacks.
      </p>
      
      <p class="noind">This example is a particulary good one, because it also shows how to use generators in order to separate the code that’s producing
         values (in this case, HTML nodes) from the code that’s consuming the sequence of generated values (in this case, the <kbd class="calibre15">for-of</kbd> loop that logs the visited nodes), without having to resort to callbacks. In addition, using iterations is, in certain cases,
         much more natural than recursion, so it’s always good to have our options open.
      </p>
      
      <p class="noind">Now that we’ve explored some practical aspects of generators, let’s go back to a slighty more theoretical topic and see how
         to exchange data with a running generator.
      </p>
      
      
      
      
      <h4 id="ch06lev2sec3" class="calibre26">6.2.3. <a id="ch06lev2sec3__title" class="calibre4"></a>Communicating with a generator
      </h4>
      
      <p class="noind">In the examples presented so far, you’ve seen how to return multiple values <i class="calibre6">from</i> a generator by using <kbd class="calibre15">yield</kbd> expressions. But generators are even more powerful than that! We can also send data <i class="calibre6">to</i> a generator, thereby achieving two-way communication! With a generator, we can produce an intermediary result, use that result
         to calculate something else from outside the generator, and then, whenever we’re ready, send completely new data back to the
         generator and resume its execution. We’ll use this feature to great effect at the end of the chapter to deal with asynchronous
         code, but for now, let’s keep it simple.
      </p>
      
      
      <h5 id="ch06lev3sec5" class="notetitle"><a id="ch06lev3sec5__title" class="calibre4"></a>Sending values as generator function arguments
      </h5>
      
      <p class="noind">The easiest way to send data to a generator is by treating it like any other function and using function call arguments. Take
         a look at the following listing.
      </p>
      
      
      
      <h5 id="ch06ex08" class="notetitle">Listing 6.8. <a id="ch06ex08__title" class="calibre4"></a>Sending data to and receiving data from a generator
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/136fig01_alt.jpg" alt="" class="calibre2" width="590" height="319" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/136fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1236" class="calibre4"></a><a id="iddle1593" class="calibre4"></a><a id="iddle2166" class="calibre4"></a><a id="iddle2209" class="calibre4"></a>A function receiving data is nothing special; plain old functions do it all the time. But remember, generators have this amazing
         power; they can be suspended and resumed. And it turns out that, unlike standard functions, generators can even receive data
         <i class="calibre6">after</i> their execution has started, whenever we resume them by requesting the next value.
      </p>
      
      
      
      <h5 id="ch06lev3sec6" class="notetitle"><a id="ch06lev3sec6__title" class="calibre4"></a>Using the next method to send values into a generator
      </h5>
      
      <p class="noind">In addition to providing data when first invoking the generator, we can send data <i class="calibre6">into</i> a generator by passing arguments to the <kbd class="calibre15">next</kbd> method. In the process, we wake up the generator from suspension and resume its execution. This passed-in value is used by
         the generator as the value of the whole <kbd class="calibre15">yield</kbd> expression, in which the generator was currently suspended, as shown in <a href="#ch06fig03" class="calibre4">figure 6.3</a>.
      </p>
      
      
      
      <h5 id="ch06fig03" class="notetitle">Figure 6.3. <a id="ch06fig03__title" class="calibre4"></a>The first call to <kbd class="calibre15">ninjaIterator.next()</kbd> requests a new value from the generator, which returns <kbd class="calibre15">Hattori skulk</kbd> and suspends the execution of the generator at the <kbd class="calibre15">yield</kbd> expression. The second call to <kbd class="calibre15">ninjaIterator.next("Hanzo")</kbd> requests a new value, but also sends the argument <kbd class="calibre15">Hanzo</kbd> into the generator. This value will be used as the value of the whole <kbd class="calibre15">yield</kbd> expression, and the variable <kbd class="calibre15">imposter</kbd> will now carry the value <kbd class="calibre15">Hanzo</kbd>.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig03_alt.jpg" alt="" class="calibre2" width="590" height="238" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig03_alt.jpg"></p>
      
      
      <p class="noind">In this example, we have two calls to the <kbd class="calibre15">ninjaIterator</kbd>’s <kbd class="calibre15">next</kbd> method. The first call, <kbd class="calibre15">ninjaIterator.next()</kbd>, requests the first value from the generator. Because our generator hasn’t started executing, this call starts the generator,
         which calculates the <a id="iddle1165" class="calibre4"></a><a id="iddle1235" class="calibre4"></a><a id="iddle1434" class="calibre4"></a><a id="iddle1592" class="calibre4"></a><a id="iddle2117" class="calibre4"></a><a id="iddle2119" class="calibre4"></a><a id="iddle2134" class="calibre4"></a>value of the expression <kbd class="calibre15">"Hattori " + action,</kbd> yields the <kbd class="calibre15">Hattori skulk</kbd> value, and suspends the generator’s execution. There’s nothing special about this; we’ve done something similar multiple
         times throughout this chapter.
      </p>
      
      <p class="noind">The interesting thing happens on the second call to the <kbd class="calibre15">ninjaIterator</kbd>’s <kbd class="calibre15">next</kbd> method: <kbd class="calibre15">ninjaIterator.next("Hanzo")</kbd>. This time, we’re using the <kbd class="calibre15">next</kbd> method to pass data back to the generator. Our generator function is patiently waiting, suspended at the expression <kbd class="calibre15">yield ("Hattori " + action)</kbd>, so the value <kbd class="calibre15">Hanzo</kbd>, passed as the argument to <kbd class="calibre15">next()</kbd>, is used as the value of the whole <kbd class="calibre15">yield</kbd> expression. In our case, this means that the variable <kbd class="calibre15">imposter</kbd> in <kbd class="calibre15">imposter = yield ("Hattori " + action)</kbd> will end up with the value <kbd class="calibre15">Hanzo</kbd>.
      </p>
      
      <p class="noind">That’s how we achieve two-way communication with a generator. We use <kbd class="calibre15">yield</kbd> to return data from a generator, and the <kbd class="calibre15">iterator</kbd>’s <kbd class="calibre15">next()</kbd> method to pass data back to the generator.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch06note03" class="notetitle">Note</h5>
      
      
      <p class="noindclose">The <kbd class="calibre15">next</kbd> method supplies the value to the waiting <kbd class="calibre15">yield</kbd> expression, so if there’s no <kbd class="calibre15">yield</kbd> expression waiting, there’s nothing to supply the value to. For this reason, we <i class="calibre6">can’t</i> supply values over the first call to the <kbd class="calibre15">next</kbd> method. But remember, if you need to supply an initial value to the generator, you can do so when calling the generator itself,
         as we did with <kbd class="calibre15">NinjaGenerator("skulk")</kbd>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      
      <h5 id="ch06lev3sec7" class="notetitle"><a id="ch06lev3sec7__title" class="calibre4"></a>Throwing exceptions
      </h5>
      
      <p class="noind">There’s another, slightly less orthodox, way to supply a value to a generator: by throwing an exception. Each iterator, in
         addition to having a <kbd class="calibre15">next</kbd> method, has a <kbd class="calibre15">throw</kbd> method that we can use to throw an exception back to the generator. Again, let’s look at a simple example.
      </p>
      
      
      
      <h5 id="ch06ex09" class="notetitle">Listing 6.9. <a id="ch06ex09__title" class="calibre4"></a>Throwing exceptions to generators
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/138fig01_alt.jpg" alt="" class="calibre2" width="590" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/138fig01_alt.jpg"></p>
      
      
      <p class="noind"><a href="#ch06ex09" class="calibre4">Listing 6.9</a> starts similarly to <a href="#ch06ex08" class="calibre4">listing 6.8</a>, by specifying a generator called <kbd class="calibre15">NinjaGenerator</kbd>. But this time, the body of the generator is slightly different. We’ve surrounded the whole function body code with a <kbd class="calibre15">try-catch</kbd> block:
      </p>
      
      
      <pre id="PLd0e14328" class="calibre5">function* NinjaGenerator() {
  try{
    yield "Hattori";
    fail("The expected exception didn't occur");
  }
  catch(e){
    assert(e === "Catch this!", "Aha! We caught an exception");
  }
}</pre>
      
      <p class="noind"><a id="iddle1438" class="calibre4"></a><a id="iddle2083" class="calibre4"></a>We then continue by creating an iterator, and getting one value from the generator:
      </p>
      
      <pre id="PLd0e14347" class="calibre5">const ninjaIterator = NinjaGenerator();
const result1 = ninjaIterator.next();</pre>
      
      <p class="noind">Finally, we use the <kbd class="calibre15">throw</kbd> method, available on all iterators, to throw an exception back to the generator:
      </p>
      
      <pre id="PLd0e14359" class="calibre5">ninjaIterator.throw("Catch this!");</pre>
      
      <p class="noind">By running this listing, we can see that our exception throwing works as expected, as shown in <a href="#ch06fig04" class="calibre4">figure 6.4</a>.
      </p>
      
      
      
      <h5 id="ch06fig04" class="notetitle">Figure 6.4. <a id="ch06fig04__title" class="calibre4"></a>We can throw exceptions to generators from outside a generator.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig04.jpg" alt="" class="calibre2" width="388" height="254" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig04.jpg"></p>
      
      
      
      <p class="noind">This feature that enables us to throw exceptions back to generators might feel a bit strange at first. Why would we even want
         to do that? Don’t worry; we won’t keep you in the dark for long. At the end of this chapter, we’ll use this feature to improve
         asynchronous server-side communication. Just be patient a bit longer.
      </p>
      
      <p class="noind">Now that you’ve seen several aspects of generators, we’re ready to take a look under the hood to see how generators work.</p>
      
      
      
      
      <h4 id="ch06lev2sec4" class="calibre26">6.2.4. <a id="ch06lev2sec4__title" class="calibre4"></a>Exploring generators under the hood
      </h4>
      
      <p class="noind">So far we know that calling a generator doesn’t execute it. Instead, it creates a new iterator that we can use to request
         values from the generator. After a generator produces (or yields) a value, it suspends its execution and waits for the next
         request. So in a way, a generator works almost like a small program, a state machine that moves between states:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Suspended start—</i> </b>When the generator is created, it starts in this state. None of the generator’s code is executed.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Executing—</i> </b>The state in which the code of the generator is executed. The execution continues either from the beginning or from where
            the generator was last suspended. A generator moves to this state when the matching iterator’s <kbd class="calibre15">next</kbd> method is called, and there exists code to be executed.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Suspended yield—</i> </b><a id="iddle1797" class="calibre4"></a><a id="iddle1983" class="calibre4"></a><a id="iddle2210" class="calibre4"></a>During execution, when a generator reaches a <kbd class="calibre15">yield</kbd> expression, it creates a new object carrying the return value, yields it, and suspends its execution. This is the state in
            which the generator is paused and is waiting to continue its execution.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Completed—</i> </b>If during execution the generator either runs into a <kbd class="calibre15">return</kbd> statement or runs out of code to execute, the generator moves into this state.
            
         </li>
         
      </ul>
      
      <p class="noind"><a href="#ch06fig05" class="calibre4">Figure 6.5</a> illustrates these states.
      </p>
      
      
      
      <h5 id="ch06fig05" class="notetitle">Figure 6.5. <a id="ch06fig05__title" class="calibre4"></a>During execution, a generator moves between states triggered by calls to the matching iterator’s <kbd class="calibre15">next</kbd> method.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig05_alt.jpg" alt="" class="calibre2" width="590" height="497" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig05_alt.jpg"></p>
      
      
      <p class="noind">Now let’s supplement this on an even deeper level, by seeing how the execution of generators is tracked with execution contexts.</p>
      
      
      
      <h5 id="ch06lev3sec8" class="notetitle"><a id="ch06lev3sec8__title" class="calibre4"></a>Tracking generators with execution contexts
      </h5>
      
      <p class="noind"><a id="iddle1441" class="calibre4"></a><a id="iddle1600" class="calibre4"></a>In the previous chapter, we introduced the execution context, an internal JavaScript mechanism used to track the execution
         of functions. Although somewhat special, generators are still functions, so let’s take a closer look by exploring the relationship
         between them and execution contexts. We’ll start with a simple code fragment:
      </p>
      
      <pre id="PLd0e14512" class="calibre5">function* NinjaGenerator(action) {
  yield "Hattori " + action;
  return "Yoshi " + action;
}

const ninjaIterator = NinjaGenerator("skulk");
const result1 = ninjaIterator.next();
const result2 = ninjaIterator.next();</pre>
      
      <p class="noind">Here we reuse our generator that produces two values: <kbd class="calibre15">Hattori skulk</kbd> and <kbd class="calibre15">Yoshi skulk</kbd>.
      </p>
      
      <p class="noind">Now, we’ll explore the state of the application, the execution context stack at various points in the application execution.
         <a href="#ch06fig06" class="calibre4">Figure 6.6</a> gives a snapshot at two positions in the application execution. The first snapshot shows the state of the application execution
         <i class="calibre6">before</i> calling the <kbd class="calibre15">NinjaGenerator</kbd> function <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg">. Because we’re executing global code, the execution context stack contains only the global execution context, which references
         the global environment in which our identifiers are kept. Only the <kbd class="calibre15">NinjaGenerator</kbd> identifier references a function, while the values of all other identifiers are <kbd class="calibre15">undefined</kbd>.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch06fig06" class="notetitle">Figure 6.6. <a id="ch06fig06__title" class="calibre4"></a>The state of the execution context stack <i class="calibre6">before</i> calling the <kbd class="calibre15">NinjaGenerator</kbd> function <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-01.jpg">, and <i class="calibre6">when</i> calling the <kbd class="calibre15">NinjaGenerator</kbd> function <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg"></h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig06_alt.jpg" alt="" class="calibre2" width="590" height="703" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig06_alt.jpg"></p>
      
      
      <p class="noind">When we make the call to the <kbd class="calibre15">NinjaGenerator</kbd> function <img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg" alt="" class="calibre2" width="24" height="24" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/num-02.jpg"></p>
      
      <pre id="PLd0e14590" class="calibre5">const ninjaIterator = NinjaGenerator("skulk");</pre>
      
      <p class="noind">the control flow enters the generator and, as it happens when we enter any other function, a new <kbd class="calibre15">NinjaGenerator</kbd> execution context item is created (alongside the matching lexical environment) and pushed onto the stack. But because generators
         are special, <i class="calibre6">none</i> of the function code is executed. Instead, a new iterator, which we’ll refer to in the code as <kbd class="calibre15">ninjaIterator</kbd>, is created and returned. Because the iterator is used to control the execution of the generator, the iterator gets a reference
         to the execution context in which it was created.
      </p>
      
      <p class="noind">An interesting thing happens when the program execution leaves the generator, as shown in <a href="#ch06fig07" class="calibre4">figure 6.7</a>. Typically, when program execution returns from a standard function, the matching execution context is popped from the stack
         and completely discarded. But this isn’t the case with generators.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch06fig07" class="notetitle">Figure 6.7. <a id="ch06fig07__title" class="calibre4"></a>The state of the application when returning from the <kbd class="calibre15">NinjaGenerator</kbd> call
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig07_alt.jpg" alt="" class="calibre2" width="590" height="528" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig07_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1798" class="calibre4"></a>The matching <kbd class="calibre15">NinjaGenerator</kbd> stack item <i class="calibre6">is</i> popped from the stack, but it’s <i class="calibre6">not</i> discarded, because the <kbd class="calibre15">ninjaIterator</kbd> keeps a reference to it. You can see it as an analogue to closures. In closures, we need to keep alive the variables that
         are alive at the moment the function closure is created, so our functions keep a reference to the environment in which they
         were created. In this way, we make sure that the environment and its variables are alive as long as the function itself. Generators,
         on the other hand, have to be able to resume their execution. Because the execution of all functions is handled by execution
         contexts, the iterator keeps a reference to its execution context, so that it’s alive for as long as the iterator needs it.
      </p>
      
      <p class="noind">Another interesting thing happens when we call the <kbd class="calibre15">next</kbd> method on the iterator:
      </p>
      
      <pre id="PLd0e14656" class="calibre5">const result1 = ninjaIterator.next();</pre>
      
      <p class="noind">If this was a standard straightforward function call, this would cause the creation of a <i class="calibre6">new</i> <kbd class="calibre15">next()</kbd> execution context item, which would be placed on the stack. But as you might have noticed, generators are anything but standard,
         and a call to the <kbd class="calibre15">next</kbd> method of an iterator behaves a lot differently. It reactivates the matching execution context, in this case, the <kbd class="calibre15">NinjaGenerator</kbd> context, and places it on top of the stack, continuing the execution where it left off, as shown in <a href="#ch06fig08" class="calibre4">figure 6.8</a>.
      </p>
      
      
      
      <h5 id="ch06fig08" class="notetitle">Figure 6.8. <a id="ch06fig08__title" class="calibre4"></a>Calling the iterator’s <kbd class="calibre15">next</kbd> method reactivates the execution context stack item of the matching generator, pushes it on the stack, and continues where
         it left off the last time.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig08_alt.jpg" alt="" class="calibre2" width="590" height="484" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig08_alt.jpg"></p>
      
      
      <p class="noind"><a href="#ch06fig08" class="calibre4">Figure 6.8</a> illustrates a crucial difference between standard functions and generators. Standard functions can only be called anew, and
         each call creates a <i class="calibre6">new</i> execution context. In contrast, the execution context of a generator can be temporarily suspended and resumed at will.
      </p>
      
      <p class="noind">In our example, because this is the first call to the <kbd class="calibre15">next</kbd> method, and the generator hasn’t started executing, the generator starts its execution and moves to the Executing state.
         The next interesting thing happens when our generator function reaches this point:
      </p>
      
      <pre id="PLd0e14709" class="calibre5">yield "Hattori " + action</pre>
      
      <p class="noind"><a id="iddle2084" class="calibre4"></a><a id="iddle2215" class="calibre4"></a>The generator determines that the expression equals <kbd class="calibre15">Hattori skulk</kbd>, and the evaluation reaches the <kbd class="calibre15">yield</kbd> keyword. This means that <kbd class="calibre15">Hattori skulk</kbd> is the first intermediary result of our generator and that we want to suspend the execution of the generator and return that
         value. In terms of the application state, a similar thing happens as before: the <kbd class="calibre15">NinjaGenerator</kbd> context is taken off the stack, but it’s not completely discarded, because <kbd class="calibre15">ninjaIterator</kbd> keeps a reference to it. The generator is now suspended, and has moved to the Suspended Yield state, without blocking. The
         program execution resumes in global code, by storing the yielded value to <kbd class="calibre15">result1</kbd>. The current state of the application is shown in <a href="#ch06fig09" class="calibre4">figure 6.9</a>.
      </p>
      
      
      
      <h5 id="ch06fig09" class="notetitle">Figure 6.9. <a id="ch06fig09__title" class="calibre4"></a>After yielding a value, the generator’s execution context is popped from the stack (but isn’t discarded, because <kbd class="calibre15">ninjaIterator</kbd> keeps a reference to it), and the generator execution is suspended (the generator moves to the Suspended yield state).
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig09_alt.jpg" alt="" class="calibre2" width="590" height="507" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig09_alt.jpg"></p>
      
      
      <p class="noind">The code continues by reaching another iterator call:</p>
      
      <pre id="PLd0e14767" class="calibre5">const result2 = ninjaIterator.next();</pre>
      
      <p class="noind"><a id="iddle1878" class="calibre4"></a><a id="iddle1962" class="calibre4"></a><a id="iddle1975" class="calibre4"></a><a id="iddle1984" class="calibre4"></a><a id="iddle2112" class="calibre4"></a><a id="iddle2211" class="calibre4"></a>At this point, we go through the whole procedure once again: we reactivate the <kbd class="calibre15">NinjaGenerator</kbd> context referenced by <kbd class="calibre15">ninjaIterator</kbd>, push it onto the stack, and continue the execution where we left off. In this case, the generator evaluates the expression
         <kbd class="calibre15">"Yoshi " + action</kbd>. But this time there’s no <kbd class="calibre15">yield</kbd> expression, and instead the program encounters a <kbd class="calibre15">return</kbd> statement. This returns the value <kbd class="calibre15">Yoshi skulk</kbd> and completes the generator’s execution by moving the generator into the Completed state.
      </p>
      
      <p class="noind">Uff, this was something! We went deep into how generators work under the hood to show you that all the wonderful benefits
         of generators are a side effect of the fact that a generator’s execution context is kept alive if we yield from a generator,
         and not destroyed as is the case with return values and standard functions.
      </p>
      
      <p class="noind">Now we recommend that you take a quick breather before continuing on to the second key ingredient required for writing elegant
         asynchronous code: promises.
      </p>
      
      
      
      
      
      <h3 id="ch06lev1sec3" class="calibre24"><a id="ch06lev1sec3__title" class="calibre3"></a>6.3. Working with promises
      </h3>
      
      <p class="noind">In JavaScript, we rely a lot on asynchronous computations, computations whose results we don’t have yet but will at some later
         point. So ES6 has introduced a new concept that makes handling asynchronous tasks easier: promises.
      </p>
      
      <p class="noind">A <i class="calibre6">promise</i> is a placeholder for a value that we don’t have now but will have later; it’s a guarantee that we’ll eventually know the
         result of an asynchronous computation. If we make good on our promise, our result will be a value. If a problem occurs, our
         result will be an error, an excuse for why we couldn’t deliver. One great example of using promises is fetching data from
         a server; we promise that we’ll eventually get the data, but there’s always a chance that problems will occur.
      </p>
      
      <p class="noind">Creating a new promise is easy, as you can see in the following example.</p>
      
      
      
      <h5 id="ch06ex10" class="notetitle">Listing 6.10. <a id="ch06ex10__title" class="calibre4"></a>Creating a simple promise
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/146fig01_alt.jpg" alt="" class="calibre2" width="590" height="253" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/146fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1157" class="calibre4"></a><a id="iddle1442" class="calibre4"></a><a id="iddle1475" class="calibre4"></a><a id="iddle2080" class="calibre4"></a><a id="iddle2136" class="calibre4"></a>To create a promise, we use the new, built-in <kbd class="calibre15">Promise</kbd> constructor, to which we pass a function, in this case an arrow function (but we could just as easily use a function expression).
         This function, called an <i class="calibre6">executor</i> function, has two parameters: <kbd class="calibre15">resolve</kbd> and <kbd class="calibre15">reject</kbd>. The executor is called <i class="calibre6">immediately</i> when constructing the <kbd class="calibre15">Promise</kbd> object with two built-in functions as arguments: <kbd class="calibre15">resolve</kbd>, which we manually call if we want the promise to resolve successfully, and <kbd class="calibre15">reject</kbd>, which we call if an error occurs.
      </p>
      
      <p class="noind">This code uses the promise by calling the built-in <kbd class="calibre15">then</kbd> method on the <kbd class="calibre15">Promise</kbd> object, a method to which we pass two callback functions: a <i class="calibre6">success</i> callback and a <i class="calibre6">failure</i> callback. The former is called if the promise is resolved successfully (if the <kbd class="calibre15">resolve</kbd> function is called on the promise), and the latter is called if there’s a problem (either an unhandled exception occurs or
         the <kbd class="calibre15">reject</kbd> function is called on a promise).
      </p>
      
      <p class="noind">In our example code, we create a promise and immediately resolve it by calling the <kbd class="calibre15">resolve</kbd> function with the argument <kbd class="calibre15">Hattori</kbd>. Therefore, when we call the <kbd class="calibre15">then</kbd> method, the first, success, callback is executed and the test that outputs <kbd class="calibre15">We were promised Hattori!</kbd> passes.
      </p>
      
      <p class="noind">Now that we have a general idea of what promises are and how they work, let’s take a step back to see some of the problems
         that promises tackle.
      </p>
      
      
      <h4 id="ch06lev2sec5" class="calibre26">6.3.1. <a id="ch06lev2sec5__title" class="calibre4"></a>Understanding the problems with simple callbacks
      </h4>
      
      <p class="noind">We use asynchronous code because we don’t want to block the execution of our application (thereby disappointing our users)
         while long-running tasks are executing. Currently, we solve this problem with callbacks: To a long-running task we provide
         a function, a callback that’s invoked when the task is finally done.
      </p>
      
      <p class="noind">For example, fetching a JSON file from a server is a long-running task, during which we don’t want to make the application
         unresponsive for our users. Therefore, we provide a callback that will be invoked when the task is done:
      </p>
      
      <pre id="PLd0e14974" class="calibre5">getJSON("data/ninjas.json", function() {
  /*Handle results*/
});</pre>
      
      <p class="noind">Naturally, during this long-running task, errors can happen. And the problem with callbacks is that you can’t use built-in
         language constructs, such as <kbd class="calibre15">try-catch</kbd> statements, in the following way:
      </p>
      
      <pre id="PLd0e14986" class="calibre5">try {
  getJSON("data/ninjas.json", function() {
    //Handle results
  });
} catch(e) {/*Handle errors*/}</pre>
      
      <p class="noind">This happens because the code invoking the callback usually isn’t executed in the same step of the event loop as the code
         that starts the long-running task (you’ll see exactly what this means when you learn more about the event loop in <a href="kindle_split_026.html#ch13" class="calibre4">chapter 13</a>). <a id="iddle1329" class="calibre4"></a>As a consequence, errors usually get lost. Many libraries, therefore, define their own conventions for reporting errors. For
         example, in the Node.js world, callbacks customarily take two arguments, <kbd class="calibre15">err</kbd> and <kbd class="calibre15">data</kbd>, where <kbd class="calibre15">err</kbd> will be a non-null value if an error occurs somewhere along the way. This leads to the first problem with callbacks: <i class="calibre6">difficult error handling</i>.
      </p>
      
      <p class="noind">After we’ve performed a long-running task, we often want to do something with the obtained data. This can lead to starting
         another long-running task, which can eventually trigger yet another long-running task, and so on—leading to a series of interdependent,
         asynchronous, callback-processed steps. For example, if we want to execute a sneaky plan to find all ninjas at our disposal,
         get the location of the first ninja, and send him some orders, we’d end up with something like this:
      </p>
      
      <pre id="PLd0e15020" class="calibre5">getJSON("data/ninjas.json", function(err, ninjas){
  getJSON(ninjas[0].location, function(err, locationInfo){
    sendOrder(locationInfo, function(err, status){
     /*Process status*/
    })
  })
});</pre>
      
      <p class="noind">You’ve probably ended up, at least once or twice, with similarly structured code—a bunch of nested callbacks that represent
         a series of steps that have to be made. You might notice that this code is difficult to understand, inserting new steps is
         a pain, and error handling complicates your code significantly. You get this “pyramid of doom” that keeps growing and is difficult
         to manage. This leads us to the second problem with callbacks: <i class="calibre6">performing sequences of steps is tricky.</i></p>
      
      <p class="noind">Sometimes, the steps that we have to go through to get to the final result don’t depend on each other, so we don’t have to
         make them in sequence. Instead, to save precious milliseconds, we can do them in parallel. For example, if we want to set
         a plan in motion that requires us to know which ninjas we have at our disposal, the plan itself, and the location where our
         plan will play out, we could take advantage of jQuery’s <kbd class="calibre15">get</kbd> method and write something like this:
      </p>
      
      <pre id="PLd0e15037" class="calibre5">var ninjas, mapInfo, plan;

$.get("data/ninjas.json", function(err, data){
  if(err) { processError(err); return; }
  ninjas = data;
  actionItemArrived();
});

$.get("data/mapInfo.json", function(err, data){
  if(err) { processError(err); return; }
  mapInfo = data;
  actionItemArrived();
});

$.get("plan.json", function(err, data) {
  if(err) { processError(err); return; }

  plan = data;
  actionItemArrived ();
});

function actionItemArrived(){
  if(ninjas != null &amp;&amp; mapInfo != null &amp;&amp; plan != null){
    console.log("The plan is ready to be set in motion!");
  }
}

function processError(err){
  alert("Error", err)
}</pre>
      
      <p class="noind"><a id="iddle1859" class="calibre4"></a><a id="iddle1888" class="calibre4"></a><a id="iddle1976" class="calibre4"></a><a id="iddle2137" class="calibre4"></a><a id="iddle2152" class="calibre4"></a>In this code, we execute the actions of getting the ninjas, getting the map info, and getting the plan in parallel, because
         these actions don’t depend on each other. We only care that, in the end, we have all the data at our disposal. Because we
         don’t know the order in which the data is received, every time we get some data, we have to check whether it’s the last piece
         of the puzzle that we’re missing. Finally, when all pieces are in place, we can set our plan in motion. Notice that we have
         to write a lot of boilerplate code just to do something as common as executing a number of actions in parallel. This leads
         us to the third problem with callbacks: <i class="calibre6">performing a number of steps in parallel is also tricky.</i></p>
      
      <p class="noind">When presenting the first problem with callbacks—dealing with errors—we showed how we can’t use some of the fundamental language
         constructs, such as <kbd class="calibre15">try-catch</kbd> statements. A similar thing holds with loops: If you want to perform asynchronous actions for each item in a collection,
         you have to jump through some more hoops to get it done.
      </p>
      
      <p class="noind">It’s true that you can make a library to simplify dealing with all these problems (and many people have). But this often leads
         to a lot of slightly different ways of dealing with the same problems, so the people behind JavaScript have bestowed upon
         us <i class="calibre6">promises</i>, a standard approach for dealing with asynchronous computation.
      </p>
      
      <p class="noind">Now that you understand most of the reasons behind the introduction of promises, as well as have a basic understanding of
         them, let’s take it up a notch.
      </p>
      
      
      
      <h4 id="ch06lev2sec6" class="calibre26">6.3.2. <a id="ch06lev2sec6__title" class="calibre4"></a>Diving into promises
      </h4>
      
      <p class="noind">A promise is an object that serves as a placeholder for a result of an asynchronous task. It represents a value that we don’t
         have but hope to have in the future. For this reason, during its lifetime, a promise can go through a couple of states, as
         shown in <a href="#ch06fig10" class="calibre4">figure 6.10</a>.
      </p>
      
      
      
      <h5 id="ch06fig10" class="notetitle">Figure 6.10. <a id="ch06fig10__title" class="calibre4"></a>States of a promise
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig10_alt.jpg" alt="" class="calibre2" width="590" height="278" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig10_alt.jpg"></p>
      
      
      <p class="noind">A promise starts in the <i class="calibre6">pending</i> state, in which we know nothing about our promised value. That’s why a promise in the pending state is also called an <kbd class="calibre15">unresolved</kbd> promise. During program execution, if the promise’s <kbd class="calibre15">resolve</kbd> function is called, the <a id="iddle1515" class="calibre4"></a><a id="iddle1963" class="calibre4"></a><a id="iddle2113" class="calibre4"></a>promise moves into the <i class="calibre6">fulfilled</i> state, in which we’ve successfully obtained the promised value. On the other hand, if the promise’s <kbd class="calibre15">reject</kbd> function is called, or if an unhandled exception occurs during promise handling, the promise moves into the <i class="calibre6">rejected</i> state, in which we weren’t able to obtain the promised value, but in which we at least know why. Once a promise has reached
         either the <i class="calibre6">fulfilled</i> state or the <i class="calibre6">rejected</i> state, it can’t switch (a promise can’t go from fulfilled to rejected or vice versa), and it always stays in that state.
         We say that a promise is <i class="calibre6">resolved</i> (either successfully or not).
      </p>
      
      <p class="noind">The following listing provides a closer look at what’s going on when we use promises.</p>
      
      <h5 id="ch06ex11" class="notetitle">Listing 6.11. <a id="ch06ex11__title" class="calibre4"></a>A closer look at promise order of execution
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex11-0.jpg" alt="" class="calibre2" width="590" height="199" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex11-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex11-1.jpg" alt="" class="calibre2" width="590" height="279" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex11-1.jpg"></p>
      
      <p class="noind"><a id="iddle1443" class="calibre4"></a><a id="iddle1860" class="calibre4"></a><a id="iddle1879" class="calibre4"></a>The code in <a href="#ch06ex11" class="calibre4">listing 6.11</a> outputs the results shown in <a href="#ch06fig11" class="calibre4">figure 6.11</a>. As you can see, the code starts by logging the “At code start” message by using our custom-made <kbd class="calibre15">report</kbd> function (<a href="kindle_split_030.html#app03" class="calibre4">appendix C</a>) that outputs the message onscreen. This enables us to easily track the order of execution.
      </p>
      
      
      
      <h5 id="ch06fig11" class="notetitle">Figure 6.11. <a id="ch06fig11__title" class="calibre4"></a>The result of executing <a href="#ch06ex11" class="calibre4">listing 6.11</a></h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig11.jpg" alt="" class="calibre2" width="388" height="286" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/06fig11.jpg"></p>
      
      
      
      <p class="noind">Next we create a new promise by calling the <kbd class="calibre15">Promise</kbd> constructor. This immediately invokes the executor function in which we set up a timeout:
      </p>
      
      <pre id="PLd0e15232" class="calibre5">setTimeout(() =&gt; {
  report("Resolving ninjaDelayedPromise");
  resolve("Hattori");
}, 500);</pre>
      
      <p class="noind">The timeout will resolve the promise after 500ms. This could have been any other asynchronous task, but we chose the humble
         timeout because of its simplicity.
      </p>
      
      <p class="noind">After the <kbd class="calibre15">ninjaDelayedPromise</kbd> has been created, it still doesn’t know the value that it will eventually have, or whether it will even be successful. (Remember,
         it’s still waiting for the time-out that will resolve it.) So after construction, the <kbd class="calibre15">ninjaDelayedPromise</kbd> is in the first promise state, <i class="calibre6">pending</i>.
      </p>
      
      <p class="noind">Next we use the <kbd class="calibre15">then</kbd> method on the <kbd class="calibre15">ninjaDelayedPromise</kbd> to schedule a callback to be executed when the promise successfully resolves:
      </p>
      
      <pre id="PLd0e15262" class="calibre5">ninjaDelayedPromise.then(ninja =&gt; {
  assert(ninja === "Hattori",
        "ninjaDelayedPromise resolve handled with Hattori");
});</pre>
      
      <p class="noind">This callback will <i class="calibre6">always</i> be called asynchronously, regardless of the current state of the promise.
      </p>
      
      <p class="noind"><a id="iddle1106" class="calibre4"></a><a id="iddle1166" class="calibre4"></a><a id="iddle1409" class="calibre4"></a><a id="iddle1459" class="calibre4"></a><a id="iddle1889" class="calibre4"></a><a id="iddle1964" class="calibre4"></a><a id="iddle1965" class="calibre4"></a><a id="iddle1977" class="calibre4"></a>We continue by creating another promise, <kbd class="calibre15">ninjaImmediatePromise</kbd>, which is resolved immediately during its construction, by calling the <kbd class="calibre15">resolve</kbd> function. Unlike the <kbd class="calibre15">ninjaDelayedPromise</kbd>, which after construction is in the <i class="calibre6">pending</i> state, the <kbd class="calibre15">ninja-ImmediatePromise</kbd> finishes construction in the <i class="calibre6">resolved</i> state, and the promise already has the value <kbd class="calibre15">Yoshi</kbd>.
      </p>
      
      <p class="noind">Afterward, we use the <kbd class="calibre15">ninjaImmediatePromise</kbd>’s <kbd class="calibre15">then</kbd> method to register a callback that will be executed when the promise successfully resolves. But our promise is already settled;
         does this mean that the success callback will be immediately called or that it will be ignored? The answer is <i class="calibre6">neither</i>.
      </p>
      
      <p class="noind">Promises are designed to deal with asynchronous actions, so the JavaScript engine <i class="calibre6">always</i> resorts to asynchronous handling, to make the promise behavior predictable. The engine does this by executing the <kbd class="calibre15">then</kbd> callbacks after all the code in the current step of the event loop is executed (once again, we’ll explore exactly what this
         means in <a href="kindle_split_026.html#ch13" class="calibre4">chapter 13</a>). For this reason, if we study the output in <a href="#ch06fig11" class="calibre4">figure 6.11</a>, we’ll see that we first log “At code end” and then we log that the <kbd class="calibre15">ninjaImmediatePromise</kbd> was resolved. In the end, after the 500ms timeout expires, the <kbd class="calibre15">ninjaDelayedPromise</kbd> is resolved, which causes the execution of the matching <kbd class="calibre15">then</kbd> callback.
      </p>
      
      <p class="noind">In this example, for the sake of simplicity, we’ve worked only with the rosy scenario in which everything goes great. But
         the real world isn’t all sunshine and rainbows, so let’s see how to deal with all sorts of crazy problems that can occur.
      </p>
      
      
      
      <h4 id="ch06lev2sec7" class="calibre26">6.3.3. <a id="ch06lev2sec7__title" class="calibre4"></a>Rejecting promises
      </h4>
      
      <p class="noind">There are two ways of rejecting a promise: <i class="calibre6">explicitly</i>, by calling the passed-in <kbd class="calibre15">reject</kbd> method in the executor function of a promise, and <i class="calibre6">implicitly</i>, if during the handling of a promise, an unhandled exception occurs. Let’s start our exploration with the following listing.
      </p>
      
      
      
      <h5 id="ch06ex12" class="notetitle">Listing 6.12. <a id="ch06ex12__title" class="calibre4"></a>Explicitly rejecting promises
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/152fig01_alt.jpg" alt="" class="calibre2" width="590" height="123" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/152fig01_alt.jpg"></p>
      
      
      <p class="noind">We can explicitly reject a promise, by calling the passed-in <kbd class="calibre15">reject</kbd> method: <kbd class="calibre15">reject("Explicitly reject a promise!")</kbd>. If a promise is rejected, when registering callbacks through the <kbd class="calibre15">then</kbd> method, the second, error, callback will always be invoked.
      </p>
      
      <p class="noind">In addition, we can use an alternative syntax for handling promise rejections, by using the built-in <kbd class="calibre15">catch</kbd> method, as shown in the following listing.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch06ex13" class="notetitle">Listing 6.13. <a id="ch06ex13__title" class="calibre4"></a>Chaining a catch method
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/153fig01_alt.jpg" alt="" class="calibre2" width="590" height="94" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/153fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle2138" class="calibre4"></a>As <a href="#ch06ex13" class="calibre4">listing 6.13</a> shows, we can chain in the <kbd class="calibre15">catch</kbd> method after the <kbd class="calibre15">then</kbd> method, to also provide an error callback that will be invoked when a promise gets rejected. In this example, this is a matter
         of personal style. Both options work equally well, but later, when working with chains of promises, we’ll see an example in
         which chaining the <kbd class="calibre15">catch</kbd> method is useful.
      </p>
      
      <p class="noind">In addition to explicit rejection (via the <kbd class="calibre15">reject</kbd> call), a promise can also be rejected implicitly, if an exception occurs during its processing. Take a look at the following
         example.
      </p>
      
      
      
      <h5 id="ch06ex14" class="notetitle">Listing 6.14. <a id="ch06ex14__title" class="calibre4"></a>Exceptions implicitly reject a promise
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/153fig02_alt.jpg" alt="" class="calibre2" width="590" height="139" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/153fig02_alt.jpg"></p>
      
      
      <p class="noind">Within the body of the promise executor, we try to increment <kbd class="calibre15">undeclaredVariable</kbd>, a variable that isn’t defined in our program. As expected, this results in an exception. Because there’s no <kbd class="calibre15">try-catch</kbd> statement within the body of the executor, this results in an implicit rejection of the current promise, and the <kbd class="calibre15">catch</kbd> callback is eventually invoked. In this situation, we could have just as easily supplied the second callback to the <kbd class="calibre15">then</kbd> method, and the end effect would be the same.
      </p>
      
      <p class="noind">This way of treating all problems that happen while working with promises in a uniform way is extremely handy. Regardless
         of how the promise was rejected, whether explicitly by calling the <kbd class="calibre15">reject</kbd> method or even implicitly, if an exception occurs, all errors and rejection reasons are directed to our rejection callback.
         This makes our lives as developers a little easier.
      </p>
      
      <p class="noind">Now that we understand how promises work, and how to schedule success and failure callbacks, let’s take a real-world scenario,
         getting JSON-formatted data from a server, and “promisify” it.
      </p>
      
      
      
      
      <h4 id="ch06lev2sec8" class="calibre26">6.3.4. <a id="ch06lev2sec8__title" class="calibre4"></a>Creating our first real-world promise
      </h4>
      
      <p class="noind"><a id="iddle1837" class="calibre4"></a><a id="iddle1838" class="calibre4"></a><a id="iddle1885" class="calibre4"></a><a id="iddle2206" class="calibre4"></a>One of the most common asynchronous actions on the client is fetching data from the server. As such, this is an excellent
         little case study on the use of promises. For the underlying implementation, we’ll use the built-in <kbd class="calibre15">XMLHttpRequest</kbd> object.
      </p>
      
      <h5 id="ch06ex15" class="notetitle">Listing 6.15. <a id="ch06ex15__title" class="calibre4"></a>Creating a getJSON promise
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex15-0.jpg" alt="" class="calibre2" width="590" height="202" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex15-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex15-1.jpg" alt="" class="calibre2" width="590" height="248" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex15-1.jpg"></p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch06note04" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Executing this example, and all subsequent examples that reuse this function, requires a running server. You can, for example,
         use <a href="http://www.npmjs.com/package/http-server" class="calibre4">www.npmjs.com/package/http-server</a>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Our goal is to create a <kbd class="calibre15">getJSON</kbd> function that returns a promise that will enable us to register success and failure callbacks for asynchronously getting
         JSON-formatted data from the server. For the underlying implementation, we use the built-in <kbd class="calibre15">XMLHttpRequest</kbd> object that offers two events: <kbd class="calibre15">onload</kbd> and <kbd class="calibre15">onerror</kbd>. The <kbd class="calibre15">onload</kbd> event is triggered when the browser receives a response from the server, and <kbd class="calibre15">onerror</kbd> is triggered when an error in communication happens. These event handlers will be called asynchronously by the browser, as
         they occur.
      </p>
      
      <p class="noind"><a id="iddle1170" class="calibre4"></a><a id="iddle1709" class="calibre4"></a><a id="iddle1883" class="calibre4"></a><a id="iddle2114" class="calibre4"></a><a id="iddle2139" class="calibre4"></a>If an error in the communication happens, we definitely won’t be able to get our data from the server, so the honest thing
         to do is to reject our promise:
      </p>
      
      <pre id="PLd0e15615" class="calibre5">request.onerror = function(){
  reject(this.status + " " + this.statusText);
};</pre>
      
      <p class="noind">If we receive a response from the server, we have to analyze that response and consider the exact situation. Without going
         into too much detail, a server can respond with various things, but in this case, we care only that the response is successful
         (status 200). If it isn’t, again we reject the promise.
      </p>
      
      <p class="noind">Even if the server has successfully responded with data, this still doesn’t mean that we’re in the clear. Because our goal
         was to get JSON-formatted objects from the server, the JSON code could always have syntax errors. This is why, when calling
         the <kbd class="calibre15">JSON.parse</kbd> method, we surround the code with a <kbd class="calibre15">try-catch</kbd> statement. If an exception occurs while parsing the server response, we also reject the promise. With this, we’ve taken care
         of all bad scenarios that can happen.
      </p>
      
      <p class="noind">If everything goes according to plan, and we successfully obtain our objects, we can safely resolve the promise. Finally,
         we can use our <kbd class="calibre15">getJSON</kbd> function to fetch ninjas from the server:
      </p>
      
      <pre id="PLd0e15639" class="calibre5">getJSON("data/ninjas.json").then(ninjas =&gt; {
  assert(ninjas !== null, "Ninjas obtained!");
}).catch(e =&gt; fail("Shouldn't be here:" + e));</pre>
      
      <p class="noind">In this case, we have three potential sources of errors: errors in establishing the communication between the server and the
         client, the server responding with unanticipated data (invalid response status), and invalid JSON code. But from the perspective
         of the code that uses the <kbd class="calibre15">getJSON</kbd> function, we don’t care about the specifics of error sources. We only supply a callback that gets triggered if everything
         goes okay and the data is properly received, and a callback that gets triggered if any error occurs. This makes our lives
         as developers so much easier.
      </p>
      
      <p class="noind">Now we’re going to take it up a notch and explore another big advantage of promises: their elegant composition. We’ll start
         by chaining several promises in a series of distinct steps.
      </p>
      
      
      
      <h4 id="ch06lev2sec9" class="calibre26">6.3.5. <a id="ch06lev2sec9__title" class="calibre4"></a>Chaining promises
      </h4>
      
      <p class="noind">You’ve already seen how handling a sequence of interdependent steps leads to the pyramid of doom, a deeply nested and difficult-to-maintain
         sequence of callbacks. Promises are a step toward solving that problem, because they have the ability to be chained.
      </p>
      
      <p class="noind">Earlier in the chapter, you saw how, by using the <kbd class="calibre15">then</kbd> method on a promise, we can register a callback that will be executed if a promise is successfully resolved. What we didn’t
         tell you is that calling the <kbd class="calibre15">then</kbd> method also returns a new promise. So <a id="iddle1167" class="calibre4"></a><a id="iddle1391" class="calibre4"></a><a id="iddle1890" class="calibre4"></a>there’s nothing stopping us from chaining as many <kbd class="calibre15">then</kbd> methods as we want; see the following code.
      </p>
      
      
      
      <h5 id="ch06ex16" class="notetitle">Listing 6.16. <a id="ch06ex16__title" class="calibre4"></a>Chaining promises with then
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/156fig01_alt.jpg" alt="" class="calibre2" width="590" height="126" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/156fig01_alt.jpg"></p>
      
      
      <p class="noind">This creates a sequence of promises that will be, if everything goes according to plan, resolved one after another. First,
         we use the <kbd class="calibre15">getJSON("data/ninjas.json")</kbd> method to fetch a list of ninjas from the file on the server. After we receive that list, we take the information about the
         first ninja, and we request a list of missions the ninja is assigned to: <kbd class="calibre15">getJSON(ninjas[0].missionsUrl)</kbd>. Later, when these missions come in, we make yet another request for the details of the first mission: <kbd class="calibre15">getJSON(missions[0].details-Url)</kbd>. Finally, we log the details of the mission.
      </p>
      
      <p class="noind">Writing such code using standard callbacks would result in a deeply nested sequence of callbacks. Identifying the exact sequence
         of steps wouldn’t be easy, and God forbid we decide to add in an extra step somewhere in the middle.
      </p>
      
      
      <h5 id="ch06lev3sec9" class="notetitle"><a id="ch06lev3sec9__title" class="calibre4"></a>Catching errors in chained promises
      </h5>
      
      <p class="noind">When dealing with sequences of asynchronous steps, an error can occur in any step. We already know that we either can provide
         a second, error callback to the <kbd class="calibre15">then</kbd> call, or can chain in a <kbd class="calibre15">catch</kbd> call that takes an error callback. When we care about only the success/failure of the entire sequence of steps, supplying
         each step with special error handling might be tedious. So, as shown in <a href="#ch06ex16" class="calibre4">listing 6.16</a>, we can take advantage of the <kbd class="calibre15">catch</kbd> method that you saw earlier:
      </p>
      
      <pre id="PLd0e15741" class="calibre5">...catch(error =&gt; fail("An error has occurred:" + err));</pre>
      
      <p class="noind">If a failure occurs in any of the previous promises, the <kbd class="calibre15">catch</kbd> method catches it. If no error occurs, the program flow continues through it, unobstructed.
      </p>
      
      <p class="noind">Dealing with a sequence of steps is much nicer with promises than with regular callbacks, wouldn’t you agree? But it’s still
         not as elegant as it could be. We’ll get to that soon, but first let’s see how to use promises to take care of parallel asynchronous
         steps.
      </p>
      
      
      
      
      <h4 id="ch06lev2sec10" class="calibre26">6.3.6. <a id="ch06lev2sec10__title" class="calibre4"></a>Waiting for a number of promises
      </h4>
      
      <p class="noind">In addition to helping us deal with sequences of interdependent, asynchronous steps, promises significantly reduce the burden
         of waiting for several independent asynchronous tasks. Let’s revisit our example in which we want to, in parallel, gather
         information about the ninjas at our disposal, the intricacies of the plan, and the map of the <a id="iddle1880" class="calibre4"></a><a id="iddle1881" class="calibre4"></a>location where the plan will be set in motion. With promises, this is as simple as shown in the following listing.
      </p>
      
      
      
      <h5 id="ch06ex17" class="notetitle">Listing 6.17. <a id="ch06ex17__title" class="calibre4"></a>Waiting for a number of promises with Promise.all
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/157fig01_alt.jpg" alt="" class="calibre2" width="590" height="151" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/157fig01_alt.jpg"></p>
      
      
      <p class="noind">As you can see, we don’t have to care about the order in which tasks are executed, and whether some of them have finished,
         while others didn’t. We state that we want to wait for a number of promises by using the built-in <kbd class="calibre15">Promise.all</kbd> method. This method takes in an array of promises and creates a <i class="calibre6">new</i> promise that successfully resolves when all passed-in promises resolve, and rejects if even one of the promises fails. The
         succeed callback receives an array of succeed values, one for each of the passed-in promises, in order. Take a minute to appreciate
         the elegance of code that processes multiple parallel asynchronous tasks with promises.
      </p>
      
      <p class="noind">The <kbd class="calibre15">Promise.all</kbd> method waits for all promises in a list. But at times we have numerous promises, but we care only about the first one that
         succeeds (or fails). Meet the <kbd class="calibre15">Promise.race</kbd> method.
      </p>
      
      
      <h5 id="ch06lev3sec10" class="notetitle"><a id="ch06lev3sec10__title" class="calibre4"></a>Racing promises
      </h5>
      
      <p class="noind">Imagine that we have a group of ninjas at our disposal, and that we want to give an assignment to the first ninja who answers
         our call. When dealing with promises, we can write something like the following listing.
      </p>
      
      
      
      <h5 id="ch06ex18" class="notetitle">Listing 6.18. <a id="ch06ex18__title" class="calibre4"></a>Racing promises with Promise.race
      </h5>
      <pre id="PLd0e15818" class="calibre5"><b class="calibre21">Promise.race</b>([getJSON("data/yoshi.json"),
              getJSON("data/hattori.json"),
              getJSON("data/hanzo.json")])
       .then(ninja =&gt; {
         assert(ninja !== null, ninja.name + " responded first");
        }).catch(error =&gt; fail("Failure!"));</pre>
      
      <p class="noind">It’s simple as that. There’s no need for manually tracking everything. We use the <kbd class="calibre15">Promise.race</kbd> method to take an array of promises and return a completely <i class="calibre6">new</i> promise that resolves or rejects as soon as the first of the promises resolves or rejects.
      </p>
      
      <p class="noind">So far you’ve seen how promises work, and how we can use them to greatly simplify dealing with a series of asynchronous steps,
         either in series or in parallel. Although <a id="iddle1589" class="calibre4"></a><a id="iddle1799" class="calibre4"></a><a id="iddle1884" class="calibre4"></a>the improvements, when compared to plain old callbacks in terms of error handling and code elegance, are great, promisified
         code still isn’t on the same level of elegance as simple synchronous code. In the next section, the two big concepts that
         we’ve introduced in this chapter, <i class="calibre6">generators</i> and <i class="calibre6">promises</i>, come together to provide the simplicity of synchronous code with the nonblocking nature of asynchronous code.
      </p>
      
      
      
      
      
      <h3 id="ch06lev1sec4" class="calibre24"><a id="ch06lev1sec4__title" class="calibre3"></a>6.4. Combining generators and promises
      </h3>
      
      <p class="noind">In this section, we’ll combine generators (and their capability to pause and resume their execution) with promises, in order
         to achieve more elegant asynchronous code. We’ll use the example of a functionality that enables users to get details of the
         highest-rated mission done by the most popular ninja. The data representing the ninjas, the summaries of their missions, as
         well as the details of the missions are stored on a remote server, encoded in JSON.
      </p>
      
      <p class="noind">All of these subtasks are long-running and mutually dependent. If we were to implement them in a synchronous fashion, we’d
         get the following straightforward code:
      </p>
      
      <pre id="PLd0e15882" class="calibre5">try {
   const ninjas = syncGetJSON("data/ninjas.json");
   const missions = syncGetJSON(ninjas[0].missionsUrl);
   const missionDetails = syncGetJSON(missions[0].detailsUrl);
   //Study the mission description
} catch(e){
  //Oh no, we weren't able to get the mission details
}</pre>
      
      <p class="noind">Although this code is great for its simplicity and error handling, it blocks the UI, which results in unhappy users. Ideally,
         we’d like to change this code so that no blocking occurs during a long-running task. One way of doing this is by combining
         generators and promises.
      </p>
      
      <p class="noind">As we know, yielding from a generator suspends the execution of the generator without blocking. To wake up the generator and
         continue its execution, we have to call the <kbd class="calibre15">next</kbd> method on the generator’s iterator. Promises, on the other hand, allow us to specify a callback that will be triggered in
         case we were able to obtain the promised value, and a callback that will be triggered in case an error has occurred.
      </p>
      
      <p class="noind">The idea, then, is to combine generators and promises in the following way: We put the code that uses asynchronous tasks in
         a generator, and we execute that generator function. When we reach a point in the generator execution that calls an asynchronous
         task, we create a promise that represents the value of that asynchronous task. Because we have no idea when that promise will
         be resolved (or even if it will be resolved), at this point of generator execution, we yield from the generator, so that we
         don’t cause blocking. After a while, when the promise gets settled, we continue the execution of our generator by calling
         the iterator’s <kbd class="calibre15">next</kbd> method. We do this as many times as necessary. See the following listing for a practical example.
      </p>
      
      
      <p class="noind"></p>
      <h5 id="ch06ex19" class="notetitle">Listing 6.19. <a id="ch06ex19__title" class="calibre4"></a>Combining generators and promises
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex19-0.jpg" alt="" class="calibre2" width="590" height="126" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex19-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex19-1.jpg" alt="" class="calibre2" width="590" height="337" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch06ex19-1.jpg"></p>
      
      <p class="noind"><a id="iddle1104" class="calibre4"></a><a id="iddle2118" class="calibre4"></a>The <kbd class="calibre15">async</kbd> function takes a generator, calls it, and creates an iterator that will be used to resume the generator execution. Inside
         the <kbd class="calibre15">async</kbd> function, we declare a <kbd class="calibre15">handle</kbd> function that handles one return value from the generator—one “iteration” of our iterator. If the generator result is a promise
         that gets resolved successfully, we use the iterator’s <kbd class="calibre15">next</kbd> method to send the promised value back to the generator and resume the generator’s execution. If an error occurs and the
         promise gets rejected, we throw that error to the generator by using the iterator’s <kbd class="calibre15">throw</kbd> method (told you it would come in handy). We keep doing this until the generator says it’s done.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch06note05" class="notetitle">Note</h5>
      
      
      <p class="noindclose">This is a rough sketch, a minimum amount of code needed to combine generators and promises. We don’t recommend that you use
         this code in production.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Now let’s take a closer look at the generator. On the first invocation of the iterator’s <kbd class="calibre15">next</kbd> method, the generator executes up to the first <kbd class="calibre15">getJSON("data/ninjas.json")</kbd> <a id="iddle1095" class="calibre4"></a><a id="iddle1156" class="calibre4"></a><a id="iddle1168" class="calibre4"></a><a id="iddle1495" class="calibre4"></a><a id="iddle2115" class="calibre4"></a><a id="iddle2212" class="calibre4"></a>call. This call creates a promise that will eventually contain the list of information about our <kbd class="calibre15">ninjas</kbd>. Because this value is fetched asynchronously, we have no idea how much time it will take the browser to get it. But we know
         one thing: We don’t want to block the application execution while we’re waiting. For this reason, at this moment of execution,
         the generator yields control, which pauses the generator, and returns the control flow to the invocation of the <kbd class="calibre15">handle</kbd> function. Because the yielded value is a <kbd class="calibre15">getJSON</kbd> promise, in the <kbd class="calibre15">handle</kbd> function, by using the <kbd class="calibre15">then</kbd> and <kbd class="calibre15">catch</kbd> methods of the promise, we register a success and an error callback, and continue execution. With this, the control flow
         leaves the execution of the <kbd class="calibre15">handle</kbd> function and the body of the <kbd class="calibre15">async</kbd> function, and continues after the call to the <kbd class="calibre15">async</kbd> function (in our case, there’s no more code after, so it idles). During this time, our generator function patiently waits
         suspended, without blocking the program execution.
      </p>
      
      <p class="noind">Much, much later, when the browser receives a response (either a positive or a negative one), one of the promise callbacks
         is invoked. If the promise was resolved successfully, the success callback is invoked, which in turn causes the execution
         of the iterator’s <kbd class="calibre15">next</kbd> method, which asks the generator for another value. This brings back the generator from suspension and sends to it the value
         passed in by the callback. This means that we reenter the body of our generator, after the first <kbd class="calibre15">yield</kbd> expression, whose value becomes the <kbd class="calibre15">ninjas</kbd> list that was asynchronously fetched from the server. The execution of the generator function continues, and the value is
         assigned to the <kbd class="calibre15">plan</kbd> variable.
      </p>
      
      <p class="noind">In the next line of the generator, we use some of the obtained data, <kbd class="calibre15">ninjas[0].missionUrl</kbd>, to make another <kbd class="calibre15">getJSON</kbd> call that creates another promise that should eventually contain a list of missions done by the most popular ninja. Again,
         because this is an asynchronous task, we have no idea how long it’s going to take, so we again yield the execution and repeat
         the whole process.
      </p>
      
      <p class="noind">This process is repeated as long as there are asynchronous tasks in the generator.</p>
      
      <p class="noind">This was a tad on the complex side, but we like this example because it combines a lot of things that you’ve learned so far:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Functions as first-class objects—</i> </b>We send a function as an argument to the <kbd class="calibre15">async</kbd> function.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Generator functions—</i> </b>We use their ability to suspend and resume execution.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Promises—</i> </b>They help us deal with asynchronous code.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Callbacks—</i> </b>We register success and failure callbacks on our promises.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Arrow functions—</i> </b>Because of their simplicity, for callbacks we use arrow functions.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Closures—</i> </b>The iterator, through which we control the generator, is created in the <kbd class="calibre15">async</kbd> function, and we access it, through closures, in the promise callbacks.
            
         </li>
         
      </ul>
      
      <p class="noind">Now that we’ve gone through the whole process, let’s take a minute to appreciate how much more elegant the code that implements
         our business logic is. Consider this:
      </p>
      
      
      <pre id="PLd0e16122" class="calibre5">getJSON("data/ninjas.json", (err, ninjas) =&gt; {
  if(err) { console.log("Error fetching ninjas", err); return; }

  getJSON(ninjas[0].missionsUrl, (err, missions) =&gt; {
     if(err) { console.log("Error locating ninja missions", err); return; }
     console.log(misssions);
  })
});</pre>
      
      <p class="noind"><a id="iddle1114" class="calibre4"></a><a id="iddle2140" class="calibre4"></a>Instead of mixed control-flow and error handling, and slightly confusing code, we end up with something like this:
      </p>
      
      <pre id="PLd0e16141" class="calibre5">async(function*() {
  try {
    const ninjas = yield getJSON("data/ninjas.json");
    const missions = yield getJSON(ninjas[0].missionsUrl);

    //All information recieved
  }
  catch(e) {
    //An error has occurred
  }
});</pre>
      
      <p class="noind">This end result combines the advantages of synchronous and asynchronous code. From synchronous code, we have the ease of understanding,
         and the ability to use all standard control-flow and exception-handling mechanisms such as loops and <kbd class="calibre15">try-catch</kbd> statements. From asynchronous code, we get the nonblocking nature; the execution of our application isn’t blocked while waiting
         for long-running asynchronous tasks.
      </p>
      
      
      <h4 id="ch06lev2sec11" class="calibre26">6.4.1. <a id="ch06lev2sec11__title" class="calibre4"></a>Looking forward—the async function
      </h4>
      
      <p class="noind">Notice that we still had to write some boilerplate code; we had to develop an <kbd class="calibre15">async</kbd> function that takes care of handling promises and requesting values from the generator. Although we can write this function
         only once and then reuse it throughout our code, it would be even nicer if we didn’t have to think about it. The people in
         charge of JavaScript are well aware of the usefulness of the combination of generators and promises, and they want to make
         our lives even easier by building in direct language support for mixing generators and promises.
      </p>
      
      <p class="noind">For these situations, the current plan is to include two new keywords, <kbd class="calibre15">async</kbd> and <kbd class="calibre15">await</kbd>, that would take care of this boilerplate code. Soon, we’ll be able to write something like this:
      </p>
      
      <pre id="PLd0e16173" class="calibre5">(<b class="calibre21">async</b> function (){
  try {
    const ninjas = <b class="calibre21">await</b> getJSON("data/ninjas.json");
    const missions = <b class="calibre21">await</b> getJSON(missions[0].missionsUrl);

    console.log(missions);
  }
  catch(e) {
    console.log("Error: ", e);
  }
})()</pre>
      
      <p class="noind"><a id="iddle1534" class="calibre4"></a>We use the <kbd class="calibre15">async</kbd> keyword in front of the function keyword to specify that this function relies on asynchronous values, and at every place
         where we call an asynchronous task, we place the <kbd class="calibre15">await</kbd> keyword that says to the JavaScript engine, please wait for this result without blocking. In the background, everything happens
         as we’ve discussed previously throughout the chapter, but now we don’t need to worry about it.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch06note06" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Async functions will appear in the next installment of JavaScript. Currently no browser supports it, but you can use transpilers
         such as Babel or Traceur if you wish to use async in your code today.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      
      
      <h3 id="ch06lev1sec5" class="calibre24"><a id="ch06lev1sec5__title" class="calibre3"></a>6.5. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Generators are functions that generate sequences of values—not all at once, but on a per request basis.
            
         </li>
         
         <li class="calibre20">Unlike standard functions, generators can suspend and resume their execution. After a generator has generated a value, it
            suspends its execution without blocking the main thread and patiently waits for the next request.
            
         </li>
         
         <li class="calibre20">A generator is declared by putting an asterisk (<kbd class="calibre15">*</kbd>) after the function keyword. Within the body of the generator, we can use the new <kbd class="calibre15">yield</kbd> keyword that yields a value and suspends the execution of the generator. If we want to yield to another generator, we use
            the <kbd class="calibre15">yield*</kbd> operator.
            
         </li>
         
         <li class="calibre20">Calling a generator creates an iterator object through which we control the execution of the generator. We request new values
            from the generator by using the iterator’s <kbd class="calibre15">next</kbd> method, and we can even throw exceptions into the generator by calling the iterator’s <kbd class="calibre15">throw</kbd> method. In addition, the <kbd class="calibre15">next</kbd> method can be used to send in values to the generator.
            
         </li>
         
         <li class="calibre20">A promise is a placeholder for the results of a computation; it’s a guarantee that eventually we’ll know the result of the
            computation, most often an asynchronous computation. A promise can either succeed or fail, and after it has done so, there
            will be no more changes.
            
         </li>
         
         <li class="calibre20">Promises significantly simplify our dealings with asynchronous tasks. We can easily work with sequences of interdependent
            asynchronous steps by using the <kbd class="calibre15">then</kbd> method to chain promises. Parallel handling of multiple asynchronous steps is also greatly simplified; we use the <kbd class="calibre15">Promise.all</kbd> method.
            
         </li>
         
         <li class="calibre20">We can combine generators and promises to deal with asynchronous tasks with the simplicity of synchronous code.
            
         </li>
         
      </ul>
      
      
      
      
      <h3 id="ch06lev1sec6" class="calibre24"><a id="ch06lev1sec6__title" class="calibre3"></a>6.6. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch06qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch06qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch06qa2q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind"><a id="iddle1508" class="calibre4"></a><a id="iddle2191" class="calibre4"></a>After running the following code, what are the values of variables <kbd class="calibre15">a1</kbd> to <kbd class="calibre15">a4</kbd>?
            </p>
            
            <pre id="PLd0e16315" class="calibre5">function *EvenGenerator(){
  let num = 2;
  while(true){
    yield num;
    num = num + 2;
  }
}

let generator = EvenGenerator();

let a1 = generator.next().value;
let a2 = generator.next().value;
let a3 = EvenGenerator().next().value;
let a4 = generator.next().value;</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch06qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch06qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind">What’s the content of the <kbd class="calibre15">ninjas</kbd> array after running the following code? (Hint: think about how the <kbd class="calibre15">for-of</kbd> loop can be implemented with a <kbd class="calibre15">while</kbd> loop.)
            </p>
            
            <pre id="PLd0e16337" class="calibre5">function* NinjaGenerator(){
  yield "Yoshi";
  return "Hattori";
  yield "Hanzo";
}

var ninjas = [];
for(let ninja of NinjaGenerator()){
  ninjas.push(ninja);
}

ninjas;</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch06qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch06qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">What are the values of variables <kbd class="calibre15">a1</kbd> and <kbd class="calibre15">a2</kbd>, after running the following code?
            </p>
            
            <pre id="PLd0e16356" class="calibre5">function *Gen(val){
  val = yield val * 2;
  yield val;
}

let generator = Gen(2);
let a1 = generator.next(3).value;
let a2 = generator.next(4).value;</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch06qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch06qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">What’s the output of the following code?</p>
            
            <pre id="PLd0e16369" class="calibre5">const promise = new Promise((resolve, reject) =&gt; {
  reject("Hattori");
});

promise.then(val =&gt; alert("Success: " + val))
       .catch(e =&gt; alert("Error: " + e));</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch06qa2qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch06qa2q5" class="calibre4"></a><b class="calibre21">5 </b></p><p class="noind">What’s the output of the following code?</p>
            
            <pre id="PLd0e16383" class="calibre5">const promise = new Promise((resolve, reject) =&gt; {
  resolve("Hattori");
  setTimeout(()=&gt; reject("Yoshi"), 500);
});

promise.then(val =&gt; alert("Success: " + val))
       .catch(e =&gt; alert("Error: " + e));</pre>
            <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_27"></div>
<h2 id="part03" class="part">Part 3. <a id="part03__title" class="calibre3"></a>Digging into objects and fortifying your code
      </h2>
      
      
      <p class="noind">Now that you’ve learned the ins and outs of functions, we’ll continue our exploration of JavaScript by taking a closer look
         at object fundamentals in <a href="kindle_split_019.html#ch07" class="calibre4">chapter 7</a>.
      </p>
      
      <p class="noind">In <a href="kindle_split_020.html#ch08" class="calibre4">chapter 8</a>, we’ll study how to control access to and monitor our objects with getters and setters, and with proxies, a completely new
         type of object in JavaScript.
      </p>
      
      <p class="noind">We’ll take a look at collections in <a href="kindle_split_021.html#ch09" class="calibre4">chapter 9</a>—traditional ones such as arrays, as well as completely new types such as maps and sets.
      </p>
      
      <p class="noind">From there, we’ll move on to regular expressions in <a href="kindle_split_022.html#ch10" class="calibre4">chapter 10</a>. You’ll learn that many tasks that used to take reams of code to accomplish can be condensed to a mere handful of statements
         through the proper use of JavaScript regular expressions.
      </p>
      
      <p class="noind">Finally, in <a href="kindle_split_023.html#ch11" class="calibre4">chapter 11</a>, we’ll show you how to structure your JavaScript applications into smaller, well-organized units of functionality called
         modules.
      </p>
      
      
      
      
      <div class="calibre25" id="calibre_pb_29"></div>
<h2 id="ch07" class="part">Chapter 7. <a id="ch07__title" class="calibre3"></a>Object orientation with prototypes
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Exploring prototypes
            
         </li>
         
         <li class="calibre20">Using functions as constructors
            
         </li>
         
         <li class="calibre20">Extending objects with prototypes
            
         </li>
         
         <li class="calibre20">Avoiding common gotchas
            
         </li>
         
         <li class="calibre20">Building classes with inheritance
            
         </li>
         
      </ul>
      
      <p class="noind">You’ve learned that functions are first-class objects in JavaScript, that closures make them incredibly versatile and useful,
         and that you can combine generator functions with promises to tackle the problem of asynchronous code. Now we’re ready to
         tackle another important aspect of JavaScript: object prototypes.
      </p>
      
      <p class="noind">A <i class="calibre6">prototype</i> is an object to which the search for a particular property can be delegated to. Prototypes are a convenient means of defining
         properties and functionality that will be automatically accessible to other objects. Prototypes serve a similar purpose to
         that of classes in classical object-oriented languages. Indeed, the main use of prototypes in JavaScript is in producing code
         written in an object-oriented <a id="iddle1177" class="calibre4"></a><a id="iddle1914" class="calibre4"></a>way, similar to, but not exactly like, code in more conventional, class-based languages such as Java or C#.
      </p>
      
      <p class="noind">In this chapter, we’ll delve into how prototypes work, study their connection with constructor functions, and see how to mimic
         some of the object-oriented features often used in other, more conventional object-oriented languages. We’ll also explore
         a new addition to JavaScript, the <kbd class="calibre15">class</kbd> keyword, which doesn’t exactly bring full-featured classes to JavaScript but does enable us to easily mimic classes and inheritance.
         Let’s start exploring.
      </p>
      
      <h3 class="calibre24"><a id="ch07qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch07qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch07qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">How do you test whether an object has access to a particular property?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch07qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch07qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">Why is a prototype chain important for working with objects in JavaScript?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch07qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch07qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">Do ES6 classes change how JavaScript works with objects?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch07lev1sec1" class="calibre24"><a id="ch07lev1sec1__title" class="calibre3"></a>7.1. Understanding prototypes
      </h3>
      
      <p class="noind">In JavaScript, objects are collections of named properties with values. For example, we can easily create new objects with
         object-literal notation:
      </p>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/168fig01.jpg" alt="" class="calibre2" width="500" height="103" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/168fig01.jpg"></p>
      
      
      <p class="noind">As we can see, object properties can be simple values (such as numbers or strings), functions, and even other objects. In
         addition, JavaScript is a highly dynamic language, and the properties assigned to an object can be easily changed by modifying
         and deleting existing properties:
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/168fig02_alt.jpg" alt="" class="calibre2" width="590" height="109" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/168fig02_alt.jpg"></p>
      
      <p class="noind">We can even add completely new properties:</p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/168fig03_alt.jpg" alt="" class="calibre2" width="590" height="17" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/168fig03_alt.jpg"></p>
      
      <p class="noind">In the end, all these modifications have left our simple object in the following state:</p>
      
      
      <pre id="PLd0e16567" class="calibre5">{
  prop1: [],
  prop3: {},
  prop4: "Hello"
};</pre>
      
      <p class="noind"><a id="iddle1673" class="calibre4"></a><a id="iddle1713" class="calibre4"></a>When developing software, we strive not to reinvent the wheel, so we want to reuse as much code as possible. One form of code
         reuse that also helps organize our programs is <i class="calibre6">inheritance</i>, extending the features of one object into another. In JavaScript, inheritance is implemented with prototyping.
      </p>
      
      <p class="noind">The idea of prototyping is simple. Every object can have a reference to its <i class="calibre6">prototype</i>, an object to which the search for a particular property can be delegated to, if the object itself doesn’t have that property.
         Imagine that you’re in a game quiz with a group of people, and that the game show host asks you a question. If you know the
         answer, you give it immediately, and if you don’t, you ask the person next to you. It’s as simple as that.
      </p>
      
      <p class="noind">Let’s take a look at the following listing.</p>
      
      
      
      <h5 id="ch07ex01" class="notetitle">Listing 7.1. <a id="ch07ex01__title" class="calibre4"></a>With prototypes, objects can access properties of other objects
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/169fig01_alt.jpg" alt="" class="calibre2" width="590" height="250" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/169fig01_alt.jpg"></p>
      
      
      <p class="noind">In this example, we start by creating three objects: <kbd class="calibre15">yoshi</kbd>, <kbd class="calibre15">hattori</kbd>, and <kbd class="calibre15">kuma</kbd>. Each has one specific property accessible only to that object: Only <kbd class="calibre15">yoshi</kbd> can <kbd class="calibre15">skulk</kbd>, only <kbd class="calibre15">hattori</kbd> can <kbd class="calibre15">sneak</kbd>, and only <kbd class="calibre15">kuma</kbd> can <kbd class="calibre15">creep</kbd>. See <a href="#ch07fig01" class="calibre4">figure 7.1</a>.
      </p>
      
      
      
      <h5 id="ch07fig01" class="notetitle">Figure 7.1. <a id="ch07fig01__title" class="calibre4"></a>Initially, each object has access to only its own properties.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig01_alt.jpg" alt="" class="calibre2" width="590" height="190" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1818" class="calibre4"></a><a id="iddle1897" class="calibre4"></a><a id="iddle1901" class="calibre4"></a>To test whether an object has access to a particular property, we can use the <kbd class="calibre15">in</kbd> operator. For example, executing <kbd class="calibre15">skulk in yoshi</kbd> returns <kbd class="calibre15">true</kbd>, because <kbd class="calibre15">yoshi</kbd> has access to the <kbd class="calibre15">skulk</kbd> property; whereas executing <kbd class="calibre15">sneak in yoshi</kbd> returns <kbd class="calibre15">false</kbd>.
      </p>
      
      <p class="noind">In JavaScript, the object’s prototype property is an internal property that’s not directly accessible (so we mark it with
         <kbd class="calibre15">[[prototype]]</kbd>). Instead, the built-in method <kbd class="calibre15">Object.setPrototypeOf</kbd> takes in two object arguments and sets the second object as the prototype of the first. For example, calling <kbd class="calibre15">Object.setPrototypeOf(yoshi, hattori);</kbd> sets up <kbd class="calibre15">hattori</kbd> as a prototype of <kbd class="calibre15">yoshi</kbd>.
      </p>
      
      <p class="noind">As a result, whenever we ask <kbd class="calibre15">yoshi</kbd> for a property that it doesn’t have, <kbd class="calibre15">yoshi</kbd> delegates that search to <kbd class="calibre15">hattori</kbd>. We can access <kbd class="calibre15">hattori</kbd>’s <kbd class="calibre15">sneak</kbd> property through <kbd class="calibre15">yoshi</kbd>. See <a href="#ch07fig02" class="calibre4">figure 7.2</a>.
      </p>
      
      
      
      <h5 id="ch07fig02" class="notetitle">Figure 7.2. <a id="ch07fig02__title" class="calibre4"></a>When we access a property that the object doesn’t have, the object’s prototype is searched for that property. Here, we can
         access <kbd class="calibre15">hattori</kbd>’s <kbd class="calibre15">sneak</kbd> property through <kbd class="calibre15">yoshi</kbd>, because <kbd class="calibre15">yoshi</kbd> is <kbd class="calibre15">hattori</kbd>’s prototype.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig02_alt.jpg" alt="" class="calibre2" width="590" height="362" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig02_alt.jpg"></p>
      
      
      <p class="noind">We can do a similar thing with <kbd class="calibre15">hattori</kbd> and <kbd class="calibre15">kuma</kbd>. By using the <kbd class="calibre15">Object.setPrototypeOf</kbd> method, we can set <kbd class="calibre15">kuma</kbd> as the prototype of <kbd class="calibre15">hattori</kbd>. If we then ask <kbd class="calibre15">hattori</kbd> for a property that he doesn’t have, that search will be delegated to <kbd class="calibre15">kuma</kbd>. In this case, <kbd class="calibre15">hattori</kbd> now has access to <kbd class="calibre15">kuma</kbd>’s <kbd class="calibre15">creep</kbd> property. See <a href="#ch07fig03" class="calibre4">figure 7.3</a>.
      </p>
      
      
      
      <h5 id="ch07fig03" class="notetitle">Figure 7.3. <a id="ch07fig03__title" class="calibre4"></a>The search for a particular property stops when there are no more prototypes to explore. Accessing <kbd class="calibre15">yoshi.creep</kbd> triggers the search first in <kbd class="calibre15">yoshi</kbd>, then in <kbd class="calibre15">hattori</kbd>, and finally in <kbd class="calibre15">kuma</kbd>.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig03_alt.jpg" alt="" class="calibre2" width="590" height="373" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig03_alt.jpg"></p>
      
      
      <p class="noind">It’s important to emphasize that every object can have a prototype, and an object’s prototype can also have a prototype, and
         so on, forming a <i class="calibre6">prototype chain</i>. The search delegation for a particular property occurs up the whole chain, and it stops only when there are no more prototypes
         to explore. For example, as shown in <a href="#ch07fig03" class="calibre4">figure 7.3</a>, asking <kbd class="calibre15">yoshi</kbd> for the value of the <kbd class="calibre15">creep</kbd> property triggers the search for the property first in <kbd class="calibre15">yoshi</kbd>. Because the property isn’t found, <kbd class="calibre15">yoshi</kbd>’s prototype, <kbd class="calibre15">hattori</kbd>, is searched. Again, <kbd class="calibre15">hattori</kbd> doesn’t have a property named <kbd class="calibre15">creep</kbd>, so <kbd class="calibre15">hattori</kbd>’s prototype, <kbd class="calibre15">kuma</kbd>, is searched, and the property is finally found.
      </p>
      
      <p class="noind"><a id="iddle1793" class="calibre4"></a><a id="iddle1821" class="calibre4"></a><a id="iddle1909" class="calibre4"></a>Now that we have a basic idea of how the search for a particular property occurs through the prototype chain, let’s see how
         prototypes are used when constructing new objects with constructor functions.
      </p>
      
      
      
      <h3 id="ch07lev1sec2" class="calibre24"><a id="ch07lev1sec2__title" class="calibre3"></a>7.2. Object construction and prototypes
      </h3>
      
      <p class="noind">The simplest way to create a new object is with a statement like this:</p>
      
      <pre id="PLd0e16893" class="calibre5">const warrior = {};</pre>
      
      <p class="noind">This creates a new and empty object, which we can then populate with properties via assignment statements:</p>
      
      <pre id="PLd0e16902" class="calibre5">const warrior = {};
warrior.name = 'Saito';
warrior.occupation = 'marksman';</pre>
      
      <p class="noind">But those coming from an object-oriented background might miss the encapsulation and structuring that comes with a class constructor,
         a function that serves to initialize an object to a known initial state. After all, if we’re going to create multiple instances
         of the same type of object, assigning the properties individually isn’t only tedious but also highly error-prone. We’d like
         to be able to consolidate the set of properties and methods for a class of objects in one place.
      </p>
      
      <p class="noind">JavaScript provides such a mechanism, though in a different form than most other languages. Like object-oriented languages
         such as Java and C++, JavaScript employs the <kbd class="calibre15">new</kbd> operator to instantiate new objects via constructors, but there’s no true class definition in JavaScript. Instead, the <kbd class="calibre15">new</kbd> operator, applied to a constructor function (as you saw in <a href="kindle_split_014.html#ch03" class="calibre4">chapter 3</a>), triggers the creation of a newly allocated object.
      </p>
      
      <p class="noind"><a id="iddle1270" class="calibre4"></a>What we didn’t learn in the previous chapters was that every function has a prototype object that’s automatically set as the
         prototype of the objects created with that function. Let’s see how that works in the following listing.
      </p>
      
      
      
      <h5 id="ch07ex02" class="notetitle">Listing 7.2. <a id="ch07ex02__title" class="calibre4"></a>Creating a new instance with a prototyped method
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/172fig01_alt.jpg" alt="" class="calibre2" width="590" height="246" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/172fig01_alt.jpg"></p>
      
      
      <p class="noind">In this code, we define a seemingly do-nothing function named <kbd class="calibre15">Ninja</kbd> that we’ll invoke in two ways: as a “normal” function, <kbd class="calibre15">const ninja1 = Ninja()</kbd>; and as a constructor, <kbd class="calibre15">const ninja2 = new Ninja();</kbd>.
      </p>
      
      <p class="noind">When the function is created, it immediately gets a new object assigned to its prototype object, an object that we can extend
         just like any other object. In this case, we add a <kbd class="calibre15">swingSword</kbd> method to it:
      </p>
      
      <pre id="PLd0e16964" class="calibre5">Ninja.prototype.swingSword = function(){
  return true;
};</pre>
      
      <p class="noind">Then we put the function through its paces. First we call the function normally and store its result in variable <kbd class="calibre15">ninja1</kbd>. Looking at the function body, we see that it returns no value, so we’d expect <kbd class="calibre15">ninja1</kbd> to test as <kbd class="calibre15">undefined</kbd>, which we assert to be <kbd class="calibre15">true</kbd>. As a simple function, <kbd class="calibre15">Ninja</kbd> doesn’t appear to be all that useful.
      </p>
      
      <p class="noind">Then we call the function via the <kbd class="calibre15">new</kbd> operator, invoking it as a <i class="calibre6">constructor</i>, and something completely different happens. The function is once again called, but this time a newly allocated object has
         been created and set as the context of the function (and is accessible through the <kbd class="calibre15">this</kbd> keyword). The result returned from the <kbd class="calibre15">new</kbd> operator is a reference to this new object. We then test that <kbd class="calibre15">ninja2</kbd> has a reference to the newly created object, and that that object has a <kbd class="calibre15">swingSword</kbd> method that we can call. See <a href="#ch07fig04" class="calibre4">figure 7.4</a> for a glimpse of the current application state.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch07fig04" class="notetitle">Figure 7.4. <a id="ch07fig04__title" class="calibre4"></a>Every function, when created, gets a new prototype object. When we use a function as a constructor, the constructed object’s
         prototype is set to the function’s prototype.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig04_alt.jpg" alt="" class="calibre2" width="590" height="432" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig04_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1255" class="calibre4"></a><a id="iddle1675" class="calibre4"></a><a id="iddle1822" class="calibre4"></a><a id="iddle1902" class="calibre4"></a><a id="iddle1910" class="calibre4"></a>As you can see, a function, when created, gets a new object that’s assigned to its prototype property. The prototype object
         initially has only one property, <kbd class="calibre15">constructor</kbd>, that references back to the function (we’ll revisit the <kbd class="calibre15">constructor</kbd> property later).
      </p>
      
      <p class="noind">When we use a function as a constructor (for example, by calling <kbd class="calibre15">new Ninja()</kbd>), the prototype of the newly constructed object is set to the object referenced by the constructor function’s prototype.
      </p>
      
      <p class="noind">In this example, we’ve extended the <kbd class="calibre15">Ninja.prototype</kbd> with the <kbd class="calibre15">swingSword</kbd> method, and when the <kbd class="calibre15">ninja2</kbd> object is created, its <kbd class="calibre15">prototype</kbd> property is set to <kbd class="calibre15">Ninja</kbd>’s prototype. Therefore, when we try to access the <kbd class="calibre15">swingSword</kbd> property on <kbd class="calibre15">ninja2</kbd>, the search for that property is delegated to the <kbd class="calibre15">Ninja</kbd> prototype object. Notice that <i class="calibre6">all</i> objects created with the <kbd class="calibre15">Ninja</kbd> constructor will have access to the <kbd class="calibre15">swingSword</kbd> method. Now that’s code reuse!
      </p>
      
      <p class="noind">The <kbd class="calibre15">swingSword</kbd> method is a property of the <kbd class="calibre15">Ninja</kbd>’s prototype, and not a property of <kbd class="calibre15">ninja</kbd> instances. Let’s explore this difference between instance properties and prototype properties.
      </p>
      
      
      <h4 id="ch07lev2sec1" class="calibre26">7.2.1. <a id="ch07lev2sec1__title" class="calibre4"></a>Instance properties
      </h4>
      
      <p class="noind">When the function is called as a constructor via the <kbd class="calibre15">new</kbd> operator, its context is defined as the new object instance. In addition to exposing properties via the prototype, we can
         initialize values within the constructor function via the <kbd class="calibre15">this</kbd> parameter. Let’s examine the creation of such instance properties in the next listing.
      </p>
      
      
      
      <h5 id="ch07ex03" class="notetitle">Listing 7.3. <a id="ch07ex03__title" class="calibre4"></a>Observing the precedence of initialization activities
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/174fig01_alt.jpg" alt="" class="calibre2" width="590" height="289" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/174fig01_alt.jpg"></p>
      
      
      <p class="noind"><a href="#ch07ex03" class="calibre4">Listing 7.3</a> is similar to the previous example in that we define a <kbd class="calibre15">swingSword</kbd> method by adding it to the <kbd class="calibre15">prototype</kbd> property of the constructor:
      </p>
      
      <pre id="PLd0e17163" class="calibre5">Ninja.prototype.swingSword = function(){
   return this.swung;
};</pre>
      
      <p class="noind">But we also add an identically named method within the constructor function itself:</p>
      
      <pre id="PLd0e17172" class="calibre5">function Ninja(){
  this.swung = false;
  <b class="calibre21">this.swingSword = function(){</b>
    return !this.swung;
  };
}</pre>
      
      <p class="noind">The two methods are defined to return opposing results so we can tell which will be called.</p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch07note01" class="notetitle">Note</h5>
      
      
      <p class="noindclose">This isn’t anything we’d advise doing in real-world code; quite the opposite. We’re doing it here just to demonstrate the
         precedence of properties.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">When you run the test, you see that it passes! This shows that instance members will hide properties of the same name defined
         in the prototype. See <a href="#ch07fig05" class="calibre4">figure 7.5</a>.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch07fig05" class="notetitle">Figure 7.5. <a id="ch07fig05__title" class="calibre4"></a>If a property can be found on the instance itself, the prototype isn’t even consulted!
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig05_alt.jpg" alt="" class="calibre2" width="590" height="371" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig05_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1898" class="calibre4"></a>Within the constructor function, the <kbd class="calibre15">this</kbd> keyword refers to the newly created object, so the properties added within the constructor are created directly on the new
         <kbd class="calibre15">ninja</kbd> instance. Later, when we access the property <kbd class="calibre15">swingSword</kbd> on <kbd class="calibre15">ninja</kbd>, there’s no need to traverse the prototype chain (as shown in <a href="#ch07fig04" class="calibre4">figure 7.4</a>); the property created within the constructor is immediately found and returned (see <a href="#ch07fig05" class="calibre4">figure 7.5</a>).
      </p>
      
      <p class="noind">This has an interesting side effect. Take a look at <a href="#ch07fig06" class="calibre4">figure 7.6</a>, which shows the state of the application if we create three <kbd class="calibre15">ninja</kbd> instances.
      </p>
      
      
      
      <h5 id="ch07fig06" class="notetitle">Figure 7.6. <a id="ch07fig06__title" class="calibre4"></a>Every instance gets its own version of the properties created within the constructor, but they all have access to the same
         prototype’s properties.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig06_alt.jpg" alt="" class="calibre2" width="590" height="265" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig06_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1125" class="calibre4"></a><a id="iddle1378" class="calibre4"></a><a id="iddle1824" class="calibre4"></a><a id="iddle1912" class="calibre4"></a>As you can see, every <kbd class="calibre15">ninja</kbd> instance gets its own version of the properties that were created within the constructor, while they all have access to the
         same prototype’s properties. This is okay for value properties (for example, <kbd class="calibre15">swung</kbd>) that are specific to each object instance. But in certain cases it might be problematic for methods.
      </p>
      
      <p class="noind">In this example, we’d have three versions of the <kbd class="calibre15">swingSword</kbd> method that all perform the same logic. This isn’t a problem if we create a couple of objects, but it’s something to pay
         attention to if we plan to create large numbers of objects. Because each method copy behaves the same, creating multiple copies
         often doesn’t make sense, because it only consumes more memory. Sure, in general, the JavaScript engine might perform some
         optimizations, but that’s not something to rely on. From that perspective, it makes sense to place object methods only on
         the function’s prototype, because in that way we have a single method shared by all object instances.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch07note02" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Remember <a href="kindle_split_016.html#ch05" class="calibre4">chapter 5</a> on closures: Methods defined within constructor functions allow us to mimic private object variables. If this is something
         we need, specifying methods within constructors is the only way to go.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      
      <h4 id="ch07lev2sec2" class="calibre26">7.2.2. <a id="ch07lev2sec2__title" class="calibre4"></a>Side effects of the dynamic nature of JavaScript
      </h4>
      
      <p class="noind">You’ve already seen that JavaScript is a dynamic language in which properties can be easily added, removed, and modified at
         will. The same thing holds for prototypes, both function prototypes and object prototypes. See the following listing.
      </p>
      
      <h5 id="ch07ex04" class="notetitle">Listing 7.4. <a id="ch07ex04__title" class="calibre4"></a>With prototypes, everything can be changed at runtime
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch07ex04-0.jpg" alt="" class="calibre2" width="590" height="139" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch07ex04-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch07ex04-1.jpg" alt="" class="calibre2" width="590" height="253" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch07ex04-1.jpg"></p>
      
      <p class="noind"><a id="iddle1256" class="calibre4"></a>Here we again define a <kbd class="calibre15">Ninja</kbd> constructor and proceed to use it to create an object instance. The state of the application at this moment is shown in <a href="#ch07fig07" class="calibre4">figure 7.7</a>.
      </p>
      
      
      
      <h5 id="ch07fig07" class="notetitle">Figure 7.7. <a id="ch07fig07__title" class="calibre4"></a>After construction, <kbd class="calibre15">ninja1</kbd> has the property <kbd class="calibre15">swung</kbd>, and its prototype is the <kbd class="calibre15">Ninja</kbd> prototype that has only a <kbd class="calibre15">constructor</kbd> property.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig07.jpg" alt="" class="calibre2" width="443" height="394" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig07.jpg"></p>
      
      
      
      <p class="noind"><i class="calibre6">After</i> the instance has been created, we add a <kbd class="calibre15">swingSword</kbd> method to the prototype. Then we run a test to show that the change we made to the prototype after the object was constructed
         takes effect. The current state of the application is shown in <a href="#ch07fig08" class="calibre4">figure 7.8</a>.
      </p>
      
      
      
      <h5 id="ch07fig08" class="notetitle">Figure 7.8. <a id="ch07fig08__title" class="calibre4"></a>Because the <kbd class="calibre15">ninja1</kbd> instance references the <kbd class="calibre15">Ninja</kbd> prototype, even changes made after the instance was constructed are accessible.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig08_alt.jpg" alt="" class="calibre2" width="590" height="465" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig08_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1928" class="calibre4"></a>Later, we override the <kbd class="calibre15">Ninja</kbd> function’s prototype by assigning it to a completely new object that has a <kbd class="calibre15">pierce</kbd> method. This results in the application state shown in <a href="#ch07fig09" class="calibre4">figure 7.9</a>.
      </p>
      
      
      
      <h5 id="ch07fig09" class="notetitle">Figure 7.9. <a id="ch07fig09__title" class="calibre4"></a>The function’s prototype can be replaced at will. The already constructed instances reference the old prototype!
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig09_alt.jpg" alt="" class="calibre2" width="590" height="439" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig09_alt.jpg"></p>
      
      
      <p class="noind">As you can see, even though the <kbd class="calibre15">Ninja</kbd> function doesn’t reference the old <kbd class="calibre15">Ninja</kbd> prototype, the old prototype is still kept alive by the <kbd class="calibre15">ninja1</kbd> instance, which can still, through the prototype chain, access the <kbd class="calibre15">swingSword</kbd> method. But if we create new objects after this prototype switcheroo, the state of the application will be as shown in <a href="#ch07fig10" class="calibre4">figure 7.10</a>.
      </p>
      
      
      
      <h5 id="ch07fig10" class="notetitle">Figure 7.10. <a id="ch07fig10__title" class="calibre4"></a>All newly created instances reference the new prototype.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig10_alt.jpg" alt="" class="calibre2" width="590" height="543" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig10_alt.jpg"></p>
      
      
      <p class="noind">The reference between an object and the function’s prototype is established at the time of object instantiation. Newly created
         objects will have a reference to the new prototype and will have access to the <kbd class="calibre15">pierce</kbd> method, whereas the old, pre-prototype-change objects keep their original prototype, happily swinging their swords.
      </p>
      
      <p class="noind">We’ve explored how prototypes work and how they’re related to object instantiation. Well done! Now take a quick breath, so
         we can continue onward by learning more about the nature of those objects.
      </p>
      
      
      
      
      <h4 id="ch07lev2sec3" class="calibre26">7.2.3. <a id="ch07lev2sec3__title" class="calibre4"></a>Object typing via constructors
      </h4>
      
      <p class="noind"><a id="iddle1257" class="calibre4"></a><a id="iddle1269" class="calibre4"></a><a id="iddle1823" class="calibre4"></a><a id="iddle1908" class="calibre4"></a><a id="iddle1911" class="calibre4"></a>Although it’s great to know how JavaScript uses the prototype to find the correct property references, it’s also handy to
         know which function constructed an object instance. As you’ve seen earlier, the constructor of an object is available via
         the constructor property of the constructor function prototype. For example, <a href="#ch07fig11" class="calibre4">figure 7.11</a> shows the state of the application when we instantiate an object with the <kbd class="calibre15">Ninja</kbd> constructor.
      </p>
      
      
      
      <h5 id="ch07fig11" class="notetitle">Figure 7.11. <a id="ch07fig11__title" class="calibre4"></a>The prototype object of each function has a constructor property that references the function.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig11.jpg" alt="" class="calibre2" width="443" height="317" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig11.jpg"></p>
      
      
      
      <p class="noind"><a id="iddle1676" class="calibre4"></a><a id="iddle2144" class="calibre4"></a>By using the <kbd class="calibre15">constructor</kbd> property, we can access the function that was used to create the object. This information can be used as a form of type checking,
         as shown in the next listing.
      </p>
      
      
      
      <h5 id="ch07ex05" class="notetitle">Listing 7.5. <a id="ch07ex05__title" class="calibre4"></a>Examining the type of an instance and its constructor
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/180fig01_alt.jpg" alt="" class="calibre2" width="590" height="189" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/180fig01_alt.jpg"></p>
      
      
      <p class="noind">We define a constructor and create an object instance using it. Then we examine the type of the instance by using the <kbd class="calibre15">typeof</kbd> operator. This doesn’t reveal much, as all instances will be objects, thus always returning <kbd class="calibre15">object</kbd> as the result. Much more interesting is the <kbd class="calibre15">instanceof</kbd> operator, which gives us a way to determine whether an instance was created by a particular function constructor. You’ll
         learn more about how the <kbd class="calibre15">instanceof</kbd> operator works later in the chapter.
      </p>
      
      <p class="noind">In addition, we can use the <kbd class="calibre15">constructor</kbd> property, that we now know is accessible to all instances, as a reference to the original function that created it. We can
         use this to verify the origin of the instance (much as we can with the <kbd class="calibre15">instanceof</kbd> operator).
      </p>
      
      <p class="noind">Additionally, because this is just a reference to the original constructor, we can instantiate a new <kbd class="calibre15">Ninja</kbd> object using it, as shown in the next listing.
      </p>
      
      
      
      <h5 id="ch07ex06" class="notetitle">Listing 7.6. <a id="ch07ex06__title" class="calibre4"></a>Instantiating a new object using a reference to a constructor
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/180fig02_alt.jpg" alt="" class="calibre2" width="590" height="117" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/180fig02_alt.jpg"></p>
      
      
      <p class="noind">Here we define a constructor and create an instance using that constructor. Then we use the <kbd class="calibre15">constructor</kbd> property of the created instance to construct a second instance. Testing shows that a second <kbd class="calibre15">Ninja</kbd> has been constructed and that the variable doesn’t merely point to the same instance.
      </p>
      
      <p class="noind"><a id="iddle1905" class="calibre4"></a>What’s especially interesting is that we can do this without even having access to the original function; we can use the reference
         completely behind the scenes, even if the original constructor is no longer in scope.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch07note03" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Although the <kbd class="calibre15">constructor</kbd> property of an object can be changed, doing so doesn’t have any immediate or obvious constructive purpose (though we might
         be able to think of some malicious ones). The property’s reason for being is to indicate from where the object was constructed.
         If the <kbd class="calibre15">constructor</kbd> property is overwritten, the original value is lost.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">That’s all useful, but we’ve just scratched the surface of the superpowers that prototypes confer on us. Now things get interesting.</p>
      
      
      
      
      <h3 id="ch07lev1sec3" class="calibre24"><a id="ch07lev1sec3__title" class="calibre3"></a>7.3. Achieving inheritance
      </h3>
      
      <p class="noind"><i class="calibre6">Inheritance</i> is a form of reuse in which new objects have access to properties of existing objects. This helps us avoid the need to repeat
         code and data across our code base. In JavaScript, inheritance works slightly differently than in other popular object-oriented
         languages. Consider the following listing, in which we attempt to achieve inheritance.
      </p>
      
      
      
      <h5 id="ch07ex07" class="notetitle">Listing 7.7. <a id="ch07ex07__title" class="calibre4"></a>Trying to achieve inheritance with prototypes
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/181fig01_alt.jpg" alt="" class="calibre2" width="590" height="178" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/181fig01_alt.jpg"></p>
      
      
      <p class="noind">Because the prototype of a function is an object, there are multiple ways of copying functionality (such as properties or
         methods) to effect inheritance. In this code, we define a <kbd class="calibre15">Person</kbd> and then a <kbd class="calibre15">Ninja</kbd>. And because a <kbd class="calibre15">Ninja</kbd> is clearly a person, we want <kbd class="calibre15">Ninja</kbd> to inherit the attributes of <kbd class="calibre15">Person</kbd>. We attempt to do so by copying the <kbd class="calibre15">dance</kbd> property of the <kbd class="calibre15">Person</kbd> prototype’s method to a similarly named property in the <kbd class="calibre15">Ninja</kbd> prototype.
      </p>
      
      <p class="noind">Running our test reveals that although we may have taught the ninja to dance, we failed to make the <kbd class="calibre15">Ninja</kbd> a <kbd class="calibre15">Person</kbd>, as shown in <a href="#ch07fig12" class="calibre4">figure 7.12</a>. We taught the <kbd class="calibre15">Ninja</kbd> to mimic the dance <a id="iddle1899" class="calibre4"></a><a id="iddle2082" class="calibre4"></a>of a person, but that hasn’t <i class="calibre6">made</i> the <kbd class="calibre15">Ninja</kbd> a <kbd class="calibre15">Person</kbd>. That’s not inheritance—it’s just copying.
      </p>
      
      
      
      <h5 id="ch07fig12" class="notetitle">Figure 7.12. <a id="ch07fig12__title" class="calibre4"></a>Our <kbd class="calibre15">Ninja</kbd> isn’t really a <kbd class="calibre15">Person</kbd>. No happy dance!
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig12.jpg" alt="" class="calibre2" width="388" height="230" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig12.jpg"></p>
      
      
      
      <p class="noind">Apart from the fact that this approach isn’t exactly working, we’d also need to copy each property of <kbd class="calibre15">Person</kbd> to the <kbd class="calibre15">Ninja</kbd> prototype individually. That’s no way to do inheritance. Let’s keep exploring.
      </p>
      
      <p class="noind">What we really want to achieve is a <i class="calibre6">prototype chain</i> so that a <kbd class="calibre15">Ninja</kbd> can <i class="calibre6">be</i> a <kbd class="calibre15">Person</kbd>, and a <kbd class="calibre15">Person</kbd> can be a <kbd class="calibre15">Mammal</kbd>, and a <kbd class="calibre15">Mammal</kbd> can be an <kbd class="calibre15">Animal</kbd>, and so on, all the way to <kbd class="calibre15">Object</kbd>. The best technique for creating such a prototype chain is to use an instance of an object as the other object’s prototype:
      </p>
      
      <pre id="PLd0e17801" class="calibre5"><i class="calibre6">SubClass</i>.prototype = new <i class="calibre6">SuperClass</i>();</pre>
      
      <p class="noind">For example:</p>
      
      <pre id="PLd0e17815" class="calibre5">Ninja.prototype = new Person();</pre>
      
      <p class="noind">This preserves the prototype chain, because the prototype of the <kbd class="calibre15">SubClass</kbd> instance will be an instance of the <kbd class="calibre15">SuperClass</kbd>, which has a prototype with all the properties of <kbd class="calibre15">SuperClass</kbd>, and which will in turn have a prototype pointing to an instance of <i class="calibre6">its</i> superclass, and on and on. In the next listing, we change <a href="#ch07ex07" class="calibre4">listing 7.7</a> slightly to use this technique.
      </p>
      
      
      
      <h5 id="ch07ex08" class="notetitle">Listing 7.8. <a id="ch07ex08__title" class="calibre4"></a>Achieving inheritance with prototypes
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/182fig01_alt.jpg" alt="" class="calibre2" width="590" height="198" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/182fig01_alt.jpg"></p>
      
      
      <p class="noind">The only change to the code is to use an instance of <kbd class="calibre15">Person</kbd> as the prototype for <kbd class="calibre15">Ninja</kbd>. Running the tests shows that we’ve succeeded, as shown in <a href="#ch07fig13" class="calibre4">figure 7.13</a>. Now we’ll take a closer look at the inner workings by looking at the state of the application after we’ve created the new
         <kbd class="calibre15">ninja</kbd> object, as shown in <a href="#ch07fig14" class="calibre4">figure 7.14</a>.
      </p>
      
      
      
      <h5 id="ch07fig13" class="notetitle">Figure 7.13. <a id="ch07fig13__title" class="calibre4"></a>Our <kbd class="calibre15">Ninja</kbd> is a <kbd class="calibre15">Person</kbd>! Let the victory dance begin.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig13.jpg" alt="" class="calibre2" width="388" height="230" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig13.jpg"></p>
      
      
      
      
      
      <h5 id="ch07fig14" class="notetitle">Figure 7.14. <a id="ch07fig14__title" class="calibre4"></a>We’ve achieved inheritance by setting the prototype of the <kbd class="calibre15">Ninja</kbd> constructor to a new instance of a <kbd class="calibre15">Person</kbd> object.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig14_alt.jpg" alt="" class="calibre2" width="590" height="483" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig14_alt.jpg"></p>
      
      
      <p class="noind"><a href="#ch07fig14" class="calibre4">Figure 7.14</a> shows that when we define a <kbd class="calibre15">Person</kbd> function, a <kbd class="calibre15">Person</kbd> <a id="iddle1258" class="calibre4"></a><a id="iddle1903" class="calibre4"></a>prototype is also created that references the <kbd class="calibre15">Person</kbd> function through its <kbd class="calibre15">constructor</kbd> property. Normally, we can extend the <kbd class="calibre15">Person</kbd> prototype with additional properties, and in this case, we specify that every person, created with the <kbd class="calibre15">Person</kbd> constructor, has access to the <kbd class="calibre15">dance</kbd> method:
      </p>
      
      <pre id="PLd0e17944" class="calibre5">function Person(){}
Person.prototype.dance = function(){};</pre>
      
      <p class="noind">We also define a <kbd class="calibre15">Ninja</kbd> function that gets its own prototype object with a <kbd class="calibre15">constructor</kbd> property referencing the <kbd class="calibre15">Ninja</kbd> function: <kbd class="calibre15">function Ninja(){}</kbd>.
      </p>
      
      <p class="noind">Next, in order to achieve inheritance, we replace the prototype of the <kbd class="calibre15">Ninja</kbd> function with a new <kbd class="calibre15">Person</kbd> instance. Now, when we create a new <kbd class="calibre15">Ninja</kbd> object, the internal prototype property of the newly created <kbd class="calibre15">ninja</kbd> object will be set to the object to which the current <kbd class="calibre15">Ninja</kbd> prototype property points to, the previously constructed <kbd class="calibre15">Person</kbd> instance:
      </p>
      
      
      <pre id="PLd0e17988" class="calibre5">function Ninja(){}
Ninja.prototype = new Person();
var ninja = new Ninja();</pre>
      
      <p class="noind"><a id="iddle1907" class="calibre4"></a>When we try to access the <kbd class="calibre15">dance</kbd> method through the <kbd class="calibre15">ninja</kbd> object, the JavaScript runtime will first check the <kbd class="calibre15">ninja</kbd> object itself. Because it doesn’t have the <kbd class="calibre15">dance</kbd> property, its prototype, the <kbd class="calibre15">person</kbd> object, is searched. The <kbd class="calibre15">person</kbd> object also doesn’t have the <kbd class="calibre15">dance</kbd> property, so its prototype is searched, and the property is finally found. This is how to achieve inheritance in JavaScript!
      </p>
      
      <p class="noind">Here’s the important implication: When we perform an <kbd class="calibre15">instanceof</kbd> operation, we can determine whether the function inherits the functionality of any object in its prototype chain.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch07note04" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Another technique that may have occurred to you, and that we advise strongly against, is to use the <kbd class="calibre15">Person</kbd> prototype object directly as the <kbd class="calibre15">Ninja</kbd> prototype, like this: <kbd class="calibre15">Ninja.prototype = Person.prototype</kbd>. Any changes to the <kbd class="calibre15">Ninja</kbd> prototype will then also change the <kbd class="calibre15">Person</kbd> prototype (because they’re the same object), and that’s bound to have undesirable side effects.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">An additional happy side effect of doing prototype inheritance in this manner is that all inherited function prototypes will
         continue to live-update. Objects that inherit from the prototype always have access to the current prototype properties.
      </p>
      
      
      <h4 id="ch07lev2sec4" class="calibre26">7.3.1. <a id="ch07lev2sec4__title" class="calibre4"></a>The problem of overriding the constructor property
      </h4>
      
      <p class="noind">If we take a closer look at <a href="#ch07fig14" class="calibre4">figure 7.14</a>, we’ll see that by setting the new <kbd class="calibre15">Person</kbd> object as a prototype of the <kbd class="calibre15">Ninja</kbd> constructor, we’ve lost our connection to the <kbd class="calibre15">Ninja</kbd> constructor that was previously kept by the original <kbd class="calibre15">Ninja</kbd> prototype. This is a problem, because the <kbd class="calibre15">constructor</kbd> property can be used to determine the function with which the object was created. Somebody using our code could make a perfectly
         reasonable assumption that the following test will pass:
      </p>
      
      <pre id="PLd0e18087" class="calibre5">assert(ninja.constructor === Ninja,
      "The ninja object was created by the Ninja constructor");</pre>
      
      <p class="noind">But in the current state of the application, this test fails. As <a href="#ch07fig14" class="calibre4">figure 7.14</a> shows, if we search the <kbd class="calibre15">ninja</kbd> object for the <kbd class="calibre15">constructor</kbd> property, we won’t find it. So we go over to its prototype, which also doesn’t have a constructor property, and again, we
         follow the prototype and end up in the prototype object of <kbd class="calibre15">Person</kbd>, which has a <kbd class="calibre15">constructor</kbd> property referencing the <kbd class="calibre15">Person</kbd> function. In effect, we get the wrong answer: If we ask the <kbd class="calibre15">ninja</kbd> object which function has constructed it, we’ll get <kbd class="calibre15">Person</kbd> as the answer. This can be the source of some serious bugs.
      </p>
      
      <p class="noind">It’s up to us to fix this situation! But before we can do that, we have to take a detour and see how JavaScript enables us
         to configure properties.
      </p>
      
      
      
      <h5 id="ch07lev3sec1" class="notetitle"><a id="ch07lev3sec1__title" class="calibre4"></a>Configuring object properties
      </h5>
      
      <p class="noind"><a id="iddle1243" class="calibre4"></a><a id="iddle1387" class="calibre4"></a><a id="iddle1503" class="calibre4"></a><a id="iddle1603" class="calibre4"></a><a id="iddle1617" class="calibre4"></a><a id="iddle1814" class="calibre4"></a><a id="iddle1896" class="calibre4"></a><a id="iddle2032" class="calibre4"></a><a id="iddle2164" class="calibre4"></a><a id="iddle2205" class="calibre4"></a>In JavaScript, every object property is described with a <i class="calibre6">property descriptor</i> through which we can configure the following keys:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><kbd class="calibre15">configurable</kbd>—If set to <kbd class="calibre15">true</kbd>, the property’s descriptor can be changed and the property can be deleted. If set to <kbd class="calibre15">false</kbd>, we can do neither of these things.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">enumerable</kbd>—If set to <kbd class="calibre15">true</kbd>, the property shows up during a <kbd class="calibre15">for-in</kbd> loop over the object’s properties (we’ll get to the <kbd class="calibre15">for-in</kbd> loop soon).
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">value</kbd>—Specifies the value of the property. Defaults to <kbd class="calibre15">undefined</kbd>.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">writable</kbd>—If set to <kbd class="calibre15">true</kbd>, the property value can be changed by using an assignment.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">get</kbd>—Defines the <i class="calibre6">getter</i> function, which will be called when we access the property. Can’t be defined in conjunction with <kbd class="calibre15">value</kbd> and <kbd class="calibre15">writable</kbd>.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">set</kbd>—Defines the <i class="calibre6">setter</i> function, which will be called whenever an assignment is made to the property. Also can’t be defined in conjunction with
            <kbd class="calibre15">value</kbd> and <kbd class="calibre15">writable</kbd>.
            
         </li>
         
      </ul>
      
      <p class="noind">Say we create a property through a simple assignment, for example:</p>
      
      <pre id="PLd0e18273" class="calibre5">ninja.name = "Yoshi";</pre>
      
      <p class="noind">This property will be configurable, enumerable, and writable, its value will be set to <kbd class="calibre15">Yoshi</kbd>, and functions <kbd class="calibre15">get</kbd> and <kbd class="calibre15">set</kbd> would be <kbd class="calibre15">undefined</kbd>.
      </p>
      
      <p class="noind">When we want to fine-tune our property configuration, we can use the built-in <kbd class="calibre15">Object.defineProperty</kbd> method, which takes an object on which the property will be defined, the name of the property, and a property descriptor
         object. As an example, take a look at the following code.
      </p>
      
      
      
      <h5 id="ch07ex09" class="notetitle">Listing 7.9. <a id="ch07ex09__title" class="calibre4"></a>Configuring properties
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/185fig01_alt.jpg" alt="" class="calibre2" width="590" height="307" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/185fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1259" class="calibre4"></a>We start with the creation of an empty object, to which we add two properties: <kbd class="calibre15">name</kbd> and <kbd class="calibre15">weapon</kbd>, in the good old-fashioned way, by using assignments. Next, we use the built-in <kbd class="calibre15">Object.define-Property</kbd> method to define the property <kbd class="calibre15">sneaky</kbd>, which isn’t <kbd class="calibre15">configurable</kbd>, isn’t <kbd class="calibre15">enumerable</kbd>, and has its <kbd class="calibre15">value</kbd> set to <kbd class="calibre15">true</kbd>. This <kbd class="calibre15">value</kbd> can be changed because it’s <kbd class="calibre15">writable</kbd>.
      </p>
      
      <p class="noind">Finally, we test that we can access the newly created <kbd class="calibre15">sneaky</kbd> property, and we use the <kbd class="calibre15">for-in</kbd> loop to go through all enumerable properties of the object. <a href="#ch07fig15" class="calibre4">Figure 7.15</a> shows the result.
      </p>
      
      
      
      <h5 id="ch07fig15" class="notetitle">Figure 7.15. <a id="ch07fig15__title" class="calibre4"></a>Properties <kbd class="calibre15">name</kbd> and <kbd class="calibre15">weapon</kbd> will be visited in the <kbd class="calibre15">for-in</kbd> loop, whereas our specially added <kbd class="calibre15">sneaky</kbd> property won’t (even though we can access it normally).
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig15.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig15.jpg"></p>
      
      
      
      <p class="noind">By setting <kbd class="calibre15">enumerable</kbd> to <kbd class="calibre15">false</kbd>, we can be sure that the property won’t appear when using the <kbd class="calibre15">for-in</kbd> loop. To understand why we’d want to do something like this, let’s go back to the original problem.
      </p>
      
      
      
      <h5 id="ch07lev3sec2" class="notetitle"><a id="ch07lev3sec2__title" class="calibre4"></a>Finally solving the problem of overriding the constructor property
      </h5>
      
      <p class="noind">When trying to extend <kbd class="calibre15">Person</kbd> with <kbd class="calibre15">Ninja</kbd> (or to make <kbd class="calibre15">Ninja</kbd> a subclass of <kbd class="calibre15">Person</kbd>), we ran into the following problem: When we set a new <kbd class="calibre15">Person</kbd> object as a prototype to the <kbd class="calibre15">Ninja</kbd> constructor, we lose the original <kbd class="calibre15">Ninja</kbd> prototype that keeps our <kbd class="calibre15">constructor</kbd> property. We don’t want to lose the <kbd class="calibre15">constructor</kbd> property, because it’s useful for determining the function used to create our object instances and it might be expected by
         other developers working on our code base.
      </p>
      
      <p class="noind">We can solve this problem by using the knowledge that we’ve just obtained. We’ll define a new <kbd class="calibre15">constructor</kbd> property on the new <kbd class="calibre15">Ninja.prototype</kbd> by using the <kbd class="calibre15">Object.defineProperty</kbd> method. See the following listing.
      </p>
      
      
      
      <h5 id="ch07ex10" class="notetitle">Listing 7.10. <a id="ch07ex10__title" class="calibre4"></a>Fixing the constructor property problem
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/186fig01_alt.jpg" alt="" class="calibre2" width="590" height="303" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/186fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1677" class="calibre4"></a><a id="iddle1906" class="calibre4"></a>Now if we run the code, we’ll see that everything is peachy. We’ve reestablished the connection between <kbd class="calibre15">ninja</kbd> instances and the <kbd class="calibre15">Ninja</kbd> function, so we can know that they were constructed by the <kbd class="calibre15">Ninja</kbd> function. In addition, if anybody tries to loop through the properties of the <kbd class="calibre15">Ninja.prototype</kbd> object, we’ve made sure that our patched-on property <kbd class="calibre15">constructor</kbd> won’t be visited. Now that’s the mark of a true ninja; we went in, did our job, and got out, without anybody noticing anything
         from the outside!
      </p>
      
      
      
      
      <h4 id="ch07lev2sec5" class="calibre26">7.3.2. <a id="ch07lev2sec5__title" class="calibre4"></a>The instanceof operator
      </h4>
      
      <p class="noind">In most programming languages, the straightforward approach for checking whether an object is a part of a class hierarchy
         is to use the <kbd class="calibre15">instanceof</kbd> operator. For example, in Java, the <kbd class="calibre15">instanceof</kbd> operator works by checking whether the object on the left side is either the same class or a subclass of the class type on
         the right.
      </p>
      
      <p class="noind">Although certain parallels could be made with how the <kbd class="calibre15">instanceof</kbd> operator works in JavaScript, there’s a little twist. In JavaScript, the <kbd class="calibre15">instanceof</kbd> operator works on the prototype chain of the object. For example, say we have the following expression:
      </p>
      
      <pre id="PLd0e18528" class="calibre5">ninja instanceof Ninja</pre>
      
      <p class="noind">The <kbd class="calibre15">instanceof</kbd> operator works by checking whether the <i class="calibre6">current</i> prototype of the <kbd class="calibre15">Ninja</kbd> function is in the prototype chain of the <kbd class="calibre15">ninja</kbd> instance. Let’s go back to our persons and ninjas, for a more concrete example.
      </p>
      
      
      
      <h5 id="ch07ex11" class="notetitle">Listing 7.11. <a id="ch07ex11__title" class="calibre4"></a>Studying the instanceof operator
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/187fig01_alt.jpg" alt="" class="calibre2" width="590" height="154" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/187fig01_alt.jpg"></p>
      
      
      <p class="noind">As expected, a ninja is, at the same time, a <kbd class="calibre15">Ninja</kbd> and a <kbd class="calibre15">Person</kbd>. But, to nail down this point, <a href="#ch07fig16" class="calibre4">figure 7.16</a> shows how the whole thing works behind the scenes.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch07fig16" class="notetitle">Figure 7.16. <a id="ch07fig16__title" class="calibre4"></a>The prototype chain of a <kbd class="calibre15">ninja</kbd> instance is composed of a <kbd class="calibre15">new Person()</kbd> object and the <kbd class="calibre15">Person prototype</kbd>.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig16_alt.jpg" alt="" class="calibre2" width="590" height="343" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig16_alt.jpg"></p>
      
      
      <p class="noind">The prototype chain of a ninja instance is composed of a <kbd class="calibre15">new Person()</kbd> object, through which we’ve achieved inheritance, and the <kbd class="calibre15">Person prototype</kbd>. When evaluating the expression <kbd class="calibre15">ninja instanceof Ninja</kbd>, the JavaScript engine takes the prototype of the <kbd class="calibre15">Ninja</kbd> function, the <kbd class="calibre15">new Person()</kbd> object, and checks whether it’s in the prototype chain of the <kbd class="calibre15">ninja</kbd> instance. Because the <kbd class="calibre15">new Person()</kbd> object is a direct prototype of the <kbd class="calibre15">ninja</kbd> instance, the result is <kbd class="calibre15">true</kbd>.
      </p>
      
      <p class="noind">In the second case, where we check <kbd class="calibre15">ninja instanceof Person</kbd>, the JavaScript engine takes the prototype of the <kbd class="calibre15">Person</kbd> function, the <kbd class="calibre15">Person prototype</kbd>, and checks whether it can be found in the prototype chain of the <kbd class="calibre15">ninja</kbd> instance. Again, it can, because it’s the prototype of our <kbd class="calibre15">new Person()</kbd> object, which, as we’ve already seen, is the prototype of the <kbd class="calibre15">ninja</kbd> instance.
      </p>
      
      <p class="noind">And that’s all there is to know about the <kbd class="calibre15">instanceof</kbd> operator. Although its most common use is in providing a clear way to determine whether an instance was created by a particular
         function constructor, it doesn’t exactly work like that. Instead, it checks whether the prototype of the right-side function
         is in the prototype chain of the object on the left. Therefore, there is a caveat that we should be careful about.
      </p>
      
      
      <h5 id="ch07lev3sec3" class="notetitle"><a id="ch07lev3sec3__title" class="calibre4"></a>The instanceof caveat
      </h5>
      
      <p class="noind">As you’ve seen multiple times throughout this chapter, JavaScript is a dynamic language in which we can modify a <i class="calibre6">lot</i> of things during program execution. For example, there’s nothing stopping us from changing the prototype of a constructor,
         as shown in the following listing.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch07ex12" class="notetitle">Listing 7.12. <a id="ch07ex12__title" class="calibre4"></a>Watch out for changes to constructor prototypes
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/189fig01_alt.jpg" alt="" class="calibre2" width="590" height="127" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/189fig01_alt.jpg"></p>
      
      
      <p class="noind">In this example, we again repeat all the basic steps of making a <kbd class="calibre15">ninja</kbd> instance, and our first test goes fine. But if we change the prototype of the <kbd class="calibre15">Ninja</kbd> constructor function <i class="calibre6">after</i> the creation of the <kbd class="calibre15">ninja</kbd> instance, and again test whether <kbd class="calibre15">ninja</kbd> is an <kbd class="calibre15">instanceof Ninja</kbd>, we’ll see that the situation has changed. This will surprise us only if we cling to the inaccurate assumption that the <kbd class="calibre15">instanceof</kbd> operator tells us whether an instance was created by a particular function constructor. If, on the other hand, we take the
         real semantics of the <kbd class="calibre15">instanceof</kbd> operator—that it checks only whether the prototype of the function on the right side is in the prototype chain of the object
         on the left side—we won’t be surprised. This situation is shown in <a href="#ch07fig17" class="calibre4">figure 7.17</a>.
      </p>
      
      
      
      <h5 id="ch07fig17" class="notetitle">Figure 7.17. <a id="ch07fig17__title" class="calibre4"></a>The <kbd class="calibre15">instanceof</kbd> operator checks whether the prototype of the function on the right is in the prototype chain of the object on the left. Be
         careful; the function’s prototype can be changed anytime!
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig17_alt.jpg" alt="" class="calibre2" width="590" height="450" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/07fig17_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1178" class="calibre4"></a><a id="iddle1179" class="calibre4"></a><a id="iddle1181" class="calibre4"></a><a id="iddle1398" class="calibre4"></a><a id="iddle1400" class="calibre4"></a><a id="iddle1915" class="calibre4"></a><a id="iddle1917" class="calibre4"></a><a id="iddle2042" class="calibre4"></a>Now that we understand how prototypes work in JavaScript, and how to use prototypes in conjunction with constructor functions
         to implement inheritance, let’s move on to a new addition in the ES6 version of JavaScript: classes.
      </p>
      
      
      
      
      
      <h3 id="ch07lev1sec4" class="calibre24"><a id="ch07lev1sec4__title" class="calibre3"></a>7.4. Using JavaScript “classes” in ES6
      </h3>
      
      <p class="noind">It’s great that JavaScript lets us use a form of inheritance via prototypes. But many developers, especially those from a
         classical object-oriented background, would prefer a simplification or abstraction of JavaScript’s inheritance system into
         one that they’re more familiar with.
      </p>
      
      <p class="noind">This inevitably leads toward the realm of classes, even though JavaScript doesn’t support classical inheritance natively.
         As a response to this need, several JavaScript libraries that simulate classical inheritance have popped up. Because each
         library implements classes in its own way, the ECMAScript committee has standardized the syntax for simulating class-based
         inheritance. Notice how we said <i class="calibre6">simulating</i>. Even though now we can use the <kbd class="calibre15">class</kbd> keyword in JavaScript, the underlying implementation is still based on prototype inheritance!
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch07note05" class="notetitle">Note</h5>
      
      
      <p class="noindclose">The <kbd class="calibre15">class</kbd> keyword has been added to the ES6 version of JavaScript, and not all browsers implement it (see <a href="http://mng.bz/3ykA" class="calibre4">http://mng.bz/3ykA</a> for current support).
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Let’s start by studying the new syntax.</p>
      
      
      <h4 id="ch07lev2sec6" class="calibre26">7.4.1. <a id="ch07lev2sec6__title" class="calibre4"></a>Using the class keyword
      </h4>
      
      <p class="noind">ES6 introduces a new <kbd class="calibre15">class</kbd> keyword that provides a much more elegant way of creating objects and implementing inheritance than manually implementing
         it ourselves with prototypes. Using the <kbd class="calibre15">class</kbd> keyword is easy, as shown in the following listing.
      </p>
      
      
      
      <h5 id="ch07ex13" class="notetitle">Listing 7.13. <a id="ch07ex13__title" class="calibre4"></a>Creating a class in ES6
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/190fig01_alt.jpg" alt="" class="calibre2" width="590" height="216" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/190fig01_alt.jpg"></p>
      
      
      <p class="noind"><a href="#ch07ex13" class="calibre4">Listing 7.13</a> shows that we can create a <kbd class="calibre15">Ninja</kbd> class by using the <kbd class="calibre15">class</kbd> keyword. When creating ES6 classes, we can explicitly define a <kbd class="calibre15">constructor</kbd> function that will be invoked when instantiating a <kbd class="calibre15">Ninja</kbd> instance. In the constructor’s body, we can access the newly created instance with the <kbd class="calibre15">this</kbd> keyword, and we can easily add new properties, such as the <kbd class="calibre15">name</kbd> property. Within the class body, we can also define methods that will be accessible to all <kbd class="calibre15">Ninja</kbd> instances. In this case, we’ve defined a <kbd class="calibre15">swingSword</kbd> method that returns <kbd class="calibre15">true</kbd>:
      </p>
      
      <pre id="PLd0e18884" class="calibre5"><b class="calibre21">class</b> Ninja{
  constructor(name){
    this.name = name;
  }

  swingSword(){
    return true;
  }
}</pre>
      
      <p class="noind">Next we can create a <kbd class="calibre15">Ninja</kbd> instance by calling the <kbd class="calibre15">Ninja</kbd> class with the keyword <kbd class="calibre15">new</kbd>, just as we would if <kbd class="calibre15">Ninja</kbd> was a simple constructor function (as earlier in the chapter):
      </p>
      
      <pre id="PLd0e18907" class="calibre5">var ninja = new Ninja("Yoshi");</pre>
      
      <p class="noind">Finally, we can test that the <kbd class="calibre15">ninja</kbd> instance behaves as expected, that it’s an <kbd class="calibre15">instance-of Ninja</kbd>, has a <kbd class="calibre15">name</kbd> property, and has access to the <kbd class="calibre15">swingSword</kbd> method:
      </p>
      
      <pre id="PLd0e18928" class="calibre5">assert(ninja instanceof Ninja, "Our ninja is a Ninja");
assert(ninja.name === "Yoshi", "named Yoshi");
assert(ninja.swingSword(), "and he can swing a sword");</pre>
      
      
      <h5 id="ch07lev3sec4" class="notetitle"><a id="ch07lev3sec4__title" class="calibre4"></a>Classes are syntactic sugar
      </h5>
      
      <p class="noind">As mentioned earlier, even though ES6 has introduced the <kbd class="calibre15">class</kbd> keyword, under the hood we’re still dealing with good old prototypes; classes are syntactic sugar designed to make our lives
         a bit easier when mimicking classes in JavaScript.
      </p>
      
      <p class="noind">Our class code from <a href="#ch07ex13" class="calibre4">listing 7.13</a> can be translated to functionally identical ES5 code:
      </p>
      
      <pre id="PLd0e18951" class="calibre5">function Ninja(name) {
  this.name = name;
}
Ninja.prototype.swingSword = function() {
  return true;
};</pre>
      
      <p class="noind">As you can see, there’s nothing especially new with ES6 classes. The code is more elegant, but the same concepts are applied.</p>
      
      
      
      
      <h5 id="ch07lev3sec5" class="notetitle"><a id="ch07lev3sec5__title" class="calibre4"></a>Static methods
      </h5>
      
      <p class="noind"><a id="iddle1812" class="calibre4"></a><a id="iddle1900" class="calibre4"></a>In the previous examples, you saw how to define object methods (prototype methods), accessible to all object instances. In
         addition to such methods, classical object-oriented languages such as Java use static methods, methods defined on a class
         level. Check out the following example.
      </p>
      
      <h5 id="ch07ex14" class="notetitle">Listing 7.14. <a id="ch07ex14__title" class="calibre4"></a>Static methods in ES6
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch07ex14-0.jpg" alt="" class="calibre2" width="590" height="226" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch07ex14-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch07ex14-1.jpg" alt="" class="calibre2" width="590" height="191" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch07ex14-1.jpg"></p>
      
      <p class="noind">We again create a <kbd class="calibre15">Ninja</kbd> class that has a <kbd class="calibre15">swingSword</kbd> method accessible from all <kbd class="calibre15">ninja</kbd> instances. We also define a static method, <kbd class="calibre15">compare</kbd>, by prefixing the method name with the keyword <kbd class="calibre15">static</kbd>.
      </p>
      
      <pre id="PLd0e19011" class="calibre5"><b class="calibre21">static</b> compare(ninja1, ninja2){
    return ninja1.level - ninja2.level;
}</pre>
      
      <p class="noind">The <kbd class="calibre15">compare</kbd> method, which compares the skill levels of two ninjas, is defined on the class level, and not the instance level! Later we
         test that this effectively means that the <kbd class="calibre15">compare</kbd> method isn’t accessible from <kbd class="calibre15">ninja</kbd> instances but is accessible from the <kbd class="calibre15">Ninja</kbd> class:
      </p>
      
      <pre id="PLd0e19034" class="calibre5">assert(!("compare" in ninja1) &amp;&amp; !("compare" in ninja2),
       "The ninja instance doesn't know how to compare");
assert(Ninja.compare(ninja1, ninja2) &gt; 0,
      "The Ninja class can do the comparison!");</pre>
      
      <p class="noind"><a id="iddle1180" class="calibre4"></a><a id="iddle1260" class="calibre4"></a><a id="iddle1399" class="calibre4"></a><a id="iddle1815" class="calibre4"></a><a id="iddle1916" class="calibre4"></a>We can also look at how “static” methods can be implemented in pre-ES6 code. For this, we have to remember only that classes
         are implemented through functions. Because static methods are class-level methods, we can implement them by taking advantage
         of functions as first-class objects, and adding a method property to our constructor function, as in the following example:
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/193fig01_alt.jpg" alt="" class="calibre2" width="590" height="52" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/193fig01_alt.jpg"></p>
      
      <p class="noind">Now let’s move on to inheritance.</p>
      
      
      
      
      <h4 id="ch07lev2sec7" class="calibre26">7.4.2. <a id="ch07lev2sec7__title" class="calibre4"></a>Implementing inheritance
      </h4>
      
      <p class="noind">To be honest, performing inheritance in pre-ES6 code can be a pain. Let’s go back to our trusted Ninjas, Persons example:</p>
      
      <pre id="PLd0e19102" class="calibre5">function Person(){}
Person.prototype.dance = function(){};

function Ninja(){}
Ninja.prototype <b class="calibre21">= new Person();</b>

Object.defineProperty(Ninja.prototype, "constructor", {
  enumerable: false,
  value: Ninja,
  writable: true
});</pre>
      
      <p class="noind">There’s a lot to keep in mind here: Methods accessible to all instances should be added directly to the prototype of the constructor
         function, as we did with the <kbd class="calibre15">dance</kbd> method and the <kbd class="calibre15">Person</kbd> constructor. If we want to implement inheritance, we have to set the prototype of the derived “class” to the instance of
         the base “class.” In this case, we assigned a new instance of <kbd class="calibre15">Person</kbd> to <kbd class="calibre15">Ninja.prototype</kbd>. Unfortunately, this messes up the <kbd class="calibre15">constructor</kbd> property, so we have to manually restore it with the <kbd class="calibre15">Object.defineProperty</kbd> method. This is a lot to keep in mind when trying to achieve a relatively simple and commonly used feature (inheritance).
         Luckily, with ES6, all of this is significantly simplified.
      </p>
      
      <p class="noind">Let’s see how it’s done in the following listing.</p>
      
      <h5 id="ch07ex15" class="notetitle">Listing 7.15. <a id="ch07ex15__title" class="calibre4"></a>Inheritance in ES6
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch07ex15-0.jpg" alt="" class="calibre2" width="590" height="291" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch07ex15-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch07ex15-1.jpg" alt="" class="calibre2" width="590" height="374" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch07ex15-1.jpg"></p>
      
      <p class="noind"><a id="iddle1465" class="calibre4"></a><a href="#ch07ex15" class="calibre4">Listing 7.15</a> shows how to achieve inheritance in ES6; we use the <kbd class="calibre15">extends</kbd> keyword to inherit from another class:
      </p>
      
      <pre id="PLd0e19161" class="calibre5">class Ninja extends Person</pre>
      
      <p class="noind">In this example, we create a <kbd class="calibre15">Person</kbd> class with a constructor that assigns a <kbd class="calibre15">name</kbd> to each <kbd class="calibre15">Person</kbd> instance. We also define a <kbd class="calibre15">dance</kbd> method that will be accessible to all <kbd class="calibre15">Person</kbd> instances:
      </p>
      
      <pre id="PLd0e19185" class="calibre5">class Person {
  constructor(name){
    this.name = name;
  }
  dance(){
    return true;
  }
}</pre>
      
      <p class="noind">Next we define a <kbd class="calibre15">Ninja</kbd> class that extends the <kbd class="calibre15">Person</kbd> class. It has an additional <kbd class="calibre15">weapon</kbd> property, and a <kbd class="calibre15">wieldWeapon</kbd> method:
      </p>
      
      <pre id="PLd0e19206" class="calibre5">class Ninja <b class="calibre21">extends Person</b> {
  constructor(name, weapon){
    <b class="calibre21">super(name);</b>
    this.weapon = weapon;
  }

  wieldWeapon(){
    return true;
  }
}</pre>
      
      <p class="noind"><a id="iddle2081" class="calibre4"></a>In the constructor of the derived, <kbd class="calibre15">Ninja</kbd> class, there’s a call to the constructor of the base, <kbd class="calibre15">Person</kbd> class, through the keyword <kbd class="calibre15">super</kbd>. This should be familiar, if you’ve worked with any class-based language.
      </p>
      
      <p class="noind">We continue by creating a <kbd class="calibre15">person</kbd> instance and checking that it’s an instance of the <kbd class="calibre15">Person</kbd> class that has a <kbd class="calibre15">name</kbd> and can <kbd class="calibre15">dance</kbd>. Just to be sure, we also check that a person who <i class="calibre6">isn’t</i> a Ninja can’t wield a weapon:
      </p>
      
      <pre id="PLd0e19255" class="calibre5">var person = new Person("Bob");

assert(person instanceof Person, "A person's a person");
assert(person.dance(), "A person can dance.");
assert(person.name === "Bob", "We can call it by name.");
assert(!(person instanceof Ninja), "But it's not a Ninja");
assert(!("wieldWeapon" in person), "And it cannot wield a weapon");</pre>
      
      <p class="noind">We also create a <kbd class="calibre15">ninja</kbd> instance and check that it’s an instance of <kbd class="calibre15">Ninja</kbd> and can wield a weapon. Because every <kbd class="calibre15">ninja</kbd> is also a <kbd class="calibre15">Person</kbd>, we check that a ninja is an instance of <kbd class="calibre15">Person</kbd>, that it has a <kbd class="calibre15">name</kbd>, and that it also, in the interim of fighting, enjoys dancing:
      </p>
      
      <pre id="PLd0e19282" class="calibre5">var ninja = new Ninja("Yoshi", "Wakizashi");
assert(ninja instanceof Ninja, "A ninja's a ninja");
assert(ninja.wieldWeapon(), "That can wield a weapon");
assert(ninja instanceof Person, "But it's also a person");
assert(ninja.name === "Yoshi" , "That has a name");
assert(ninja.dance(), "And enjoys dancing");</pre>
      
      <p class="noind">See how easy this is? There’s no need to think about prototypes or the side effects of certain overridden properties. We define
         classes and specify their relationship by using the <kbd class="calibre15">extends</kbd> keyword. Finally, with ES6, hordes of developers coming from languages such as Java or C# can be at peace.
      </p>
      
      <p class="noind">And that’s it. With ES6, we build class hierarchies almost as easily as in any other, more conventional object-oriented language.</p>
      
      
      
      
      <h3 id="ch07lev1sec5" class="calibre24"><a id="ch07lev1sec5__title" class="calibre3"></a>7.5. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">JavaScript objects are simple collections of named properties with values.
            
         </li>
         
         <li class="calibre20">JavaScript uses prototypes.
            
         </li>
         
         <li class="calibre20">Every object can have a reference to a <i class="calibre6">prototype</i>, an object to which we delegate the search for a particular property, if the object itself doesn’t have the searched-for
            property. An object’s prototype can have its own prototype, and so on, forming a <i class="calibre6">prototype chain</i>.
            
         </li>
         
         <li class="calibre20">We can define the prototype of an object by using the <kbd class="calibre15">Object.setPrototypeOf</kbd> method.
            
         </li>
         
         <li class="calibre20">Prototypes are closely linked to constructor functions. Every function has a <kbd class="calibre15">prototype</kbd> property that’s set as the prototype of objects that it instantiates.
            
         </li>
         
         <li class="calibre20">A function’s <kbd class="calibre15">prototype</kbd> object has a <kbd class="calibre15">constructor</kbd> property pointing back to the function itself. This property is accessible to all objects instantiated with that function
            and, with certain limitations, can be used to find out whether an object was created by a particular function.
            
         </li>
         
         <li class="calibre20">In JavaScript, almost everything can be changed at runtime, including an object’s prototypes and a function’s prototypes!
            
         </li>
         
         <li class="calibre20">If we want the instances created by a <kbd class="calibre15">Ninja</kbd> constructor function to “inherit” (more accurately, have access to) properties accessible to instances created by the <kbd class="calibre15">Person</kbd> constructor function, set the prototype of the <kbd class="calibre15">Ninja</kbd> constructor to a new instance of the <kbd class="calibre15">Person</kbd> class.
            
         </li>
         
         <li class="calibre20">In JavaScript, properties have attributes (configurable, enumerable, writable). These properties can be defined by using the
            built-in <kbd class="calibre15">Object.defineProperty</kbd> method.
            
         </li>
         
         <li class="calibre20">JavaScript ES6 adds support for a <kbd class="calibre15">class</kbd> keyword that enables us to more easily mimic classes. Behind the scenes, prototypes are still in play!
            
         </li>
         
         <li class="calibre20">The <kbd class="calibre15">extends</kbd> keyword enables elegant inheritance.
            
         </li>
         
      </ul>
      
      
      
      <h3 id="ch07lev1sec6" class="calibre24"><a id="ch07lev1sec6__title" class="calibre3"></a>7.6. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch07qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch07qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch07qa2q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">Which of the following properties points to an object that will be searched if the target object doesn’t have the searched-for
               property?
            </p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">class</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">instance</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">prototype</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">pointTo</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch07qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch07qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind">What’s the value of variable <kbd class="calibre15">a1</kbd> after the following code is executed?
            </p>
            
            <pre id="PLd0e19456" class="calibre5">function Ninja(){}
Ninja.prototype.talk = function (){
  return "Hello";
};

const ninja = new Ninja();
const a1 = ninja.talk();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch07qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch07qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">What’s the value of <kbd class="calibre15">a1</kbd> after running the following code?
            </p>
            
            <pre id="PLd0e19472" class="calibre5">function Ninja(){}
Ninja.message = "Hello";

const ninja = new Ninja();

const a1 = ninja.message;</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch07qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch07qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">Explain the difference between the <kbd class="calibre15">getFullName</kbd> method in these two code fragments:
            </p>
            
            <pre id="PLd0e19489" class="calibre5">//First fragment
function Person(firstName, lastName){
  this.firstName = firstName;
  this.lastName = lastName;

  this.getFullName = function () {
    return this.firstName + " " + this.lastName;
  }
}

//Second fragment
function Person(firstName, lastName) {
  this.firstName = firstName;
  this.lastName = lastName;
}

Person.prototype.getFullName = function () {
  return this.firstName + " " + this.lastName;
}</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch07qa2qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch07qa2q5" class="calibre4"></a><b class="calibre21">5 </b></p><p class="noind">After running the following code, what will <kbd class="calibre15">ninja.constructor</kbd> point to?
            </p>
            
            <pre id="PLd0e19505" class="calibre5">function Person() { }
function Ninja() { }

const ninja = new Ninja();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch07qa2qe6" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch07qa2q6" class="calibre4"></a><b class="calibre21">6 </b></p><p class="noind">After running the following code, what will <kbd class="calibre15">ninja.constructor</kbd> point to?
            </p>
            
            <pre id="PLd0e19521" class="calibre5">function Person() { }
function Ninja() { }
Ninja.prototype = new Person();
const ninja = new Ninja();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch07qa2qe7" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch07qa2q7" class="calibre4"></a><b class="calibre21">7 </b></p><p class="noind">Explain how the <kbd class="calibre15">instanceof</kbd> operator works in the following example.
            </p>
            
            <pre id="PLd0e19537" class="calibre5">function Warrior() { }

function Samurai() { }
Samurai.prototype = new Warrior();

var samurai = new Samurai();

samurai instanceof Warrior; //Explain</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch07qa2qe8" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch07qa2q8" class="calibre4"></a><b class="calibre21">8 </b></p><p class="noind">Translate the following ES6 code into ES5 code.</p>
            
            <pre id="PLd0e19550" class="calibre5">class Warrior {
  constructor(weapon){
    this.weapon = weapon;
  }

  wield() {
    return "Wielding " + this.weapon;
  }

  static duel(warrior1, warrior2){
    return warrior1.wield() + " " + warrior2.wield();
  }
}</pre>
            <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_31"></div>
<h2 id="ch08" class="part">Chapter 8. <a id="ch08__title" class="calibre3"></a>Controlling access to objects
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Using getters and setters to control access to object properties
            
         </li>
         
         <li class="calibre20">Controlling access to objects through proxies
            
         </li>
         
         <li class="calibre20">Using proxies for cross-cutting concerns
            
         </li>
         
      </ul>
      
      <p class="noind">In the previous chapter, you saw that JavaScript objects are dynamic collections of properties. We can easily add new properties,
         change the values of properties, and even completely remove existing properties. In many situations (for example, when validating
         property values, logging, or displaying data in the UI), we need to be able to monitor exactly what’s going on with our objects.
         So in this chapter, you’ll learn techniques for controlling access to and monitoring all of the changes that occur in your
         objects.
      </p>
      
      <p class="noind">We’ll start with getters and setters, methods that control access to specific object properties. You first saw these methods
         in action in <a href="kindle_split_016.html#ch05" class="calibre4">chapters 5</a> and <a href="kindle_split_019.html#ch07" class="calibre4 totri-footnote">7</a>. In this chapter, you’ll see some of their built-in language support and how to use them for logging, performing data validation,
         and defining computed properties.
      </p>
      
      <p class="noind">We’ll continue with proxies, a completely new type of object introduced in ES6. These objects control access to other objects.
         You’ll learn how they work and how to use them to great effect to easily expand your code with cross-cutting concerns <a id="iddle1027" class="calibre4"></a><a id="iddle1111" class="calibre4"></a><a id="iddle1619" class="calibre4"></a><a id="iddle1891" class="calibre4"></a>such as performance measurement or logging, and how to avoid null exceptions by autopopulating object properties. Let’s start
         the journey with something we already know to a certain degree: getters and setters.
      </p>
      
      <h3 class="calibre24"><a id="ch08qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch08qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch08qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">What are some of the benefits of accessing a property’s value through getters and setters?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch08qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch08qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">What is the main difference between proxies and getters and setters?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch08qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch08qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">What are proxy traps? Name three types of trap.</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch08lev1sec1" class="calibre24"><a id="ch08lev1sec1__title" class="calibre3"></a>8.1. Controlling access to properties with getters and setters
      </h3>
      
      <p class="noind">In JavaScript, objects are relatively simple collections of properties. The primary way to keep track of our program state
         is by modifying those properties. For example, consider the following code:
      </p>
      
      <pre id="PLd0e19675" class="calibre5">function Ninja (level) {
  this.skillLevel = level;
}
const ninja = new Ninja(100);</pre>
      
      <p class="noind">Here we define a <kbd class="calibre15">Ninja</kbd> constructor that creates <kbd class="calibre15">ninja</kbd> objects with a property <kbd class="calibre15">skillLevel</kbd>. Later, if we want to change the value of that property, we can write the following code: <kbd class="calibre15">ninja.skillLevel = 20</kbd>.
      </p>
      
      <p class="noind">That’s all nice and convenient, but what happens in the following cases?</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">We want to safeguard against accidental mistakes, such as assigning unanticipated data. For example, we want to stop ourselves
            from doing something like assigning a value of a wrong type: <kbd class="calibre15">ninja.skillLevel = "high"</kbd>.
            
         </li>
         
         <li class="calibre20">We want to log all changes to the <kbd class="calibre15">skillLevel</kbd> property.
            
         </li>
         
         <li class="calibre20">We need to show the value of our <kbd class="calibre15">skillLevel</kbd> property somewhere in the UI of our web page. Naturally, we want to present the last, up-to-date value of the property, but
            how can we easily do this?
            
         </li>
         
      </ul>
      
      <p class="noind">We can handle all of these cases elegantly with getter and setter methods.</p>
      
      <p class="noind">In <a href="kindle_split_016.html#ch05" class="calibre4">chapter 5</a>, you saw a glimpse of getters and setters as a means of mimicking private object properties in JavaScript through closures.
         Let’s revisit the material you’ve learned so far, by working with ninjas that have a private <kbd class="calibre15">skillLevel</kbd> property accessible only through getters and setters, as shown in the following listing.
      </p>
      
      
      
      <h5 id="ch08ex01" class="notetitle">Listing 8.1. <a id="ch08ex01__title" class="calibre4"></a>Using getters and setters to guard private properties
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/200fig01_alt.jpg" alt="" class="calibre2" width="590" height="229" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/200fig01_alt.jpg"></p>
      
      
      <p class="noind">We define a <kbd class="calibre15">Ninja</kbd> constructor that creates ninjas with a “private” <kbd class="calibre15">skillLevel</kbd> variable accessible only through our <kbd class="calibre15">getSkillLevel</kbd> and <kbd class="calibre15">setSkillLevel</kbd> methods: The property value can be obtained only through the <kbd class="calibre15">getSkillLevel</kbd> method, whereas a new property value can be set only through the <kbd class="calibre15">setSkillLevel</kbd> method (remember <a href="kindle_split_016.html#ch05" class="calibre4">chapter 5</a> on closures?).
      </p>
      
      <p class="noind">Now, if we want to log all read attempts of the <kbd class="calibre15">skillLevel</kbd> property, we expand the <kbd class="calibre15">getSkillLevel</kbd> method; and if we want to react to all write attempts, we expand the <kbd class="calibre15">setSkillLevel</kbd> method, as in the following snippet:
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/201fig01_alt.jpg" alt="" class="calibre2" width="590" height="251" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/201fig01_alt.jpg"></p>
      
      <p class="noind">This is great. We can easily react to all interactions with our properties by plugging in, for example, logging, data validation,
         or other side effects such as UI modifications.
      </p>
      
      <p class="noind">But one nagging concern might be popping into your mind. The <kbd class="calibre15">skillLevel</kbd> property is a value property; it references data (the number 100), and not a function. Unfortunately, in order to take advantage
         of all the benefits of controlled access, all our interactions with the property have to be made by explicitly calling the
         associated methods, which is, to be honest, slightly awkward.
      </p>
      
      <p class="noind">Luckily, JavaScript has built-in support for true getters and setters: properties that are accessed as normal data properties
         (for example, <kbd class="calibre15">ninja.skillLevel</kbd>), but that are methods that can compute the value of a requested property, validate the passed-in value, or whatever else
         we need them to do. Let’s take a look at this built-in support.
      </p>
      
      
      
      <h4 id="ch08lev2sec1" class="calibre26">8.1.1. <a id="ch08lev2sec1__title" class="calibre4"></a>Defining getters and setters
      </h4>
      
      <p class="noind"><a id="iddle1028" class="calibre4"></a><a id="iddle1620" class="calibre4"></a><a id="iddle1816" class="calibre4"></a><a id="iddle1892" class="calibre4"></a><a id="iddle2011" class="calibre4"></a>In JavaScript, getter and setter methods can be defined in two ways:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">By specifying them within object literals or within ES6 class definitions
            
         </li>
         
         <li class="calibre20">By using the built-in <kbd class="calibre15">Object.defineProperty</kbd> method
            
         </li>
         
      </ul>
      
      <p class="noind">Explicit support for getters and setters has existed for quite some time now, since the days of ES5. As always, let’s explore
         the syntax through an example. In this case, we have an object storing a list of ninjas, and we want to be able to get and
         set the first ninja in the list.
      </p>
      
      
      
      <h5 id="ch08ex02" class="notetitle">Listing 8.2. <a id="ch08ex02__title" class="calibre4"></a>Defining getters and setters in object literals
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/202fig01_alt.jpg" alt="" class="calibre2" width="590" height="310" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/202fig01_alt.jpg"></p>
      
      
      <p class="noind">This example defines a <kbd class="calibre15">ninjaCollection</kbd> object that has a standard property, <kbd class="calibre15">ninjas</kbd>, which references an array of ninjas, and a getter and a setter for the property <kbd class="calibre15">firstNinja</kbd>. The general syntax for getters and setters is shown in <a href="#ch08fig01" class="calibre4">figure 8.1</a>.
      </p>
      
      
      
      <h5 id="ch08fig01" class="notetitle">Figure 8.1. <a id="ch08fig01__title" class="calibre4"></a>The syntax for defining getters and setters. Prefix the property name with either the <kbd class="calibre15">get</kbd> or the <kbd class="calibre15">set</kbd> keyword.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/08fig01_alt.jpg" alt="" class="calibre2" width="590" height="222" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/08fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1604" class="calibre4"></a><a id="iddle1618" class="calibre4"></a>As you can see, we define a getter property by prefixing the name with a <kbd class="calibre15">get</kbd> keyword, and a setter property with a <kbd class="calibre15">set</kbd> keyword.
      </p>
      
      <p class="noind">In <a href="#ch08ex02" class="calibre4">listing 8.2</a>, both the getter and the setter log a message. In addition, the getter returns the value of the ninja at index <kbd class="calibre15">0</kbd>, and the setter assigns a new value to the ninja at the same index:
      </p>
      
      <pre id="PLd0e19955" class="calibre5">get firstNinja(){
  report("Getting firstNinja");
  return this.ninjas[0];
},
set firstNinja(value){
  report("Setting firstNinja");
  this.ninjas[0] = value;
}</pre>
      
      <p class="noind">Next, we test that accessing the getter property returns the first ninja, Yoshi:</p>
      
      <pre id="PLd0e19964" class="calibre5">assert(<b class="calibre21">ninjaCollection.firstNinja</b> === "Yoshi",
       "Yoshi is the first ninja");</pre>
      
      <p class="noind">Notice that the getter property is accessed as if it were a standard object property (and not as the method that it is).</p>
      
      <p class="noind">After we access a getter property, the associated getter method is implicitly called, the message <kbd class="calibre15">Getting firstNinja</kbd> is logged, and the value of the ninja at index <kbd class="calibre15">0</kbd> is returned.
      </p>
      
      <p class="noind">We continue by taking advantage of our setter method, and writing to the <kbd class="calibre15">firstNinja</kbd> property, again, just as we would assign a new value to a normal object property:
      </p>
      
      <pre id="PLd0e19991" class="calibre5">ninjaCollection.firstNinja = "Hachi";</pre>
      
      <p class="noind">Similar to the previous case, because the <kbd class="calibre15">firstNinja</kbd> property has a setter method, whenever we assign a value to that property, the setter method is implicitly called. This logs
         the message <kbd class="calibre15">Setting firstNinja</kbd> and modifies the value of the ninja at index <kbd class="calibre15">0</kbd>.
      </p>
      
      <p class="noind">Finally, we can test that our modification has done the work and that the new value of the ninja at index <kbd class="calibre15">0</kbd> can be accessed both through the <kbd class="calibre15">ninjas</kbd> collection and through our getter method:
      </p>
      
      <pre id="PLd0e20018" class="calibre5">assert(ninjaCollection.firstNinja === "Hachi"
    &amp;&amp; ninjaCollection.ninjas[0] ===  "Hachi",
       "Now Hachi is the first ninja");</pre>
      
      <p class="noind"><a href="#ch08fig02" class="calibre4">Figure 8.2</a> shows the output generated by <a href="#ch08ex02" class="calibre4">listing 8.2</a>. When we access a property with a getter (for example, through <kbd class="calibre15">ninjaCollection.firstNinja</kbd>), the getter method is immediately called, and in this case, the message <kbd class="calibre15">Getting firstNinja</kbd> is logged. Later, we test that the output is <kbd class="calibre15">Yoshi</kbd> and that the message <kbd class="calibre15">Yoshi is the first ninja</kbd> is logged. We proceed similarly by assigning a new value to the <kbd class="calibre15">firstNinja</kbd> property, and as we can see in the output, this implicitly triggers the execution of the setter method, which outputs the
         message <kbd class="calibre15">Setting firstNinja</kbd>.
      </p>
      
      
      
      <h5 id="ch08fig02" class="notetitle">Figure 8.2. <a id="ch08fig02__title" class="calibre4"></a>The output from <a href="#ch08ex02" class="calibre4">listing 8.2</a>: if a property has a getter and a setter method, the getter method is implicitly called whenever we read the property value,
         and the setter method is called whenever we assign a new value to the property.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/08fig02.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/08fig02.jpg"></p>
      
      
      
      <p class="noind">An important point to take from all this is that native getters and setters allow us to specify properties that are accessed
         as standard properties, but that are methods whose execution is triggered immediately when the property is accessed. This
         is further emphasized in <a href="#ch08fig03" class="calibre4">figure 8.3</a>.
      </p>
      
      
      
      <h5 id="ch08fig03" class="notetitle">Figure 8.3. <a id="ch08fig03__title" class="calibre4"></a>Accessing a property with a getter method implicitly calls the matching getter. The process is the same as if this were a
         standard method call, and the getter method gets executed. A similar thing happens when we assign a value to a property through
         a setter method.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/08fig03_alt.jpg" alt="" class="calibre2" width="590" height="250" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/08fig03_alt.jpg"></p>
      
      
      <p class="noind">This syntax for defining a getter and a setter is straightforward, so it’s no wonder that we can use the exact same syntax
         to define getters and setters in other situations. The following example uses ES6 classes.
      </p>
      
      
      
      <h5 id="ch08ex03" class="notetitle">Listing 8.3. <a id="ch08ex03__title" class="calibre4"></a>Using getters and setters with ES6 classes
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/204fig01_alt.jpg" alt="" class="calibre2" width="590" height="392" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/204fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1808" class="calibre4"></a><a id="iddle1817" class="calibre4"></a>This modifies the code from <a href="#ch08ex02" class="calibre4">listing 8.2</a> to include ES6 classes. We keep all the tests to verify that the example still works as expected.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch08note01" class="notetitle">Note</h5>
      
      
      <p class="noindclose">We don’t always have to define both a getter and a setter for a given property. For example, often we’ll want to provide only
         a getter. If in that case we still attempt to write a value to that property, the exact behavior depends on whether the code
         is in strict or nonstrict mode. If the code is in nonstrict mode, assigning a value to a property with only a getter achieves
         nothing; the JavaScript engine will silently ignore our request. If, on the other hand, the code is in strict mode, the JavaScript
         engine will throw a type error, indicating that we’re trying to assign a value to a property that has a getter but no setter.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Although specifying getters and setters through ES6 classes and object literals is easy, you’ve probably noticed something
         missing. Traditionally, getters and setters are used to control access to private object properties, as in <a href="#ch08ex01" class="calibre4">listing 8.1</a>. Unfortunately, as we already know from <a href="kindle_split_016.html#ch05" class="calibre4">chapter 5</a>, JavaScript doesn’t have private object properties. Instead, we can mimic them through closures, by defining variables and
         specifying object methods that will close over those variables. Because with object literals and classes our getter and setter
         methods aren’t created within the same function scope as variables that we could use for private object properties, we can’t
         do this. Luckily, there’s an alternative way, through the <kbd class="calibre15">Object.defineProperty</kbd> method.
      </p>
      
      <p class="noind">In <a href="kindle_split_019.html#ch07" class="calibre4">chapter 7</a>, you saw that the <kbd class="calibre15">Object.defineProperty</kbd> method can be used to define new properties by passing in a property descriptor object. Among other things, the property
         descriptor can include a <kbd class="calibre15">get</kbd> and a <kbd class="calibre15">set</kbd> property that define the property’s getter and setter methods.
      </p>
      
      <p class="noind">We’ll use this feature to modify <a href="#ch08ex01" class="calibre4">listing 8.1</a> to implement built-in getters and setters that control access to a “private” object property, as shown in the following listing.
      </p>
      
      
      <p class="noind"></p>
      <h5 id="ch08ex04" class="notetitle">Listing 8.4. <a id="ch08ex04__title" class="calibre4"></a>Defining getters and setters with Object.defineProperty
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex04-0.jpg" alt="" class="calibre2" width="590" height="149" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex04-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex04-1.jpg" alt="" class="calibre2" width="590" height="253" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex04-1.jpg"></p>
      
      <p class="noind">In this example, we first define a <kbd class="calibre15">Ninja</kbd> constructor function with a <kbd class="calibre15">_skillLevel</kbd> variable that we’ll use as a private variable, just as in <a href="#ch08ex01" class="calibre4">listing 8.1</a>.
      </p>
      
      <p class="noind">Next, on the newly created object, referenced by the <kbd class="calibre15">this</kbd> keyword, we define a <kbd class="calibre15">skillLevel</kbd> property by using the built-in <kbd class="calibre15">Object.defineProperty</kbd> method:
      </p>
      
      <pre id="PLd0e20199" class="calibre5">Object.defineProperty(this, 'skillLevel', {
  get: () =&gt; {
    report("The get method is called");
    return _skillLevel;
  },
  set: value =&gt; {
    report("The set method is called");
    _skillLevel = value;
  }
});</pre>
      
      <p class="noind">Because we want the <kbd class="calibre15">skillLevel</kbd> property to control access to a private variable, we specify a <kbd class="calibre15">get</kbd> and a <kbd class="calibre15">set</kbd> method that will be called whenever the property is accessed.
      </p>
      
      <p class="noind">Notice that, unlike getters and setters specified on object literals and classes, the <kbd class="calibre15">get</kbd> and <kbd class="calibre15">set</kbd> methods defined through <kbd class="calibre15">Object.defineProperty</kbd> are created in the same scope as the “private” <kbd class="calibre15">skillLevel</kbd> variable. Both methods create a closure <a id="iddle1030" class="calibre4"></a><a id="iddle1622" class="calibre4"></a><a id="iddle1894" class="calibre4"></a>around the private variable, and we can access that private variable only through these two methods.
      </p>
      
      <p class="noind">The rest of the code works exactly as in the previous examples. We create a new <kbd class="calibre15">Ninja</kbd> instance and check that we can’t access the private variable directly. Instead, all interactions have to go through the getter
         and setter, which we now use just as if they were standard object properties:
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/207fig01_alt.jpg" alt="" class="calibre2" width="590" height="62" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/207fig01_alt.jpg"></p>
      
      <p class="noind">As you can see, the approach with <kbd class="calibre15">Object.defineProperty</kbd> is more verbose and complicated than getters and setters in object literals and classes. But in certain cases, when we need
         private object properties, it’s well worth it.
      </p>
      
      <p class="noind">Regardless of the way we define them, getters and setters allow us to define object properties that are used like standard
         object properties, but are methods that can execute additional code whenever we read or write to a particular property. This
         is an incredibly useful feature that enables us to perform logging, validate assignment values, and even notify other parts
         of the code when certain changes occur. Let’s explore some of these applications.
      </p>
      
      
      
      <h4 id="ch08lev2sec2" class="calibre26">8.1.2. <a id="ch08lev2sec2__title" class="calibre4"></a>Using getters and setters to validate property values
      </h4>
      
      <p class="noind">As we’ve established so far, a setter is a method that’s executed whenever we write a value to the matching property. We can
         take advantage of setters to perform an action whenever code attempts to update the value of a property. For example, one
         of the things we can do is validate the passed-in value. Take a look at the following code, which ensures that our <kbd class="calibre15">skillLevel</kbd> property can be assigned only integer values.
      </p>
      
      <h5 id="ch08ex05" class="notetitle">Listing 8.5. <a id="ch08ex05__title" class="calibre4"></a>Validating property value assignments with setters
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex05-0.jpg" alt="" class="calibre2" width="590" height="208" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex05-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex05-1.jpg" alt="" class="calibre2" width="590" height="171" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex05-1.jpg"></p>
      
      <p class="noind"><a id="iddle1029" class="calibre4"></a><a id="iddle1621" class="calibre4"></a><a id="iddle1893" class="calibre4"></a>This example is a straightforward extension to <a href="#ch08ex04" class="calibre4">listing 8.4</a>. The only major difference is that now, whenever a new value is assigned to the <kbd class="calibre15">skillLevel</kbd> property, we check whether the passed-in value is an integer. If it isn’t, an exception is thrown, and the private <kbd class="calibre15">_skillLevel</kbd> variable won’t be modified. If everything went okay and an integer value is received, we end up with a new value of the private
         <kbd class="calibre15">_skillLevel</kbd> variable:
      </p>
      
      <pre id="PLd0e20360" class="calibre5">set: value =&gt; {
  if(!Number.isInteger(value)){
    throw new TypeError("Skill level should be a number");
  }
  _skillLevel = value;
}</pre>
      
      <p class="noind">When testing this code, we first check that all goes okay if we assign an integer:</p>
      
      <pre id="PLd0e20369" class="calibre5">ninja.skillLevel = 10;
assert(ninja.skillLevel === 10, "The value was updated");</pre>
      
      <p class="noind">And then we test the situation in which we mistakenly assign a value of another type, such as a string. In that case, we should
         end up with an exception.
      </p>
      
      <pre id="PLd0e20378" class="calibre5">try {
  <b class="calibre21">ninja.skillLevel = "Great";</b>
  fail("Should not be here");
} catch(e){
  pass("Setting a non-integer value throws an exception");
}</pre>
      
      <p class="noind">This is how you avoid all those silly little bugs that happen when a value of the wrong type ends up in a certain property.
         Sure, it adds overhead, but that’s a price that we sometimes have to pay to safely use a highly dynamic language such as JavaScript.
      </p>
      
      <p class="noind">This is just one example of the usefulness of setter methods; there are many more that we won’t explicitly explore. For example,
         you can use the same principle to track value history, perform logging, provide change notification, and more.
      </p>
      
      
      
      <h4 id="ch08lev2sec3" class="calibre26">8.1.3. <a id="ch08lev2sec3__title" class="calibre4"></a>Using getters and setters to define computed properties
      </h4>
      
      <p class="noind">In addition to being able to control access to certain object properties, getters and setters can be used to define <i class="calibre6">computed properties</i>, properties whose value is calculated per request. Computed properties don’t store a value; they provide a <kbd class="calibre15">get</kbd> and/or a <kbd class="calibre15">set</kbd> method to retrieve and set other properties indirectly. In the following example, the object has two properties, <kbd class="calibre15">name</kbd> and <kbd class="calibre15">clan</kbd>, which we’ll use to compute the property <kbd class="calibre15">fullTitle</kbd>.
      </p>
      
      
      <p class="noind"></p>
      <h5 id="ch08ex06" class="notetitle">Listing 8.6. <a id="ch08ex06__title" class="calibre4"></a>Defining computed properties
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex06-0.jpg" alt="" class="calibre2" width="590" height="196" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex06-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex06-1.jpg" alt="" class="calibre2" width="590" height="208" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex06-1.jpg"></p>
      
      <p class="noind">Here we define a <kbd class="calibre15">shogun</kbd> object, with two standard properties, <kbd class="calibre15">name</kbd> and <kbd class="calibre15">clan</kbd>. In addition, we specify a getter and a setter method for a computed property, <kbd class="calibre15">fullTitle</kbd>:
      </p>
      
      <pre id="PLd0e20449" class="calibre5">const shogun = {
  name: "Yoshiaki",
  clan: "Ashikaga",
  <b class="calibre21">get fullTitle(){</b>
    return this.name + " " + this.clan;
  <b class="calibre21">},</b>
  <b class="calibre21">set fullTitle(value) {</b>
    const segments = value.split(" ");
    this.name = segments[0];
    this.clan = segments[1];
  <b class="calibre21">}</b>
};</pre>
      
      <p class="noind">The <kbd class="calibre15">get</kbd> method computes the value of the <kbd class="calibre15">fullTitle</kbd> property, on request, by concatenating the <kbd class="calibre15">name</kbd> and <kbd class="calibre15">clan</kbd> properties. The <kbd class="calibre15">set</kbd> method, on the other hand, uses the built-in <kbd class="calibre15">split</kbd> method, available to all strings, to split the assigned string into segments by the space character. The first segment represents
         the name and is assigned to the <kbd class="calibre15">name</kbd> property, whereas the second segment represents the clan and is assigned to the <kbd class="calibre15">clan</kbd> property.
      </p>
      
      <p class="noind"><a id="iddle1026" class="calibre4"></a><a id="iddle1033" class="calibre4"></a><a id="iddle1923" class="calibre4"></a><a id="iddle2085" class="calibre4"></a>This takes care of both routes: Reading the <kbd class="calibre15">fullTitle</kbd> property computes its value, and writing to the <kbd class="calibre15">fullTitle</kbd> property modifies the properties that constitute the property value.
      </p>
      
      <p class="noind">To be honest, we don’t have to use computed properties. A method called <kbd class="calibre15">getFullTitle</kbd> could be equally useful, but computed properties can improve the conceptual clarity of our code. If a certain value (in this
         case, the <kbd class="calibre15">fullTitle</kbd> value) depends <i class="calibre6">only</i> on the internal state of the object (in this case, on the <kbd class="calibre15">name</kbd> and <kbd class="calibre15">clan</kbd> properties), it makes perfect sense to represent it as a data field, a property, instead of a function.
      </p>
      
      <p class="noind">This concludes our exploration of getters and setters. You’ve seen that they’re a useful addition to the language that can
         help us deal with logging, data validation, and detecting changes in property values. Unfortunately, sometimes this isn’t
         enough. In certain cases, we need to control all types of interactions with our objects, and for this, we can use a completely
         new type of object: a <i class="calibre6">proxy</i>.
      </p>
      
      
      
      
      <h3 id="ch08lev1sec2" class="calibre24"><a id="ch08lev1sec2__title" class="calibre3"></a>8.2. Using proxies to control access
      </h3>
      
      <p class="noind">A <i class="calibre6">proxy</i> is a surrogate through which we control access to another object. It enables us to define custom actions that will be executed
         when an object is being interacted with—for example, when a property value is read or set, or when a method is called. You
         can think of proxies as almost a generalization of getters and setters; but with each getter and setter, you control access
         to only a single object property, whereas proxies enable you to generically handle all interactions with an object, including
         even method calls.
      </p>
      
      <p class="noind">We can use proxies when we’d traditionally use getters and setters, such as for logging, data validation, and computed properties.
         But proxies are even more powerful. They allow us to easily add profiling and performance measurements to our code, autopopulate
         object properties in order to avoid pesky null exceptions, and to wrap host objects such as the DOM in order to reduce cross-browser
         incompatibilities.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch08note02" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Proxies are introduced by ES6. For current browser support, see <a href="http://mng.bz/9uEM" class="calibre4">http://mng.bz/9uEM</a>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">In JavaScript, we can create proxies by using the built-in <kbd class="calibre15">Proxy</kbd> constructor. Let’s start simple, with a proxy that intercepts all attempts to read and write to properties of an object.
      </p>
      
      <h5 id="ch08ex07" class="notetitle">Listing 8.7. <a id="ch08ex07__title" class="calibre4"></a>Creating proxies with the Proxy constructor
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex07-0.jpg" alt="" class="calibre2" width="590" height="299" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex07-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex07-1.jpg" alt="" class="calibre2" width="590" height="145" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex07-1.jpg"></p>
      
      <p class="noind"><a id="iddle1605" class="calibre4"></a><a id="iddle1972" class="calibre4"></a><a id="iddle2013" class="calibre4"></a><a id="iddle2132" class="calibre4"></a>We first create our base <kbd class="calibre15">emperor</kbd> object that has only a <kbd class="calibre15">name</kbd> property. Next, by using the built-in <kbd class="calibre15">Proxy</kbd> constructor, we wrap our <kbd class="calibre15">emperor</kbd> object (or <i class="calibre6">target</i> object, as it’s commonly called) into a proxy object named <kbd class="calibre15">representative</kbd>. During proxy construction, as a second argument, we also send an object that specifies <i class="calibre6">traps</i>, functions that will be called when certain actions are performed on an object:
      </p>
      
      <pre id="PLd0e20648" class="calibre5">const representative = new Proxy(emperor, {
  get: (target, key) =&gt; {
    report("Reading " + key + " through a proxy");
    return key in target ? target[key]
                             : "Don't bother the emperor!"
  },
  set: (target, key, value) =&gt; {
    report("Writing " + key + " through a proxy");
    target[key] = value;
  }
});</pre>
      
      <p class="noind">In this case, we’ve specified two traps: a <kbd class="calibre15">get</kbd> trap that will be called whenever we try to read a value of a property through the proxy, and a <kbd class="calibre15">set</kbd> trap that will be called whenever we set a property value through the proxy. The <i class="calibre6">get</i> trap performs the following functionality: If the target object has a property, that property is returned; and if the object
         doesn’t have a property, we return a message warning our user not to bother the <kbd class="calibre15">emperor</kbd> with frivolous details.
      </p>
      
      <pre id="PLd0e20671" class="calibre5">get: (target, key) =&gt; {
  report("Reading " + key + " through a proxy");
  return key in target ? target[key]
                       : "Don't bother the emperor!"
}</pre>
      
      <p class="noind">Next, we test that we can access the <kbd class="calibre15">name</kbd> property both directly through the target <kbd class="calibre15">emperor</kbd> object as well as through our proxy object:
      </p>
      
      <pre id="PLd0e20686" class="calibre5">assert(emperor.name === "Komei", "The emperor's name is Komei");
assert(representative.name === "Komei",
      "We can get the name property through a proxy");</pre>
      
      <p class="noind">If we access the <kbd class="calibre15">name</kbd> property directly through the <kbd class="calibre15">emperor</kbd> object, the value <kbd class="calibre15">Komei</kbd> is returned. But if we access the <kbd class="calibre15">name</kbd> property through the <kbd class="calibre15">proxy</kbd> object, the <kbd class="calibre15">get</kbd> trap is implicitly called. Because the <kbd class="calibre15">name</kbd> property is found in the target <kbd class="calibre15">emperor</kbd> object, the value <kbd class="calibre15">Komei</kbd> is also returned. See <a href="#ch08fig04" class="calibre4">figure 8.4</a>.
      </p>
      
      
      
      <h5 id="ch08fig04" class="notetitle">Figure 8.4. <a id="ch08fig04__title" class="calibre4"></a>Accessing the <kbd class="calibre15">name</kbd> property directly (on the left) and indirectly, through a proxy (on the right)
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/08fig04_alt.jpg" alt="" class="calibre2" width="590" height="276" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/08fig04_alt.jpg"></p>
      
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch08note03" class="notetitle">Note</h5>
      
      
      <p class="noindclose">It’s important to emphasize that proxy traps are activated in the same way as getters and setters. As soon as we perform an
         action (for example, accessing a property value on a proxy), the matching trap gets implicitly called, and the JavaScript
         engine goes through a similar process as if we’ve explicitly invoked a function.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">On the other hand, if we access a nonexisting <kbd class="calibre15">nickname</kbd> property directly on the target <kbd class="calibre15">emperor</kbd> object, we’ll get, unsurprisingly, an <kbd class="calibre15">undefined</kbd> value. But if we try to access it through our <kbd class="calibre15">proxy</kbd> object, the <kbd class="calibre15">get</kbd> handler will be activated. Because the target <a id="iddle1059" class="calibre4"></a><a id="iddle1253" class="calibre4"></a><a id="iddle1388" class="calibre4"></a><a id="iddle1504" class="calibre4"></a><a id="iddle1616" class="calibre4"></a><a id="iddle1678" class="calibre4"></a><a id="iddle1924" class="calibre4"></a><a id="iddle2014" class="calibre4"></a><a id="iddle2025" class="calibre4"></a><a id="iddle2086" class="calibre4"></a><a id="iddle2145" class="calibre4"></a><kbd class="calibre15">emperor</kbd> object doesn’t have a <kbd class="calibre15">nickname</kbd> property, the proxy’s <kbd class="calibre15">get</kbd> trap will return the <kbd class="calibre15">Don't bother the emperor!</kbd> message.
      </p>
      
      <p class="noind">We’ll continue the example by assigning a new property through our proxy object: <kbd class="calibre15">representative.nickname = "Tenno"</kbd>. Because the assignment is done through a proxy, and not directly, the <kbd class="calibre15">set</kbd> trap, which logs a message and assigns a property to our target <kbd class="calibre15">emperor</kbd> object, is activated:
      </p>
      
      <pre id="PLd0e20845" class="calibre5">set: (target, key, value) =&gt; {
    report("Writing " + key + " through a proxy");
    target[key] = value;
}</pre>
      
      <p class="noind">Naturally, the newly created property can be accessed both through the proxy object and the target object:</p>
      
      <pre id="PLd0e20854" class="calibre5">assert(emperor.nickname === "Tenno",
      "The emperor now has a nickname");
assert(representative.nickname === "Tenno",
      "The nickname is also accessible through the proxy");</pre>
      
      <p class="noind">This is the gist of how to use proxies: Through the <kbd class="calibre15">Proxy</kbd> constructor, we create a proxy object that controls access to the target object by activating certain traps, whenever an
         operation is performed directly on a proxy.
      </p>
      
      <p class="noind">In this example, we’ve used the <kbd class="calibre15">get</kbd> and <kbd class="calibre15">set</kbd> traps, but many other built-in traps allow us to define handlers for various object actions (see <a href="http://mng.bz/ba55" class="calibre4">http://mng.bz/ba55</a>). For example:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The <i class="calibre6">apply</i> trap will be activated when calling a function, and the <i class="calibre6">construct</i> trap when using the new operator.
            
         </li>
         
         <li class="calibre20">The <i class="calibre6">get</i> and <i class="calibre6">set</i> traps will be activated when reading/writing to a property.
            
         </li>
         
         <li class="calibre20">The <i class="calibre6">enumerate</i> trap will be activated for <kbd class="calibre15">for-in</kbd> statements.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">getPrototypeOf</kbd> and <kbd class="calibre15">setPrototypeOf</kbd> will be activated for getting and setting the prototype value.
            
         </li>
         
      </ul>
      
      <p class="noind">We can intercept many operations, but going through all of them is outside the scope of this book. For now, we turn our attention
         to a few operations that we can’t override: equality (== or ===), <kbd class="calibre15">instanceof</kbd>, and the <kbd class="calibre15">typeof</kbd> operator.
      </p>
      
      <p class="noind">For example, the expression <kbd class="calibre15">x == y</kbd> (or a stricter <kbd class="calibre15">x === y</kbd>) is used to check whether <kbd class="calibre15">x</kbd> and <kbd class="calibre15">y</kbd> refer to identical objects (or are of the same value). This equality operator has some assumptions. For example, comparing
         two objects should always return the same value for the same two objects, which isn’t something that we can guarantee if that
         value is determined by a user-specified function. In addition, the act of comparing two objects shouldn’t give access to one
         of those objects, which would be the case if equality could be trapped. For similar reasons, the <kbd class="calibre15">instanceof</kbd> and the <kbd class="calibre15">typeof</kbd> operators can’t be trapped.
      </p>
      
      <p class="noind"><a id="iddle1031" class="calibre4"></a><a id="iddle1112" class="calibre4"></a><a id="iddle1735" class="calibre4"></a><a id="iddle1919" class="calibre4"></a>Now that we know how proxies work and how to create them, let’s explore some of their practical aspects, such as how to use
         proxies for logging, performance measurement, autopopulating properties, and implementing arrays that can be accessed with
         negative indexes. We’ll start with logging.
      </p>
      
      
      <h4 id="ch08lev2sec4" class="calibre26">8.2.1. <a id="ch08lev2sec4__title" class="calibre4"></a>Using proxies for logging
      </h4>
      
      <p class="noind">One of the most powerful tools when trying to figure out how code works or when trying to get to the root of a nasty bug is
         <i class="calibre6">logging</i>, the act of outputting information that we find useful at a particular moment. We might, for example, want to know which
         functions are called, how long they’ve been executing, what properties are read or written to, and so on.
      </p>
      
      <p class="noind">Unfortunately, when implementing logging, we usually scatter logging statements throughout the code. Take a look at the <kbd class="calibre15">Ninja</kbd> example used earlier in the chapter.
      </p>
      
      
      
      <h5 id="ch08ex08" class="notetitle">Listing 8.8. <a id="ch08ex08__title" class="calibre4"></a>Logging without proxies
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/214fig01_alt.jpg" alt="" class="calibre2" width="590" height="308" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/214fig01_alt.jpg"></p>
      
      
      <p class="noind">We define a <kbd class="calibre15">Ninja</kbd> constructor function that adds a getter and a setter to the <kbd class="calibre15">skillLevel</kbd> property, which log all attempts of reading and writing to that property.
      </p>
      
      <p class="noind">Notice that this isn’t an ideal solution. We’ve cluttered our domain code that deals with reading and writing to an object
         property with logging code. In addition, if in the future we need more properties on the <kbd class="calibre15">ninja</kbd> object, we have to be careful not to forget to add additional logging statements to each new property.
      </p>
      
      <p class="noind">Luckily, one of the straightforward uses of proxies is to enable logging whenever we read or write to a property, but in a
         much nicer and cleaner way. Consider the following example.
      </p>
      
      
      <p class="noind"></p>
      <h5 id="ch08ex09" class="notetitle">Listing 8.9. <a id="ch08ex09__title" class="calibre4"></a>Using proxies makes it easier to add logging to objects
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex09-0.jpg" alt="" class="calibre2" width="590" height="139" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex09-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex09-1.jpg" alt="" class="calibre2" width="590" height="226" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex09-1.jpg"></p>
      
      <p class="noind"><a id="iddle1032" class="calibre4"></a><a id="iddle1606" class="calibre4"></a><a id="iddle1740" class="calibre4"></a><a id="iddle1754" class="calibre4"></a><a id="iddle1861" class="calibre4"></a><a id="iddle1920" class="calibre4"></a><a id="iddle2015" class="calibre4"></a><a id="iddle2087" class="calibre4"></a>Here we define a <kbd class="calibre15">makeLoggable</kbd> function that takes a <kbd class="calibre15">target</kbd> object and returns a new <kbd class="calibre15">Proxy</kbd> that has a handler with a <kbd class="calibre15">get</kbd> and a <kbd class="calibre15">set</kbd> trap. These traps, besides reading and writing to the property, log the information about which property is read or written
         to.
      </p>
      
      <p class="noind">Next, we create a <kbd class="calibre15">ninja</kbd> object with a <kbd class="calibre15">name</kbd> property, and we pass it to the <kbd class="calibre15">make-Loggable</kbd> function, in which it will be used as a target for a newly created proxy. We then assign the proxy back to the <kbd class="calibre15">ninja</kbd> identifier, overriding it. (Don’t worry, our original <kbd class="calibre15">ninja</kbd> object is kept alive as the target object of our proxy.)
      </p>
      
      <p class="noind">Whenever we try to read a property (for example, with <kbd class="calibre15">ninja.name</kbd>), the <kbd class="calibre15">get</kbd> trap will be called, and the information about which property has been read will be logged. A similar thing will happen when
         writing to a property: <kbd class="calibre15">ninja.weapon = "sword".</kbd></p>
      
      <p class="noind">Notice how much easier and more transparent this is when compared to the standard way of using getters and setters. We don’t
         have to mix our domain code with our logging code, and there’s no need to add separate logging for each object property. Instead,
         all property reads and writes go through our proxy object trap methods. Logging has been specified in only one place and is
         reused as many times as necessary, on as many objects as necessary.
      </p>
      
      
      
      <h4 id="ch08lev2sec5" class="calibre26">8.2.2. <a id="ch08lev2sec5__title" class="calibre4"></a>Using proxies for measuring performance
      </h4>
      
      <p class="noind">Besides being used for logging property accesses, proxies can be used for measuring the performance of function invocations,
         without even modifying the source code of a <a id="iddle1060" class="calibre4"></a>function. Say we want to measure the performance of a function that calculates whether a number is a prime, as shown in the
         following listing.
      </p>
      
      
      
      <h5 id="ch08ex10" class="notetitle">Listing 8.10. <a id="ch08ex10__title" class="calibre4"></a>Measuring performance with proxies
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/216fig01_alt.jpg" alt="" class="calibre2" width="590" height="346" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/216fig01_alt.jpg"></p>
      
      
      <p class="noind">In this example, we have a simple <kbd class="calibre15">isPrime</kbd> function. (The exact function doesn’t matter; we’re using it as an example of a function whose execution can last a nontrivial
         amount of time.)
      </p>
      
      <p class="noind">Now imagine that we need to measure the performance of the <kbd class="calibre15">isPrime</kbd> function, but without modifying its code. We could wrap the function into a proxy that has a trap that will be called whenever
         the function is called:
      </p>
      
      <pre id="PLd0e21194" class="calibre5">isPrime = new Proxy(isPrime, {
  apply: (target, thisArg, args) =&gt; {
...
  }
});</pre>
      
      <p class="noind">We use the <kbd class="calibre15">isPrime</kbd> function as the target object of a newly constructed proxy. In addition, we supply a handler with an <kbd class="calibre15">apply</kbd> trap that will be executed on function invocation.
      </p>
      
      <p class="noind">Similarly, as in the previous example, we’ve assigned the newly created proxy to the <kbd class="calibre15">isPrime</kbd> identifier. In that way, we don’t have to change any of the code that calls the function whose execution time we want to
         measure; the rest of the program code is completely oblivious to our changes. (How’s that for some ninja stealth action?)
      </p>
      
      <p class="noind"><a id="iddle1035" class="calibre4"></a><a id="iddle1113" class="calibre4"></a><a id="iddle1249" class="calibre4"></a><a id="iddle1921" class="calibre4"></a>Whenever the <kbd class="calibre15">isPrime</kbd> function is called, that call is rerouted to our proxy’s <kbd class="calibre15">apply</kbd> trap, which will start a stopwatch with the built-in <kbd class="calibre15">console.time</kbd> method (remember <a href="kindle_split_011.html#ch01" class="calibre4">chapter 1</a>), call the original <kbd class="calibre15">isPrime</kbd> function, log the elapsed time, and finally return the result of the <kbd class="calibre15">isPrime</kbd> invocation.
      </p>
      
      
      
      <h4 id="ch08lev2sec6" class="calibre26">8.2.3. <a id="ch08lev2sec6__title" class="calibre4"></a>Using proxies to autopopulate properties
      </h4>
      
      <p class="noind">In addition to simplifying logging, proxies can be used for autopopulating properties. For example, imagine that you have
         to model your computer’s folder structure, in which a folder object can have properties that can also be folders. Now imagine
         that you have to model a file at the end of a long path, such as this:
      </p>
      
      <pre id="PLd0e21278" class="calibre5">rootFolder.ninjasDir.firstNinjaDir.ninjaFile = "yoshi.txt";</pre>
      
      <p class="noind">To create this, you might write something along the following lines:</p>
      
      <pre id="PLd0e21287" class="calibre5">const rootFolder = new Folder();
rootFolder.ninjasDir = new Folder();
rootFolder.ninjasDir.firstNinjaDir = new Folder();
rootFolder.ninjasDir.firstNinjaDir.ninjaFile = "yoshi.txt";</pre>
      
      <p class="noind">Seems a tad more tedious than necessary, doesn’t it? This is where autopopulating properties comes into play; just take a
         look at the following example.
      </p>
      
      
      
      <h5 id="ch08ex11" class="notetitle">Listing 8.11. <a id="ch08ex11__title" class="calibre4"></a>Autopopulating properties with proxies
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/217fig01_alt.jpg" alt="" class="calibre2" width="590" height="386" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/217fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1036" class="calibre4"></a><a id="iddle1607" class="calibre4"></a><a id="iddle1791" class="calibre4"></a><a id="iddle1922" class="calibre4"></a>Normally, if we consider only the following code, we’d expect an exception to be raised:
      </p>
      
      <pre id="PLd0e21344" class="calibre5">const rootFolder = new Folder();
rootFolder.ninjasDir.firstNinjaDir.ninjaFile = "yoshi.txt";</pre>
      
      <p class="noind">We’re accessing a property, <kbd class="calibre15">firstNinjaDir,</kbd> of an undefined property, <kbd class="calibre15">ninjasDir</kbd>, of the <kbd class="calibre15">rootFolder</kbd> object. But if we run the code, you see that all is well, as shown in <a href="#ch08fig05" class="calibre4">figure 8.5</a>.
      </p>
      
      
      
      <h5 id="ch08fig05" class="notetitle">Figure 8.5. <a id="ch08fig05__title" class="calibre4"></a>The output of running the code from <a href="#ch08ex11" class="calibre4">listing 8.11</a></h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/08fig05.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/08fig05.jpg"></p>
      
      
      
      <p class="noind">This happens because we’re using proxies. Every time we access a property, the proxy <kbd class="calibre15">get</kbd> trap is activated. If our folder object already contains the requested property, its value is returned, and if it doesn’t,
         a new folder is created and assigned to the property. This is how two of our properties, <kbd class="calibre15">ninjasDir</kbd> and <kbd class="calibre15">firstNinjaDir</kbd>, are created. Requesting a value of an uninitialized property triggers its creation.
      </p>
      
      <p class="noind">Finally, we have a tool for ridding ourselves of some cases of the pesky null exception!</p>
      
      
      
      <h4 id="ch08lev2sec7" class="calibre26">8.2.4. <a id="ch08lev2sec7__title" class="calibre4"></a>Using proxies to implement negative array indexes
      </h4>
      
      <p class="noind">In our day-to-day programming, we’ll usually work with <i class="calibre6">a lot</i> of arrays. Let’s explore how to take advantage of proxies to make our dealings with arrays a little more pleasant.
      </p>
      
      <p class="noind">If your programming background is from languages such as Python, Ruby, or Perl, you might be used to negative array indexes,
         which enable you to use negative indexes to access array items from the back, as shown in the following snippet:
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/218fig01_alt.jpg" alt="" class="calibre2" width="590" height="157" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/218fig01_alt.jpg"></p>
      
      <p class="noind">Now compare the code that we normally use to access the last item in the array, <kbd class="calibre15">ninjas [ninjas.length-1]</kbd>, with the code that we can use if our language of choice supports negative array indexes, <kbd class="calibre15">ninjas[-1]</kbd>. See how much more elegant this is?
      </p>
      
      <p class="noind">Unfortunately, JavaScript doesn’t offer built-in support for negative array indexes, but we can mimic this ability through
         proxies. To explore this concept, we’ll look at a <a id="iddle2088" class="calibre4"></a>slightly simplified version of code written by Sindre Sorhus (<a href="https://github.com/sindresorhus/negative-array" class="calibre4">https://github.com/sindresorhus/negative-array</a>), as shown in the following listing.
      </p>
      
      <h5 id="ch08ex12" class="notetitle">Listing 8.12. <a id="ch08ex12__title" class="calibre4"></a>Negative array indexes with proxies
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex12-0.jpg" alt="" class="calibre2" width="590" height="238" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex12-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex12-1.jpg" alt="" class="calibre2" width="590" height="396" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch08ex12-1.jpg"></p>
      
      <p class="noind"><a id="iddle1034" class="calibre4"></a><a id="iddle1608" class="calibre4"></a><a id="iddle1918" class="calibre4"></a><a id="iddle2016" class="calibre4"></a>In this example, we define a function that will create a proxy for a passed-in array. Because we don’t want our proxy to work
         with other types of objects, we throw an exception in case the argument isn’t an array:
      </p>
      
      <pre id="PLd0e21482" class="calibre5">if (!Array.isArray(array)) {
    throw new TypeError('Expected an array');
}</pre>
      
      <p class="noind">We continue by creating and returning a new proxy with two traps, a <kbd class="calibre15">get</kbd> trap that will activate whenever we try to read an array item, and a <kbd class="calibre15">set</kbd> trap that will activate whenever we write to an array item:
      </p>
      
      <pre id="PLd0e21497" class="calibre5">return new Proxy(array, {
  get: (target, index) =&gt; {
    index = +index;
    return target[index &lt; 0 ? target.length + index : index];
  },
  set: (target, index, val) =&gt; {
    index = +index;
    return target[index &lt; 0 ? target.length + index : index] = val;
  }
});</pre>
      
      <p class="noind">The trap bodies are similar. First, we turn the property into a number by using the unary plus operator (<kbd class="calibre15">index = +index</kbd>). Then, if the requested index is less than <kbd class="calibre15">0</kbd>, we access array items from the back by anchoring to the length of the array, and if it’s greater than or equal to <kbd class="calibre15">0</kbd>, we access the array item in a standard fashion.
      </p>
      
      <p class="noind">Finally, we perform various tests to check that on normal arrays we can only access array items through positive array indexes,
         and that, if we use a proxy, we can both access and modify array items through negative indexes.
      </p>
      
      <p class="noind">Now that you’ve seen how to use proxies to achieve some interesting features such as autopopulating object properties and
         accessing negative array indexes, which are outright impossible without proxies, let’s explore the most significant downside
         to proxies: performance issues.
      </p>
      
      
      
      <h4 id="ch08lev2sec8" class="calibre26">8.2.5. <a id="ch08lev2sec8__title" class="calibre4"></a>Performance costs of proxies
      </h4>
      
      <p class="noind">As we already know, a proxy is a surrogate object through which we control access to another object. A proxy can define traps,
         functions that will be executed whenever a certain operation is performed on a proxy. And, as you’ve also seen, we can use
         these traps to implement useful functionalities such as logging, performance measurements, autopopulating properties, negative
         array indexes, and so on. Unfortunately, there’s also a downside. The fact that all our operations have to pass in through
         the proxy adds a layer of indirection that enables us to implement all these cool features, but at the same time it introduces
         a significant amount of additional processing that impacts performance.
      </p>
      
      <p class="noind">To test these performance issues, we can build on the negative array indexes example from <a href="#ch08ex12" class="calibre4">listing 8.12</a> and compare the execution time when accessing items in a normal array versus accessing items through a proxy, as shown in
         the following listing.
      </p>
      
      
      
      <h5 id="ch08ex13" class="notetitle">Listing 8.13. <a id="ch08ex13__title" class="calibre4"></a>Checking the performance limitations of proxies
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/221fig01_alt.jpg" alt="" class="calibre2" width="590" height="279" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/221fig01_alt.jpg"></p>
      
      
      <p class="noind">Because a single operation of the code happens much too quickly to measure reliably, the code has to be executed many times
         to get a measurable value. Frequently, this count can be in the tens of thousands, or even millions, depending on the nature
         of the code being measured. A little trial and error lets us choose a reasonable value: in this case 500,000.
      </p>
      
      <p class="noind">We also need to bracket the execution of the code with two <kbd class="calibre15">new Date().getTime()</kbd> timestamps: one before we start executing the target code, and one after. Their difference tells us how long the code took
         to perform. Finally, we can compare the results by calling the <kbd class="calibre15">measure</kbd> function on both the proxied array and the standard array.
      </p>
      
      <p class="noind">On our machine, the results don’t fare well for proxies. It turns out that in Chrome, proxies are around 50 times slower;
         in Firefox, they’re about 20 times slower.
      </p>
      
      <p class="noind">For now, we recommend that you be careful when using proxies. Although they allow you to be creative with controlling access
         to objects, that amount of control comes with performance issues. You can use proxies with code that’s not performance sensitive,
         but be careful when using them in code that’s executed a lot. As always, we recommend that you thoroughly test the performance
         of your code.
      </p>
      
      
      
      
      <h3 id="ch08lev1sec3" class="calibre24"><a id="ch08lev1sec3__title" class="calibre3"></a>8.3. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">We can monitor our objects with getters, setters, and proxies.
            
         </li>
         
         <li class="calibre20">By using accessor methods (getters and setters), we can control access to object properties.
            
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">Accessor properties can be defined by using the built-in <kbd class="calibre15">Object.define-Property</kbd> method or with a special <kbd class="calibre15">get</kbd> and <kbd class="calibre15">set</kbd> syntax as parts of object literals or ES6 classes.
                  
               </li>
               
               <li class="calibre20">A <kbd class="calibre15">get</kbd> method is implicitly called whenever we try to read, whereas a <kbd class="calibre15">set</kbd> method is called whenever we assign a value to the matching object’s property.
                  
               </li>
               
               <li class="calibre20">Getter methods can be used to define computed properties, properties whose value is calculated on a per request basis, whereas
                  setter methods can be used to achieve data validation and logging.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">Proxies are an ES6 addition to JavaScript and are used to control other objects.
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">Proxies enable us to define custom actions that will be executed when an object is interacted with (for example, when a property
                  is read or a function is called).
                  
               </li>
               
               <li class="calibre20">All interactions have to go through the proxy, which has traps that are triggered when a specific action occurs.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">Use proxies to achieve elegant
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">Logging
                  
               </li>
               
               <li class="calibre20">Performance measurements
                  
               </li>
               
               <li class="calibre20">Data validation
                  
               </li>
               
               <li class="calibre20">Autopopulating object properties (thereby avoiding pesky null exceptions)
                  
               </li>
               
               <li class="calibre20">Negative array indexes
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">Proxies aren’t fast, so be careful when using them in code that’s executed a lot. We recommend that you do performance testing.
            
         </li>
         
      </ul>
      
      
      
      <h3 id="ch08lev1sec4" class="calibre24"><a id="ch08lev1sec4__title" class="calibre3"></a>8.4. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch08qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch08qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch08qa2q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">After running the following code, which of the following expressions will throw an exception and why?</p>
            
            <pre id="PLd0e21694" class="calibre5">const ninja = {
   get name() {
     return "Akiyama";
   }
}</pre>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">ninja.name();</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">const name = ninja.name;</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch08qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch08qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind">In the following code, which mechanism allows getters to access a private object variable?</p>
            
            <pre id="PLd0e21722" class="calibre5">function Samurai() {
  const _weapon = "katana";
  Object.defineProperty(this, "weapon", {
    get: () =&gt; _weapon
  });
}
const samurai = new Samurai();
assert(samurai.weapon === "katana", "A katana wielding samurai");</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch08qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch08qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">Which of the following assertions will pass?</p>
            
            <pre id="PLd0e21736" class="calibre5">const daimyo = { name: "Matsu", clan: "Takasu"};
const proxy = new Proxy(daimyo, {
  get: (target, key) =&gt; {
    if(key === "clan"){
      return "Tokugawa";
    }
  }
});

assert(daimyo.clan === "Takasu", "Matsu of clan Takasu");
assert(proxy.clan === "Tokugawa", "Matsu of clan Tokugawa?");

proxy.clan = "Tokugawa";

assert(daimyo.clan === "Takasu", "Matsu of clan Takasu");
assert(proxy.clan === "Tokugawa", "Matsu of clan Tokugawa?");</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch08qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch08qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">Which of the following assertions will pass?</p>
            
            <pre id="PLd0e21749" class="calibre5">const daimyo = { name: "Matsu", clan: "Takasu", armySize: 10000};
const proxy = new Proxy(daimyo, {
  set: (target, key, value) =&gt; {
    if(key === "armySize") {
      const number = Number.parseInt(value);
      if(!Number.isNaN(number)){
        target[key] = number;
      }
    } else {
       target[key] = value;
    }
  },
});

assert(daimyo.armySize === 10000, "Matsu has 10 000 men at arms");
assert(proxy.armySize === 10000, "Matsu has 10 000 men at arms");

proxy.armySize = "large";
assert(daimyo.armySize === "large", "Matsu has a large army");

daimyo.armySize = "large";
assert(daimyo.armySize === "large", "Matsu has a large army");</pre>
            <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_33"></div>
<h2 id="ch09" class="part">Chapter 9. <a id="ch09__title" class="calibre3"></a>Dealing with collections
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Creating and modifying arrays
            
         </li>
         
         <li class="calibre20">Using and reusing array functions
            
         </li>
         
         <li class="calibre20">Creating dictionaries with maps
            
         </li>
         
         <li class="calibre20">Creating collections of unique objects with sets
            
         </li>
         
      </ul>
      
      <p class="noind">Now that we’ve spent some time wrangling the particularities of object-orientation in JavaScript, we’ll move on to a closely
         related topic: collections of items. We’ll start with arrays, the most basic type of collection in JavaScript, and look at
         some array peculiarities you may not expect if your programming background is in another programming language. We’ll continue
         by exploring some of the built-in array methods that will help you write more elegant array-handling code.
      </p>
      
      <p class="noind">Next, we’ll discuss two new ES6 collections: maps and sets. Using maps, you can create dictionaries of a sort that carry mappings
         between keys and values—a collection that’s extremely useful in certain programming tasks. Sets, on the other hand, are collections
         of unique items in which each item can’t occur more than once. Let’s begin our exploration with the simplest and most common
         of all collections: arrays.
      </p>
      
      
      <h3 class="calibre24"><a id="ch09qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch09qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch09qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind"><a id="iddle1073" class="calibre4"></a><a id="iddle1074" class="calibre4"></a><a id="iddle1078" class="calibre4"></a><a id="iddle1082" class="calibre4"></a><a id="iddle1209" class="calibre4"></a><a id="iddle1213" class="calibre4"></a><a id="iddle1718" class="calibre4"></a>What are some of the common pitfalls of using objects as dictionaries or maps?
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch09qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch09qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">What value types can a key/value pair have in a <kbd class="calibre15">Map</kbd>?
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch09qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch09qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">Must the items in a <kbd class="calibre15">Set</kbd> be of the same type?
            </p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch09lev1sec1" class="calibre24"><a id="ch09lev1sec1__title" class="calibre3"></a>9.1. Arrays
      </h3>
      
      <p class="noind">Arrays are one of the most common data types. Using them, you can handle collections of items. If your programming background
         is in a strongly typed language such as C, you probably think of arrays as sequential chunks of memory that house items of
         the same type, where each chunk of memory is of fixed size and has an associated index through which you can easily access
         it.
      </p>
      
      <p class="noind">But as with many things in JavaScript, arrays come with a twist: They’re just objects. Although this leads to some unfortunate
         side effects, primarily in terms of performance, it also has some benefits. For example, arrays can access methods, like other
         objects—methods that will make our lives a lot easier.
      </p>
      
      <p class="noind">In this section, we’ll first look at ways to create arrays. Then we’ll explore how to add items to and remove items from different
         positions in an array. Finally, we’ll examine the built-in array methods that will make our array-handling code much more
         elegant.
      </p>
      
      
      <h4 id="ch09lev2sec1" class="calibre26">9.1.1. <a id="ch09lev2sec1__title" class="calibre4"></a>Creating arrays
      </h4>
      
      <p class="noind">There are two fundamental ways to create new arrays:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Using the built-in <kbd class="calibre15">Array</kbd> constructor
            
         </li>
         
         <li class="calibre20">Using array literals <kbd class="calibre15">[]</kbd>
            
         </li>
         
      </ul>
      
      <p class="noind">Let’s start with a simple example in which <kbd class="calibre15">we</kbd> create an array of ninjas and an array of samurai.
      </p>
      
      <h5 id="ch09ex01" class="notetitle">Listing 9.1. <a id="ch09ex01__title" class="calibre4"></a>Creating arrays
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex01-0.jpg" alt="" class="calibre2" width="590" height="212" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex01-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex01-1.jpg" alt="" class="calibre2" width="590" height="160" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex01-1.jpg"></p>
      
      <p class="noind">In <a href="#ch09ex01" class="calibre4">listing 9.1</a>, we start by creating two arrays. The <kbd class="calibre15">ninjas</kbd> array is created with a simple array literal:
      </p>
      
      <pre id="PLd0e21950" class="calibre5">const ninjas = ["Kuma", "Hattori", "Yagyu"];</pre>
      
      <p class="noind">It’s immediately prefilled with three ninjas: Kuma, Hattori, and Yagyu. The <kbd class="calibre15">samurai</kbd> array is created using the built-in <kbd class="calibre15">Array</kbd> constructor:
      </p>
      
      <pre id="PLd0e21965" class="calibre5">const samurai = new Array("Oda", "Tomoe");</pre>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <b id="ch09sb01" class="calibre21">Array literals versus the Array constructor</b>
         
         <p class="noind">Using array literals to create arrays is preferred over creating arrays with the <kbd class="calibre15">Array</kbd> constructor. The primary reason is simplicity: <kbd class="calibre15">[]</kbd> versus <kbd class="calibre15">new Array()</kbd> (2 characters versus 11 characters—hardly a fair contest). In addition, because JavaScript is highly dynamic, nothing stops
            someone from overriding the built-in <kbd class="calibre15">Array</kbd> constructor, which means calling <kbd class="calibre15">new Array()</kbd> doesn’t necessarily have to create an array. Thus we recommend that you generally stick to array literals.
         </p>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Regardless of how we create it, each array has a <kbd class="calibre15">length</kbd> property that specifies the size of the array. For example, the <kbd class="calibre15">length</kbd> of the <kbd class="calibre15">ninjas</kbd> array is <kbd class="calibre15">3</kbd>, and it contains 3 ninjas. We can test this with the following assertions:
      </p>
      
      <pre id="PLd0e22010" class="calibre5">assert(ninjas.length === 3, "There are three ninjas");
assert(samurai.length === 2, "And only two samurai");</pre>
      
      <p class="noind">As you probably know, you access array items by using index notation, where the first item is positioned at index <kbd class="calibre15">0</kbd> and the last item at index <kbd class="calibre15">array.length</kbd> – 1. But if we try to access an index outside those bounds—for example, with <kbd class="calibre15">ninjas[4]</kbd> (remember, we have only three ninjas!), we won’t get the scary “Array index out of bounds” exception that we receive in most
         other programming languages. Instead, <kbd class="calibre15">undefined</kbd> is returned, signaling that there’s nothing there:
      </p>
      
      <pre id="PLd0e22031" class="calibre5">assert(ninjas[4] === undefined,
      "We get undefined if we try to access an out of bounds index");</pre>
      
      <p class="noind"><a id="iddle1080" class="calibre4"></a><a id="iddle1211" class="calibre4"></a><a id="iddle1869" class="calibre4"></a><a id="iddle1925" class="calibre4"></a><a id="iddle2038" class="calibre4"></a><a id="iddle2153" class="calibre4"></a>This behavior is a consequence of the fact that JavaScript arrays are objects. Just as we’d get <kbd class="calibre15">undefined</kbd> if we tried to access a nonexistent object property, we get <kbd class="calibre15">undefined</kbd> when accessing a nonexistent array index.
      </p>
      
      <p class="noind">On the other hand, if we try to write to a position outside of array bounds, as in</p>
      
      <pre id="PLd0e22089" class="calibre5">ninjas[4] = "Ishi";</pre>
      
      <p class="noind">the array will expand to accommodate the new situation. For example, see <a href="#ch09fig01" class="calibre4">figure 9.1</a>: We’ve essentially created a hole in the array, and the item at index <kbd class="calibre15">3</kbd> is <kbd class="calibre15">undefined</kbd>. This also changes the value of the <kbd class="calibre15">length</kbd> property, which now reports a value of <kbd class="calibre15">5</kbd>, even though one array item is <kbd class="calibre15">undefined</kbd>.
      </p>
      
      
      
      <h5 id="ch09fig01" class="notetitle">Figure 9.1. <a id="ch09fig01__title" class="calibre4"></a>Writing to an array index outside of array bounds expands the array.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig01_alt.jpg" alt="" class="calibre2" width="590" height="205" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig01_alt.jpg"></p>
      
      
      <p class="noind">Unlike in most other languages, in JavaScript, arrays also exhibit a peculiar feature related to the <kbd class="calibre15">length</kbd> property: Nothing stops us from manually changing its value. Setting a value higher than the current length will expand the
         array with <kbd class="calibre15">undefined</kbd> items, whereas setting the value to a lower value will trim the array, as in <kbd class="calibre15">ninjas.length = 2;</kbd>.
      </p>
      
      <p class="noind">Now that we’ve gone through the basics of array creation, let’s go through some of the most common array methods.</p>
      
      
      
      <h4 id="ch09lev2sec2" class="calibre26">9.1.2. <a id="ch09lev2sec2__title" class="calibre4"></a>Adding and removing items at either end of an array
      </h4>
      
      <p class="noind">Let’s start with the following simple methods we can use to add items to and remove items from an array:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><kbd class="calibre15">push</kbd> adds an item to the end of the array.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">unshift</kbd> adds an item to the beginning of the array.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">pop</kbd> removes an item from the end of the array.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">shift</kbd> removes an item from the beginning of the array.
            
         </li>
         
      </ul>
      
      <p class="noind">You’ve probably already used these methods, but just in case, let’s make sure we’re on the same page by exploring the following
         listing.
      </p>
      
      
      <p class="noind"></p>
      <h5 id="ch09ex02" class="notetitle">Listing 9.2. <a id="ch09ex02__title" class="calibre4"></a>Adding and removing array items
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex02-0.jpg" alt="" class="calibre2" width="590" height="232" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex02-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex02-1.jpg" alt="" class="calibre2" width="590" height="414" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex02-1.jpg"></p>
      
      <p class="noind">In this example, we first create a new, empty <kbd class="calibre15">ninjas</kbd> array:
      </p>
      
      <pre id="PLd0e22205" class="calibre5">ninjas = [] // ninjas: []</pre>
      
      <p class="noind">In each array, we can use the built-in <kbd class="calibre15">push</kbd> method to append an item to the end of the array, changing its length in the process:
      </p>
      
      <pre id="PLd0e22217" class="calibre5">ninjas.push("Kuma"); // ninjas: ["Kuma"];
ninjas.push("Hattori"); // ninjas: ["Kuma", "Hattori"];</pre>
      
      <p class="noind"><a id="iddle1870" class="calibre4"></a>We can also add new items to the beginning of the array by using the built in <kbd class="calibre15">unshift</kbd> method:
      </p>
      
      <pre id="PLd0e22235" class="calibre5">ninjas.unshift("Yagyu");// ninjas: ["Yagyu", "Kuma", "Hattori"];</pre>
      
      <p class="noind">Notice how existing array items are adjusted. For example, before calling the <kbd class="calibre15">unshift</kbd> method, <kbd class="calibre15">"Kuma"</kbd> was at index <kbd class="calibre15">0</kbd>, and afterward it’s at index <kbd class="calibre15">1</kbd>.
      </p>
      
      <p class="noind">We can also remove elements from either the end or the beginning of the array. Calling the built-in <kbd class="calibre15">pop</kbd> method removes an element from the end of the array, reducing the array’s length in the process:
      </p>
      
      <pre id="PLd0e22262" class="calibre5">var lastNinja = ninjas.pop(); // ninjas:["Yagyu", "Kuma"]
                              // lastNinja: "Hattori"</pre>
      
      <p class="noind">We can also remove an item from the beginning of the array by using the built-in <kbd class="calibre15">shift</kbd> method:
      </p>
      
      <pre id="PLd0e22274" class="calibre5">var firstNinja = ninjas.shift(); //ninjas: ["Kuma"]
                                 //firstNinja: "Yagyu"</pre>
      
      <p class="noind"><a href="#ch09fig02" class="calibre4">Figure 9.2</a> shows how <kbd class="calibre15">push</kbd>, <kbd class="calibre15">pop</kbd>, <kbd class="calibre15">shift</kbd>, and <kbd class="calibre15">unshift</kbd> modify arrays.
      </p>
      
      
      
      <h5 id="ch09fig02" class="notetitle">Figure 9.2. <a id="ch09fig02__title" class="calibre4"></a>The <kbd class="calibre15">push</kbd> and <kbd class="calibre15">pop</kbd> methods modify the end of an array, whereas <kbd class="calibre15">shift</kbd> and <kbd class="calibre15">unshift</kbd> modify the array’s beginning.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig02_alt.jpg" alt="" class="calibre2" width="590" height="341" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig02_alt.jpg"></p>
      
      
      
      <p class="noind"></p>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <b id="ch09sb02" class="calibre21">Performance considerations: pop and push versus shift and unshift</b>
         
         <p class="noind"><a id="iddle1079" class="calibre4"></a><a id="iddle1210" class="calibre4"></a><a id="iddle2039" class="calibre4"></a>The <kbd class="calibre15">pop</kbd> and <kbd class="calibre15">push</kbd> methods only affect the last item in an array: <kbd class="calibre15">pop</kbd> by removing the last item, and <kbd class="calibre15">push</kbd> by inserting an item at the end of the array. On the other hand, the <kbd class="calibre15">shift</kbd> and <kbd class="calibre15">unshift</kbd> methods change the first item in the array. This means the indexes of any subsequent array items have to be adjusted. For
            this reason, <kbd class="calibre15">push</kbd> and <kbd class="calibre15">pop</kbd> are significantly faster operations than <kbd class="calibre15">shift</kbd> and <kbd class="calibre15">unshift</kbd>, and we recommend using them unless you have a good reason to do otherwise.
         </p>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      
      <h4 id="ch09lev2sec3" class="calibre26">9.1.3. <a id="ch09lev2sec3__title" class="calibre4"></a>Adding and removing items at any array location
      </h4>
      
      <p class="noind">The previous example removed items from the beginning and end of the array. But this is too constraining—in general, we should
         be able to remove items from any array location. One straightforward approach for doing this is shown in the following listing.
      </p>
      
      
      
      <h5 id="ch09ex03" class="notetitle">Listing 9.3. <a id="ch09ex03__title" class="calibre4"></a>Naïve way to remove an array item
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/230fig01_alt.jpg" alt="" class="calibre2" width="590" height="220" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/230fig01_alt.jpg"></p>
      
      
      <p class="noind">This approach to deleting an item from an array doesn’t work. We effectively only create a hole in the array. The array still
         reports that it has four items, but one of them—the one we wanted to delete—is <kbd class="calibre15">undefined</kbd> (see <a href="#ch09fig03" class="calibre4">figure 9.3</a>).
      </p>
      
      
      
      <h5 id="ch09fig03" class="notetitle">Figure 9.3. <a id="ch09fig03__title" class="calibre4"></a>Deleting an item from an array creates a hole in the array.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig03.jpg" alt="" class="calibre2" width="485" height="187" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig03.jpg"></p>
      
      
      
      <p class="noind"><a id="iddle2053" class="calibre4"></a>Similarly, if we wanted to insert an item at an arbitrary position, where would we even start? As an answer to these problems,
         all JavaScript arrays have access to the <kbd class="calibre15">splice</kbd> method: Starting from a given index, this method removes and inserts items. Check out the following example.
      </p>
      
      <h5 id="ch09ex04" class="notetitle">Listing 9.4. <a id="ch09ex04__title" class="calibre4"></a>Removing and adding items at arbitrary positions
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex04-0.jpg" alt="" class="calibre2" width="590" height="190" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex04-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex04-1.jpg" alt="" class="calibre2" width="590" height="271" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex04-1.jpg"></p>
      
      <p class="noind">We begin by creating a new array with four items:</p>
      
      <pre id="PLd0e22454" class="calibre5">var ninjas = ["Yagyu", "Kuma", "Hattori", "Fuma"];</pre>
      
      <p class="noind">Then we call the built-in <kbd class="calibre15">splice</kbd> method:
      </p>
      
      <pre id="PLd0e22466" class="calibre5">var removedItems = ninjas.splice(1,1);//ninjas:["Yagyu","Hattori", "Fuma"];
                                    //removedItems: ["Kuma"]</pre>
      
      <p class="noind">In this case, <kbd class="calibre15">splice</kbd> takes two arguments: the index from which the splicing starts, and the number of elements to be removed (if we leave out
         this argument, all elements to the end of the array are removed). In this case, the element with index <kbd class="calibre15">1</kbd> is removed from the array, and all subsequent elements are shifted accordingly.
      </p>
      
      <p class="noind"><a id="iddle1083" class="calibre4"></a><a id="iddle1214" class="calibre4"></a><a id="iddle1501" class="calibre4"></a>In addition, the <kbd class="calibre15">splice</kbd> method returns an array of items that have been removed. In this case, the result is an array with a single item: <kbd class="calibre15">"Kuma"</kbd>.
      </p>
      
      <p class="noind">Using the <kbd class="calibre15">splice</kbd> method, we can also insert items into arbitrary positions in an array. For example, consider the following code:
      </p>
      
      <pre id="PLd0e22521" class="calibre5">removedItems = ninjas.splice(1, 2, "Mochizuki", "Yoshi", "Momochi");
//ninjas: ["Yagyu", "Mochizuki", "Yoshi", "Momochi"]
//removedItems: ["Hattori", "Fuma"]</pre>
      
      <p class="noind">Starting from index <kbd class="calibre15">1</kbd>, it first removes two items and then adds three items: <kbd class="calibre15">"Mochizuki"</kbd>, <kbd class="calibre15">"Yoshi"</kbd>, and <kbd class="calibre15">"Momochi"</kbd>.
      </p>
      
      <p class="noind">Now that we’ve given you a refresher on how arrays work, let’s continue by studying some common operations that are often
         performed on arrays. These will help you write more elegant array-handling code.
      </p>
      
      
      
      <h4 id="ch09lev2sec4" class="calibre26">9.1.4. <a id="ch09lev2sec4__title" class="calibre4"></a>Common operations on arrays
      </h4>
      
      <p class="noind">In this section, we’ll explore some of the most common operations on arrays:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><i class="calibre6">Iterating</i> (or <i class="calibre6">traversing</i>) through arrays
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Mapping</i> existing array items to create a new array based on them
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Testing</i> array items to check whether they satisfy certain conditions
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Finding</i> specific array items
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Aggregating</i> arrays and computing a single value based on array items (for example, calculating the sum of an array)
            
         </li>
         
      </ul>
      
      <p class="noind">We’ll start with the basics: array iterations.</p>
      
      
      <h5 id="ch09lev3sec1" class="notetitle"><a id="ch09lev3sec1__title" class="calibre4"></a>Iterating over arrays
      </h5>
      
      <p class="noind">One of the most common operations is iterating over an array. Going back to Computer Science 101, an iteration is most often
         performed in the following way:
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/232fig01_alt.jpg" alt="" class="calibre2" width="590" height="79" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/232fig01_alt.jpg"></p>
      
      <p class="noind">This example is as simple as it looks. It uses a <kbd class="calibre15">for</kbd> loop to check every item in the array; the results are shown in <a href="#ch09fig04" class="calibre4">figure 9.4</a>.
      </p>
      
      
      
      <h5 id="ch09fig04" class="notetitle">Figure 9.4. <a id="ch09fig04__title" class="calibre4"></a>The output of checking the ninjas with a <kbd class="calibre15">for</kbd> loop
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig04.jpg" alt="" class="calibre2" width="350" height="209" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig04.jpg"></p>
      
      
      
      <p class="noind">You’ve probably written something like this so many times that you don’t even have to think about it anymore. But just in
         case, let’s take a closer look at the <kbd class="calibre15">for</kbd> loop.
      </p>
      
      <p class="noind">To go through an array, we have to set up a counter variable, <kbd class="calibre15">i</kbd>, specify the number up to which we want to count (<kbd class="calibre15">ninjas.length)</kbd>, and <a id="iddle1084" class="calibre4"></a><a id="iddle1215" class="calibre4"></a><a id="iddle1511" class="calibre4"></a><a id="iddle1743" class="calibre4"></a>define how the counter will be modified (<kbd class="calibre15">i++</kbd>). That’s an awful lot of bookkeeping to perform such a common action, and it can be a source of annoying little bugs. In
         addition, it makes our code more difficult to read. Readers have to look closely at every part of the <kbd class="calibre15">for</kbd> loop, just to be sure it goes through all the items and doesn’t skip any.
      </p>
      
      <p class="noind">To make life easier, all JavaScript arrays have a built-in <kbd class="calibre15">forEach</kbd> method we can use in such situations. Look at the following example.
      </p>
      
      
      
      <h5 id="ch09ex05" class="notetitle">Listing 9.5. <a id="ch09ex05__title" class="calibre4"></a>Using the forEach method
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/233fig01_alt.jpg" alt="" class="calibre2" width="590" height="94" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/233fig01_alt.jpg"></p>
      
      
      <p class="noind">We provide a callback (in this case, an arrow function) that’s called <i class="calibre6">immediately</i>, for each item in the array. That’s it—no more fussing about the start index, the end condition, or the exact nature of the
         increment. The JavaScript engine takes care of all that for us, behind the scenes. Notice how much easier to understand this
         code is, and how it has fewer bug-spawning points.
      </p>
      
      <p class="noind">We’ll continue by taking things up a notch and seeing how we can map arrays to other arrays.</p>
      
      
      
      <h5 id="ch09lev3sec2" class="notetitle"><a id="ch09lev3sec2__title" class="calibre4"></a>Mapping arrays
      </h5>
      
      <p class="noind">Imagine that you have an array of <kbd class="calibre15">ninja</kbd> objects. Each ninja has a name and a favorite weapon, and you want to extract an array of weapons from the <kbd class="calibre15">ninjas</kbd> array. Armed with the knowledge of the <kbd class="calibre15">forEach</kbd> method, you might write something like the following listing.
      </p>
      
      
      
      <h5 id="ch09ex06" class="notetitle">Listing 9.6. <a id="ch09ex06__title" class="calibre4"></a>Naïve extraction of a weapons array
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/233fig02_alt.jpg" alt="" class="calibre2" width="590" height="284" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/233fig02_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1742" class="calibre4"></a>This isn’t all that bad: We create a new, empty array, and use the <kbd class="calibre15">forEach</kbd> method to iterate over the <kbd class="calibre15">ninjas</kbd> array. Then, for each <kbd class="calibre15">ninja</kbd> object, we add the current weapon to the <kbd class="calibre15">weapons</kbd> array.
      </p>
      
      <p class="noind">As you might imagine, creating new arrays based on the items in an existing array is surprisingly common—so common that it
         has a special name: <i class="calibre6">mapping</i> an array. The idea is that we map each item from one array to a new item of a new array. Conveniently, JavaScript has a <kbd class="calibre15">map</kbd> function that does exactly that, as shown in the following listing.
      </p>
      
      
      
      <h5 id="ch09ex07" class="notetitle">Listing 9.7. <a id="ch09ex07__title" class="calibre4"></a>Mapping an array
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/234fig01_alt.jpg" alt="" class="calibre2" width="590" height="177" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/234fig01_alt.jpg"></p>
      
      
      <p class="noind">The built-in <kbd class="calibre15">map</kbd> method constructs a completely new array and then iterates over the input array. For each item in the input array, <kbd class="calibre15">map</kbd> places exactly one item in the newly constructed array, based on the result of the callback provided to <kbd class="calibre15">map</kbd>. The inner workings of the <kbd class="calibre15">map</kbd> function are shown in <a href="#ch09fig05" class="calibre4">figure 9.5</a>.
      </p>
      
      
      
      <h5 id="ch09fig05" class="notetitle">Figure 9.5. <a id="ch09fig05__title" class="calibre4"></a>The <kbd class="calibre15">map</kbd> function calls the provided callback function (fc) on each array item, and creates a new array with callback return values.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig05_alt.jpg" alt="" class="calibre2" width="590" height="296" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig05_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1089" class="calibre4"></a><a id="iddle1219" class="calibre4"></a><a id="iddle1433" class="calibre4"></a><a id="iddle2102" class="calibre4"></a>Now that we know how to map arrays, let’s see how to test array items for certain conditions.
      </p>
      
      
      
      <h5 id="ch09lev3sec3" class="notetitle"><a id="ch09lev3sec3__title" class="calibre4"></a>Testing array items
      </h5>
      
      <p class="noind">When working with collections of items, we’ll often run into situations where we need to know whether <i class="calibre6">all</i> or at least <i class="calibre6">some</i> of the array items satisfy certain conditions. To write this code as efficiently as possible, all JavaScript arrays have
         access to the built-in <kbd class="calibre15">every</kbd> and <kbd class="calibre15">some</kbd> methods, shown next.
      </p>
      
      
      
      <h5 id="ch09ex08" class="notetitle">Listing 9.8. <a id="ch09ex08__title" class="calibre4"></a>Testing arrays with the every and some methods
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/235fig01_alt.jpg" alt="" class="calibre2" width="590" height="278" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/235fig01_alt.jpg"></p>
      
      
      <p class="noind"><a href="#ch09ex08" class="calibre4">Listing 9.8</a> shows an example where we have a collection of <kbd class="calibre15">ninja</kbd> objects but are unsure of their names and whether all of them are armed. To get to the root of this problem, we first take
         advantage of <kbd class="calibre15">every</kbd>:
      </p>
      
      <pre id="PLd0e22900" class="calibre5">var allNinjasAreNamed = ninjas.<b class="calibre21">every</b>(ninja =&gt; "name" in ninja);</pre>
      
      <p class="noind">The <kbd class="calibre15">every</kbd> method takes a callback that, for each ninja in the collection, checks whether we know the ninja’s name. <kbd class="calibre15">every</kbd> returns <kbd class="calibre15">true</kbd> only if the passed-in callback returns <kbd class="calibre15">true</kbd> for <i class="calibre6">every</i> item in the array. <a href="#ch09fig06" class="calibre4">Figure 9.6</a> shows how <kbd class="calibre15">every</kbd> works.
      </p>
      
      
      
      <h5 id="ch09fig06" class="notetitle">Figure 9.6. <a id="ch09fig06__title" class="calibre4"></a>The <kbd class="calibre15">every</kbd> method tests whether all items in an array satisfy a certain condition represented by a callback.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig06_alt.jpg" alt="" class="calibre2" width="590" height="624" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig06_alt.jpg"></p>
      
      
      <p class="noind">In other cases, we only care whether <i class="calibre6">some</i> array items satisfy a certain condition. For these situations, we can use the built-in method <kbd class="calibre15">some</kbd>:
      </p>
      
      <pre id="PLd0e22958" class="calibre5">const someNinjasAreArmed = ninjas.some(ninja =&gt; "weapon" in ninja);</pre>
      
      <p class="noind">Starting from the first array item, <kbd class="calibre15">some</kbd> calls the callback on each array item until an item is found for which the callback returns a <kbd class="calibre15">true</kbd> value. If such an item is found, the return value is <kbd class="calibre15">true</kbd>; if not, the return value is <kbd class="calibre15">false</kbd>.
      </p>
      
      <p class="noind"><a href="#ch09fig07" class="calibre4">Figure 9.7</a> shows how <kbd class="calibre15">some</kbd> works under the hood: We search an array in order to find out whether some or all of its items satisfy a certain condition.
         Next we’ll explore how to search an array to find a particular item.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch09fig07" class="notetitle">Figure 9.7. <a id="ch09fig07__title" class="calibre4"></a>The <kbd class="calibre15">some</kbd> method checks whether at least one array item satisfies a condition represented by the passed-in callback.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig07_alt.jpg" alt="" class="calibre2" width="590" height="294" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig07_alt.jpg"></p>
      
      
      
      
      <h5 id="ch09lev3sec4" class="notetitle"><a id="ch09lev3sec4__title" class="calibre4"></a>Searching arrays
      </h5>
      
      <p class="noind"><a id="iddle1086" class="calibre4"></a><a id="iddle1217" class="calibre4"></a><a id="iddle1481" class="calibre4"></a><a id="iddle2007" class="calibre4"></a>Another common operation that you’re bound to use, sooner rather than later, is finding items in an array. Again, this task
         is greatly simplified with another built-in array method: <kbd class="calibre15">find</kbd>. Let’s study the following listing.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch09note01" class="notetitle">Note</h5>
      
      
      <p class="noindclose">The built-in <kbd class="calibre15">find</kbd> method is part of the ES6 standard. For current browser compatibility, see <a href="http://mng.bz/U532" class="calibre4">http://mng.bz/U532</a>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <h5 id="ch09ex09" class="notetitle">Listing 9.9. <a id="ch09ex09__title" class="calibre4"></a>Finding array items
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex09-0.jpg" alt="" class="calibre2" width="590" height="188" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex09-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex09-1.jpg" alt="" class="calibre2" width="590" height="224" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex09-1.jpg"></p>
      
      <p class="noind"><a id="iddle1479" class="calibre4"></a>It’s easy to find an array item that satisfies a certain condition: We use the built-in <kbd class="calibre15">find</kbd> method, passing it a callback that’s invoked for each item in the collection until the targeted item is found. This is indicated
         by the callback returning <kbd class="calibre15">true</kbd>. For example, the expression
      </p>
      
      <pre id="PLd0e23086" class="calibre5">ninjas.find(ninja =&gt; ninja.weapon === "wakizashi");</pre>
      
      <p class="noind">finds Kuma, the first ninja in the <kbd class="calibre15">ninjas</kbd> array that’s wielding a wakizashi.
      </p>
      
      <p class="noind">If we’ve gone through the entire array without a single item returning <kbd class="calibre15">true</kbd>, the final result of the search is <kbd class="calibre15">undefined</kbd>. For example, the code
      </p>
      
      <pre id="PLd0e23107" class="calibre5">ninjaWithKatana = ninjas.find(ninja =&gt; ninja.weapon === "katana");</pre>
      
      <p class="noind">returns <kbd class="calibre15">undefined</kbd>, because there isn’t a katana-wielding ninja. <a href="#ch09fig08" class="calibre4">Figure 9.8</a> shows the inner workings of the <kbd class="calibre15">find</kbd> function.
      </p>
      
      
      
      <h5 id="ch09fig08" class="notetitle">Figure 9.8. <a id="ch09fig08__title" class="calibre4"></a>The <kbd class="calibre15">find</kbd> function finds one item in an array: the first item for which the <kbd class="calibre15">find</kbd> callback returns <kbd class="calibre15">true</kbd>.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig08_alt.jpg" alt="" class="calibre2" width="590" height="277" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig08_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1672" class="calibre4"></a>If we need to find multiple items satisfying a certain criterion, we can use the <kbd class="calibre15">filter</kbd> method, which creates a <i class="calibre6">new</i> array containing all the items that satisfy that criterion. For example, the expression
      </p>
      
      <pre id="PLd0e23160" class="calibre5">const armedNinjas = ninjas.filter(ninja =&gt; "weapon" in ninja);</pre>
      
      <p class="noind">creates a new <kbd class="calibre15">armedNinjas</kbd> array that contains only <kbd class="calibre15">ninja</kbd>s with a weapon. In this case, poor unarmed Yoshi is left out. <a href="#ch09fig09" class="calibre4">Figure 9.9</a> shows how the <kbd class="calibre15">filter</kbd> function works.
      </p>
      
      
      
      <h5 id="ch09fig09" class="notetitle">Figure 9.9. <a id="ch09fig09__title" class="calibre4"></a>The <kbd class="calibre15">filter</kbd> function creates a new array that contains all items for which the callback returns <kbd class="calibre15">true</kbd>.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig09_alt.jpg" alt="" class="calibre2" width="590" height="277" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig09_alt.jpg"></p>
      
      
      <p class="noind">Throughout this example, you’ve seen how to find particular items in an array, but in many cases it might also be necessary
         to find the index of an item. Let’s take a closer look, with the following example.
      </p>
      
      
      
      <h5 id="ch09ex10" class="notetitle">Listing 9.10. <a id="ch09ex10__title" class="calibre4"></a>Finding array indexes
      </h5>
      <pre id="PLd0e23204" class="calibre5">const ninjas = ["Yagyu", "Yoshi", "Kuma", "Yoshi"];

assert(ninjas.indexOf("Yoshi") === 1, "Yoshi is at index 1");
assert(ninjas.lastIndexOf("Yoshi") === 3, "and at index 3");

const yoshiIndex = ninjas.findIndex(ninja =&gt; ninja === "Yoshi");

assert(yoshiIndex === 1, "Yoshi is still at index 1");</pre>
      
      <p class="noind">To find the index of a particular item, we use the built-in <kbd class="calibre15">indexOf</kbd> method, passing it the item whose index we want to find:
      </p>
      
      <pre id="PLd0e23216" class="calibre5">ninjas.indexOf("Yoshi")</pre>
      
      <p class="noind"><a id="iddle1088" class="calibre4"></a><a id="iddle1218" class="calibre4"></a><a id="iddle1482" class="calibre4"></a><a id="iddle1485" class="calibre4"></a><a id="iddle2049" class="calibre4"></a><a id="iddle2051" class="calibre4"></a>In cases where a particular item can be found multiple times in an array (as is the case with <kbd class="calibre15">"Yoshi"</kbd> and the <kbd class="calibre15">ninjas</kbd> array), we may also be interested in finding the last index where Yoshi appears. For this, we can use the <kbd class="calibre15">lastIndexOf</kbd> method:
      </p>
      
      <pre id="PLd0e23274" class="calibre5">ninjas.lastIndexOf("Yoshi")</pre>
      
      <p class="noind">Finally, in the most-general case, when we don’t have a reference to the exact item whose index we want to search for, we
         can use the <kbd class="calibre15">findIndex</kbd> method:
      </p>
      
      <pre id="PLd0e23286" class="calibre5">const yoshiIndex = ninjas.findIndex(ninja =&gt; ninja === "Yoshi");</pre>
      
      <p class="noind">The <kbd class="calibre15">findIndex</kbd> method takes a callback and returns the index of the first item for which the callback returns <kbd class="calibre15">true</kbd>. In essence, it works a lot like the <kbd class="calibre15">find</kbd> method, the only difference being that <kbd class="calibre15">find</kbd> returns a particular item, whereas <kbd class="calibre15">findIndex</kbd> returns the index of that item.
      </p>
      
      
      
      <h5 id="ch09lev3sec5" class="notetitle"><a id="ch09lev3sec5__title" class="calibre4"></a>Sorting arrays
      </h5>
      
      <p class="noind">One of the most common array operations is <i class="calibre6">sorting—</i>arranging items systematically in some order. Unfortunately, correctly implementing sorting algorithms isn’t the easiest of
         programming tasks: We have to select the best sorting algorithm for the task, implement it, and tailor it to our needs, while,
         as always, being careful not to introduce subtle bugs. To get this burden off our back, as you saw in <a href="kindle_split_014.html#ch03" class="calibre4">chapter 3</a>, all JavaScript arrays have access to the built-in <kbd class="calibre15">sort</kbd> method, whose usage looks something like this:
      </p>
      
      <pre id="PLd0e23328" class="calibre5">array.sort((a, b) =&gt; a – b);</pre>
      
      <p class="noind">The JavaScript engine implements the sorting algorithm. The only thing we have to provide is a callback that informs the sorting
         algorithm about the relationship between two array items. The possible results are as follows:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">If a callback returns a value less than <kbd class="calibre15">0</kbd>, then item <kbd class="calibre15">a</kbd> should come before item <kbd class="calibre15">b</kbd>.
            
         </li>
         
         <li class="calibre20">If a callback returns a value equal to <kbd class="calibre15">0</kbd>, then items <kbd class="calibre15">a</kbd> and <kbd class="calibre15">b</kbd> are on equal footing (as far as the sorting algorithm is concerned, they’re equal).
            
         </li>
         
         <li class="calibre20">If a callback returns a value greater than <kbd class="calibre15">0</kbd>, then item <kbd class="calibre15">a</kbd> should come after item <kbd class="calibre15">b</kbd>.
            
         </li>
         
      </ul>
      
      <p class="noind"><a href="#ch09fig10" class="calibre4">Figure 9.10</a> shows the decisions made by the sorting algorithm depending on the callback return value.
      </p>
      
      
      
      <h5 id="ch09fig10" class="notetitle">Figure 9.10. <a id="ch09fig10__title" class="calibre4"></a>If the call-back returns a value less than <kbd class="calibre15">0</kbd>, the first item should come before the second. If the callback returns <kbd class="calibre15">0</kbd>, both items should be left as is. And if the return value is greater than <kbd class="calibre15">0</kbd>, the first item should come after the second item.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig10_alt.jpg" alt="" class="calibre2" width="590" height="205" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig10_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1017" class="calibre4"></a><a id="iddle1019" class="calibre4"></a><a id="iddle1047" class="calibre4"></a><a id="iddle1081" class="calibre4"></a><a id="iddle1212" class="calibre4"></a><a id="iddle1628" class="calibre4"></a><a id="iddle1721" class="calibre4"></a>And that’s about all you need to know about the sorting algorithm. The actual sorting is performed behind the scenes, without
         us having to manually move array items around. Let’s look at a simple example.
      </p>
      
      
      
      <h5 id="ch09ex11" class="notetitle">Listing 9.11. <a id="ch09ex11__title" class="calibre4"></a>Sorting an array
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/241fig01_alt.jpg" alt="" class="calibre2" width="590" height="195" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/241fig01_alt.jpg"></p>
      
      
      <p class="noind">In <a href="#ch09ex11" class="calibre4">listing 9.11</a> we have an array of <kbd class="calibre15">ninja</kbd> objects, where each ninja has a name. Our goal is to sort that array lexicographically (in alphabetical order), according
         to ninja names. For this, we naturally use the <kbd class="calibre15">sort</kbd> function:
      </p>
      
      <pre id="PLd0e23478" class="calibre5">ninjas.sort(function(ninja1, ninja2){
  if(ninja1.name &lt; ninja2.name) { return -1; }
  if(ninja1.name &gt; ninja2.name) { return 1; }

  return 0;
});</pre>
      
      <p class="noind">To the <kbd class="calibre15">sort</kbd> function we only need to pass a callback that’s used to compare two array items. Because we want to make a lexical comparison,
         we state that if <kbd class="calibre15">ninja1</kbd>’s name is “less” than <kbd class="calibre15">ninja2</kbd>’s name, the callback returns <kbd class="calibre15">-1</kbd> (remember, this means <kbd class="calibre15">ninja1</kbd> should come before <kbd class="calibre15">ninja2</kbd>, in the final sorted order); if it’s greater, the callback returns <kbd class="calibre15">1</kbd> (<kbd class="calibre15">ninja1</kbd> should come after <kbd class="calibre15">ninja2</kbd>); if they’re equal, the callback returns <kbd class="calibre15">0</kbd>. Notice that we can use simple less-than (<kbd class="calibre15">&lt;</kbd>) and greater-than (<kbd class="calibre15">&gt;</kbd>) operators to compare two ninja names.
      </p>
      
      <p class="noind">That’s about it! The rest of the nitty-gritty details of sorting are left to the JavaScript engine, without us having to worry
         about them.
      </p>
      
      
      
      <h5 id="ch09lev3sec6" class="notetitle"><a id="ch09lev3sec6__title" class="calibre4"></a>Aggregating array items
      </h5>
      
      <p class="noind">How many times have you written code like the following?</p>
      
      <pre id="PLd0e23535" class="calibre5">const numbers = [1, 2, 3, 4];
const sum = 0;

numbers.forEach(number =&gt; {
   sum += number;
});

assert(sum === 10, "The sum of first four numbers is 10");</pre>
      
      <p class="noind"><a id="iddle1085" class="calibre4"></a><a id="iddle1140" class="calibre4"></a><a id="iddle1216" class="calibre4"></a><a id="iddle1582" class="calibre4"></a><a id="iddle1929" class="calibre4"></a>This code has to visit every item in a collection and aggregate some value, in essence reducing the entire array to a single
         value. Don’t worry—JavaScript has something to help with this situation, too: the <kbd class="calibre15">reduce</kbd> method, as shown in the following example.
      </p>
      
      
      
      <h5 id="ch09ex12" class="notetitle">Listing 9.12. <a id="ch09ex12__title" class="calibre4"></a>Aggregating items with reduce
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/242fig01_alt.jpg" alt="" class="calibre2" width="590" height="89" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/242fig01_alt.jpg"></p>
      
      
      <p class="noind">The <kbd class="calibre15">reduce</kbd> method works by taking the initial value (in this case, <kbd class="calibre15">0</kbd>) and calling the callback function on each array item with the result of the previous callback invocation (or the initial
         value) and the current array item as arguments. The result of the <kbd class="calibre15">reduce</kbd> invocation is the result of the last callback, called on the last array item. <a href="#ch09fig11" class="calibre4">Figure 9.11</a> sheds more light on the process.
      </p>
      
      
      
      <h5 id="ch09fig11" class="notetitle">Figure 9.11. <a id="ch09fig11__title" class="calibre4"></a>The <kbd class="calibre15">reduce</kbd> function applies a callback to an aggregated value and each item in an array to reduce the array to a single value.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig11_alt.jpg" alt="" class="calibre2" width="590" height="238" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig11_alt.jpg"></p>
      
      
      <p class="noind">We hope we’ve convinced you that JavaScript contains some useful array methods that can make our lives significantly easier
         and your code more elegant, without having to resort to pesky <kbd class="calibre15">for</kbd> loops. If you’d like to find out more about these and other array methods, we recommend the Mozilla Developer Network explanation
         at <a href="http://mng.bz/cS21" class="calibre4">http://mng.bz/cS21</a>.
      </p>
      
      <p class="noind">Now we’ll take things a bit further and show you how to reuse these array methods on your own, custom objects.</p>
      
      
      
      
      <h4 id="ch09lev2sec5" class="calibre26">9.1.5. <a id="ch09lev2sec5__title" class="calibre4"></a>Reusing built-in array functions
      </h4>
      
      <p class="noind">There are times when we may want to create an object that contains a collection of data. If the collection was all we were
         worried about, we could use an array. But in certain cases, there may be more state to store than just the collection itself—perhaps
         we need to store some sort of metadata regarding the collected items.
      </p>
      
      <p class="noind"><a id="iddle1075" class="calibre4"></a><a id="iddle1719" class="calibre4"></a>One option may be to create a new array every time you wish to create a new version of such an object, and add the metadata
         properties and methods to it. Remember, we can add properties and methods to an object as we please, including arrays. Generally,
         however, this can be slow, not to mention tedious.
      </p>
      
      <p class="noind">Let’s examine the possibility of using a normal object and <i class="calibre6">giving</i> it the functionality we desire. Methods that know how to deal with collections already exist on the <kbd class="calibre15">Array</kbd> object; can we trick them into working on our own objects? Turns out that we can, as shown in the following listing.
      </p>
      
      <h5 id="ch09ex13" class="notetitle">Listing 9.13. <a id="ch09ex13__title" class="calibre4"></a>Simulating array-like methods
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex13-0.jpg" alt="" class="calibre2" width="590" height="184" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex13-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex13-1.jpg" alt="" class="calibre2" width="590" height="277" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex13-1.jpg"></p>
      
      <p class="noind">In this example, we create a “normal” object and instrument it to mimic some of the behaviors of an array. First we define
         a <kbd class="calibre15">length</kbd> property to record the number of elements that are stored, just like an array. Then we define a method to add an element
         to the end of the simulated array, calling this method <kbd class="calibre15">add</kbd>:
      </p>
      
      <pre id="PLd0e23691" class="calibre5">add: function(elem){
  Array.prototype.push.call(this, elem);
}</pre>
      
      <p class="noind"><a id="iddle1077" class="calibre4"></a><a id="iddle1150" class="calibre4"></a><a id="iddle1221" class="calibre4"></a><a id="iddle1328" class="calibre4"></a><a id="iddle1483" class="calibre4"></a><a id="iddle1744" class="calibre4"></a><a id="iddle1926" class="calibre4"></a>Rather than write our own code, we can use a native method of JavaScript arrays: <kbd class="calibre15">Array.prototype.push</kbd>.
      </p>
      
      <p class="noind">Normally, the <kbd class="calibre15">Array.prototype.push</kbd> method would operate on its own array via its function context. But here, we’re tricking the method to use <i class="calibre6">our</i> object as its context by using the <kbd class="calibre15">call</kbd> method (remember <a href="kindle_split_015.html#ch04" class="calibre4">chapter 4</a>) and forcing our object to be the context of the <kbd class="calibre15">push</kbd> method. (Notice how we could’ve just as easily used the <kbd class="calibre15">apply</kbd> method.) The <kbd class="calibre15">push</kbd> method, which increments the <kbd class="calibre15">length</kbd> property (thinking that it’s the <kbd class="calibre15">length</kbd> property of an array), adds a numbered property to the object referencing the passed element. In a way, this behavior is
         almost subversive (how fitting for ninjas!), but it exemplifies what we can do with mutable object contexts.
      </p>
      
      <p class="noind">The <kbd class="calibre15">add</kbd> method expects an element reference to be passed for storage. Although sometimes we may have such a reference around, more
         often than not we won’t, so we also define a convenience method, <kbd class="calibre15">gather</kbd>, that looks up the element by its <kbd class="calibre15">id</kbd> value and adds it to storage:
      </p>
      
      <pre id="PLd0e23787" class="calibre5">gather: function(id){
  this.add(document.getElementById(id));
}</pre>
      
      <p class="noind">Finally, we also define a <kbd class="calibre15">find</kbd> method that lets us find an arbitrary item in our custom object, by taking advantage of the built-in array <kbd class="calibre15">find</kbd> method:
      </p>
      
      <pre id="PLd0e23802" class="calibre5">find: function(callback){
  return Array.prototype.find.call(this, callback);
}</pre>
      
      <p class="noind">The borderline nefarious behavior we demonstrated in this section not only reveals the power that malleable function contexts
         give us, but also shows how we can be clever in reusing code that’s already written, instead of constantly reinventing the
         wheel.
      </p>
      
      <p class="noind">Now that we’ve spent some time with arrays, let’s move on to two new types of collections introduced by ES6: maps and sets.</p>
      
      
      
      
      <h3 id="ch09lev1sec2" class="calibre24"><a id="ch09lev1sec2__title" class="calibre3"></a>9.2. Maps
      </h3>
      
      <p class="noind">Imagine that you’re a developer at <a href="http://freelanceninja.com" class="calibre4">freelanceninja.com</a>, a site that wants to cater to a more international audience. For each piece of text on the website—for example, “Ninjas
         for hire”—you’d like to create a mapping to each targeted language, such as “<img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/244fig01.jpg" alt="" class="calibre2" width="184" height="22" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/244fig01.jpg">” in Japanese, “<img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/244fig02.jpg" alt="" class="calibre2" width="92" height="23" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/244fig02.jpg">” in Chinese, or “<img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/244fig03.jpg" alt="" class="calibre2" width="101" height="22" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/244fig03.jpg">” in Korean (let’s hope Google Translate has done an adequate job). These collections, which map a key to a specific value,
         are called by different names in different programming languages, but most often they’re known as <i class="calibre6">dictionaries</i> or <i class="calibre6">maps</i>.
      </p>
      
      <p class="noind">But how do you efficiently manage this localization in JavaScript? One traditional approach is to take advantage of the fact
         that objects are collections of named properties and values, and create something like the following dictionary:
      </p>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/245fig01_alt.jpg" alt="" class="calibre2" width="590" height="327" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/245fig01_alt.jpg"></p>
      
      <p class="noind"><a id="iddle1224" class="calibre4"></a><a id="iddle1271" class="calibre4"></a><a id="iddle1747" class="calibre4"></a><a id="iddle1820" class="calibre4"></a>At first glance, this may seem like a perfectly fine approach to this problem, and for this example, it isn’t half bad. But
         unfortunately, in general, you can’t rely on it.
      </p>
      
      
      <h4 id="ch09lev2sec6" class="calibre26">9.2.1. <a id="ch09lev2sec6__title" class="calibre4"></a>Don’t use objects as maps
      </h4>
      
      <p class="noind">Imagine that somewhere on our site we need to access the translation for the word <i class="calibre6">constructor</i>, so we extend the dictionary example into the following code.
      </p>
      
      
      
      <h5 id="ch09ex14" class="notetitle">Listing 9.14. <a id="ch09ex14__title" class="calibre4"></a>Objects have access to properties that weren’t explicitly defined
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/245fig02_alt.jpg" alt="" class="calibre2" width="590" height="274" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/245fig02_alt.jpg"></p>
      
      
      <p class="noind">We try to access the translation for the word <i class="calibre6">constructor</i>—a word that we foolishly forgot to define in our dictionary. Normally, in such a case, we’d expect the dictionary to return
         <kbd class="calibre15">undefined</kbd>. But that isn’t the result, as you can see in <a href="#ch09fig12" class="calibre4">figure 9.12</a>.
      </p>
      
      
      
      <h5 id="ch09fig12" class="notetitle">Figure 9.12. <a id="ch09fig12__title" class="calibre4"></a>Running <a href="#ch09ex14" class="calibre4">listing 9.14</a> shows that objects aren’t good maps, because they have access to properties that weren’t explicitly defined (through their
         prototypes).
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig12.jpg" alt="" class="calibre2" width="388" height="201" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig12.jpg"></p>
      
      
      
      <p class="noind">As you can see, by accessing the <kbd class="calibre15">constructor</kbd> property, we obtain the following string:
      </p>
      
      <pre id="PLd0e23950" class="calibre5">"function Object() { [native code] }"</pre>
      
      <p class="noind"><a id="iddle1261" class="calibre4"></a><a id="iddle1343" class="calibre4"></a>What’s with this? As you learned in <a href="kindle_split_019.html#ch07" class="calibre4">chapter 7</a>, all objects have prototypes; even if we define new, empty objects as our maps, they still have access to the properties
         of the prototype objects. One of those properties is <kbd class="calibre15">constructor</kbd> (recall that <kbd class="calibre15">constructor</kbd> is the property of the prototype object that points back to the constructor function), and it’s the culprit behind the mess
         we now have on our hands.
      </p>
      
      <p class="noind">In addition, with objects, keys can only be string values; if you want to create a mapping for any other value, that value
         will be silently converted into a string without anyone asking you anything! For example, imagine that we want to track some
         information about HTML nodes, as in the following listing.
      </p>
      
      
      
      <h5 id="ch09ex15" class="notetitle">Listing 9.15. <a id="ch09ex15__title" class="calibre4"></a>Mapping values to HTML nodes with objects
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/246fig01_alt.jpg" alt="" class="calibre2" width="590" height="328" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/246fig01_alt.jpg"></p>
      
      
      <p class="noind">In <a href="#ch09ex15" class="calibre4">listing 9.15</a>, we create two HTML elements, <kbd class="calibre15">firstElement</kbd> and <kbd class="calibre15">secondElement</kbd>, which we then fetch from the DOM by using the <kbd class="calibre15">document.getElementById</kbd> method. In order to create a mapping that will store additional information about each element, we define a plain old JavaScript
         object:
      </p>
      
      <pre id="PLd0e24008" class="calibre5">const map = {};</pre>
      
      <p class="noind">Then we use the HTML element as a key for our mapping object and associate some data with it:</p>
      
      <pre id="PLd0e24017" class="calibre5">map[firstElement] = { data: "firstElement"}</pre>
      
      <p class="noind"><a id="iddle1222" class="calibre4"></a><a id="iddle1745" class="calibre4"></a><a id="iddle2128" class="calibre4"></a>And we check that we can retrieve that data. Because that works as it should, we repeat the entire process for the second
         element:
      </p>
      
      <pre id="PLd0e24051" class="calibre5">map[secondElement] = { data: "secondElement"};</pre>
      
      <p class="noind">Again, everything looks hunky dory; we’ve successfully associated some data with our HTML element. But a problem occurs if
         we decide to revisit the first element:
      </p>
      
      <pre id="PLd0e24060" class="calibre5">map[firstElement].data</pre>
      
      <p class="noind">It would be normal to assume that we’d again obtain the information about the first element, but this isn’t the case. Instead,
         as <a href="#ch09fig13" class="calibre4">figure 9.13</a> shows, the information about the second element is returned.
      </p>
      
      
      
      <h5 id="ch09fig13" class="notetitle">Figure 9.13. <a id="ch09fig13__title" class="calibre4"></a>Running the code from <a href="#ch09ex15" class="calibre4">listing 9.15</a> shows that objects are converted to strings if we try to use them as object properties.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig13.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig13.jpg"></p>
      
      
      
      <p class="noind">This happens because with objects, keys are stored as strings. This means when we try to use any non-string value, such as
         an HTML element, as a property of an object, that value is silently converted to a string by calling its <kbd class="calibre15">toString</kbd> method. Here, this returns the string <kbd class="calibre15">"[object HTMLDivElement]"</kbd>, and the information about the first element is stored as the value of the <kbd class="calibre15">[object HTMLDivElement]</kbd> property.
      </p>
      
      <p class="noind">Next, when we try to create a mapping for the second element, a similar thing happens. The second element, which is also an
         HTML div element, is also converted to a string, and its additional data is also assigned to the <kbd class="calibre15">[object HTMLDivElement]</kbd> property, overriding the value we set for the first element.
      </p>
      
      <p class="noind">For these two reasons—properties inherited through prototypes and support for string-only keys—plain objects generally aren’t
         useful as maps. Due to this limitation, the ECMAScript committee has specified a completely new type: <kbd class="calibre15">Map</kbd>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch09note02" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Maps are a part of the ES6 standard. For current browser compatibility, see: <a href="http://mng.bz/JYYM" class="calibre4">http://mng.bz/JYYM</a>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      
      <h4 id="ch09lev2sec7" class="calibre26">9.2.2. <a id="ch09lev2sec7__title" class="calibre4"></a>Creating our first map
      </h4>
      
      <p class="noind">Creating maps is easy: We use a new, built-in <kbd class="calibre15">Map</kbd> constructor. Look at the following example.
      </p>
      
      
      <p class="noind"></p>
      <h5 id="ch09ex16" class="notetitle">Listing 9.16. <a id="ch09ex16__title" class="calibre4"></a>Creating our first map
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex16-0.jpg" alt="" class="calibre2" width="590" height="242" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex16-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex16-1.jpg" alt="" class="calibre2" width="590" height="329" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex16-1.jpg"></p>
      
      <p class="noind"><a id="iddle1631" class="calibre4"></a><a id="iddle1741" class="calibre4"></a>In this example, we create a new map by calling the built-in <kbd class="calibre15">Map</kbd> constructor:
      </p>
      
      <pre id="PLd0e24165" class="calibre5">const ninjaIslandMap = new Map();</pre>
      
      <p class="noind">Next, we create three ninja objects, cleverly called <kbd class="calibre15">ninja1</kbd>, <kbd class="calibre15">ninja2</kbd>, and <kbd class="calibre15">ninja3</kbd>. We then use the built-in map <kbd class="calibre15">set</kbd> method:
      </p>
      
      <pre id="PLd0e24186" class="calibre5">ninjaIslandMap.set(ninja1, { homeIsland: "Honshu"});</pre>
      
      <p class="noind">This creates a mapping between a key—in this case, the <kbd class="calibre15">ninja1</kbd> object—and a value—in this case, an object carrying the information about the ninja’s home island. We do this for the first
         two ninjas, <kbd class="calibre15">ninja1</kbd> and <kbd class="calibre15">ninja2</kbd>.
      </p>
      
      <p class="noind"><a id="iddle1319" class="calibre4"></a><a id="iddle1733" class="calibre4"></a><a id="iddle2044" class="calibre4"></a>In the next step, we obtain the mapping for the first two ninjas by using another built-in map method, <kbd class="calibre15">get</kbd>:
      </p>
      
      <pre id="PLd0e24226" class="calibre5">assert(ninjaIslandMap.get(ninja1).homeIsland === "Honshu",
      "The first mapping works");</pre>
      
      <p class="noind">The mapping of course exists for the first two ninjas, but it doesn’t exist for the third ninja, because we haven’t used the
         third ninja as an argument to the <kbd class="calibre15">set</kbd> method. The current state of the map is shown in <a href="#ch09fig14" class="calibre4">figure 9.14</a>.
      </p>
      
      
      
      <h5 id="ch09fig14" class="notetitle">Figure 9.14. <a id="ch09fig14__title" class="calibre4"></a>A map is a collection of key-value pairs, where a key can be anything—even another object.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig14.jpg" alt="" class="calibre2" width="478" height="392" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig14.jpg"></p>
      
      
      
      <p class="noind">In addition to <kbd class="calibre15">get</kbd> and <kbd class="calibre15">set</kbd> methods, every map also has a built-in <kbd class="calibre15">size</kbd> property and <kbd class="calibre15">has</kbd> and <kbd class="calibre15">delete</kbd> methods. The <kbd class="calibre15">size</kbd> property tells us how many mappings we’ve created. In this case, we’ve created only two mappings.
      </p>
      
      <p class="noind">The <kbd class="calibre15">has</kbd> method, on the other hand, notifies us whether a mapping for a particular key already exists:
      </p>
      
      <pre id="PLd0e24281" class="calibre5">ninjaIslandMap.has(ninja1); //true
ninjaIslandMap.has(ninja3); //false</pre>
      
      <p class="noind">The <kbd class="calibre15">delete</kbd> method enables us to remove items from our map:
      </p>
      
      <pre id="PLd0e24293" class="calibre5">ninjaIslandMap.delete(ninja1);</pre>
      
      <p class="noind">One of the fundamental concepts when dealing with maps is determining when two map keys are equal. Let’s explore this concept.</p>
      
      
      <h5 id="ch09lev3sec7" class="notetitle"><a id="ch09lev3sec7__title" class="calibre4"></a>Key equality
      </h5>
      
      <p class="noind">If you come from a bit more traditional background, such as C#, Java, or Python, you may be surprised by the next example.</p>
      
      
      
      <h5 id="ch09ex17" class="notetitle">Listing 9.17. <a id="ch09ex17__title" class="calibre4"></a>Key equality in maps
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/249fig01_alt.jpg" alt="" class="calibre2" width="590" height="220" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/249fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1223" class="calibre4"></a><a id="iddle1694" class="calibre4"></a><a id="iddle1746" class="calibre4"></a>In <a href="#ch09ex17" class="calibre4">listing 9.17</a>, we use the built-in <kbd class="calibre15">location.href</kbd> property to obtain the URL of the current page. Next, by using the built-in URL constructor, we create two new URL objects
         that link to the current page. We then associate a description object with each link. Finally, we check that the correct mappings
         have been created, as shown in <a href="#ch09fig15" class="calibre4">figure 9.15</a>.
      </p>
      
      
      
      <h5 id="ch09fig15" class="notetitle">Figure 9.15. <a id="ch09fig15__title" class="calibre4"></a>If we run the code from <a href="#ch09ex17" class="calibre4">listing 9.17</a>, we can see that key equality in maps is based on object equality.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig15.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig15.jpg"></p>
      
      
      
      <p class="noind">People who have mostly worked in JavaScript may not find this result unexpected: We have two different objects for which we
         create two different mappings. But notice that the two URL objects, even though they’re separate objects, still point to the
         same URL location: the location of the current page. We could argue that, when creating mappings, these two objects should
         be considered equal. But in JavaScript, we can’t overload the equality operator, and the two objects, even though they have
         the same content, are always considered different. This isn’t the case with other languages, such as Java and C#, so be careful!
      </p>
      
      
      
      
      <h4 id="ch09lev2sec8" class="calibre26">9.2.3. <a id="ch09lev2sec8__title" class="calibre4"></a>Iterating over maps
      </h4>
      
      <p class="noind">So far, you’ve seen some of the advantages of maps: You can be sure they contain only items that you put in them, and you
         can use anything as a key. But there’s more!
      </p>
      
      <p class="noind">Because maps are collections, there’s nothing stopping us from iterating over them with <kbd class="calibre15">for...of</kbd> loops. (Remember, we used the <kbd class="calibre15">for...of</kbd> loop to iterate over values created by generators in <a href="kindle_split_017.html#ch06" class="calibre4">chapter 6</a>.) You’re also guaranteed that these values will be visited in the order in which they were inserted (something we can’t rely
         on when iterating over objects using the <kbd class="calibre15">for...in</kbd> loop). Let’s look at the following example.
      </p>
      
      
      
      <h5 id="ch09ex18" class="notetitle">Listing 9.18. <a id="ch09ex18__title" class="calibre4"></a>Iterating over maps
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/250fig01_alt.jpg" alt="" class="calibre2" width="590" height="304" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/250fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1225" class="calibre4"></a><a id="iddle1331" class="calibre4"></a><a id="iddle1711" class="calibre4"></a><a id="iddle2026" class="calibre4"></a><a id="iddle2030" class="calibre4"></a><a id="iddle2165" class="calibre4"></a>As the previous listing shows, once we’ve created a mapping, we can easily iterate over it using the <kbd class="calibre15">for...of</kbd> loop:
      </p>
      
      <pre id="PLd0e24465" class="calibre5">for(var item of directory){
  assert(item[0] !== null, "Key:" + item[0]);
  assert(item[1] !== null, "Value:" + item[1]);
}</pre>
      
      <p class="noind">In each iteration, this gives a two-item array, where the first item is a key and the second item is the value of an item
         from our directory map. We can also use the <kbd class="calibre15">keys</kbd> and <kbd class="calibre15">values</kbd> methods to iterate over, well, keys and values contained in a map.
      </p>
      
      <p class="noind">Now that we’ve looked at maps, let’s visit another newcomer to JavaScript: <i class="calibre6">sets</i>, which are collections of unique items.
      </p>
      
      
      
      
      <h3 id="ch09lev1sec3" class="calibre24"><a id="ch09lev1sec3__title" class="calibre3"></a>9.3. Sets
      </h3>
      
      <p class="noind">In many real-world problems, we have to deal with collections of <i class="calibre6">distinct</i> items (meaning each item can’t appear more than once) called <i class="calibre6">sets</i>. Up to ES6, this was something you had to implement yourself by mimicking sets with standard objects. For a crude example,
         see the next listing.
      </p>
      
      <h5 id="ch09ex19" class="notetitle">Listing 9.19. <a id="ch09ex19__title" class="calibre4"></a>Mimicking sets with objects
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex19-0.jpg" alt="" class="calibre2" width="590" height="241" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex19-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex19-1.jpg" alt="" class="calibre2" width="590" height="280" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch09ex19-1.jpg"></p>
      
      <p class="noind"><a id="iddle1226" class="calibre4"></a><a id="iddle2027" class="calibre4"></a><a href="#ch09ex19" class="calibre4">Listing 9.19</a> shows a simple example of how sets can be mimicked with objects. We use a data-storage object, <kbd class="calibre15">data</kbd>, to keep track of our set items, and we expose three methods: <kbd class="calibre15">has</kbd>, which checks whether an item is already contained in the set; <kbd class="calibre15">add</kbd>, which adds an item only if the same item isn’t already contained in the set; and <kbd class="calibre15">remove</kbd>, which removes an already-contained item from the set.
      </p>
      
      <p class="noind">But this is a poor doppelganger. Because with maps, you can’t really store objects—only strings and numbers—and there’s always
         the risk of accessing prototype objects. For these reasons, the ECMAScript committee decided to introduce a completely new
         type of collection: <i class="calibre6">sets</i>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch09note03" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Sets are a part of the ES6 standard. For current browser compatibility, see <a href="http://mng.bz/QRTS" class="calibre4">http://mng.bz/QRTS</a>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      <h4 id="ch09lev2sec9" class="calibre26">9.3.1. <a id="ch09lev2sec9__title" class="calibre4"></a>Creating our first set
      </h4>
      
      <p class="noind">The cornerstone of creating sets is the newly introduced constructor function, conveniently named <kbd class="calibre15">Set</kbd>. Let’s look at an example.
      </p>
      
      
      
      <h5 id="ch09ex20" class="notetitle">Listing 9.20. <a id="ch09ex20__title" class="calibre4"></a>Creating a set
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/252fig01_alt.jpg" alt="" class="calibre2" width="590" height="302" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/252fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1229" class="calibre4"></a><a id="iddle1632" class="calibre4"></a><a id="iddle2031" class="calibre4"></a><a id="iddle2045" class="calibre4"></a><a id="iddle2151" class="calibre4"></a>Here we use the built-in <kbd class="calibre15">Set</kbd> constructor to create a new <kbd class="calibre15">ninjas</kbd> set that will contain distinct ninjas. If we don’t pass in any arguments, an empty set is created. We can also pass in an
         array, such as this, which pre-fills the set:
      </p>
      
      <pre id="PLd0e24639" class="calibre5">new Set(["Kuma", "Hattori", "Yagyu", "Hattori"]);</pre>
      
      <p class="noind">As we already mentioned, sets are collections of unique items, and their primary purpose is to stop us from storing multiple
         occurrences of the same object. In this case, this means <kbd class="calibre15">"Hattori"</kbd>, which we tried to add twice, is added only once.
      </p>
      
      <p class="noind">A number of methods are accessible from every set. For example, the <kbd class="calibre15">has</kbd> method checks whether an item is contained in the set:
      </p>
      
      <pre id="PLd0e24657" class="calibre5">ninjas.has("Hattori")</pre>
      
      <p class="noind">and the <kbd class="calibre15">add</kbd> method is used to add unique items to the set:
      </p>
      
      <pre id="PLd0e24669" class="calibre5">ninjas.add(<b class="calibre21">"</b>Yoshi<b class="calibre21">"</b>);</pre>
      
      <p class="noind">If you’re curious about how many items are in a set, you can always use the <kbd class="calibre15">size</kbd> property.
      </p>
      
      <p class="noind">Similar to maps and arrays, sets are collections, so we can iterate over them with a <kbd class="calibre15">for...of</kbd> loop. As you can see in <a href="#ch09fig16" class="calibre4">figure 9.16</a>, the items are always iterated over in the order in which they were inserted.
      </p>
      
      
      
      <h5 id="ch09fig16" class="notetitle">Figure 9.16. <a id="ch09fig16__title" class="calibre4"></a>Running the code from <a href="#ch09ex20" class="calibre4">listing 9.20</a> shows that the items in a set are iterated over in the order in which they were inserted.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig16.jpg" alt="" class="calibre2" width="388" height="358" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig16.jpg"></p>
      
      
      
      <p class="noind">Now that we’ve gone through the basics of sets, let’s visit some common operations on sets: unions, intersections, and differences.</p>
      
      
      
      <h4 id="ch09lev2sec10" class="calibre26">9.3.2. <a id="ch09lev2sec10__title" class="calibre4"></a>Union of sets
      </h4>
      
      <p class="noind">A union of two sets, <kbd class="calibre15">A</kbd> and <kbd class="calibre15">B,</kbd> creates a new set that contains all elements from both <kbd class="calibre15">A</kbd> and <kbd class="calibre15">B</kbd>. Naturally, each item can’t occur more than once in the new set.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch09ex21" class="notetitle">Listing 9.21. <a id="ch09ex21__title" class="calibre4"></a>Using sets to perform a union of collections
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/254fig01_alt.jpg" alt="" class="calibre2" width="590" height="289" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/254fig01_alt.jpg"></p>
      
      
      <p class="noind">We first create an array of <kbd class="calibre15">ninjas</kbd> and an array of <kbd class="calibre15">samurai</kbd>. Notice that Hattori is leading a busy life: samurai by day, ninja by night. Now imagine that we need to create a collection
         of people whom we can call to arms if a neighboring daimyo decides that his province is a bit cramped. We create a new set,
         <kbd class="calibre15">warriors</kbd>, that includes all ninjas and all samurai. Hattori is in both collections, but we want to include him only once—it’s not
         like two Hattoris will respond to our call.
      </p>
      
      <p class="noind">In this case, a set is perfect! We don’t need to manually keep track of whether an item has been already included: The set
         takes care of that by itself, automatically. When creating this new set, we use the spread operator <kbd class="calibre15">[...ninjas, ...samurai]</kbd> (remember <a href="kindle_split_014.html#ch03" class="calibre4">chapter 3</a>) to create a new array that contains all ninjas and all samurai. In case you’re wondering, Hattori is present twice in this
         new array. But when we finally pass that array to the <kbd class="calibre15">Set</kbd> constructor, Hattori is included only once, as shown in <a href="#ch09fig17" class="calibre4">figure 9.17</a>.
      </p>
      
      
      
      <h5 id="ch09fig17" class="notetitle">Figure 9.17. <a id="ch09fig17__title" class="calibre4"></a>A union of two sets keeps the items from both collections (without duplicates).
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig12a_alt.jpg" alt="" class="calibre2" width="590" height="246" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/09fig12a_alt.jpg"></p>
      
      
      
      
      
      <h4 id="ch09lev2sec11" class="calibre26">9.3.3. <a id="ch09lev2sec11__title" class="calibre4"></a>Intersection of sets
      </h4>
      
      <p class="noind"><a id="iddle1003" class="calibre4"></a><a id="iddle1227" class="calibre4"></a><a id="iddle1228" class="calibre4"></a><a id="iddle1435" class="calibre4"></a><a id="iddle1480" class="calibre4"></a><a id="iddle1683" class="calibre4"></a><a id="iddle2028" class="calibre4"></a><a id="iddle2029" class="calibre4"></a>The <i class="calibre6">intersection</i> of two sets, <kbd class="calibre15">A</kbd> and <kbd class="calibre15">B</kbd>, creates a set that contains elements of <kbd class="calibre15">A</kbd> that are also in <kbd class="calibre15">B</kbd>. For example, we can find ninjas that are also samurai, as shown next.
      </p>
      
      
      
      <h5 id="ch09ex22" class="notetitle">Listing 9.22. <a id="ch09ex22__title" class="calibre4"></a>Intersection of sets
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/255fig01_alt.jpg" alt="" class="calibre2" width="590" height="139" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/255fig01_alt.jpg"></p>
      
      
      <p class="noind">The idea behind <a href="#ch09ex22" class="calibre4">listing 9.22</a> is to create a new set that contains only ninjas who are also samurai. We do this by taking advantage of the array’s <kbd class="calibre15">filter</kbd> method, which, as you’ll remember, creates a new array that contains only the items that match a certain criterion. In this
         case, the criterion is that the ninja is also a samurai (is contained in the set of samurai). Because the <kbd class="calibre15">filter</kbd> method can only be used on arrays, we have to turn the <kbd class="calibre15">ninjas</kbd> set into an array by using the spread operator:
      </p>
      
      <pre id="PLd0e24897" class="calibre5">[...ninjas]</pre>
      
      <p class="noind">Finally, we check that we’ve found only one ninja who’s also a samurai: the Jack of all trades, Hattori.</p>
      
      
      
      <h4 id="ch09lev2sec12" class="calibre26">9.3.4. <a id="ch09lev2sec12__title" class="calibre4"></a>Difference of sets
      </h4>
      
      <p class="noind">The difference of two sets, <kbd class="calibre15">A</kbd> and <kbd class="calibre15">B</kbd>, contains all elements that are in set <kbd class="calibre15">A</kbd> but are <i class="calibre6">not</i> in set <kbd class="calibre15">B</kbd>. As you might guess, this is similar to the intersection of sets, with one small but significant difference. In the next
         listing, we want to find only true ninjas (not those who also moonlight as samurai).
      </p>
      
      
      
      <h5 id="ch09ex23" class="notetitle">Listing 9.23. <a id="ch09ex23__title" class="calibre4"></a>Difference of sets
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/255fig02_alt.jpg" alt="" class="calibre2" width="590" height="160" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/255fig02_alt.jpg"></p>
      
      
      <p class="noind">The only change is to specify that we care only about the ninjas who are <i class="calibre6">not</i> also samurai, by putting an exclamation mark (<kbd class="calibre15">!</kbd>) before the <kbd class="calibre15">samurai.has(ninja)</kbd> expression.
      </p>
      
      
      
      
      
      <h3 id="ch09lev1sec4" class="calibre24"><a id="ch09lev1sec4__title" class="calibre3"></a>9.4. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Arrays are a special type of object with a <kbd class="calibre15">length</kbd> property and <kbd class="calibre15">Array.prototype</kbd> as their prototype.
            
         </li>
         
         <li class="calibre20">We can create new arrays using the array literal notation (<kbd class="calibre15">[])</kbd> or by calling the built-in <kbd class="calibre15">Array</kbd> constructor.
            
         </li>
         
         <li class="calibre20">We can modify the contents of an array using several methods accessible from array objects:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">The built-in <kbd class="calibre15">push</kbd> and <kbd class="calibre15">pop</kbd> methods add items to and remove items from the end of the array.
                  
               </li>
               
               <li class="calibre20">The built-in <kbd class="calibre15">shift</kbd> and <kbd class="calibre15">unshift</kbd> methods add items to and remove items from the beginning of the array.
                  
               </li>
               
               <li class="calibre20">The built-in <kbd class="calibre15">splice</kbd> method can be used to remove items from and add items to arbitrary array positions.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">All arrays have access to a number of useful methods:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">The <kbd class="calibre15">map</kbd> method creates a new array with the results of calling a callback on every element.
                  
               </li>
               
               <li class="calibre20">The <kbd class="calibre15">every</kbd> and <kbd class="calibre15">some</kbd> methods determine whether all or some array items satisfy a certain criterion.
                  
               </li>
               
               <li class="calibre20">The <kbd class="calibre15">find</kbd> and <kbd class="calibre15">filter</kbd> methods find array items that satisfy a certain condition.
                  
               </li>
               
               <li class="calibre20">The <kbd class="calibre15">sort</kbd> method sorts an array.
                  
               </li>
               
               <li class="calibre20">The <kbd class="calibre15">reduce</kbd> method aggregates all items in an array into a single value.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">You can reuse the built-in array methods when implementing your own objects by explicitly setting the method call context
            with the <kbd class="calibre15">call</kbd> or <kbd class="calibre15">apply</kbd> method.
            
         </li>
         
         <li class="calibre20">Maps and dictionaries are objects that contain mappings between a key and a value.
            
         </li>
         
         <li class="calibre20">Objects in JavaScript are lousy maps because you can only use string values as keys and because there’s always the risk of
            accessing prototype properties. Instead, use the new built-in <kbd class="calibre15">Map</kbd> collection.
            
         </li>
         
         <li class="calibre20">Maps are collections and can be iterated over using the <kbd class="calibre15">for...of</kbd> loop.
            
         </li>
         
         <li class="calibre20">Sets are collections of unique items.
            
         </li>
         
      </ul>
      
      
      
      <h3 id="ch09lev1sec5" class="calibre24"><a id="ch09lev1sec5__title" class="calibre3"></a>9.5. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch09qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch09qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch09qa2q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">What will be the content of the <kbd class="calibre15">samurai</kbd> array, after running the following code?
            </p>
            
            <pre id="PLd0e25135" class="calibre5">const samurai = ["Oda", "Tomoe"];
samurai[3] = "Hattori";</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch09qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch09qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind">What will be the content of the <kbd class="calibre15">ninjas</kbd> array, after running the following code?
            </p>
            
            <pre id="PLd0e25151" class="calibre5">const ninjas = [];

ninjas.push("Yoshi");
ninjas.unshift("Hattori");

ninjas.length = 3;

ninjas.pop();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch09qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch09qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">What will be the content of the <kbd class="calibre15">samurai</kbd> array, after running the following code?
            </p>
            
            <pre id="PLd0e25169" class="calibre5">const samurai = [];

samurai.push("Oda");
samurai.unshift("Tomoe");
samurai.splice(1, 0, "Hattori", "Takeda");
samurai.pop();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch09qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch09qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">What will be stored in variables <kbd class="calibre15">first</kbd>, <kbd class="calibre15">second</kbd>, and <kbd class="calibre15">third</kbd>, after running the following code?
            </p>
            
            <pre id="PLd0e25191" class="calibre5">const ninjas = [{name:"Yoshi", age: 18},
             {name:"Hattori", age: 19},
             {name:"Yagyu", age: 20}];

const first = persons.map(ninja =&gt; ninja.age);
const second = first.filter(age =&gt; age % 2 == 0);
const third = first.reduce((aggregate, item) =&gt;  aggregate + item, 0);</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch09qa2qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch09qa2q5" class="calibre4"></a><b class="calibre21">5 </b></p><p class="noind">What will be stored in variables <kbd class="calibre15">first</kbd> and <kbd class="calibre15">second</kbd>, after running the following code?
            </p>
            
            <pre id="PLd0e25210" class="calibre5">const ninjas = [{ name: "Yoshi", age: 18 },
               { name: "Hattor", age: 19 },
               { name: "Yagyu", age: 20 }];

const first = ninjas.some(ninja =&gt; ninja.age % 2 == 0);
const second = ninjas.every(ninja =&gt; ninja.age % 2 == 0);</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch09qa2qe6" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch09qa2q6" class="calibre4"></a><b class="calibre21">6 </b></p><p class="noind">Which of the following assertions will pass?</p>
            
            <pre id="PLd0e25223" class="calibre5">const samuraiClanMap = new Map();

const samurai1 = { name: "Toyotomi"};
const samurai2 = { name: "Takeda"};
const samurai3 = { name: "Akiyama"};

const oda = { clan: "Oda"};
const tokugawa = { clan: "Tokugawa"};
const takeda ={clan: "Takeda"};

samuraiClanMap.set(samurai1, oda);
samuraiClanMap.set(samurai2, tokugawa);
samuraiClanMap.set(samurai2, takeda);
assert(samuraiClanMap.size === 3, "There are three mappings");
assert(samuraiClanMap.has(samurai1), "The first samurai has a mapping");
assert(samuraiClanMap.has(samurai3), "The third samurai has a mapping");</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch09qa2qe7" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch09qa2q7" class="calibre4"></a><b class="calibre21">7 </b></p><p class="noind">Which of the following assertions will pass?</p>
            
            <pre id="PLd0e25238" class="calibre5">const samurai = new Set("Toyotomi", "Takeda", "Akiyama", "Akiyama");
assert(samurai.size === 4, "There are four samurai in the set");

samurai.add("Akiyama");
assert(samurai.size === 5, "There are five samurai in the set");

assert(samurai.has("Toyotomi", "Toyotomi is in!");
assert(samurai.has("Hattori", "Hattori is in!");</pre>
            <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_35"></div>
<h2 id="ch10" class="part">Chapter 10. <a id="ch10__title" class="calibre3"></a>Wrangling regular expressions
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">A refresher on regular expressions
            
         </li>
         
         <li class="calibre20">Compiling regular expressions
            
         </li>
         
         <li class="calibre20">Capturing with regular expressions
            
         </li>
         
         <li class="calibre20">Working with frequently encountered idioms
            
         </li>
         
      </ul>
      
      <p class="noind">Regular expressions are a necessity of modern development. There, we said it. Although many a web developer could go through
         life happily ignoring regular expressions, some problems that need to be solved in JavaScript code can’t be addressed elegantly
         without regular expressions.
      </p>
      
      <p class="noind">Sure, there may be other ways to solve the same problems. But frequently, something that might take a half-screen of code
         can be distilled down to a single statement with the proper use of regular expressions. All JavaScript ninjas need regular
         expressions as an essential part of their toolkits.
      </p>
      
      <p class="noind">Regular expressions trivialize the process of tearing apart strings and looking for information. Everywhere you look in mainstream
         JavaScript libraries, you’ll see the prevalent use of regular expressions for various spot tasks:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Manipulating strings of HTML nodes
            
         </li>
         
         <li class="calibre20">Locating partial selectors within a CSS selector expression
            
         </li>
         
         <li class="calibre20">Determining whether an element has a specific class name
            
         </li>
         
         <li class="calibre20"><a id="iddle1934" class="calibre4"></a><a id="iddle1947" class="calibre4"></a>Input validation
            
         </li>
         
         <li class="calibre20">And more
            
         </li>
         
      </ul>
      
      <p class="noind">Let’s start by looking at an example.</p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch10note01" class="notetitle">Tip</h5>
      
      
      <p class="noindclose">Becoming fluent in regular expressions requires a lot of practice. You might find a site such as JS Bin (<a href="http://jsbin.com" class="calibre4">http://jsbin.com</a>) handy for playing around with examples. A couple of sites are dedicated to regular expression testing, such as the Regular
         Expression Test Page for JavaScript (<a href="http://www.regexplanet.com/advanced/javascript/index.html" class="calibre4">www.regexplanet.com/advanced/javascript/index.html</a>) and regex101 (<a href="http://www.regex101.com/#javascript" class="calibre4">www.regex101.com/#javascript</a>). regex101 is an especially useful site for beginners, because it also automatically generates explanations for the targeted
         regular expression.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <h3 class="calibre24"><a id="ch10qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">When would you prefer to use a RegExp literal over a RegExp object?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">What is sticky matching, and how do you enable it?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">How does matching differ when using a global versus a non-global regular expression?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch10lev1sec1" class="calibre24"><a id="ch10lev1sec1__title" class="calibre3"></a>10.1. Why regular expressions rock
      </h3>
      
      <p class="noind">Let’s say we want to validate that a string, perhaps entered into a form by a website user, follows the format for a nine-digit
         U.S. postal code. We all know that the U.S. Postal Service has little sense of humor and insists that a postal code (also
         known as a ZIP code) follows this specific format:
      </p>
      
      <pre id="PLd0e25391" class="calibre5">99999-9999</pre>
      
      <p class="noind">Each <kbd class="calibre15">9</kbd> represents a decimal digit, and the format is 5 decimal digits, followed by a hyphen, followed by 4 decimal digits. If you
         use any other format, your package or letter gets diverted into the black hole of the hand-sorting department, and good luck
         predicting how long it will take to emerge again.
      </p>
      
      <p class="noind">Let’s create a function that, given a string, verifies that the U.S. Postal Service will stay happy. We could resort to performing
         a comparison on each character, but we’re a ninja and that’s too inelegant a solution, resulting in a lot of needless repetition.
         Rather, consider the following solution.
      </p>
      
      
      
      <h5 id="ch10ex01" class="notetitle">Listing 10.1. <a id="ch10ex01__title" class="calibre4"></a>Testing for a specific pattern in a string
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/260fig01_alt.jpg" alt="" class="calibre2" width="590" height="301" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/260fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1496" class="calibre4"></a><a id="iddle1514" class="calibre4"></a><a id="iddle1626" class="calibre4"></a><a id="iddle1712" class="calibre4"></a><a id="iddle1724" class="calibre4"></a><a id="iddle1858" class="calibre4"></a>This code takes advantage of the fact that we have only two checks to make, depending on the position of the character within
         the string. We still need to perform up to nine comparisons at runtime, but we have to write each comparison only once.
      </p>
      
      <p class="noind">Even so, would anyone consider this solution <i class="calibre6">elegant</i>? It’s more elegant than the brute-force, noniterative approach, but it still seems like an awful lot of code for such a simple
         check. Now consider this approach:
      </p>
      
      <pre id="PLd0e25462" class="calibre5">function isThisAZipCode(candidate) {
  return /^\d{5}-\d{4}$/.test(candidate);
}</pre>
      
      <p class="noind">Except for some esoteric syntax in the body of the function, that’s a lot more succinct and elegant, no? That’s the power
         of regular expressions, and it’s just the tip of the iceberg. Don’t worry if that syntax looks like someone’s pet iguana walked
         across the keyboard; we’re about to recap regular expressions before you learn how to use them in ninja-like fashion on your
         pages.
      </p>
      
      
      
      <h3 id="ch10lev1sec2" class="calibre24"><a id="ch10lev1sec2__title" class="calibre3"></a>10.2. A regular expression refresher
      </h3>
      
      <p class="noind">Much as we’d like to, we can’t offer you an exhaustive tutorial on regular expressions in the space we have. After all, entire
         books have been dedicated to regular expressions. But we’ll do our best to hit all the important points.
      </p>
      
      <p class="noind">For more detail than we can offer in this chapter, the books <i class="calibre6">Mastering Regular Expressions</i> by Jeffrey E. F. Friedl, <i class="calibre6">Introducing Regular Expressions</i> by Michael Fitzgerald, and <i class="calibre6">Regular Expressions Cookbook</i> by Jan Goyvaerts and Steven Levithan, all from O’Reilly, are popular choices.
      </p>
      
      <p class="noind">Let’s dig in.</p>
      
      
      <h4 id="ch10lev2sec1" class="calibre26">10.2.1. <a id="ch10lev2sec1__title" class="calibre4"></a>Regular expressions explained
      </h4>
      
      <p class="noind">The term <i class="calibre6">regular expression</i> stems from mid-century mathematics, when a mathematician named Stephen Kleene described models of computational automata
         as “regular sets.” But that won’t help us understand anything about regular expressions, so let’s simplify things and say
         that a regular expression is a way to express a <i class="calibre6">pattern</i> for matching strings of text. The expression itself consists of terms and <a id="iddle1011" class="calibre4"></a><a id="iddle1374" class="calibre4"></a><a id="iddle1585" class="calibre4"></a><a id="iddle1646" class="calibre4"></a><a id="iddle1737" class="calibre4"></a><a id="iddle1857" class="calibre4"></a><a id="iddle1931" class="calibre4"></a><a id="iddle2111" class="calibre4"></a><a id="iddle2146" class="calibre4"></a><a id="iddle2207" class="calibre4"></a>operators that allow us to define these patterns. We’ll see what those terms and operators consist of shortly.
      </p>
      
      <p class="noind">In JavaScript, as with most other object types, we have two ways to create a regular expression:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Via a regular expression literal
            
         </li>
         
         <li class="calibre20">By constructing an instance of a <kbd class="calibre15">RegExp</kbd> object
            
         </li>
         
      </ul>
      
      <p class="noind">For example, if we want to create a mundane regular expression (or <i class="calibre6">regex</i>, for short) that matches the string <kbd class="calibre15">test</kbd> exactly, we could do so with a regex literal:
      </p>
      
      <pre id="PLd0e25590" class="calibre5">const pattern = /test/;</pre>
      
      <p class="noind">That might look strange, but regex literals are delimited with forward slashes in the same way that string literals are delimited
         with quote characters.
      </p>
      
      <p class="noind">Alternatively, we could construct a <kbd class="calibre15">RegExp</kbd> instance, passing the regex as a string:
      </p>
      
      <pre id="PLd0e25605" class="calibre5">const pattern = new RegExp("test");</pre>
      
      <p class="noind">Both formats result in the same regex being created in the variable <kbd class="calibre15">pattern</kbd>.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch10note02" class="notetitle">Tip</h5>
      
      
      <p class="noindclose">The literal syntax is preferred when the regex is known at development time, and the constructor approach is used when the
         regex is constructed at runtime by building it up dynamically in a string.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">One of the reasons that the literal syntax is preferred over expressing regexes in a string is that (as you’ll soon see) the
         backslash character plays an important part in regular expressions. But the backslash character is <i class="calibre6">also</i> the escape character for string literals, so to express a backslash within a string literal, we need to use a double backslash
         (<kbd class="calibre15">\\</kbd>). This can make regular expressions, which already possess a cryptic syntax, even more odd-looking when expressed within
         strings.
      </p>
      
      <p class="noind">In addition to the expression itself, five flags can be associated with a regex:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><kbd class="calibre15">i</kbd>—Makes the regex case-insensitive, so <kbd class="calibre15">/test/i</kbd> matches not only <i class="calibre6">test</i>, but also <i class="calibre6">Test</i>, <i class="calibre6">TEST</i>, <i class="calibre6">tEsT</i>, and so on.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">g</kbd>—Matches all instances of the pattern, as opposed to the default of <i class="calibre6">local</i>, which matches only the first occurrence. More on this later.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">m</kbd>—Allows matches across multiple lines, as might be obtained from the value of a <kbd class="calibre15">textarea</kbd> element.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">y</kbd>—Enables sticky matching. A regular expression performs sticky matching in the target string by attempting to match from the
            last match position.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">u</kbd>—Enables the use of Unicode point escapes (<kbd class="calibre15">\u{...}</kbd>).
            
         </li>
         
      </ul>
      
      <p class="noind">These flags are appended to the end of the literal (for example, <kbd class="calibre15">/test/ig</kbd>) or passed in a string as the second parameter to the <kbd class="calibre15">RegExp</kbd> constructor (<kbd class="calibre15">new RegExp("test", "ig")</kbd>).
      </p>
      
      <p class="noind"><a id="iddle1002" class="calibre4"></a><a id="iddle1005" class="calibre4"></a><a id="iddle1023" class="calibre4"></a><a id="iddle1162" class="calibre4"></a><a id="iddle1171" class="calibre4"></a><a id="iddle1863" class="calibre4"></a><a id="iddle1941" class="calibre4"></a><a id="iddle1955" class="calibre4"></a><a id="iddle1956" class="calibre4"></a><a id="iddle1958" class="calibre4"></a><a id="iddle2012" class="calibre4"></a><a id="iddle2054" class="calibre4"></a>Matching the exact string <i class="calibre6">test</i> (even in a case-insensitive manner) isn’t interesting—after all, we can do that particular check with a simple string comparison.
         So let’s take a look at the terms and operators that give regular expressions their immense power to match more compelling
         patterns.
      </p>
      
      
      
      <h4 id="ch10lev2sec2" class="calibre26">10.2.2. <a id="ch10lev2sec2__title" class="calibre4"></a>Terms and operators
      </h4>
      
      <p class="noind">Regular expressions, like most other expressions we’re familiar with, are made up of terms and operators that qualify those
         terms. In the sections that follow, you’ll see how these terms and operators can be used to express patterns.
      </p>
      
      
      <h5 id="ch10lev3sec1" class="notetitle"><a id="ch10lev3sec1__title" class="calibre4"></a>Exact matching
      </h5>
      
      <p class="noind">Any character that’s not a special character or operator (which we’ll introduce as we go along) must appear literally in the
         expression. For example, in our <kbd class="calibre15">/test/</kbd> regex, four terms represent characters that must appear literally in a string for it to match the expressed pattern.
      </p>
      
      <p class="noind">Placing such characters one after the other implicitly denotes an operation that means <i class="calibre6">followed by</i>. So <kbd class="calibre15">/test/</kbd> means <i class="calibre6">t</i> followed by <i class="calibre6">e</i> followed by <i class="calibre6">s</i> followed by <i class="calibre6">t</i>.
      </p>
      
      
      
      <h5 id="ch10lev3sec2" class="notetitle"><a id="ch10lev3sec2__title" class="calibre4"></a>Matching from a class of characters
      </h5>
      
      <p class="noind">Many times, we won’t want to match a specific literal character, but a character from a finite set of characters. We can specify
         this with the set operator (also called the <i class="calibre6">character class</i> operator) by placing the set of characters that we want to match in square brackets: <kbd class="calibre15">[abc]</kbd>.
      </p>
      
      <p class="noind">The preceding example signifies that we want to match any of the characters <kbd class="calibre15">a</kbd>, <kbd class="calibre15">b</kbd>, or <kbd class="calibre15">c</kbd>. Note that even though this expression spans five characters (three letters and two brackets), it matches only a single character
         in the candidate string.
      </p>
      
      <p class="noind">Other times, we want to match anything <i class="calibre6">but</i> a finite set of characters. We can specify this by placing a caret character (<kbd class="calibre15">^</kbd>) right after the opening bracket of the set operator:
      </p>
      
      <pre id="PLd0e25876" class="calibre5">[^abc]</pre>
      
      <p class="noind">This changes the meaning to any character <i class="calibre6">but</i> <kbd class="calibre15">a</kbd>, <kbd class="calibre15">b</kbd>, or <kbd class="calibre15">c</kbd>.
      </p>
      
      <p class="noind">There’s one more invaluable variation to the set operation: the ability to specify a range of values. For example, if we want
         to match any one of the lowercase characters between <i class="calibre6">a</i> and <i class="calibre6">m</i>, we could write <kbd class="calibre15">[abcdefghijklm]</kbd>. But we can express that much more succinctly as follows:
      </p>
      
      <pre id="PLd0e25909" class="calibre5">[a-m]</pre>
      
      <p class="noind">The dash indicates that all characters from <kbd class="calibre15">a</kbd> through <kbd class="calibre15">m</kbd> inclusive (and lexicographically) are included in the set.
      </p>
      
      
      
      <h5 id="ch10lev3sec3" class="notetitle"><a id="ch10lev3sec3__title" class="calibre4"></a>Escaping
      </h5>
      
      <p class="noind">Not all characters represent their literal equivalent. Certainly all of the alphabetic and decimal digit characters represent
         themselves, but as you’ll see, special characters such as <kbd class="calibre15">$</kbd> and the period (.) represent either matches to something other than themselves, <a id="iddle1009" class="calibre4"></a><a id="iddle1012" class="calibre4"></a><a id="iddle1116" class="calibre4"></a><a id="iddle1345" class="calibre4"></a><a id="iddle1375" class="calibre4"></a><a id="iddle1943" class="calibre4"></a><a id="iddle1954" class="calibre4"></a><a id="iddle1960" class="calibre4"></a><a id="iddle1967" class="calibre4"></a>or operators that qualify the preceding term. In fact, you’ve already seen how the <kbd class="calibre15">[</kbd>, <kbd class="calibre15">]</kbd>, -, and <kbd class="calibre15">^</kbd> characters are used to represent something other than their literal selves.
      </p>
      
      <p class="noind">How do we specify that we want to match a literal <kbd class="calibre15">[</kbd> or <kbd class="calibre15">$</kbd> or <kbd class="calibre15">^</kbd> or other special character? Within a regex, the backslash character escapes whatever character follows it, making it a literal
         match term. So <kbd class="calibre15">\[</kbd> specifies a literal match to the <kbd class="calibre15">[</kbd> character, rather than the opening of a character class expression. A double backslash (<kbd class="calibre15">\\</kbd>) matches a single backslash.
      </p>
      
      
      
      <h5 id="ch10lev3sec4" class="notetitle"><a id="ch10lev3sec4__title" class="calibre4"></a>Begins and ends
      </h5>
      
      <p class="noind">Frequently, we may want to ensure that a pattern matches at the beginning of a string, or perhaps at the end of a string.
         The caret character, when used as the first character of the regex, anchors the match at the beginning of the string, such
         that <kbd class="calibre15">/^test/</kbd> matches only if the substring <kbd class="calibre15">test</kbd> appears at the beginning of the string being matched. (Note that this is an overload of the <kbd class="calibre15">^</kbd> character, because it’s also used to negate a character class set.)
      </p>
      
      <p class="noind">Similarly, the dollar sign (<kbd class="calibre15">$</kbd>) signifies that the pattern must appear at the end of the string:
      </p>
      
      <pre id="PLd0e26052" class="calibre5">/test$/</pre>
      
      <p class="noind">Using both <kbd class="calibre15">^</kbd> and <kbd class="calibre15">$</kbd> indicates that the specified pattern must encompass the entire candidate string:
      </p>
      
      <pre id="PLd0e26067" class="calibre5">/^test$/</pre>
      
      
      
      <h5 id="ch10lev3sec5" class="notetitle"><a id="ch10lev3sec5__title" class="calibre4"></a>Repeated occurrences
      </h5>
      
      <p class="noind">If we want to match a series of four <kbd class="calibre15">a</kbd> characters, we might express that with <kbd class="calibre15">/aaaa/</kbd>, but what if we want to match <i class="calibre6">any</i> number of the same character? Regular expressions enable us to specify several repetition options:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">To specify that a character is optional (it can appear either once or not at all), follow it with <kbd class="calibre15">?</kbd>. For example, /<kbd class="calibre15">t?est/</kbd> matches both <i class="calibre6">test</i> and <i class="calibre6">est</i>.
            
         </li>
         
         <li class="calibre20">To specify that a character should appear one or many times, use <kbd class="calibre15">+</kbd>, as in <kbd class="calibre15">/t+est/</kbd>, which matches <i class="calibre6">test</i>, <i class="calibre6">ttest</i>, and <i class="calibre6">tttest</i>, but not <i class="calibre6">est</i>.
            
         </li>
         
         <li class="calibre20">To specify that the character appears <i class="calibre6">zero, one,</i> or <i class="calibre6">many</i> times, use <kbd class="calibre15">*</kbd>, as in <kbd class="calibre15">/t*est/</kbd>, which matches <i class="calibre6">test</i>, <i class="calibre6">ttest</i>, <i class="calibre6">tttest</i>, <i class="calibre6">and est</i>.
            
         </li>
         
         <li class="calibre20">To specify a fixed number of repetitions, indicate the number of allowed repetitions between braces. For example, <kbd class="calibre15">/a{4}/</kbd> indicates a match on four consecutive <kbd class="calibre15">a</kbd> characters.
            
         </li>
         
         <li class="calibre20">To specify a range for the repetition count, indicate the range with a comma separator. For example, <kbd class="calibre15">/a{4,10}/</kbd> matches any string of 4 through 10 consecutive <kbd class="calibre15">a</kbd> characters.
            
         </li>
         
         <li class="calibre20">To specify an open-ended range, omit the second value in the range (but leave the comma). The regex <kbd class="calibre15">/a{4,}/</kbd> matches any string of four or more consecutive <kbd class="calibre15">a</kbd> characters.
            
         </li>
         
      </ul>
      
      <p class="noind"><a id="iddle1004" class="calibre4"></a><a id="iddle1629" class="calibre4"></a><a id="iddle1805" class="calibre4"></a><a id="iddle1874" class="calibre4"></a><a id="iddle1959" class="calibre4"></a>Any of these repetition operators can be <i class="calibre6">greedy</i> or <i class="calibre6">nongreedy</i>. By default, they’re greedy: They will consume all the possible characters that make up a match. Annotating the operator
         with a <kbd class="calibre15">?</kbd> character (an overload of the <kbd class="calibre15">?</kbd> operator), as in <kbd class="calibre15">a+?</kbd>, makes the operation nongreedy: It will consume <i class="calibre6">only</i> enough characters to make a match.
      </p>
      
      <p class="noind">For example, if we’re matching against the string <kbd class="calibre15">aaa</kbd>, the regular expression <kbd class="calibre15">/a+/</kbd> would match all three <kbd class="calibre15">a</kbd> characters, whereas the nongreedy expression <kbd class="calibre15">/a+?/</kbd> would match only one <kbd class="calibre15">a</kbd> character, because a single <kbd class="calibre15">a</kbd> character is all that’s needed to satisfy the <kbd class="calibre15">a+</kbd> term.
      </p>
      
      
      
      <h5 id="ch10lev3sec6" class="notetitle"><a id="ch10lev3sec6__title" class="calibre4"></a>Predefined character classes
      </h5>
      
      <p class="noind">Some characters that we might want to match are impossible to specify with literal characters (for example, control characters
         such as a carriage return). In addition, often we might want to match character classes, such as a set of decimal digits,
         or a set of whitespace characters. The regular expression syntax provides predefined terms that represent these characters
         or commonly used classes so that we can use control-character matching in our regular expressions and don’t need to resort
         to the character class operator for commonly used sets of characters.
      </p>
      
      <p class="noind"><a href="#ch10table01" class="calibre4">Table 10.1</a> lists these terms and the character or set they represent. These predefined sets help keep our regular expressions from looking
         excessively cryptic.
      </p>
      
      <h5 id="ch10table01" class="notetitle">Table 10.1. <a id="ch10table01__title" class="calibre4"></a>Predefined character classes and character terms
      </h5>
      <table cellpadding="8" width="100%" frame="hsides" cellspacing="5" rules="groups" class="calibre29">
         <colgroup span="2" class="calibre8">
            <col width="150" class="calibre9">
            <col width="450" class="calibre9">
         </colgroup>
         <thead class="calibre30">
            <tr class="calibre11">
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Predefined term</p>
               </th>
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Matches</p>
               </th>
            </tr>
         </thead>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\t</td>
               <td class="docTableCell" valign="top">Horizontal tab</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\b</td>
               <td class="docTableCell" valign="top">Backspace</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\v</td>
               <td class="docTableCell" valign="top">Vertical tab</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\f</td>
               <td class="docTableCell" valign="top">Form feed</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\r</td>
               <td class="docTableCell" valign="top">Carriage return</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\n</td>
               <td class="docTableCell" valign="top">Newline</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\cA : \cZ</td>
               <td class="docTableCell" valign="top">Control characters</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\u0000 : \uFFFF</td>
               <td class="docTableCell" valign="top">Unicode hexadecimal</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\x00 : \xFF</td>
               <td class="docTableCell" valign="top">ASCII hexadecimal</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">.</td>
               <td class="docTableCell" valign="top">Any character, except for whitespace characters (\s)</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\d</td>
               <td class="docTableCell" valign="top">Any decimal digit; equivalent to [0-9]</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\D</td>
               <td class="docTableCell" valign="top">Any character but a decimal digit; equivalent to [^0-9]</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\w</td>
               <td class="docTableCell" valign="top">Any alphanumeric character including underscore; equivalent to [A-Za-z0-9_]</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\W</td>
               <td class="docTableCell" valign="top">Any character but alphanumeric and underscore characters; equivalent to [^A-Za-z0-9_]</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top"><a id="iddle1010" class="calibre4"></a><a id="iddle1015" class="calibre4"></a><a id="iddle1021" class="calibre4"></a><a id="iddle1159" class="calibre4"></a><a id="iddle1865" class="calibre4"></a><a id="iddle1952" class="calibre4"></a><a id="iddle1953" class="calibre4"></a><a id="iddle1957" class="calibre4"></a><a id="iddle2041" class="calibre4"></a><a id="iddle2193" class="calibre4"></a>\s
               </td>
               <td class="docTableCell" valign="top">Any whitespace character (space, tab, form feed, and so on)</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\S</td>
               <td class="docTableCell" valign="top">Any character but a whitespace character</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\b</td>
               <td class="docTableCell" valign="top">A word boundary</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">\B</td>
               <td class="docTableCell" valign="top">Not a word boundary (inside a word)</td>
            </tr>
         </tbody>
      </table>
      
      
      
      <h5 id="ch10lev3sec7" class="notetitle"><a id="ch10lev3sec7__title" class="calibre4"></a>Grouping
      </h5>
      
      <p class="noind">So far, you’ve seen that operators (such as <kbd class="calibre15">+</kbd> and <kbd class="calibre15">*</kbd>) affect only the preceding term. If we want to apply the operator to a group of terms, we can use parentheses for groups,
         just as in a mathematical expression. For example, <kbd class="calibre15">/(ab)+/</kbd> matches one or more consecutive occurrences of the substring <kbd class="calibre15">ab</kbd>.
      </p>
      
      <p class="noind">When a part of a regex is grouped with parentheses, it serves double duty, also creating what’s known as a <i class="calibre6">capture</i>. There’s a lot to captures, and we discuss them in more depth in <a href="#ch10lev1sec4" class="calibre4">section 10.4</a>.
      </p>
      
      
      
      <h5 id="ch10lev3sec8" class="notetitle"><a id="ch10lev3sec8__title" class="calibre4"></a>Alternation (or)
      </h5>
      
      <p class="noind">Alternatives can be expressed using the pipe (<kbd class="calibre15">|</kbd>) character. For example: <kbd class="calibre15">/a|b/</kbd> matches either the <kbd class="calibre15">a</kbd> or <kbd class="calibre15">b</kbd> character, and <kbd class="calibre15">/(ab)+|(cd)+/</kbd> matches one or more occurrences of either <kbd class="calibre15">ab</kbd> or <kbd class="calibre15">cd</kbd>.
      </p>
      
      
      
      <h5 id="ch10lev3sec9" class="notetitle"><a id="ch10lev3sec9__title" class="calibre4"></a>Backreferences
      </h5>
      
      <p class="noind">The most complex terms we can express in regular expressions are backreferences to <i class="calibre6">captures</i> defined in the regex. We address captures at length in <a href="#ch10lev1sec4" class="calibre4">section 10.4</a>, but for now just think of them as the portions of a candidate string that are successfully matched against terms in the
         regular expression. The notation for such a term is the backslash followed by the number of the capture to be referenced,
         beginning with 1, such as <kbd class="calibre15">\1</kbd>, <kbd class="calibre15">\2</kbd>, and so on.
      </p>
      
      <p class="noind">An example is <kbd class="calibre15">/^([dtn])a\1/</kbd>, which matches a string that starts with any of the <kbd class="calibre15">d</kbd>, <kbd class="calibre15">t</kbd>, or <kbd class="calibre15">n</kbd> characters, followed by an <kbd class="calibre15">a</kbd>, followed by whatever character matches the first capture. This latter point is important! This isn’t the same as <kbd class="calibre15">/[dtn] a[dtn]/</kbd>. The character following the <kbd class="calibre15">a</kbd> can’t be any of <kbd class="calibre15">d</kbd>, or <kbd class="calibre15">t</kbd>, or <kbd class="calibre15">n</kbd>, but must be whichever one of those triggers the match for the first character. As such, which character the <kbd class="calibre15">\1</kbd> will match can’t be known until evaluation time.
      </p>
      
      <p class="noind">A good example of where this might be useful is in matching XML-type markup elements. Consider the following regex:</p>
      
      <pre id="PLd0e26734" class="calibre5">/&lt;(\w+)&gt;(.+)&lt;\/\1&gt;/</pre>
      
      <p class="noind">This allows us to match simple elements such as <kbd class="calibre15">&lt;strong&gt;</kbd>whatever<kbd class="calibre15">&lt;/strong&gt;</kbd>. Without the ability to specify a backreference, this wouldn’t be possible, because we’d have no way to know what closing
         tag would match the opening tag ahead of time.
      </p>
      
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch10note03" class="notetitle">Tip</h5>
      
      
      <p class="noindclose"><a id="iddle1439" class="calibre4"></a><a id="iddle1942" class="calibre4"></a>That was kind of a whirlwind crash course on regular expressions. If they’re still making you pull your hair out and you find
         yourself bogged down in the material that follows, we strongly recommend using one of the resources mentioned earlier in this
         chapter.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Now that you have a handle on regular expressions, you’re ready to look at how to use them wisely in your code.</p>
      
      
      
      
      
      <h3 id="ch10lev1sec3" class="calibre24"><a id="ch10lev1sec3__title" class="calibre3"></a>10.3. Compiling regular expressions
      </h3>
      
      <p class="noind">Regular expressions go through multiple phases of processing, and understanding what happens during each phase can help us
         optimize JavaScript code that uses regular expressions. The two main phases are compilation and execution.
      </p>
      
      <p class="noind"><i class="calibre6">Compilation</i> occurs when the regular expression is first created. <i class="calibre6">Execution</i> occurs when we use the compiled regular expression to match patterns in a string.
      </p>
      
      <p class="noind">During compilation, the expression is parsed by the JavaScript engine and converted into its internal representation (whatever
         that may be). This phase of parsing and conversion must occur every time a regular expression is created (discounting any
         internal optimizations performed by the browser).
      </p>
      
      <p class="noind">Frequently, browsers <i class="calibre6">are</i> smart enough to determine when identical regular expressions are being used, and to cache the compilation results for that
         particular expression. But we can’t count on this being the case in all browsers. For complex expressions, in particular,
         we can begin to get some noticeable speed improvements by predefining (and thus precompiling) our regular expressions for
         later use.
      </p>
      
      <p class="noind">As we learned in our regular expression overview in the previous section, there are two ways of creating a compiled regular
         expression in JavaScript: via a literal and via a constructor. Let’s look at an example in the following listing.
      </p>
      
      
      
      <h5 id="ch10ex02" class="notetitle">Listing 10.2. <a id="ch10ex02__title" class="calibre4"></a>Two ways to create a compiled regular expression
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/267fig01_alt.jpg" alt="" class="calibre2" width="590" height="143" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/267fig01_alt.jpg"></p>
      
      
      <p class="noind">In this example, both regular expressions are in their compiled state after creation. If we were to replace every reference
         to <kbd class="calibre15">re1</kbd> with the literal <kbd class="calibre15">/test/i</kbd>, it’s possible that the same regex would be compiled time and time again, so compiling a regex <i class="calibre6">once</i> and storing it in a variable for later reference can be an important optimization.
      </p>
      
      <p class="noind">Note that each regex has a unique object representation: Every time a regular expression is created (and thus compiled), a
         new regular expression object is created. <a id="iddle1332" class="calibre4"></a><a id="iddle1615" class="calibre4"></a><a id="iddle2052" class="calibre4"></a>This is unlike other primitive types (such as string, number, and so on), because the result will always be unique.
      </p>
      
      <p class="noind">Of particular importance is the use of the constructor (<kbd class="calibre15">new RegExp(...)</kbd>) to create a regular expression. This technique allows us to build and compile an expression from a string that we can dynamically
         create at runtime. This can be immensely useful for constructing complex expressions that will be heavily reused.
      </p>
      
      <p class="noind">For example, let’s say that we want to determine which elements within a document have a particular class name, whose value
         we won’t know until runtime. Because elements are capable of having multiple class names associated with them (inconveniently
         stored in a space-delimited string), this serves as an interesting example of runtime, regular-expression compilation (see
         the following listing).
      </p>
      
      <h5 id="ch10ex03" class="notetitle">Listing 10.3. <a id="ch10ex03__title" class="calibre4"></a>Compiling a runtime regular expression for later use
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch10ex03-0.jpg" alt="" class="calibre2" width="590" height="230" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch10ex03-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch10ex03-1.jpg" alt="" class="calibre2" width="590" height="113" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch10ex03-1.jpg"></p>
      
      <p class="noind">We can learn several interesting things from <a href="#ch10ex03" class="calibre4">listing 10.3</a>. To start, we set up a number of test-subject <kbd class="calibre15">&lt;div&gt;</kbd> and <kbd class="calibre15">&lt;span&gt;</kbd> elements with various combinations of class names. Then we define our class-name checking function, which accepts as parameters
         the class name for which we’ll check and the element type to check within.
      </p>
      
      <p class="noind">Then we collect all the elements of the specified type by using the <kbd class="calibre15">getElementsByTagName</kbd> built-in method and set up our regular expression:
      </p>
      
      <pre id="PLd0e26889" class="calibre5">const regex = new RegExp("(^|\\s)" + className + "(\\s|$)");</pre>
      
      <p class="noind"><a id="iddle1013" class="calibre4"></a><a id="iddle1182" class="calibre4"></a><a id="iddle1377" class="calibre4"></a><a id="iddle1383" class="calibre4"></a><a id="iddle1751" class="calibre4"></a><a id="iddle1872" class="calibre4"></a><a id="iddle1873" class="calibre4"></a><a id="iddle1932" class="calibre4"></a><a id="iddle1935" class="calibre4"></a><a id="iddle1938" class="calibre4"></a><a id="iddle2101" class="calibre4"></a><a id="iddle2130" class="calibre4"></a><a id="iddle2194" class="calibre4"></a>Note the use of the <kbd class="calibre15">new RegExp()</kbd> constructor to compile a regular expression based on the class name passed to the function. This is an instance where we
         can’t use a regex literal, as the class name for which we’ll search isn’t known in advance.
      </p>
      
      <p class="noind">We construct (and hence, compile) this expression once in order to avoid frequent and unnecessary recompilation. Because the
         contents of the expression are dynamic (based on the incoming <kbd class="calibre15">className</kbd> argument), we can realize major performance savings by handling the expression in this manner.
      </p>
      
      <p class="noind">The regex itself matches either the beginning of the string or a whitespace character, followed by the target class name,
         followed by either a whitespace character or the end of the string. Notice the use of a double-escape (<kbd class="calibre15">\\</kbd>) within the new regex: <kbd class="calibre15">\\s</kbd>. When creating literal regular expressions with terms including the backslash, we have to provide the backslash only once.
         But because we’re writing these backslashes within a string, we must double-escape them. This is a nuisance, to be sure, but
         one that we must be aware of when constructing regular expressions in strings rather than literals.
      </p>
      
      <p class="noind">After the regex is compiled, using it to collect the matching elements is a snap via the <kbd class="calibre15">test</kbd> method:
      </p>
      
      <pre id="PLd0e27000" class="calibre5">regex.test(elems[i].className)</pre>
      
      <p class="noind">Preconstructing and precompiling regular expressions so that they can be reused (executed) time and time again is a recommended
         technique that provides performance gains that can’t be ignored. Virtually all complex regular expression situations can benefit
         from the use of this technique.
      </p>
      
      <p class="noind">Earlier in this chapter, we mentioned that the use of parentheses in regular expressions not only serves to group terms for
         operator application, but also creates <i class="calibre6">captures</i>. Let’s find out more about that.
      </p>
      
      
      
      <h3 id="ch10lev1sec4" class="calibre24"><a id="ch10lev1sec4__title" class="calibre3"></a>10.4. Capturing matching segments
      </h3>
      
      <p class="noind">The height of usefulness with respect to regular expressions is realized when we <i class="calibre6">capture</i> the results that are found so that we can do something with them. Determining whether a string matches a pattern is an obvious
         first step and often all that we need, but determining <i class="calibre6">what</i> was matched is also useful in many situations.
      </p>
      
      
      <h4 id="ch10lev2sec3" class="calibre26">10.4.1. <a id="ch10lev2sec3__title" class="calibre4"></a>Performing simple captures
      </h4>
      
      <p class="noind">Say we want to extract a value that’s embedded in a complex string. A good example of such a string is the value of the CSS
         transform property, through which we can modify the visual position of an HTML element.
      </p>
      
      
      
      <h5 id="ch10ex04" class="notetitle">Listing 10.4. <a id="ch10ex04__title" class="calibre4"></a>A simple function for capturing an embedded value
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/269fig01_alt.jpg" alt="" class="calibre2" width="590" height="275" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/269fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1749" class="calibre4"></a>We define an element that specifies the style that will translate its position by 15 px:
      </p>
      
      <pre id="PLd0e27063" class="calibre5">"transform:translateY(15px);"</pre>
      
      <p class="noind">Unfortunately, the browser doesn’t offer an API for easily fetching the amount by which the element is translated. So we create
         our own function:
      </p>
      
      <pre id="PLd0e27072" class="calibre5">function getTranslateY(elem){
    const transformValue = elem.style.transform;
    if(transformValue){
      const match = transformValue.match(/translateY\(([^\)]+)\)/);
      return match ? match[1] : "";
    }
     return "";
   }</pre>
      
      <p class="noind">The transform parsing code may seem confusing at first:</p>
      
      <pre id="PLd0e27081" class="calibre5">const match = transformValue.match(/translateY\(([^\)]+)\)/);
return match ? match[1] : "";</pre>
      
      <p class="noind">But it’s not too bad when we break it down. To start, we need to determine whether a <kbd class="calibre15">transform</kbd> property even exists for us to parse. If not, we’ll return an empty string. If the <kbd class="calibre15">transform</kbd> property is resident, we can get down to the opacity value extraction. The <kbd class="calibre15">match</kbd> method of a regular expression returns an array of captured values if a match is found, or <kbd class="calibre15">null</kbd> if no match is found.
      </p>
      
      <p class="noind">The array returned by <kbd class="calibre15">match</kbd> includes the entire match in the first index, and then each subsequent capture following. So the zeroth entry would be the
         entire matched string of <kbd class="calibre15">translateY(15px)</kbd>, and the entry at the next position would be <kbd class="calibre15">15px</kbd>.
      </p>
      
      <p class="noind">Remember that the captures are defined by parentheses in the regular expression. Thus, when we match the transform value,
         the value is contained in the <kbd class="calibre15">[1]</kbd> position of the array, because the only capture we specified in our regex was created by the parentheses that we embedded
         after the <kbd class="calibre15">translateY</kbd> portion of the regex.
      </p>
      
      <p class="noind">This example uses a local regular expression and the <kbd class="calibre15">match</kbd> method. Things change when we use global expressions. Let’s see how.
      </p>
      
      
      
      
      <h4 id="ch10lev2sec4" class="calibre26">10.4.2. <a id="ch10lev2sec4__title" class="calibre4"></a>Matching using global expressions
      </h4>
      
      <p class="noind"><a id="iddle1436" class="calibre4"></a><a id="iddle1586" class="calibre4"></a><a id="iddle1936" class="calibre4"></a><a id="iddle2061" class="calibre4"></a>As we saw in the previous section, using a local regular expression (one without the global flag) with the <kbd class="calibre15">String</kbd> object’s <kbd class="calibre15">match</kbd> methods returns an array containing the entire matched string, along with any matched captures in the operation.
      </p>
      
      <p class="noind">But when we supply a global regular expression (one with the <kbd class="calibre15">g</kbd> flag included), <kbd class="calibre15">match</kbd> returns something different. It’s still an array of results, but in the case of a global regular expression, which matches
         all possibilities in the candidate string rather than just the first match, the array returned contains the global matches;
         captures <i class="calibre6">within</i> each match aren’t returned in this case.
      </p>
      
      <p class="noind">We can see this in action in the following code and tests.</p>
      
      
      
      <h5 id="ch10ex05" class="notetitle">Listing 10.5. <a id="ch10ex05__title" class="calibre4"></a>Differences between global and local searches with match
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/271fig01_alt.jpg" alt="" class="calibre2" width="590" height="221" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/271fig01_alt.jpg"></p>
      
      
      <p class="noind">We can see that when we do a local match, <kbd class="calibre15">html.match(/&lt;(\/?)(\w+)([^&gt;]*?)&gt;/)</kbd>, a single instance is matched and the captures within that match are also returned. But when we use a global match, <kbd class="calibre15">html.match(/&lt;(\/?)(\w+)([^&gt;]*?)&gt;/g)</kbd>, what’s returned is the list of matches.
      </p>
      
      <p class="noind">If captures are important to us, we can regain this functionality while still performing a global search by using the regular
         expression’s <kbd class="calibre15">exec</kbd> method. This method can be repeatedly called against a regular expression, causing it to return the next matched set of information
         every time it’s called. A typical pattern for use is shown in the following listing.
      </p>
      
      
      
      <h5 id="ch10ex06" class="notetitle">Listing 10.6. <a id="ch10ex06__title" class="calibre4"></a>Using the exec method to do both capturing and a global search
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/271fig02_alt.jpg" alt="" class="calibre2" width="590" height="153" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/271fig02_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1752" class="calibre4"></a><a id="iddle1930" class="calibre4"></a><a id="iddle1939" class="calibre4"></a><a id="iddle1940" class="calibre4"></a><a id="iddle1968" class="calibre4"></a>In this example, we repeatedly call the <kbd class="calibre15">exec</kbd> method:
      </p>
      
      <pre id="PLd0e27275" class="calibre5">while ((match = tag.exec(html)) !== null) {...}</pre>
      
      <p class="noind">This retains state from the previous invocation so that each subsequent call progresses to the next global match. Each call
         returns the next match <i class="calibre6">and</i> its captures.
      </p>
      
      <p class="noind">By using either <kbd class="calibre15">match</kbd> or <kbd class="calibre15">exec</kbd>, we can always find the exact matches (and captures) that we’re looking for. But we’ll need to dig further if we want to
         refer to the captures themselves within the regex.
      </p>
      
      
      
      <h4 id="ch10lev2sec5" class="calibre26">10.4.3. <a id="ch10lev2sec5__title" class="calibre4"></a>Referencing captures
      </h4>
      
      <p class="noind">We can refer to portions of a match that we’ve captured in two ways: one within the match itself, and one within a replacement
         string (where applicable). For example, let’s revisit the match in <a href="#ch10ex06" class="calibre4">listing 10.6</a> (in which we match an opening or closing HTML tag) and modify it in the following listing to also match the inner contents
         of the tag itself.
      </p>
      
      
      
      <h5 id="ch10ex07" class="notetitle">Listing 10.7. <a id="ch10ex07__title" class="calibre4"></a>Using backreferences to match the contents of an HTML tag
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/272fig01_alt.jpg" alt="" class="calibre2" width="590" height="265" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/272fig01_alt.jpg"></p>
      
      
      <p class="noind">We use <kbd class="calibre15">\1</kbd> to refer to the first capture within the expression, which in this case is the name of the tag. Using this information, we
         can match the appropriate closing tag, referring to whatever the capture matched. (This all assumes, of course, that there
         aren’t any embedded tags of the same name within the current tag, so this is hardly an exhaustive example of tag matching.)
      </p>
      
      <p class="noind">Additionally, we can get capture references within the replace string of a call to the <kbd class="calibre15">replace</kbd> method. Instead of using the backreference codes, as in <a href="#ch10ex07" class="calibre4">listing 10.7</a>, we use the syntax of <kbd class="calibre15"><ccc title="$1" class="ccc--converted" style="font-size: inherit; display: inline; color: inherit;">€0.84</ccc></kbd>, <kbd class="calibre15"><ccc title="$2" class="ccc--converted" style="font-size: inherit; display: inline; color: inherit;">€1.68</ccc></kbd>, <kbd class="calibre15"><ccc title="$3" class="ccc--converted" style="font-size: inherit; display: inline; color: inherit;">€2.53</ccc></kbd>, up through each capture number. Here’s an example:
      </p>
      
      <pre id="PLd0e27343" class="calibre5">assert("fontFamily".replace(/([A-Z])/g, "-$1").toLowerCase() ===
       "font-family", "Convert the camelCase into dashed notation.");</pre>
      
      <p class="noind"><a id="iddle1016" class="calibre4"></a><a id="iddle1750" class="calibre4"></a><a id="iddle1802" class="calibre4"></a><a id="iddle1855" class="calibre4"></a><a id="iddle1937" class="calibre4"></a>In this code, the value of the first capture (in this case, the capital letter <kbd class="calibre15">F</kbd>) is referenced in the <i class="calibre6">replace string</i> (via <kbd class="calibre15"><ccc title="$1" class="ccc--converted" style="font-size: inherit; display: inline; color: inherit;">€0.84</ccc></kbd>). This allows us to specify a replace string without even knowing what its value will be until matching time. That’s a powerful
         ninja-esque weapon to wield.
      </p>
      
      <p class="noind">The ability to reference regular-expression captures helps make a lot of code that would otherwise be difficult, quite easy.
         The expressive nature that it provides ends up allowing for some terse statements that could otherwise be rather obtuse, convoluted,
         and lengthy.
      </p>
      
      <p class="noind">Because both captures and expression grouping are specified using parentheses, there’s no way for the regular-expression processor
         to know which sets of parentheses we added to the regex for grouping and which were intended to indicate captures. It treats
         all sets of parentheses as both groups and captures, which can result in the capture of more information than we really intended,
         because we needed to specify some grouping in the regex. What can we do in such cases?
      </p>
      
      
      
      <h4 id="ch10lev2sec6" class="calibre26">10.4.4. <a id="ch10lev2sec6__title" class="calibre4"></a>Noncapturing groups
      </h4>
      
      <p class="noind">As we noted, parentheses serve a double duty: They not only group terms for operations, but also specify captures. This usually
         isn’t an issue, but in regular expressions in which lots of grouping is going on, it could cause lots of needless capturing,
         which may make sorting through the resulting captures tedious.
      </p>
      
      <p class="noind">Consider the following regex:</p>
      
      <pre id="PLd0e27414" class="calibre5">const pattern = /((ninja-)+)sword/;</pre>
      
      <p class="noind">Here, the intent is to create a regex that allows the prefix <kbd class="calibre15">ninja-</kbd> to appear one or more times before the word <kbd class="calibre15">sword</kbd>, and we want to capture the entire prefix. This regex requires two sets of parentheses:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The parentheses that define the capture (everything before the string <kbd class="calibre15">sword</kbd>)
            
         </li>
         
         <li class="calibre20">The parentheses that group the text <kbd class="calibre15">ninja-</kbd> for the <kbd class="calibre15">+</kbd> operator
            
         </li>
         
      </ul>
      
      <p class="noind">This all works fine, but it results in more than the single intended capture because of the inner set of grouping parentheses.</p>
      
      <p class="noind">To indicate that a set of parentheses shouldn’t result in a capture, the regular expression syntax lets us put the notation
         <kbd class="calibre15">?:</kbd> immediately after the opening parenthesis. This is known as a <i class="calibre6">passive subexpression</i>.
      </p>
      
      <p class="noind">Changing this regular expression to</p>
      
      <pre id="PLd0e27466" class="calibre5">const pattern = /((?:ninja-)+)sword/;</pre>
      
      <p class="noind">causes only the outer set of parentheses to create a capture. The inner parentheses have been converted to a passive subexpression.</p>
      
      <p class="noind">To test this, take a look at the following code.</p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch10ex08" class="notetitle">Listing 10.8. <a id="ch10ex08__title" class="calibre4"></a>Grouping without capturing
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/274fig01_alt.jpg" alt="" class="calibre2" width="590" height="95" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/274fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1948" class="calibre4"></a><a id="iddle1969" class="calibre4"></a><a id="iddle2062" class="calibre4"></a>Running these tests, we can see that the passive subexpression <kbd class="calibre15">/((?:ninja-)+)sword/</kbd> prevents unnecessary captures.
      </p>
      
      <p class="noind">Wherever possible in our regular expressions, we should strive to use noncapturing (passive) groups in place of capturing
         when the capture is unnecessary, so that the expression engine will have much less work to do in remembering and returning
         the captures. If we don’t need captured results, there’s no need to ask for them! The price that we pay is that already-complex
         regular expressions can become a tad more cryptic.
      </p>
      
      <p class="noind">Now let’s turn our attention to another way that regular expressions give us ninja powers: using functions with the <kbd class="calibre15">String</kbd> object’s <kbd class="calibre15">replace</kbd> method.
      </p>
      
      
      
      
      <h3 id="ch10lev1sec5" class="calibre24"><a id="ch10lev1sec5__title" class="calibre3"></a>10.5. Replacing using functions
      </h3>
      
      <p class="noind">The <kbd class="calibre15">replace</kbd> method of the <kbd class="calibre15">String</kbd> object is a powerful and versatile method, which we saw used briefly in our discussion of captures. When a regular expression
         is provided as the first parameter to <kbd class="calibre15">replace</kbd>, it will cause a replacement on a match (or <i class="calibre6">matches</i> if the regex is global) to the pattern rather than on a fixed string.
      </p>
      
      <p class="noind">For example, let’s say that we want to replace all uppercase characters in a string with <kbd class="calibre15">X</kbd>. We could write the following:
      </p>
      
      <pre id="PLd0e27556" class="calibre5">"ABCDEfg".replace(/[A-Z]/g,"X")</pre>
      
      <p class="noind">This results in a value of <kbd class="calibre15">XXXXXfg</kbd>. Nice.
      </p>
      
      <p class="noind">But perhaps the most powerful feature presented by <kbd class="calibre15">replace</kbd> is the ability to provide a function as the replacement value rather than a fixed string.
      </p>
      
      <p class="noind">When the replacement value (the second argument) is a function, it’s invoked for each match found (remember that a global
         search will match all instances of the pattern in the source string) with a variable list of parameters:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The full text of the match
            
         </li>
         
         <li class="calibre20">The captures of the match, one parameter for each
            
         </li>
         
         <li class="calibre20">The index of the match within the original string
            
         </li>
         
         <li class="calibre20">The source string
            
         </li>
         
      </ul>
      
      <p class="noind">The value returned from the function serves as the replacement value.</p>
      
      <p class="noind">This provides a tremendous amount of leeway to determine what the replacement string should be at runtime, with lots of information
         regarding the nature of the match at our fingertips. For example, in the following listing, we use the function to <a id="iddle1305" class="calibre4"></a><a id="iddle1437" class="calibre4"></a>provide a dynamic replacement value for converting a string with words separated by dashes to its camel-cased equivalent.
      </p>
      
      
      
      <h5 id="ch10ex09" class="notetitle">Listing 10.9. <a id="ch10ex09__title" class="calibre4"></a>Converting a dashed string to camel case
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/275fig01_alt.jpg" alt="" class="calibre2" width="590" height="76" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/275fig01_alt.jpg"></p>
      
      
      <p class="noind">Here, we provide a regex that matches any character preceded by a dash character. A capture in the global regex identifies
         the character that was matched (without the dash). Each time the function is called (twice in this example), it’s passed the
         full match string as the first argument, and the capture (only one for this regex) as the second argument. We aren’t interested
         in the rest of the arguments, so we didn’t specify them.
      </p>
      
      <p class="noind">The first time the function is called, it’s passed <kbd class="calibre15">-b</kbd> and <kbd class="calibre15">b;</kbd> and the second time it’s called, it’s passed <kbd class="calibre15">-w</kbd> and <kbd class="calibre15">w</kbd>. In each case, the captured letter is uppercased and returned as the replacement string. We end up with <kbd class="calibre15">-b</kbd> replaced by <kbd class="calibre15">B</kbd> and with <kbd class="calibre15">-w</kbd> replaced by <kbd class="calibre15">W</kbd>.
      </p>
      
      <p class="noind">Because a global regex will cause such a replace function to be executed for every match in a source string, this technique
         can even be extended beyond doing rote replacements. We can use the technique as a means of string traversal, instead of doing
         the <kbd class="calibre15">exec()</kbd>-in-a-while-loop technique that we saw earlier in this chapter.
      </p>
      
      <p class="noind">For example, let’s say that we’re looking to take a query string and convert it to an alternative format that suits our purposes.
         We’d turn a query string such as
      </p>
      
      <pre id="PLd0e27668" class="calibre5">foo=1&amp;foo=2&amp;blah=a&amp;blah=b&amp;foo=3</pre>
      
      <p class="noind">into one that looks like this</p>
      
      <pre id="PLd0e27677" class="calibre5">foo=1,2,3&amp;blah=a,b"</pre>
      
      <p class="noind">A solution using regular expressions and <kbd class="calibre15">replace</kbd> could result in some especially terse code, as shown in the next listing.
      </p>
      
      
      
      <h5 id="ch10ex10" class="notetitle">Listing 10.10. <a id="ch10ex10__title" class="calibre4"></a>A technique for compressing a query string
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/275fig02_alt.jpg" alt="" class="calibre2" width="590" height="378" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/275fig02_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1970" class="calibre4"></a><a id="iddle2063" class="calibre4"></a>The most interesting aspect of this example is its use of the string <kbd class="calibre15">replace</kbd> method as a means of traversing a string for values, rather than as a search-and-replace mechanism. The trick is twofold:
         passing in a function as the replacement value argument, and instead of returning a value, using it as a means of searching.
      </p>
      
      <p class="noind">The example code first declares a hash <kbd class="calibre15">key</kbd> in which we store the keys and values that we find in the source query string. Then we call the <kbd class="calibre15">replace</kbd> method on the source string, passing a regex that will match the key-value pairs, and capture the key and the value. We also
         pass a function that will be passed the full match, the key capture, and the value capture. These captured values get stored
         in the hash for later reference. Note that we return the empty string because we don’t care what substitutions happen to the
         source string—we’re just using the side effects rather than the result.
      </p>
      
      <p class="noind">After <kbd class="calibre15">replace</kbd> returns, we declare an array in which we’ll aggregate the results and iterate through the keys that we found, adding each
         to the array. Finally, we join each of the results we stored in the array by using <kbd class="calibre15">&amp;</kbd> as the delimiter, and we return the result:
      </p>
      
      <pre id="PLd0e27740" class="calibre5">const result = [];
for (let key in keys) {
  result.push(key + "=" + keys[key]);
}
return result.join("&amp;");</pre>
      
      <p class="noind">Using this technique, we can co-opt the <kbd class="calibre15">String</kbd> object’s <kbd class="calibre15">replace</kbd> method as our own string-searching mechanism. The result isn’t only fast, but also simple and effective. The level of power
         that this technique provides, especially in light of the small amount of code necessary, shouldn’t be underestimated.
      </p>
      
      <p class="noind">All of these regular expression techniques can have a huge impact on how we write script on our pages. Let’s see how to apply
         what you’ve learned to solve some common problems we might encounter.
      </p>
      
      
      
      <h3 id="ch10lev1sec6" class="calibre24"><a id="ch10lev1sec6__title" class="calibre3"></a>10.6. Solving common problems with regular expressions
      </h3>
      
      <p class="noind">In JavaScript, a few idioms tend to occur again and again, but their solutions aren’t always obvious. A knowledge of regular
         expressions can definitely come to the rescue, and in this section we’ll look at a few common problems that we can solve with
         a regex or two.
      </p>
      
      
      
      <h4 id="ch10lev2sec7" class="calibre26">10.6.1. <a id="ch10lev2sec7__title" class="calibre4"></a>Matching newlines
      </h4>
      
      <p class="noind"><a id="iddle1006" class="calibre4"></a><a id="iddle1794" class="calibre4"></a><a id="iddle1856" class="calibre4"></a><a id="iddle1864" class="calibre4"></a><a id="iddle1944" class="calibre4"></a><a id="iddle1945" class="calibre4"></a><a id="iddle1950" class="calibre4"></a><a id="iddle1951" class="calibre4"></a><a id="iddle2150" class="calibre4"></a><a id="iddle2195" class="calibre4"></a>When performing a search, it’s sometimes desirable for the period (<kbd class="calibre15">.</kbd>) term, which matches any character except for newline, to also include newline characters. Regular expression implementations
         in other languages frequently include a flag for making this possible, but JavaScript’s implementation doesn’t.
      </p>
      
      <p class="noind">Let’s look at a couple of ways of getting around this omission in JavaScript, as shown in the next listing.</p>
      
      
      
      <h5 id="ch10ex11" class="notetitle">Listing 10.11. <a id="ch10ex11__title" class="calibre4"></a>Matching <i class="calibre6">all</i> characters, including newlines
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/277fig01_alt.jpg" alt="" class="calibre2" width="590" height="168" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/277fig01_alt.jpg"></p>
      
      
      <p class="noind">This example defines a test subject string: <kbd class="calibre15">"&lt;b&gt;Hello&lt;/b&gt;\n&lt;i&gt;world!&lt;/i&gt;"</kbd>, containing a newline. Then we try various ways of matching all the characters in the string.
      </p>
      
      <p class="noind">In the first test, <kbd class="calibre15">/.*/.exec(html)[0] === "&lt;b&gt;Hello&lt;/b&gt;"</kbd>, we verify that newlines aren’t matched by the <kbd class="calibre15">.</kbd> operator. Ninjas won’t be denied, so in the next test we get our way with an alternative regex, <kbd class="calibre15">/[\S\s]*/</kbd>, in which we define a character class that matches anything that’s <i class="calibre6">not</i> a whitespace character and anything that <i class="calibre6">is</i> a whitespace character. This union is the set of all characters.
      </p>
      
      <p class="noind">Another approach is taken in the next test:</p>
      
      <pre id="PLd0e27899" class="calibre5">/[\S\s]*/.exec(html)[0] === "&lt;b&gt;Hello&lt;/b&gt;\n&lt;i&gt;world!&lt;/i&gt;"</pre>
      
      <p class="noind">Here we use an alternation regex, <kbd class="calibre15">/(?:.|\s)*/</kbd>, in which we match everything matched by <kbd class="calibre15">.</kbd>, which is everything but newline, and everything considered whitespace, which includes newline. The resulting union is the
         set of all characters including newlines. Note the use of a passive subexpression to prevent any unintended captures. Because
         of its simplicity (and implicit speed benefits), the solution provided by <kbd class="calibre15">/[\S\s]*/</kbd> is generally considered optimal.
      </p>
      
      <p class="noind">Next, let’s take a step to widen our view to a worldwide scope.</p>
      
      
      
      <h4 id="ch10lev2sec8" class="calibre26">10.6.2. <a id="ch10lev2sec8__title" class="calibre4"></a>Matching Unicode
      </h4>
      
      <p class="noind">Frequently in the use of regular expressions, we want to match alphanumeric characters, such as an ID selector in a CSS selector
         engine implementation. But assuming that the alphabetic characters will be from only the set of English ASCII characters is
         shortsighted.
      </p>
      
      <p class="noind"><a id="iddle1401" class="calibre4"></a><a id="iddle1653" class="calibre4"></a><a id="iddle1949" class="calibre4"></a>Expanding the set to include Unicode characters is sometimes desirable, explicitly supporting multiple languages not covered
         by the traditional alphanumeric character set (see the following listing).
      </p>
      
      
      
      <h5 id="ch10ex12" class="notetitle">Listing 10.12. <a id="ch10ex12__title" class="calibre4"></a>Matching Unicode characters
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/278fig01_alt.jpg" alt="" class="calibre2" width="590" height="54" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/278fig01_alt.jpg"></p>
      
      
      <p class="noind">This listing includes the entire range of Unicode characters in the match by creating a character class that includes the
         <kbd class="calibre15">\w</kbd> term, to match all the “normal” word characters, plus a range that spans the entire set of Unicode characters above U+0080.
         Starting at 128 gives us some high ASCII characters along with all Unicode characters in the Basic Multilingual Plane.
      </p>
      
      <p class="noind">The astute among you might note that by adding the entire range of Unicode characters above <kbd class="calibre15">\u0080</kbd>, we match not only alphabetic characters, but also all Unicode punctuation and other special characters (arrows, for example).
         But that’s okay, because the point of the example is to show how to match Unicode characters in general. If you have a specific
         range of characters that you want to match, you can use the lesson of this example to add whatever range you wish to the character
         class.
      </p>
      
      <p class="noind">Before moving on from our examination of regular expressions, let’s tackle one more common issue.</p>
      
      
      
      <h4 id="ch10lev2sec9" class="calibre26">10.6.3. <a id="ch10lev2sec9__title" class="calibre4"></a>Matching escaped characters
      </h4>
      
      <p class="noind">It’s common for page authors to use names that conform to program identifiers when assigning <kbd class="calibre15">id</kbd> values to page elements, but that’s just a convention; <kbd class="calibre15">id</kbd> values can contain characters other than “word” characters, including punctuation. For example, a web developer might use
         the <kbd class="calibre15">id</kbd> value <kbd class="calibre15">form:update</kbd> for an element.
      </p>
      
      <p class="noind">A library developer, when writing an implementation for, say, a CSS selector engine, would like to support escaped characters.
         This allows the user to specify complex names that don’t conform to typical naming conventions. So let’s develop a regex that
         will allow matching escaped characters. Consider the following code.
      </p>
      
      
      
      <h5 id="ch10ex13" class="notetitle">Listing 10.13. <a id="ch10ex13__title" class="calibre4"></a>Matching escaped characters in a CSS selector
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/278fig02_alt.jpg" alt="" class="calibre2" width="590" height="192" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/278fig02_alt.jpg"></p>
      
      
      <p class="noind">This particular expression works by allowing for a match of either a word character sequence or a sequence of a backslash
         followed by any character.
      </p>
      
      <p class="noind">Note that more work is required to fully support all escape characters. For more details, visit <a href="https://mathiasbynens.be/notes/css-escapes" class="calibre4">https://mathiasbynens.be/notes/css-escapes</a>.
      </p>
      
      
      
      
      <h3 id="ch10lev1sec7" class="calibre24"><a id="ch10lev1sec7__title" class="calibre3"></a>10.7. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Regular expressions are a powerful tool that permeates modern JavaScript development; virtually every aspect of any sort of
            matching depends on their use. With a good understanding of the advanced regex concepts covered in this chapter, you should
            feel comfortable tackling any challenging piece of code that could benefit from regular expressions.
            
         </li>
         
         <li class="calibre20">We can create regular expressions with regular expression literals (<kbd class="calibre15">/test/</kbd>) and with the <kbd class="calibre15">RegExp</kbd> constructor (new RegExp(<kbd class="calibre15">"test"</kbd>)). Literals are preferred when the regex is known at development time, and the constructor when the regex is constructed
            at runtime.
            
         </li>
         
         <li class="calibre20">With each regular expression, we can associate five flags: <kbd class="calibre15">i</kbd> makes the regex case-insensitive, <kbd class="calibre15">g</kbd> matches all instances of the pattern, <kbd class="calibre15">m</kbd> allows matches across multiple lines, <kbd class="calibre15">y</kbd> enables sticky matching, while <kbd class="calibre15">u</kbd> enables the use of Unicode escapes. Flags are added at the end of a regex literal: <kbd class="calibre15">/test/ig</kbd>, or as a second parameter to the <kbd class="calibre15">RegExp</kbd> constructor: <kbd class="calibre15">new RegExp("test", "i")</kbd>.
            
         </li>
         
         <li class="calibre20">Use <kbd class="calibre15">[]</kbd> (as in <kbd class="calibre15">[abc]</kbd>) to specify a set of characters that we wish to match.
            
         </li>
         
         <li class="calibre20">Use <kbd class="calibre15">^</kbd> to signify that the pattern must appear at the beginning of a string and <kbd class="calibre15">$</kbd> to signify that the pattern must appear at the end of a string.
            
         </li>
         
         <li class="calibre20">Use <kbd class="calibre15">?</kbd> to specify that a term is optional, <kbd class="calibre15">+</kbd> that a term should appear one or many times, and <kbd class="calibre15">*</kbd> to specify that a term appears zero, one, or many times.
            
         </li>
         
         <li class="calibre20">Use <kbd class="calibre15">.</kbd> to match any character.
            
         </li>
         
         <li class="calibre20">We can use backslash (<kbd class="calibre15">\</kbd>) to escape special regex characters (such as <kbd class="calibre15">. [ $ ^</kbd>).
            
         </li>
         
         <li class="calibre20">Use parentheses <kbd class="calibre15">()</kbd> to group multiple terms together, and pipe (<kbd class="calibre15">|</kbd>) to specify alternation.
            
         </li>
         
         <li class="calibre20">Portions of a string that are successfully matched against terms can be back referenced with a backslash followed by the number
            of the capture (<kbd class="calibre15">\1</kbd>, <kbd class="calibre15">\2</kbd>, and so on).
            
         </li>
         
         <li class="calibre20">Every string has access to the <kbd class="calibre15">match</kbd> function, which takes in a regular expression and returns an array containing the entire matched string along with any matched
            captures. We can also use the <kbd class="calibre15">replace</kbd> function, which causes a replacement on pattern matches rather than on a fixed string.
            
         </li>
         
      </ul>
      
      
      
      
      <h3 id="ch10lev1sec8" class="calibre24"><a id="ch10lev1sec8__title" class="calibre3"></a>10.8. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch10qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa2q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">In JavaScript, regular expressions can be created with which of the following?</p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20">Regular expression literals
                  
               </li>
               
               <li class="calibre20">The built-in <kbd class="calibre15">RegExp</kbd> constructor
                  
               </li>
               
               <li class="calibre20">The built-in <kbd class="calibre15">RegularExpression</kbd> constructor
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind">Which of the following is a regular expression literal?</p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">/test/</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">\test\</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">new RegExp("test");</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">Choose the correct regular expression flags:</p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">/test/g</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">g/test/</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">new RegExp("test", "gi");</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">The regular expression <kbd class="calibre15">/def/</kbd> matches which of the following strings?
            </p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20">One of the strings <kbd class="calibre15">d</kbd>, <kbd class="calibre15">e</kbd>, <kbd class="calibre15">f</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">def</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">de</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa2qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa2q5" class="calibre4"></a><b class="calibre21">5 </b></p><p class="noind">The regular expression <kbd class="calibre15">/[^abc]/</kbd> matches which of the following?
            </p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20">One of strings <kbd class="calibre15">a, b, c</kbd>
                  
               </li>
               
               <li class="calibre20">One of strings <kbd class="calibre15">d, e, f</kbd>
                  
               </li>
               
               <li class="calibre20">Matches the string <kbd class="calibre15">ab</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa2qe6" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa2q6" class="calibre4"></a><b class="calibre21">6 </b></p><p class="noind">Which of the following regular expressions matches the string <kbd class="calibre15">hello</kbd>?
            </p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">/hello/</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">/hell?o/</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">/hel*o/</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">/[hello]/</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa2qe7" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa2q7" class="calibre4"></a><b class="calibre21">7 </b></p><p class="noind">The regular expression <kbd class="calibre15">/(cd)+(de)*/</kbd> matches which of the following strings?
            </p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">cd</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">de</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">cdde</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">cdcd</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">ce</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">cdcddedede</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa2qe8" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa2q8" class="calibre4"></a><b class="calibre21">8 </b></p><p class="noind">In regular expressions, we can express alternatives with which of the following?</p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">#</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">&amp;</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">|</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa2qe9" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa2q9" class="calibre4"></a><b class="calibre21">9 </b></p><p class="noind">In the regular expression <kbd class="calibre15">/([0-9])2/</kbd>, we can reference the first matched digit with which of the following?
            </p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">/0</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">/1</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">\0</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">\1</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa2qe10" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa2q10" class="calibre4"></a><b class="calibre21">10 </b></p><p class="noind">The regular expression <kbd class="calibre15">/([0-5])6\1/</kbd> will match which of the following?
            </p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">060</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">16</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">261</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">565</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa2qe11" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa2q11" class="calibre4"></a><b class="calibre21">11 </b></p><p class="noind">The regular expression <kbd class="calibre15">/(?:ninja)-(trick)?-\1/</kbd> will match which of the following?
            </p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">ninja-</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">ninja-trick-ninja</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">ninja-trick-trick</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch10qa2qe12" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch10qa2q12" class="calibre4"></a><b class="calibre21">12 </b></p><p class="noind">What is the result of executing <kbd class="calibre15">"012675".replace(/0-5/g, "a")</kbd>?
            </p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">aaa67a</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">a12675</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">a1267a</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_37"></div>
<h2 id="ch11" class="part">Chapter 11. <a id="ch11__title" class="calibre3"></a>Code modularization techniques
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Using the module pattern
            
         </li>
         
         <li class="calibre20">Using current standards for writing modular code: AMD and CommonJS
            
         </li>
         
         <li class="calibre20">Working with ES6 modules
            
         </li>
         
      </ul>
      
      <p class="noind">So far we’ve explored the basic primitives of JavaScript, such as functions, objects, collections, and regular expressions.
         We have more than a couple of tools in our belt for solving specific problems with our JavaScript code. But as our applications
         start to grow, another whole set of problems, related to how we structure and manage our code, starts to emerge. Time and
         time again, it’s been proven that large, monolithic code bases are far more likely to be difficult to understand and maintain
         than smaller, well-organized ones. So it’s only natural that one way of improving the structure and organization of our programs
         is to break them into smaller, relatively loosely coupled segments called <i class="calibre6">modules</i>.
      </p>
      
      <p class="noind">Modules are larger units of organizing our code than objects and functions; they allow us to divide programs into clusters
         that belong together. When creating <a id="iddle1774" class="calibre4"></a><a id="iddle2097" class="calibre4"></a>modules, we should strive to form consistent abstractions and encapsulate implementation details. This makes it easier to
         reason about our application, because we aren’t bothered with various frivolous details when using our module functionality.
         In addition, having modules means that we can easily reuse module functionality in different parts of our applications, and
         even across different applications, significantly speeding up our development process.
      </p>
      
      <p class="noind">As you saw earlier in the book, JavaScript is big on global variables: Whenever we define a variable in mainline code, that
         variable is automatically considered global and can be accessed from any other part of our code. This might not be a problem
         for small programs, but as our applications start to grow and we include third-party code, the chance that naming clashes
         will occur starts to grow significantly. In most other programming languages, this problem is solved with namespaces (C++
         and C#) or packages (Java), which wrap all enclosed names in another name, thereby significantly reducing potential clashes.
      </p>
      
      <p class="noind">Up to ES6, JavaScript didn’t offer a higher-level, built-in feature that allows us to group related variables in a module,
         namespace, or package. So in order to tackle this problem, JavaScript programmers have developed advanced code modularization
         techniques that take advantage of existing JavaScript constructs, such as objects, immediate functions, and closures. In this
         chapter, we’ll explore some of these techniques.
      </p>
      
      <p class="noind">Luckily, it’s only a matter of time until we’ll be able to completely let go of these work-around techniques, because ES6
         finally introduces native modules. Unfortunately, the browsers haven’t caught on, so we’ll explore how modules should work
         in ES6, even though we won’t have a specific native browser implementation to test them on.
      </p>
      
      <p class="noind">Let’s start with modularization techniques that we can use today.</p>
      
      <h3 class="calibre24"><a id="ch11qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch11qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch11qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">What existing mechanism do you use to approximate modules in JavaScript pre-ES6?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch11qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch11qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">What is the difference between the AMD and CommonJS module specifications?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch11qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch11qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">Using ES6, what two statements would you need to use the <kbd class="calibre15">tryThisOut()</kbd> function from a module called <kbd class="calibre15">test</kbd> from within another module called <kbd class="calibre15">guineaPig</kbd>?
            </p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch11lev1sec1" class="calibre24"><a id="ch11lev1sec1__title" class="calibre3"></a>11.1. Modularizing code in pre-ES6 JavaScript
      </h3>
      
      <p class="noind">Pre-ES6 JavaScript has only two types of scopes: global scope and function scope. It doesn’t have something in between, a
         namespace or a module that would allow us to group certain functionality together. To write modular code, JavaScript developers
         are forced to be creative with existing JavaScript language features.
      </p>
      
      <p class="noind">When deciding which features to use, we have to keep in mind that, at a bare minimum, each module system should be able to
         do the following:
      </p>
      
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><a id="iddle1318" class="calibre4"></a><a id="iddle1543" class="calibre4"></a><a id="iddle1635" class="calibre4"></a><a id="iddle1778" class="calibre4"></a><i class="calibre6">Define an interface</i> through which we can access the functionality offered by the module.
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Hide module internals</i> so that the users of our modules aren’t burdened with a whole host of unimportant implementation details. In addition, by
            hiding module internals, we protect those internals from the outside world, thereby preventing unwanted modifications that
            can lead to all sorts of side effects and bugs.
            
         </li>
         
      </ul>
      
      <p class="noind">In this section, we’ll first see how to create modules by using standard JavaScript features that we’ve explored so far in
         the book, features such as objects, closures, and immediate functions. We’ll continue this modularization vein by exploring
         Asynchronous Module Definition (AMD) and CommonJS, the two most popular module specification standards, built on slightly
         different foundations. You’ll learn how to define modules using these standards, as well as their pros and cons.
      </p>
      
      <p class="noind">But let’s start with something for which we’ve already set the stage in previous chapters.</p>
      
      
      <h4 id="ch11lev2sec1" class="calibre26">11.1.1. <a id="ch11lev2sec1__title" class="calibre4"></a>Using objects, closures, and immediate functions to specify modules
      </h4>
      
      <p class="noind">Let’s go back to our minimal module system requirements, <i class="calibre6">hiding implementation details</i> and <i class="calibre6">defining module interfaces</i>. Now think about which JavaScript language features we can take advantage of in order to implement these minimal requirements:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Hiding module internals—</i> </b>As we already know, calling a JavaScript function creates a new scope in which we can define variables that are visible only
            within the current function. So, one option for hiding module internals is using functions as modules. In this way, all function
            variables become internal module variables that are hidden from the outside world.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Defining module interfaces—</i> </b>Implementing module internals through function variables means that those variables are accessible from only within the module.
            But if our modules are to be used from other code, we have to be able to define a clean interface through which we can expose
            the functionality offered by the module. One way of achieving this is by taking advantage of objects and closures. The idea
            is that, from our function module, we return an object that represents the public interface of our module. That object should
            contain methods offered by the module, methods that will, through closures, keep alive our internal module variables, even
            after our module function has finished its execution.
            
         </li>
         
      </ul>
      
      <p class="noind">Now that we’ve given a high-level description of how to implement modules in JavaScript, let’s go through it slowly, step
         by step, starting with using functions for hiding module internals.
      </p>
      
      
      <h5 id="ch11lev3sec1" class="notetitle"><a id="ch11lev3sec1__title" class="calibre4"></a>Functions as modules
      </h5>
      
      <p class="noind">Calling a function creates a new scope that we can use to define variables that won’t be visible from outside the current
         function. Let’s take a look at the following code snippet that counts the number of clicks on a web page:
      </p>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/285fig01_alt.jpg" alt="" class="calibre2" width="590" height="109" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/285fig01_alt.jpg"></p>
      
      <p class="noind"><a id="iddle1681" class="calibre4"></a><a id="iddle1779" class="calibre4"></a>In this example, we create a function called <kbd class="calibre15">countClicks</kbd> that creates a variable <kbd class="calibre15">numClicks</kbd> and registers a click event handler on the entire document. Whenever a click is made, the <kbd class="calibre15">numClicks</kbd> variable gets incremented and the result is displayed to the user via an alert box. There are two important things to notice
         here:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The <kbd class="calibre15">numClicks</kbd> variable, internal to the <kbd class="calibre15">countClicks</kbd> function, is kept alive through the closure of the click handler function. The variable can be referenced only within the
            handler, and <i class="calibre6">nowhere else</i>! We’ve shielded the <kbd class="calibre15">numClicks</kbd> variable from the code outside the <kbd class="calibre15">countClicks</kbd> function. At the same time, we haven’t polluted the global namespace of our program with a variable that’s probably not that
            important for the rest of our code.
            
         </li>
         
         <li class="calibre20">Our <kbd class="calibre15">countClicks</kbd> function is called only in this one place, so instead of defining a function and then calling it in a separate statement,
            we’ve used an immediate function, or an IIFE (presented in <a href="kindle_split_014.html#ch03" class="calibre4">chapter 3</a>), to define and immediately invoke the <kbd class="calibre15">countClicks</kbd> function.
            
         </li>
         
      </ul>
      
      <p class="noind">We can also take a look at the current application state, with respect to how our internal function (or module) variable is
         kept alive through closures, as shown in <a href="#ch11fig01" class="calibre4">figure 11.1</a>.
      </p>
      
      
      
      <h5 id="ch11fig01" class="notetitle">Figure 11.1. <a id="ch11fig01__title" class="calibre4"></a>The click event handler, through closures, keeps alive the local <kbd class="calibre15">numClicks</kbd> variable.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/11fig01_alt.jpg" alt="" class="calibre2" width="590" height="191" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/11fig01_alt.jpg"></p>
      
      
      <p class="noind">Now that we understand how to hide internal module details, and how closures can keep those internal details alive as long
         as necessary, let’s move on to our second minimal requirement for modules: defining module interfaces.
      </p>
      
      
      
      <h5 id="ch11lev3sec2" class="notetitle"><a id="ch11lev3sec2__title" class="calibre4"></a>The module pattern: augmenting functions as modules with objects as interfaces
      </h5>
      
      <p class="noind">The module interface is usually composed of a set of variables and functions that our module provides to the outside world.
         The easiest way to create such an interface is to use the humble JavaScript object.
      </p>
      
      <p class="noind"><a id="iddle1763" class="calibre4"></a><a id="iddle1767" class="calibre4"></a>For example, let’s create an interface for our module that counts the clicks on our web page, as shown in the following listing.
      </p>
      
      
      
      <h5 id="ch11ex01" class="notetitle">Listing 11.1. <a id="ch11ex01__title" class="calibre4"></a>The module pattern
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/286fig01_alt.jpg" alt="" class="calibre2" width="590" height="319" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/286fig01_alt.jpg"></p>
      
      
      <p class="noind">Here we use an immediate function to implement a module. Within the immediate function, we define our internal module implementation
         details: one local variable, <kbd class="calibre15">numClicks</kbd>, and one local function, <kbd class="calibre15">handleClick</kbd>, that are accessible only within the module. Next we create and immediately return an object that will serve as the module’s
         “public interface.” This interface contains a <kbd class="calibre15">countClicks</kbd> method that we can use from outside the module to access module functionality.
      </p>
      
      <p class="noind">At the same time, because we’ve exposed a module interface, our internal module details are kept alive through closures created
         by the interface. For example, in this case, the <kbd class="calibre15">countClicks</kbd> method of the interface keeps alive internal module variables <kbd class="calibre15">numClicks</kbd> and <kbd class="calibre15">handleClick</kbd>, as shown in <a href="#ch11fig02" class="calibre4">figure 11.2</a>.
      </p>
      
      
      
      <h5 id="ch11fig02" class="notetitle">Figure 11.2. <a id="ch11fig02__title" class="calibre4"></a>Expose the public interface of a module through a returned object. The internal module implementation (“private” variables
         and functions) is kept alive through closures created by public interface methods.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/11fig02_alt.jpg" alt="" class="calibre2" width="583" height="512" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/11fig02_alt.jpg"></p>
      
      
      <p class="noind">Finally, we store the object that represents the module interface, returned by the immediate function, into a variable named
         <kbd class="calibre15">MouseCounterModule</kbd>, through which we can easily consume module functionality, by writing the following code:
      </p>
      
      <pre id="PLd0e28987" class="calibre5">MouseCounterModule.countClicks()</pre>
      
      <p class="noind">And that’s basically it.</p>
      
      <p class="noind">By taking advantage of immediate functions, we can hide certain module implementation details. Then by adding objects and
         closures into the mix, we can specify a module interface that exposes the functionality provided by our module to the outside
         world.
      </p>
      
      <p class="noind"><a id="iddle1110" class="calibre4"></a><a id="iddle1276" class="calibre4"></a><a id="iddle1776" class="calibre4"></a>This pattern of using immediate functions, objects, and closures to create modules in JavaScript is called the <i class="calibre6">module pattern</i>. It was popularized by Douglas Crockford, and was one of the first massively popular ways of modularizing JavaScript code.
      </p>
      
      <p class="noind">Once we have the ability to define modules, it’s always nice to be able to split them across multiple files (in order to more
         easily manage them), or to be able to define additional functionality on existing modules, without modifying their source
         code.
      </p>
      
      <p class="noind">Let’s see how this can be done.</p>
      
      
      
      <h5 id="ch11lev3sec3" class="notetitle"><a id="ch11lev3sec3__title" class="calibre4"></a>Augmenting modules
      </h5>
      
      <p class="noind">Let’s augment our <kbd class="calibre15">MouseCounterModule</kbd> from the previous example with an additional feature of counting the number of mouse scrolls, but without modifying the original
         <kbd class="calibre15">MouseCounterModule</kbd> code. See the following listing.
      </p>
      
      <h5 id="ch11ex02" class="notetitle">Listing 11.2. <a id="ch11ex02__title" class="calibre4"></a>Augmenting modules
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch11ex02-0.jpg" alt="" class="calibre2" width="590" height="144" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch11ex02-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch11ex02-1.jpg" alt="" class="calibre2" width="590" height="275" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch11ex02-1.jpg"></p>
      
      <p class="noind"><a id="iddle1762" class="calibre4"></a>When augmenting a module, we usually follow a procedure similar to creating a new module. We immediately call a function,
         but this time, we pass to it the module we want to extend as an argument:
      </p>
      
      <pre id="PLd0e29069" class="calibre5">(function(module){
  ...
  return module;
})(MouseCounterModule);</pre>
      
      <p class="noind">Within the function, we then go about our work and create all the necessary private variables and functions. In this case,
         we’ve defined a private variable and a private function for counting and reporting the number of scrolls:
      </p>
      
      <pre id="PLd0e29078" class="calibre5">let numScrolls = 0;
const handleScroll = () =&gt; {
  alert(++numScrolls);
}</pre>
      
      <p class="noind">Finally, we extend our module, available through the immediate function’s <kbd class="calibre15">module</kbd> parameter, just as we would extend any other object:
      </p>
      
      <pre id="PLd0e29090" class="calibre5">module.countScrolls = ()=&gt; {
  document.addEventListener("wheel", handleScroll);
};</pre>
      
      <p class="noind">After we’ve performed this simple operation, our <kbd class="calibre15">MouseCounterModule</kbd> can also <kbd class="calibre15">countScrolls</kbd>.
      </p>
      
      <p class="noind">Our public module interface now has two methods, and we can use the module in the following ways:</p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/288fig01_alt.jpg" alt="" class="calibre2" width="590" height="90" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/288fig01_alt.jpg"></p>
      
      <p class="noind"><a id="iddle1764" class="calibre4"></a>As we’ve already mentioned, we’ve extended the module in a way that’s similar to the creation of a new module, through an
         immediately invoked function that extends the module. This has some interesting side effects in terms of closures, so let’s
         take a closer look at the application state after we’ve augmented the module, as shown in <a href="#ch11fig03" class="calibre4">figure 11.3</a>.
      </p>
      
      
      
      <h5 id="ch11fig03" class="notetitle">Figure 11.3. <a id="ch11fig03__title" class="calibre4"></a>When augmenting a module, we extend its external interface with new functionality, usually by passing the module to another
         immediate function. In this example, we add the ability to <kbd class="calibre15">countScrolls</kbd> to our MouseCounterModule. Notice that two separate functions are defined in different environments, and they can’t access
         each other’s internal variables.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/11fig03_alt.jpg" alt="" class="calibre2" width="583" height="860" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/11fig03_alt.jpg"></p>
      
      
      <p class="noind">If you look closely, <a href="#ch11fig03" class="calibre4">figure 11.3</a> also shows one of the shortcomings of the module pattern: the inability to share private module variables across module extensions.
         For example, the <kbd class="calibre15">countClicks</kbd> function keeps a closure around the <kbd class="calibre15">numClicks</kbd> and <kbd class="calibre15">handleClick</kbd> variables, and we could access these private module internals through the <kbd class="calibre15">countClicks</kbd> method.
      </p>
      
      <p class="noind">Unfortunately, our extension, the <kbd class="calibre15">countScrolls</kbd> function, is created in a completely separate scope, with a completely new set of private variables: <kbd class="calibre15">numScrolls</kbd> and <kbd class="calibre15">handleScroll</kbd>. The <kbd class="calibre15">countScrolls</kbd> function creates a closure only around <kbd class="calibre15">numScrolls</kbd> and <kbd class="calibre15">handleScroll</kbd> variables, and therefore can’t access the <kbd class="calibre15">numClicks</kbd> and <kbd class="calibre15">handleClick</kbd> variables.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch11note01" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Module extensions, when performed through separate immediate functions, can’t share private module internals, because every
         function invocation creates a new scope. Although this is a shortcoming, it’s not a showstopper, and we can still use the
         module pattern to keep our JavaScript applications modular.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Note that, in the module pattern, modules are objects just like any other, and we can extend them in any way we find appropriate.
         For example, we can add new functionality by extending the module object with new properties:
      </p>
      
      <pre id="PLd0e29196" class="calibre5">MouseCounterModule.newMethod = ()=&gt; {...}</pre>
      
      <p class="noind">We can also use the same principle to easily create submodules:</p>
      
      <pre id="PLd0e29205" class="calibre5">MouseCounterModule.newSubmodule = () =&gt; {
  return {...};
}();</pre>
      
      <p class="noind">Notice that all of these approaches suffer from the same fundamental shortcoming of the module pattern: Subsequent extensions
         of the module can’t access previously defined internal module details.
      </p>
      
      <p class="noind">Unfortunately, there are more problems with the module pattern. When we start building modular applications, the modules themselves
         will often depend on other modules for their functionality. Unfortunately, the module pattern doesn’t cover the management
         of these dependencies. We, as developers, have to take care of the right dependency order so that our module code has all
         it needs to execute. Although this isn’t a problem in small and medium applications, it can introduce serious issues in large
         applications that use a lot of interdependent modules.
      </p>
      
      <p class="noind">To deal with these issues, a couple of competing standards have arisen, namely Asynchronous Module Definition (AMD) and CommonJS.</p>
      
      
      
      
      <h4 id="ch11lev2sec2" class="calibre26">11.1.2. <a id="ch11lev2sec2__title" class="calibre4"></a>Modularizing JavaScript applications with AMD and CommonJS
      </h4>
      
      <p class="noind">AMD and CommonJS are competing module specification standards that allow us to specify JavaScript modules. Besides some differences
         in syntax and philosophy, the main difference is that AMD was designed explicitly with the browser in mind, whereas CommonJS
         was designed for a general-purpose JavaScript environment (such as servers, with Node.js), without being bound to the limitations
         of the browser. This section provides a relatively short overview of these module specifications; setting them up and including
         <a id="iddle1052" class="calibre4"></a><a id="iddle1107" class="calibre4"></a><a id="iddle1317" class="calibre4"></a><a id="iddle1344" class="calibre4"></a><a id="iddle1775" class="calibre4"></a><a id="iddle1974" class="calibre4"></a>them in your projects is beyond the scope of this book. For more information, we recommend <i class="calibre6">JavaScript Application Design</i> by Nicolas G. Bevacqua (Manning, 2015).
      </p>
      
      
      <h5 id="ch11lev3sec4" class="notetitle"><a id="ch11lev3sec4__title" class="calibre4"></a>AMD
      </h5>
      
      <p class="noind">AMD grew out of the Dojo toolkit (<a href="https://dojotoolkit.org/" class="calibre4">https://dojotoolkit.org/</a>), one of the popular JavaScript toolkits for building client-side web applications. AMD allows us to easily specify modules
         and their dependencies. At the same time, it was built from the ground up for the browser. Currently, the most popular AMD
         implementation is RequireJS (<a href="http://requirejs.org/" class="calibre4">http://requirejs.org/</a>).
      </p>
      
      <p class="noind">Let’s see an example of defining a small module that has a dependency to jQuery.</p>
      
      
      
      <h5 id="ch11ex03" class="notetitle">Listing 11.3. <a id="ch11ex03__title" class="calibre4"></a>Using AMD to specify a module dependent on jQuery
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/291fig01_alt.jpg" alt="" class="calibre2" width="590" height="190" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/291fig01_alt.jpg"></p>
      
      
      <p class="noind">AMD provides a function called <kbd class="calibre15">define</kbd> that accepts the following:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The ID of the newly created module. This ID can later be used to require the module from other parts of our system.
            
         </li>
         
         <li class="calibre20">A list of module IDs on which our current module depends (the required modules).
            
         </li>
         
         <li class="calibre20">A factory function that will initialize the module and that accepts the required modules as arguments.
            
         </li>
         
      </ul>
      
      <p class="noind">In this example, we use AMD’s <kbd class="calibre15">define</kbd> function to create a module with an ID <kbd class="calibre15">MouseCounterModule</kbd> that depends on jQuery. Because of this dependency, AMD first requests the jQuery module, which can take some time if the
         file has to be requested from a server. This action is performed asynchronously, in order to avoid blocking. After all dependencies
         have been downloaded and evaluated, the module factory function is called with one argument for each requested module. In
         this case, there will be one argument, because our new module requires only jQuery. Within the factory function, we create
         our module just as we would with the standard module pattern: by returning an object that exposes the public interface of
         the module.
      </p>
      
      <p class="noind"><a id="iddle1232" class="calibre4"></a><a id="iddle1462" class="calibre4"></a><a id="iddle1768" class="calibre4"></a><a id="iddle1777" class="calibre4"></a>As you can see, AMD offers several interesting benefits, such as these:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Automatic resolving of dependencies, so that we don’t have to think about the order in which we include our modules.
            
         </li>
         
         <li class="calibre20">Modules can by asynchronously loaded, thereby avoiding blocking.
            
         </li>
         
         <li class="calibre20">Multiple modules can be defined within one file.
            
         </li>
         
      </ul>
      
      <p class="noind">Now that you have the basic idea of how AMD works, let’s take a look at another, massively popular module definition standard.</p>
      
      
      
      <h5 id="ch11lev3sec5" class="notetitle"><a id="ch11lev3sec5__title" class="calibre4"></a>CommonJS
      </h5>
      
      <p class="noind">Whereas AMD was built explicitly for the browser, CommonJS is a module specification designed for a general-purpose JavaScript
         environment. Currently it has the biggest following in the Node.js community.
      </p>
      
      <p class="noind">CommonJS uses file-based modules, so we can specify one module per file. To each module, CommonJS exposes a variable, <kbd class="calibre15">module</kbd>, with a property, <kbd class="calibre15">exports</kbd>, which we can easily extend with additional properties. In the end, the content of <kbd class="calibre15">module.exports</kbd> is exposed as the module’s public interface.
      </p>
      
      <p class="noind">If we want to use a module from other parts of the application, we can require it. The file will be synchronously loaded,
         and we’ll have access to its public interface. This is the reason that CommonJS is much more popular on the server, where
         module fetching is relatively quick because it requires only a file-system read, than on the client, where the module has
         to be downloaded from a remote server, and where synchronous loading usually means blocking.
      </p>
      
      <p class="noind">Let’s look at an example that defines our reoccurring <kbd class="calibre15">MouseCounterModule</kbd>, this time in CommonJS.
      </p>
      
      
      
      <h5 id="ch11ex04" class="notetitle">Listing 11.4. <a id="ch11ex04__title" class="calibre4"></a>Using CommonJS to define a module
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/292fig01_alt.jpg" alt="" class="calibre2" width="590" height="187" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/292fig01_alt.jpg"></p>
      
      
      <p class="noind">To include our module within a different file, we can write this:</p>
      
      <pre id="PLd0e29430" class="calibre5">const MouseCounterModule = require("MouseCounterModule.js");
MouseCounterModule.countClicks();</pre>
      
      <p class="noind"><a id="iddle1765" class="calibre4"></a><a id="iddle1770" class="calibre4"></a><a id="iddle1973" class="calibre4"></a>See how simple this is?
      </p>
      
      <p class="noind">Because the philosophy of CommonJS dictates one module per file, any code that we put in a file module will be a part of that
         module. Therefore, there’s no need for wrapping variables up in immediate functions. All variables defined within a module
         are safely contained within the scope of the current module and don’t leak out to the global scope. For example, all three
         of our module variables (<kbd class="calibre15">$</kbd>, <kbd class="calibre15">numClicks</kbd>, and <kbd class="calibre15">handleClick</kbd>) are module scoped, even though they’re defined in top-level code (outside all functions and blocks), which would technically
         make them global variables in standard JavaScript files.
      </p>
      
      <p class="noind">Once again, it’s important to note that only variables and functions exposed through the <kbd class="calibre15">module.exports</kbd> object are available from outside the module. The procedure is similar to the module pattern, only instead of returning a
         completely new object, the environment already provides one that we can extend with our interface methods and properties.
      </p>
      
      <p class="noind">CommonJS has a couple of advantages:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">It has simple syntax. We need to specify only the <kbd class="calibre15">module.exports</kbd> properties, while the rest of the module code stays pretty much the same as if we were writing standard JavaScript. Requiring
            modules is also simple; we just use the <kbd class="calibre15">require</kbd> function.
            
         </li>
         
         <li class="calibre20">CommonJS is the default module format for Node.js, so we have access to thousands of packages that are available through npm,
            node’s package manager.
            
         </li>
         
      </ul>
      
      <p class="noind">CommonJS’s biggest disadvantage is that it wasn’t explicitly built with the browser in mind. Within JavaScript in the browser,
         there’s no support for the <kbd class="calibre15">module</kbd> variable and the <kbd class="calibre15">export</kbd> property; we have to package our CommonJS modules into a browser-readable format. We can achieve this with either Browserify
         (<a href="http://browserify.org/" class="calibre4">http://browserify.org/</a>) or RequireJS (<a href="http://requirejs.org/docs/commonjs.html" class="calibre4">http://requirejs.org/docs/commonjs.html</a>).
      </p>
      
      <p class="noind">Having two competing standards for specifying modules, AMD and CommonJS, has led to one of those situations in which people
         tend to divide themselves into two, sometimes even opposing, camps. If you work on relatively closed projects, this might
         not be an issue; you choose the standard that suits you better. Problems can arise, however, when we need to reuse code from
         the opposing camp and are forced to jump through all sorts of hoops. One solution is to use Universal Module Definition, or
         UMD (<a href="https://github.com/umdjs/umd" class="calibre4">https://github.com/umdjs/umd</a>), a pattern with a somewhat convoluted syntax that allows the same file to be used by both AMD and CommonJS. This is beyond
         the scope of this book, but if you’re interested, many quality resources are available online.
      </p>
      
      <p class="noind">Luckily, the ECMAScript committee has recognized the need for a unified module syntax supported in all JavaScript environments,
         so ES6 defines a new module standard that should finally put these differences to rest.
      </p>
      
      
      
      
      
      
      <h3 id="ch11lev1sec2" class="calibre24"><a id="ch11lev1sec2__title" class="calibre3"></a>11.2. ES6 modules
      </h3>
      
      <p class="noind"><a id="iddle1205" class="calibre4"></a><a id="iddle1394" class="calibre4"></a><a id="iddle1460" class="calibre4"></a><a id="iddle1669" class="calibre4"></a><a id="iddle1772" class="calibre4"></a>ES6 modules are designed to marry the advantages of CommonJS and AMD:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Similar to CommonJS, ES6 modules have a relatively simple syntax, and ES6 modules are file based (one module per file).
            
         </li>
         
         <li class="calibre20">Similar to AMD, ES6 modules provide support for asynchronous module loading.
            
         </li>
         
      </ul>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch11note02" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Built-in modules are a part of the ES6 standard. As you’ll soon see, the ES6 module syntax includes additional semantics and
         keywords (such as the <kbd class="calibre15">export</kbd> and <kbd class="calibre15">import</kbd> keywords) that aren’t supported by current browsers. If we want to use modules today, we have to transpile our module code
         with Traceur (<a href="https://github.com/google/traceur-compiler" class="calibre4">https://github.com/google/traceur-compiler</a>), Babel (<a href="http://babeljs.io/" class="calibre4">http://babeljs.io/</a>), or TypeScript (<a href="http://www.typescriptlang.org/" class="calibre4">www.typescriptlang.org/</a>). We also can use the SystemJS library (<a href="https://github.com/systemjs/systemjs" class="calibre4">https://github.com/systemjs/systemjs</a>), which provides support for loading all currently available module standards: AMD, CommonJS, and even ES6 modules. You can
         find instructions on how to use SystemJS in the project’s repository (<a href="https://github.com/systemjs/systemjs" class="calibre4">https://github.com/systemjs/systemjs</a>).
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">The main idea behind ES6 modules is that only the identifiers explicitly exported from a module are accessible from outside
         that module. All other identifiers, even the ones defined in top-level scope (what would be global scope in standard JavaScript),
         are accessible only from within the module. This was inspired by CommonJS.
      </p>
      
      <p class="noind">To provide this functionality, ES6 introduces two new keywords:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><kbd class="calibre15">export</kbd>—For making certain identifiers available from outside the module
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">import</kbd>—For importing exported module identifiers
            
         </li>
         
      </ul>
      
      <p class="noind">The syntax for exporting and importing module functionality is simple, but it has a lot of subtle nuances that we’ll explore
         slowly, step by step.
      </p>
      
      
      <h4 id="ch11lev2sec3" class="calibre26">11.2.1. <a id="ch11lev2sec3__title" class="calibre4"></a>Exporting and importing functionality
      </h4>
      
      <p class="noind">Let’s start with a simple example that shows how to export functionality from one module and import it into another.</p>
      
      
      
      <h5 id="ch11ex05" class="notetitle">Listing 11.5. <a id="ch11ex05__title" class="calibre4"></a>Exporting from a Ninja.js module
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/294fig01_alt.jpg" alt="" class="calibre2" width="590" height="110" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/294fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1766" class="calibre4"></a><a id="iddle1769" class="calibre4"></a><a id="iddle1771" class="calibre4"></a>We first define a variable, <kbd class="calibre15">ninja</kbd>, a module variable that will be accessible only within this module, even though it’s placed in top-level code (which would
         make it a global variable in pre-ES6 code).
      </p>
      
      <p class="noind">Next, we define another top-level variable, <kbd class="calibre15">message</kbd>, which we make accessible from outside the module by using the new <kbd class="calibre15">export</kbd> keyword. Finally, we also create and export the <kbd class="calibre15">sayHiToNinja</kbd> function.
      </p>
      
      <p class="noind">And that’s it! This is the minimum syntax we need to know for defining our own modules. We don’t have to use immediate functions
         or remember any esoteric syntax in order to export functionality from a module. We write our code as we would write standard
         JavaScript code, with the only difference that we prefix some of the identifiers (such as variables, functions, or classes)
         with an <kbd class="calibre15">export</kbd> keyword.
      </p>
      
      <p class="noind">Before learning how to import this exported functionality, we’ll take a look at an alternative way to export identifiers:
         We list everything we want to export at the end of the module, as shown in the following listing.
      </p>
      
      
      
      <h5 id="ch11ex06" class="notetitle">Listing 11.6. <a id="ch11ex06__title" class="calibre4"></a>Exporting at the end of a module
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/295fig01_alt.jpg" alt="" class="calibre2" width="580" height="163" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/295fig01_alt.jpg"></p>
      
      
      <p class="noind">This way of exporting module identifiers bears some resemblance to the module pattern, as an immediate function returns an
         object that represents the public interface of our module, and especially to CommonJS, as we expand the <kbd class="calibre15">module.exports</kbd> object with the public module interface.
      </p>
      
      <p class="noind">Regardless of how we’ve exported identifiers of a certain module, if we need to import them into another module, we have to
         use the <kbd class="calibre15">import</kbd> keyword, as in the following example.
      </p>
      
      
      
      <h5 id="ch11ex07" class="notetitle">Listing 11.7. <a id="ch11ex07__title" class="calibre4"></a>Importing from the Ninja.js module
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/295fig02_alt.jpg" alt="" class="calibre2" width="590" height="159" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/295fig02_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1789" class="calibre4"></a><a id="iddle1804" class="calibre4"></a><a id="iddle1806" class="calibre4"></a>We use the new <kbd class="calibre15">import</kbd> keyword to import a variable, <kbd class="calibre15">message</kbd> and a function, <kbd class="calibre15">sayHiToNinja</kbd> from the <kbd class="calibre15">ninja</kbd> module:
      </p>
      
      <pre id="PLd0e29769" class="calibre5">import { message, sayHiToNinja} from "Ninja.js";</pre>
      
      <p class="noind">By doing this, we’ve gained access to these two identifiers defined in the <kbd class="calibre15">ninja</kbd> module. Finally, we can test that we can access the <kbd class="calibre15">message</kbd> variable and call the <kbd class="calibre15">sayHiToNinja</kbd> function:
      </p>
      
      <pre id="PLd0e29787" class="calibre5">assert(message === "Hello",
      "We can access the imported variable");
assert(sayHiToNinja() === "Hello Yoshi",
      "We can say hi to Yoshi from outside the module");</pre>
      
      <p class="noind">What we can’t do is access the nonexported and nonimported variables. For example, we can’t access the <kbd class="calibre15">ninja</kbd> variable because it isn’t marked with <kbd class="calibre15">export</kbd>:
      </p>
      
      <pre id="PLd0e29802" class="calibre5">assert(typeof ninja === "undefined",
      "But we cannot access Yoshi directly");</pre>
      
      <p class="noind">With modules, we’re finally a bit safer from the misuse of global variables. Everything that we didn’t explicitly mark for
         export stays nicely isolated within a module.
      </p>
      
      <p class="noind">In this example, we’ve used a <i class="calibre6">named export</i>, which enables us to export multiple identifiers from a module (as we did with <kbd class="calibre15">message</kbd> and <kbd class="calibre15">sayHiToNinja</kbd>). Because we can export a large number of identifiers, listing them all in an import statement can be tedious. Therefore,
         a shorthand notation enables us to bring in all exported identifiers from a module, as shown in the following listing.
      </p>
      
      
      
      <h5 id="ch11ex08" class="notetitle">Listing 11.8. <a id="ch11ex08__title" class="calibre4"></a>Importing all named exports from the Ninja.js module
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/296fig01_alt.jpg" alt="" class="calibre2" width="590" height="165" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/296fig01_alt.jpg"></p>
      
      
      <p class="noind">As <a href="#ch11ex08" class="calibre4">listing 11.8</a> shows, to import all exported identifiers from a module, we use the <kbd class="calibre15">import *</kbd> notation in combination with an identifier that we’ll use to refer to the whole module (in this case, the <kbd class="calibre15">ninjaModule</kbd> identifier). After we’ve done this, we can access the exported identifiers through property notation; for example, <kbd class="calibre15">ninjaModule.message</kbd>, <kbd class="calibre15">ninjaModule.sayHiToNinja</kbd>. Notice that we still can’t access top-level variables that weren’t exported, as is the case with the <kbd class="calibre15">ninja</kbd> variable.
      </p>
      
      
      
      <h5 id="ch11lev3sec6" class="notetitle"><a id="ch11lev3sec6__title" class="calibre4"></a>Default exports
      </h5>
      
      <p class="noind"><a id="iddle1315" class="calibre4"></a><a id="iddle1395" class="calibre4"></a><a id="iddle1461" class="calibre4"></a>Often we don’t want to export a set of related identifiers from a module, but instead want to represent the whole module through
         a single export. One fairly common situation in which this occurs is when our modules contain a single class, as in the following
         listing.
      </p>
      
      
      
      <h5 id="ch11ex09" class="notetitle">Listing 11.9. <a id="ch11ex09__title" class="calibre4"></a>A default export from Ninja.js
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/297fig01_alt.jpg" alt="" class="calibre2" width="590" height="143" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/297fig01_alt.jpg"></p>
      
      
      <p class="noind">Here we’ve added the <kbd class="calibre15">default</kbd> keyword after the <kbd class="calibre15">export</kbd> keyword, which specifies the default binding for this module. In this case, the default binding for this module is the class
         named <kbd class="calibre15">Ninja</kbd>. Even though we’ve specified a default binding, we can still use named exports to export additional identifiers, as we did
         with the <kbd class="calibre15">compare-Ninjas</kbd> function.
      </p>
      
      <p class="noind">Now, we can use simplified syntax to import functionalities from Ninja.js, as shown in the following listing.</p>
      
      
      
      <h5 id="ch11ex10" class="notetitle">Listing 11.10. <a id="ch11ex10__title" class="calibre4"></a>Importing a default export
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/297fig02_alt.jpg" alt="" class="calibre2" width="590" height="222" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/297fig02_alt.jpg"></p>
      
      
      <p class="noind">We start this example with importing a default export. For this, we use a less cluttered import syntax by dropping the braces
         that are mandatory for importing named exports. Also, notice that we can choose an arbitrary name to refer to the default
         export; we aren’t bound to use the one we used when exporting. In this example, <kbd class="calibre15">ImportedNinja</kbd> refers to the <kbd class="calibre15">Ninja</kbd> class defined in the file Ninja.js.
      </p>
      
      <p class="noind"><a id="iddle1096" class="calibre4"></a><a id="iddle1396" class="calibre4"></a><a id="iddle1463" class="calibre4"></a><a id="iddle1671" class="calibre4"></a><a id="iddle1790" class="calibre4"></a>We continue the example by importing a named export, as in previous examples, just to illustrate that we can have both a default
         export and a number of named exports within a single module. Finally, we instantiate a couple of <kbd class="calibre15">ninja</kbd> objects and call the <kbd class="calibre15">compareNinjas</kbd> function, to confirm that all imports work as they should.
      </p>
      
      <p class="noind">In this case, both imports are made from the same file. ES6 offers a shorthand syntax:</p>
      
      <pre id="PLd0e29979" class="calibre5">import ImportedNinja, {compareNinjas} from "Ninja.js";</pre>
      
      <p class="noind">Here we use the comma operator to import both the default and the named exports from the Ninja.js file, in a single statement.</p>
      
      
      
      <h5 id="ch11lev3sec7" class="notetitle"><a id="ch11lev3sec7__title" class="calibre4"></a>Renaming exports and imports
      </h5>
      
      <p class="noind">If necessary, we can also rename both exports and imports. Let’s start with renaming exports, as shown in the following code
         (the comments indicate in which file the code is located):
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/298fig01_alt.jpg" alt="" class="calibre2" width="590" height="265" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/298fig01_alt.jpg"></p>
      
      <p class="noind">In the previous example, we define a function called <kbd class="calibre15">sayHi</kbd>, and we test that we can access the function only though the <kbd class="calibre15">sayHi</kbd> identifier, and not through the <kbd class="calibre15">sayHello</kbd> alias that we provide at the end of the module through the <kbd class="calibre15">as</kbd> keyword:
      </p>
      
      <pre id="PLd0e30017" class="calibre5">export { sayHi as sayHello }</pre>
      
      <p class="noind">We can perform an export rename only in this export form, and not by prefixing the variable or function declaration with the
         <kbd class="calibre15">export</kbd> keyword.
      </p>
      
      <p class="noind">Then, when we perform an import of the renamed export, we reference the import through the given alias:</p>
      
      <pre id="PLd0e30032" class="calibre5">import { sayHello } from "Greetings.js";</pre>
      
      <p class="noind">Finally, we test that we have access to the aliased identifier, but not the original one:</p>
      
      <pre id="PLd0e30041" class="calibre5">assert(typeof sayHi === "undefined"
    &amp;&amp; typeof sayHello === "function",
      "When importing, we can only access the alias");</pre>
      
      <p class="noind">The situation is similar when renaming imports, as shown in the following code segment:</p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/299fig01_alt.jpg" alt="" class="calibre2" width="590" height="299" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/299fig01_alt.jpg"></p>
      
      <p class="noind">Similarly to exporting identifiers, we can also use the <kbd class="calibre15">as</kbd> keyword to create aliases when importing identifiers from other modules. This is useful when we need to provide a better
         name that’s more suitable to the current context, or when we want to avoid naming clashes, as is the case in this small example.
      </p>
      
      <p class="noind">With this, we’ve finished our exploration of the ES6 modules’ syntax, which is recapped in <a href="#ch11table01" class="calibre4">table 11.1</a>.
      </p>
      
      <h5 id="ch11table01" class="notetitle">Table 11.1. <a id="ch11table01__title" class="calibre4"></a>Overview of ES6 module syntax
      </h5>
      <table cellpadding="8" width="100%" frame="hsides" cellspacing="5" rules="groups" class="calibre29">
         <colgroup span="2" class="calibre8">
            <col width="250" class="calibre9">
            <col width="350" class="calibre9">
         </colgroup>
         <thead class="calibre30">
            <tr class="calibre11">
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Code</p>
               </th>
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Meaning</p>
               </th>
            </tr>
         </thead>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="docTableCell" valign="top">
                  <pre id="PLd0e30099" class="calibre12">export const ninja = "Yoshi";
export function compare(){}
export class Ninja{}</pre>
                  </td>
               <td class="docTableCell" valign="top">Export a named variable.
                  Export a named function.
                  Export a named class.
               </td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">
                  <pre id="PLd0e30120" class="calibre12">export default class Ninja{}
export default function Ninja(){}</pre>
                  </td>
               <td class="docTableCell" valign="top">Export the default class export.
                  Export the default function export.
               </td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">
                  <pre id="PLd0e30138" class="calibre12">const ninja = "Yoshi";
function compare(){};
export {ninja, compare};
export {ninja as samurai, compare};</pre>
                  </td>
               <td class="docTableCell" valign="top">Export existing variables.
                  Export a variable through a new name.
               </td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">
                  <pre id="PLd0e30156" class="calibre12">import Ninja from "Ninja.js";
import {ninja, Ninja} from "Ninja.js";</pre>
                  </td>
               <td class="docTableCell" valign="top">Import a default export.
                  Import named exports.
               </td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">
                  <pre id="PLd0e30174" class="calibre12">import * as Ninja from "Ninja.js";</pre>
                  </td>
               <td class="docTableCell" valign="top">Import all named exports from a module.</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">
                  <pre id="PLd0e30189" class="calibre12">import {ninja as iNinja} from "Ninja.js";</pre>
                  </td>
               <td class="docTableCell" valign="top">Import a named export through a new name.</td>
            </tr>
         </tbody>
      </table>
      
      
      
      
      
      <h3 id="ch11lev1sec3" class="calibre24"><a id="ch11lev1sec3__title" class="calibre3"></a>11.3. Summary
      </h3>
      
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Large, monolithic code bases are far more likely to be difficult to understand and maintain than smaller, well-organized ones.
            One way of improving the structure and organization of our programs is to break them into smaller, relatively loosely coupled
            segments or modules.
            
         </li>
         
         <li class="calibre20">Modules are larger units of organizing code than objects and functions, and they allow us to divide programs into clusters
            that belong together.
            
         </li>
         
         <li class="calibre20">In general, modules foster understandability, ease maintenance, and improve the reusability of code.
            
         </li>
         
         <li class="calibre20">Pre-ES6 JavaScript has no built-in modules, and developers had to be creative with existing language features to enable code
            modularization. One of the most popular ways of creating modules is by combining immediately invoked functions with closures.
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">Immediate functions are used because they create a new scope for defining module variables that aren’t visible from outside
                  that scope.
                  
               </li>
               
               <li class="calibre20">Closures are used because they enable us to keep module variables alive.
                  
               </li>
               
               <li class="calibre20">The most popular pattern is the module pattern, which usually combines an immediate function with a return of a new object
                  that represents the module’s public interface.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">In addition to the module pattern, two popular module standards exist: Asynchronous Module Definition, designed to enable
            modules in the browser; and CommonJS, which is more popular in server-side JavaScript.
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">AMD can automatically resolve dependencies, and modules are asynchronously loaded, thereby avoiding blocking.
                  
               </li>
               
               <li class="calibre20">CommonJS has a simple syntax, synchronously loads modules (and is therefore more appropriate for the server), and has many
                  packages available through node’s package manager (npm).
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">ES6 modules are designed to take into account the features of AMD and CommonJS. These modules have a simple syntax influenced
            by CommonJS, and provide asynchronous module loading as in AMD.
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">ES6 modules are file based, one module per file.
                  
               </li>
               
               <li class="calibre20">We export identifiers so that they can be referenced by other modules by using the new <kbd class="calibre15">export</kbd> keyword.
                  
               </li>
               
               <li class="calibre20">We import identifiers exported from other modules by using the <kbd class="calibre15">import</kbd> keyword.
                  
               </li>
               
               <li class="calibre20">A module can have a single <kbd class="calibre15">default</kbd> export, which we use if we want to represent that whole module through a single export.
                  
               </li>
               
               <li class="calibre20">Both imports and exports can be renamed with the <kbd class="calibre15">as</kbd> keyword.
                  
               </li>
               
            </ul>
            
         </li>
         
      </ul>
      
      
      
      
      <h3 id="ch11lev1sec4" class="calibre24"><a id="ch11lev1sec4__title" class="calibre3"></a>11.4. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch11qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch11qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch11qa2q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">Which mechanism enables private module variables in the module pattern?</p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20">Prototypes
                  
               </li>
               
               <li class="calibre20">Closures
                  
               </li>
               
               <li class="calibre20">Promises
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch11qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch11qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind">In the following code that uses ES6 modules, which identifiers can be accessed if the module is imported?</p>
            
            <pre id="PLd0e30360" class="calibre5">const spy = "Yagyu";
function command(){
  return general + " commands you to wage war!";
}
export const general = "Minamoto";</pre>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">spy</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">command</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">general</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch11qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch11qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">In the following code that uses ES6 modules, which identifiers can be accessed when the module is imported?</p>
            
            <pre id="PLd0e30394" class="calibre5">const ninja = "Yagyu";
function command(){
  return general + " commands you to wage war!";
}
const general  = "Minamoto";

export {ninja as spy};</pre>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">spy</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">command</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">general</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">ninja</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch11qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch11qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">Which of the following imports are allowed?</p>
            
            <pre id="PLd0e30434" class="calibre5">//File: personnel.js
const ninja = "Yagyu";
function command(){
  return general + " commands you to wage war!";
}
const general  = "Minamoto";

export {ninja as spy};</pre>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">import {ninja, spy, general} from "personnel.js"</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">import * as Personnel from "personnel.js"</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">import {spy} from "personnel.js"</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch11qa2qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch11qa2q5" class="calibre4"></a><b class="calibre21">5 </b></p><p class="noind">If we have the following module code, which statement will import the <kbd class="calibre15">Ninja</kbd> class?
            </p>
            
            <pre id="PLd0e30472" class="calibre5">//Ninja.js
export default class Ninja {
  skulk(){ return "skulking"; }
}</pre>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20">import Ninja from “Ninja.js”
                  
               </li>
               
               <li class="calibre20">import * as Ninja from “Ninja.js”
                  
               </li>
               
               <li class="calibre20">import * from “Ninja.js”
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_39"></div>
<h2 id="part04" class="part">Part 4. <a id="part04__title" class="calibre3"></a>Browser reconnaissance
      </h2>
      
      
      <p class="noind">Now that we’ve explored the fundamentals of the JavaScript language, we’ll move on to browsers, the environment in which most
         JavaScript applications are executed.
      </p>
      
      <p class="noind">In <a href="kindle_split_025.html#ch12" class="calibre4">chapter 12</a>, we’ll take a closer look at the DOM by exploring efficient techniques for modifying the DOM and achieving fast, highly dynamic
         web applications.
      </p>
      
      <p class="noind">In <a href="kindle_split_026.html#ch13" class="calibre4">chapter 13</a>, you’ll learn about events, with a special focus on the event loop and its influence on perceived web application performance.
      </p>
      
      <p class="noind">Finally, the book concludes with a not-so-pleasant but necessary topic: cross-browser development. Although the state of affairs
         has improved greatly in recent years, we still can’t assume that our code will work in the same way in every available browser.
         Therefore, <a href="kindle_split_027.html#ch14" class="calibre4">chapter 14</a> presents strategies for developing cross-browser web applications.
      </p>
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_41"></div>
<h2 id="ch12" class="part">Chapter 12. <a id="ch12__title" class="calibre3"></a>Working the DOM
      </h2>
      
      <p class="noind"><a id="iddle1195" class="calibre4"></a><a id="iddle1342" class="calibre4"></a><a id="iddle1346" class="calibre4"></a><a id="iddle1966" class="calibre4"></a><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Inserting HTML into the DOM
            
         </li>
         
         <li class="calibre20">Understanding DOM attributes and DOM properties
            
         </li>
         
         <li class="calibre20">Discovering computed styles
            
         </li>
         
         <li class="calibre20">Dealing with layout thrashing
            
         </li>
         
      </ul>
      
      <p class="noind">Up to now, you’ve been learning mostly about JavaScript the language, and although there are plenty of nuances to pure JavaScript,
         developing web applications definitely doesn’t get any easier when we throw the browser’s Document Object Model (DOM) into
         the mix. One of the primary means for achieving highly dynamic web applications that respond to user actions is by modifying
         the DOM. But if we were to open up a JavaScript library, you’d notice the length and complexity of the code behind simple
         DOM operations. Even presumably simple operations like <kbd class="calibre15">cloneNode</kbd> and <kbd class="calibre15">removeChild</kbd> have relatively complex implementations.
      </p>
      
      <p class="noind">This raises two questions:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Why is this code so complex?
            
         </li>
         
         <li class="calibre20">Why do you need to understand how it works if the library will take care of it for you?
            
         </li>
         
      </ul>
      
      <p class="noind"><a id="iddle1163" class="calibre4"></a><a id="iddle1298" class="calibre4"></a><a id="iddle1351" class="calibre4"></a><a id="iddle1368" class="calibre4"></a><a id="iddle1637" class="calibre4"></a><a id="iddle1862" class="calibre4"></a>The most compelling reason is <i class="calibre6">performance</i>. Understanding how DOM modification works in libraries can allow you to write better and faster code that uses the library
         or, alternatively, enable you to use those techniques in your own code.
      </p>
      
      <p class="noind">So we’ll start this chapter by seeing how to create new parts of our pages, on demand, by injecting arbitrary HTML. We’ll
         continue by examining all the conundrums that browsers throw at us with respect to element properties and attributes, and
         we’ll discover why the results aren’t always exactly what we might expect.
      </p>
      
      <p class="noind">The same goes for Cascading Style Sheets (CSS) and the styling of elements. Many of the difficulties that we’ll run into when
         constructing a dynamic web application stem from the complications of setting and getting element styling. This book can’t
         cover all that’s known about handling element styling (that’s enough to fill another entire book), but the core essentials
         are discussed.
      </p>
      
      <p class="noind">We’ll finish the chapter by taking a look at some of the performance difficulties that can arise if you don’t pay attention
         to the way you modify and read information from the DOM. Let’s start by seeing how to inject arbitrary HTML into our pages.
      </p>
      
      <h3 class="calibre24"><a id="ch12qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch12qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch12qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">Why do you need to preparse self-closing elements in a page before injecting HTML into it?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch12qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch12qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">What are the benefits of working with DOM fragments when inserting HTML?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch12qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch12qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">How do you determine the dimensions of a hidden element on a page?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch12lev1sec1" class="calibre24"><a id="ch12lev1sec1__title" class="calibre3"></a>12.1. Injecting HTML into the DOM
      </h3>
      
      <p class="noind">In this section, we’ll look at an efficient way to insert HTML into a document at any location, given that HTML as a string.
         We present this particular technique because it’s frequently used to create highly dynamic web pages in which the user interface
         is modified as a response to user actions or data incoming from the server. This is particularly useful for the following
         scenarios:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Injecting arbitrary HTML into a page and manipulating and inserting client-side templates
            
         </li>
         
         <li class="calibre20">Retrieving and injecting HTML sent from a server
            
         </li>
         
      </ul>
      
      <p class="noind">It can be technically challenging to implement this functionality correctly (especially when compared to building an object-oriented-style
         DOM construction API, which is certainly easier to implement but requires an extra layer of abstraction than injecting the
         HTML). Consider this example of creating HTML elements from an HTML string that we can use with jQuery:
      </p>
      
      <pre id="PLd0e30727" class="calibre5">$(document.body).append("&lt;div&gt;&lt;h1&gt;Greetings&lt;/h1&gt;&lt;p&gt;Yoshi here&lt;/p&gt;&lt;/div&gt;")</pre>
      
      <p class="noind"><a id="iddle1354" class="calibre4"></a><a id="iddle1355" class="calibre4"></a><a id="iddle1640" class="calibre4"></a><a id="iddle1641" class="calibre4"></a><a id="iddle1840" class="calibre4"></a>And compare that with an approach that uses only the DOM API:
      </p>
      
      <pre id="PLd0e30786" class="calibre5">const h1 = document.createElement("h1");
h1.textContent = "Greetings";

const p = document.createElement("p");
p.textContent = "Yoshi here";

const div = document.createElement("div");

div.appendChild(h1);
div.appendChild(p);

document.body.appendChild(div);</pre>
      
      <p class="noind">Which one would you rather use?</p>
      
      <p class="noind">For these reasons, we’ll implement our own way of doing clean DOM manipulation from scratch. The implementation requires the
         following steps:
      </p>
      
      <p class="calibre18"></p>
      <ol class="calibre27">
         
         <li class="calibre20">Convert an arbitrary but valid HTML string into a DOM structure.
            
         </li>
         
         <li class="calibre20">Inject that DOM structure into any location in the DOM as efficiently as possible.
            
         </li>
         
      </ol>
      
      <p class="noind">These steps provide page authors with a smart way to inject HTML into a document. Let’s get started.</p>
      
      
      <h4 id="ch12lev2sec1" class="calibre26">12.1.1. <a id="ch12lev2sec1__title" class="calibre4"></a>Converting HTML to DOM
      </h4>
      
      <p class="noind">Converting an HTML string to a DOM structure doesn’t involve a whole lot of magic. In fact, it uses a tool that you’re most
         likely already familiar with: the <kbd class="calibre15">innerHTML</kbd> property of DOM elements.
      </p>
      
      <p class="noind">Using it is a multistep process:</p>
      
      <p class="calibre18"></p>
      <ol class="calibre27">
         
         <li class="calibre20">Make sure that the HTML string contains valid HTML code.
            
         </li>
         
         <li class="calibre20">Wrap the string in any enclosing markup that’s required by browser rules.
            
         </li>
         
         <li class="calibre20">Insert the HTML string, using <kbd class="calibre15">innerHTML</kbd>, into a dummy DOM element.
            
         </li>
         
         <li class="calibre20">Extract the DOM nodes back out.
            
         </li>
         
      </ol>
      
      <p class="noind">The steps aren’t overly complex, but the actual insertion has some gotchas that we’ll need to take into account. Let’s take
         a look at each step in detail.
      </p>
      
      
      <h5 id="ch12lev3sec1" class="notetitle"><a id="ch12lev3sec1__title" class="calibre4"></a>Preprocessing the HTML source string
      </h5>
      
      <p class="noind">To start, we’ll need to clean up the source HTML to meet our needs. For example, let’s take a look at a skeleton HTML that
         allows us to choose a ninja (through the <kbd class="calibre15">option</kbd> element) and that shows the details of the chosen ninja within a table, details that are intended to be added at a later
         point:
      </p>
      
      <pre id="PLd0e30868" class="calibre5">&lt;option&gt;Yoshi&lt;/option&gt;
&lt;option&gt;Kuma&lt;/option&gt;
&lt;table/&gt;</pre>
      
      <p class="noind"><a id="iddle1173" class="calibre4"></a><a id="iddle1352" class="calibre4"></a><a id="iddle1638" class="calibre4"></a><a id="iddle2008" class="calibre4"></a>This HTML string has two problems. First, the option elements shouldn’t stand on their own. If you follow proper HTML semantics,
         they should be contained within a <kbd class="calibre15">select</kbd> element. Second, even though markup languages usually allow us to self-close childless elements, such as <kbd class="calibre15">&lt;table/&gt;</kbd>, in HTML the self-closing works for only a small subset of elements (<kbd class="calibre15">table</kbd> not being one of them). Attempting to use that syntax in other cases is likely to cause problems in some browsers.
      </p>
      
      <p class="noind">Let’s start with solving the problem of self-closing elements. To support this feature, we can do a quick preparse on the
         HTML string to convert elements such as <kbd class="calibre15">&lt;table/&gt;</kbd> to <kbd class="calibre15">&lt;table&gt;&lt;/table&gt;</kbd> (which will be handled uniformly in all browsers), as shown in the following listing.
      </p>
      
      
      
      <h5 id="ch12ex01" class="notetitle">Listing 12.1. <a id="ch12ex01__title" class="calibre4"></a>Making sure that self-closing elements are interpreted correctly
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/308fig01_alt.jpg" alt="" class="calibre2" width="590" height="206" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/308fig01_alt.jpg"></p>
      
      
      <p class="noind">When we apply the <kbd class="calibre15">convert</kbd> function to this example HTML string, we end up with the following HTML string:
      </p>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/308fig02.jpg" alt="" class="calibre2" width="487" height="55" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/308fig02.jpg"></p>
      
      
      <p class="noind">With that accomplished, we still have to solve the problem that our <kbd class="calibre15">option</kbd> elements aren’t contained within a <kbd class="calibre15">select</kbd> element. Let’s see how to determine whether an element needs to be wrapped.
      </p>
      
      
      
      <h5 id="ch12lev3sec2" class="notetitle"><a id="ch12lev3sec2__title" class="calibre4"></a>HTML wrapping
      </h5>
      
      <p class="noind">According to the semantics of HTML, some HTML elements must be within certain container elements before they can be injected.
         For example, an <kbd class="calibre15">&lt;option&gt;</kbd> element must be contained within a <kbd class="calibre15">&lt;select&gt;</kbd>.
      </p>
      
      <p class="noind">We can solve this problem in two ways, both of which require constructing a mapping between problematic elements and their
         containers:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><a id="iddle1207" class="calibre4"></a><a id="iddle1208" class="calibre4"></a><a id="iddle1274" class="calibre4"></a><a id="iddle1333" class="calibre4"></a><a id="iddle1382" class="calibre4"></a><a id="iddle2092" class="calibre4"></a>The string could be injected directly into a specific parent by using <kbd class="calibre15">innerHTML</kbd>, where the parent has been previously constructed using the built-in <kbd class="calibre15">document createElement</kbd>. Although this may work in some cases and in some browsers, it isn’t universally guaranteed.
            
         </li>
         
         <li class="calibre20">The string could be wrapped with the appropriate required markup and then injected directly into any container element (such
            as a <kbd class="calibre15">&lt;div&gt;</kbd>). This is more foolproof, but it’s also more work.
            
         </li>
         
      </ul>
      
      <p class="noind">The second technique is preferred; it involves little browser-specific code, in contrast to the first approach, which requires
         a fair amount of mostly browser-specific code.
      </p>
      
      <p class="noind">The set of problematic elements that need to be wrapped in specific container elements is fortunately a rather manageable
         seven. In <a href="#ch12table01" class="calibre4">table 12.1</a>, the ellipses (<kbd class="calibre15">...</kbd>) indicates the locations where the elements need to be injected.
      </p>
      
      <h5 id="ch12table01" class="notetitle">Table 12.1. <a id="ch12table01__title" class="calibre4"></a>Elements that need to be contained within other elements
      </h5>
      <table cellpadding="8" width="100%" frame="hsides" cellspacing="5" rules="groups" class="calibre29">
         <colgroup span="2" class="calibre8">
            <col width="250" class="calibre9">
            <col width="350" class="calibre9">
         </colgroup>
         <thead class="calibre30">
            <tr class="calibre11">
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Element name</p>
               </th>
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Ancestor element</p>
               </th>
            </tr>
         </thead>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="docTableCell" valign="top">&lt;option&gt;, &lt;optgroup&gt;</td>
               <td class="docTableCell" valign="top">&lt;select multiple&gt;...&lt;/select&gt;</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">&lt;legend&gt;</td>
               <td class="docTableCell" valign="top">&lt;fieldset&gt;...&lt;/fieldset&gt;</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">&lt;thead&gt;, &lt;tbody&gt;, &lt;tfoot&gt;, &lt;colgroup&gt;, &lt;caption&gt;</td>
               <td class="docTableCell" valign="top">&lt;table&gt;...&lt;/table&gt;</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">&lt;tr&gt;</td>
               <td class="docTableCell" valign="top">
                  &lt;table&gt;&lt;thead&gt;...&lt;/thead&gt;&lt;/table&gt;<br class="calibre13">&lt;table&gt;&lt;tbody&gt;...&lt;/tbody&gt;&lt;/table&gt;<br class="calibre13">&lt;table&gt;&lt;tfoot&gt;...&lt;/tfoot&gt;&lt;/table&gt;
                  
               </td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">&lt;td&gt;, &lt;th&gt;</td>
               <td class="docTableCell" valign="top">&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;...&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">&lt;col&gt;</td>
               <td class="docTableCell" valign="top">
                  &lt;table&gt;<br class="calibre13">  &lt;tbody&gt;&lt;/tbody&gt;<br class="calibre13">  &lt;colgroup&gt;...&lt;/colgroup&gt;<br class="calibre13">&lt;/table&gt;
                  
               </td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Nearly all of these are straightforward, save for the following points, which require a bit of explanation:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">A <kbd class="calibre15">&lt;select&gt;</kbd> element with the <kbd class="calibre15">multiple</kbd> attribute is used (as opposed to a nonmultiple select) because it won’t automatically check any of the options that are placed
            inside it (whereas a single select will autocheck the first option).
            
         </li>
         
         <li class="calibre20">The <kbd class="calibre15">&lt;col&gt;</kbd> fix includes an extra <kbd class="calibre15">&lt;tbody&gt;</kbd>, without which the <kbd class="calibre15">&lt;colgroup&gt;</kbd> won’t be generated properly.
            
         </li>
         
      </ul>
      
      <p class="noind">With the elements properly mapped to their wrapping requirements, let’s start generating.</p>
      
      <p class="noind">With the information from <a href="#ch12table01" class="calibre4">table 12.1</a>, we can generate the HTML that we need to insert into a DOM element, as shown in the following listing.
      </p>
      
      
      <p class="noind"></p>
      <h5 id="ch12ex02" class="notetitle">Listing 12.2. <a id="ch12ex02__title" class="calibre4"></a>Generating a list of DOM nodes from some markup
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex02-0.jpg" alt="" class="calibre2" width="590" height="232" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex02-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex02-1.jpg" alt="" class="calibre2" width="590" height="180" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex02-1.jpg"></p>
      
      <p class="noind">We create a map of all element types that need to be placed within special parent containers, a map that contains the depth
         of the node, as well as the enclosing HTML. Next, we use a regular expression to match the opening bracket and the tag name
         of the element we want to insert:
      </p>
      
      <pre id="PLd0e31233" class="calibre5">const tagName = htmlString.match(/&lt;\w+/);</pre>
      
      <p class="noind">Then we select a map entry, and in case there isn’t one, we create a dummy entry with an empty parent element markup:</p>
      
      <pre id="PLd0e31242" class="calibre5">let mapEntry = tagName ? map[tagName[0]] : null;
if  (!mapEntry) { mapEntry = [0, " ", " "]; }</pre>
      
      <p class="noind">We follow this by creating a new <kbd class="calibre15">div</kbd> element, surrounding it with the mapped HTML, and inserting the newly created HTML into the previously created <kbd class="calibre15">div</kbd> element:
      </p>
      
      <pre id="PLd0e31257" class="calibre5">let div = (doc || document).createElement("div");
div.innerHTML = mapEntry[1] + htmlString + mapEntry[2]</pre>
      
      <p class="noind"><a id="iddle1353" class="calibre4"></a><a id="iddle1369" class="calibre4"></a><a id="iddle1513" class="calibre4"></a><a id="iddle1639" class="calibre4"></a>Finally, we find the parent of the desired node created from our HTML string, and we return the newly created node:
      </p>
      
      <pre id="PLd0e31299" class="calibre5">while (mapEntry[0]--) { div = div.lastChild;}
return div.childNodes;</pre>
      
      <p class="noind">After all of this, we have a set of DOM nodes that we can begin to insert into the document.</p>
      
      <p class="noind">If we go back to our motivating example, and apply the <kbd class="calibre15">getNodes</kbd> function, we’ll end up with something along the following lines:
      </p>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/311fig01.jpg" alt="" class="calibre2" width="471" height="93" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/311fig01.jpg"></p>
      
      
      
      
      
      <h4 id="ch12lev2sec2" class="calibre26">12.1.2. <a id="ch12lev2sec2__title" class="calibre4"></a>Inserting elements into the document
      </h4>
      
      <p class="noind">After we have the DOM nodes, it’s time to insert them into the document. A couple of steps are required, and we’ll work through
         them in this section.
      </p>
      
      <p class="noind">Because we have an array of elements that we need to insert—potentially into any number of locations within the document—we
         want to try to keep the number of operations performed to a minimum. We can do this by using <i class="calibre6">DOM fragments</i>. DOM fragments are part of the W3C DOM specification and are supported in all browsers. This useful facility gives us a container
         to hold a collection of DOM nodes.
      </p>
      
      <p class="noind">This in itself is quite useful, but it also has the advantage that the fragment can be injected and cloned in a single operation
         instead of having to inject and clone each individual node over and over again. This has the potential to dramatically reduce
         the number of operations required for a page.
      </p>
      
      <p class="noind">Before we use this mechanism in our code, let’s revisit the <kbd class="calibre15">getNodes()</kbd> code of <a href="#ch12ex02" class="calibre4">listing 12.2</a> and adjust it a tad to use DOM fragments. The changes are minor and consist of adding a <kbd class="calibre15">fragment</kbd> parameter to the function’s parameter list, as follows.
      </p>
      
      <h5 id="ch12ex03" class="notetitle">Listing 12.3. <a id="ch12ex03__title" class="calibre4"></a>Expanding the getNodes function with fragments
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex03-0.jpg" alt="" class="calibre2" width="590" height="224" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex03-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex03-1.jpg" alt="" class="calibre2" width="590" height="237" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex03-1.jpg"></p>
      
      <p class="noind"><a id="iddle1337" class="calibre4"></a><a id="iddle1985" class="calibre4"></a>In this example, we make a couple of changes. First we modify the function signature by adding another parameter, <kbd class="calibre15">fragment</kbd>:
      </p>
      
      <pre id="PLd0e31381" class="calibre5">function getNodes(htmlString, doc, fragment) {...}</pre>
      
      <p class="noind">This parameter, if it’s passed, is expected to be a DOM fragment that we want the nodes to be injected into for later use.</p>
      
      <p class="noind">To do so, we add the following fragment just before the <kbd class="calibre15">return</kbd> statement of the function to add the nodes to the passed fragment:
      </p>
      
      <pre id="PLd0e31396" class="calibre5">if (fragment) {
  while (div.firstChild) {
    fragment.appendChild(div.firstChild);
  }
}</pre>
      
      <p class="noind">Now, let’s see it in use. In the following listing, which assumes that the updated <kbd class="calibre15">getNodes</kbd> function is in scope, a fragment is created and passed in to that function (which, you may recall, converts the incoming
         HTML string into DOM elements). This DOM is now appended to the fragment.
      </p>
      
      <h5 id="ch12ex04" class="notetitle">Listing 12.4. <a id="ch12ex04__title" class="calibre4"></a>Inserting a DOM fragment into multiple locations in the DOM
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex04-0.jpg" alt="" class="calibre2" width="590" height="175" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex04-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex04-1.jpg" alt="" class="calibre2" width="590" height="243" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex04-1.jpg"></p>
      
      <p class="noind"><a id="iddle1109" class="calibre4"></a><a id="iddle1347" class="calibre4"></a><a id="iddle1370" class="calibre4"></a><a id="iddle1609" class="calibre4"></a><a id="iddle1895" class="calibre4"></a>There’s another important point here: If we’re inserting this element into more than one location in the document, we’re going
         to need to clone this fragment again and again. If we weren’t using a fragment, we’d have to clone each individual node every
         time, instead of the whole fragment at once.
      </p>
      
      <p class="noind">With this, we’ve developed a way to generate and insert arbitrary DOM elements in an intuitive manner. Let’s continue this
         exploration of the DOM by seeing the difference between DOM attributes and properties.
      </p>
      
      
      
      
      <h3 id="ch12lev1sec2" class="calibre24"><a id="ch12lev1sec2__title" class="calibre3"></a>12.2. Using DOM attributes and properties
      </h3>
      
      <p class="noind">When accessing the values of element attributes, we have two options: using the traditional DOM methods of <kbd class="calibre15">getAttribute</kbd> and <kbd class="calibre15">setAttribute,</kbd> or using properties of the DOM objects that correspond to the attributes.
      </p>
      
      <p class="noind">For example, to obtain the <kbd class="calibre15">id</kbd> of an element whose reference is stored in variable <kbd class="calibre15">e</kbd>, we could use either of the following:
      </p>
      
      <pre id="PLd0e31484" class="calibre5">e.getAttribute('id')
e.id</pre>
      
      <p class="noind">Either will give us the value of the <kbd class="calibre15">id</kbd>.
      </p>
      
      <p class="noind">Let’s examine the following code to better understand how attribute values and their corresponding properties behave.</p>
      
      
      
      <h5 id="ch12ex05" class="notetitle">Listing 12.5. <a id="ch12ex05__title" class="calibre4"></a>Accessing attribute values via DOM methods and properties
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/313fig01_alt.jpg" alt="" class="calibre2" width="590" height="272" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/313fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1334" class="calibre4"></a><a id="iddle1372" class="calibre4"></a><a id="iddle1648" class="calibre4"></a><a id="iddle2017" class="calibre4"></a>This example shows interesting behavior with respect to element attributes and element properties. It starts by defining a
         simple <kbd class="calibre15">&lt;div&gt;</kbd> element that we’ll use as a test subject. Within the document’s <kbd class="calibre15">DOMContentLoaded</kbd> handler (to ensure that the DOM is fully built), we obtain a reference to the lone <kbd class="calibre15">&lt;div&gt;</kbd> element, <kbd class="calibre15">const div = document.querySelector("div")</kbd>, and then run a few tests.
      </p>
      
      <p class="noind">In the first test, we set the <kbd class="calibre15">id</kbd> attribute to the value <kbd class="calibre15">ninja-1</kbd> via the <kbd class="calibre15">setAttribute()</kbd> method. Then we assert that <kbd class="calibre15">getAttribute()</kbd> returns the same value for that attribute. It should be no surprise that this test works just fine when we load the page:
      </p>
      
      <pre id="PLd0e31566" class="calibre5">div.setAttribute("id", "ninja-1");
assert(div.getAttribute('id') === "ninja-1",
       "Attribute successfully changed");</pre>
      
      <p class="noind">Similarly, in the next test, we set the <kbd class="calibre15">id</kbd> property to the value <kbd class="calibre15">ninja-2</kbd> and then verify that the property value has indeed changed. No problem.
      </p>
      
      <pre id="PLd0e31581" class="calibre5">div.id = "ninja-2";
assert(div.id === "ninja-2",
      "Property successfully changed");</pre>
      
      <p class="noind"><a id="iddle1240" class="calibre4"></a><a id="iddle1360" class="calibre4"></a><a id="iddle1365" class="calibre4"></a><a id="iddle2064" class="calibre4"></a><a id="iddle2068" class="calibre4"></a><a id="iddle2070" class="calibre4"></a><a id="iddle2074" class="calibre4"></a><a id="iddle2079" class="calibre4"></a>The next test is when things get interesting. We again set the <kbd class="calibre15">id</kbd> property to a new value, in this case <kbd class="calibre15">ninja-3</kbd>, and again verify that the property value has changed. But then we also assert that not only should the property value change,
         but also the value of the <kbd class="calibre15">id</kbd> <i class="calibre6">attribute</i>. Both assertions pass. From this we learn that the <kbd class="calibre15">id</kbd> property and the <kbd class="calibre15">id</kbd> attribute are somehow linked together. Changing the <kbd class="calibre15">id</kbd> property value also changes the <kbd class="calibre15">id</kbd> attribute value:
      </p>
      
      <pre id="PLd0e31673" class="calibre5">div.id = "ninja-3";
assert(div.id === "ninja-3",
      "Property successfully changed");
assert(div.getAttribute('id') === "ninja-3",
       "Attribute successfully changed via property");</pre>
      
      <p class="noind">The next test proves that it also works the other way around: Setting an attribute value also changes the corresponding property
         value.
      </p>
      
      <pre id="PLd0e31682" class="calibre5">div.setAttribute("id","ninja-4");
assert(div.id === "ninja-4",
       "Property successfully changed via attribute");
assert(div.getAttribute('id') === "ninja-4","Attribute changed");</pre>
      
      <p class="noind">But don’t let this fool you into thinking that the property and attribute are sharing the same value—they aren’t. We’ll see
         later in this chapter that the attribute and corresponding property, although linked, aren’t always identical.
      </p>
      
      <p class="noind">It’s important to note that not all attributes are represented by element properties. Although it’s generally true for attributes
         that are natively specified by the HTML DOM, <i class="calibre6">custom attributes</i> that we may place on the elements in our pages don’t automatically become represented by element properties. To access the
         value of a custom attribute, we need to use the DOM methods <kbd class="calibre15">getAttribute()</kbd> and <kbd class="calibre15">setAttribute()</kbd>.
      </p>
      
      <p class="noind">If you’re not sure whether a property for an attribute exists, you can always test for it and fall back to the DOM methods
         if it doesn’t exist. Here’s an example:
      </p>
      
      <pre id="PLd0e31706" class="calibre5">const value = element.someValue ? element.someValue
                                : element.getAttribute('someValue');</pre>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch12note01" class="notetitle">Tip</h5>
      
      
      <p class="noindclose">In HTML5, use the prefix <kbd class="calibre15">data-</kbd> for all custom attributes to keep them valid in the eye of the HTML5 specification. It’s a good convention that clearly separates
         custom attributes from native attributes.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      
      <h3 id="ch12lev1sec3" class="calibre24"><a id="ch12lev1sec3__title" class="calibre3"></a>12.3. Styling attribute headaches
      </h3>
      
      <p class="noind">As with general attributes, getting and setting styling attributes can be a headache. As with the attributes and properties
         in the previous section, we again have two approaches for handling <kbd class="calibre15">style</kbd> values: the attribute value, and the element property created from it.
      </p>
      
      <p class="noind">The most commonly used of these is the <kbd class="calibre15">style</kbd> element property, which isn’t a string but an object that holds properties corresponding to the style values specified in
         the element markup. In addition, you’ll see that there’s a method for accessing the computed style information of an element,
         where <i class="calibre6">computed style</i> means the style that will be applied to the element after evaluating all inherited and applied style information.
      </p>
      
      <p class="noind">This section outlines the things you need to know when working with styles in browsers. Let’s start with a look at where style
         information is recorded.
      </p>
      
      
      <h4 id="ch12lev2sec3" class="calibre26">12.3.1. <a id="ch12lev2sec3__title" class="calibre4"></a>Where are my styles?
      </h4>
      
      <p class="noind">The style information located in the <kbd class="calibre15">style</kbd> property of a DOM element is initially set from the value specified for the <kbd class="calibre15">style</kbd> attribute in the element markup. For example, <kbd class="calibre15">style="color:red;"</kbd> results in that style information being placed into the style object. During page execution, the script can set or modify
         values in the style object, and these changes will actively affect the display of the element.
      </p>
      
      <p class="noind"><a id="iddle1014" class="calibre4"></a><a id="iddle1335" class="calibre4"></a><a id="iddle2069" class="calibre4"></a>Many script authors are disappointed to find that no values from on-page <kbd class="calibre15">&lt;style&gt;</kbd> elements or external style sheets are available in the element’s <kbd class="calibre15">style</kbd> object. But we won’t stay disappointed for long—you’ll soon see a way to obtain this information.
      </p>
      
      <p class="noind">For now, let’s see how the <kbd class="calibre15">style</kbd> property gets its values. Examine the following code.
      </p>
      
      
      
      <h5 id="ch12ex06" class="notetitle">Listing 12.6. <a id="ch12ex06__title" class="calibre4"></a>Examining the style property
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/316fig01_alt.jpg" alt="" class="calibre2" width="590" height="384" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/316fig01_alt.jpg"></p>
      
      
      <p class="noind">In this example, we set up a <kbd class="calibre15">&lt;style&gt;</kbd> element to establish an internal style sheet whose values will be applied to the elements on the page. The style sheet specifies
         that all <kbd class="calibre15">&lt;div&gt;</kbd> elements will appear in a font size that’s 1.8 times bigger than the default, with a solid gold border of <kbd class="calibre15">0</kbd> width. Any elements to which this is applied will possess a border, but it won’t be visible because it has a width of <kbd class="calibre15">0</kbd>.
      </p>
      
      <pre id="PLd0e31822" class="calibre5">&lt;style&gt;
  div { font-size: 1.8em; border: 0 solid gold; }
&lt;/style&gt;</pre>
      
      <p class="noind">Then we create a <kbd class="calibre15">&lt;div&gt;</kbd> element with an inlined style attribute that colors the text of the element black:
      </p>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/316fig02.jpg" alt="" class="calibre2" width="495" height="60" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/316fig02.jpg"></p>
      
      
      <p class="noind"><a id="iddle1127" class="calibre4"></a><a id="iddle1230" class="calibre4"></a><a id="iddle1670" class="calibre4"></a><a id="iddle2067" class="calibre4"></a>We then begin the testing. After obtaining a reference to the <kbd class="calibre15">&lt;div&gt;</kbd> element, we test that the <kbd class="calibre15">style</kbd> attribute receives a <kbd class="calibre15">color</kbd> property that represents the color assigned to the element. Note that even though the <kbd class="calibre15">color</kbd> is specified as <kbd class="calibre15">#000</kbd> in the inline style, it’s normalized to RGB notation when set in the <kbd class="calibre15">style</kbd> property in most browsers (so we check both formats).
      </p>
      
      <pre id="PLd0e31886" class="calibre5">assert(div.style.color === 'rgb(0, 0, 0)' ||
       div.style.color === '#000',
       'color was recorded');</pre>
      
      <p class="noind">Looking ahead, in <a href="#ch12fig01" class="calibre4">figure 12.1</a>, we see that this test passes.
      </p>
      
      
      
      <h5 id="ch12fig01" class="notetitle">Figure 12.1. <a id="ch12fig01__title" class="calibre4"></a>By running this test, we can see that inline and assigned styles are recorded, but inherited styles aren’t.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/12fig01.jpg" alt="" class="calibre2" width="388" height="282" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/12fig01.jpg"></p>
      
      
      
      <p class="noind">Then we naïvely test that the fontsize styling and the border width specified in the inline style sheet have been recorded
         in the style object. But even though we can see in <a href="#ch12fig01" class="calibre4">figure 12.1</a> that the fontsize style has been applied to the element, the test fails. This is because the style object doesn’t reflect
         any style information inherited from CSS style sheets:
      </p>
      
      <pre id="PLd0e31917" class="calibre5">assert(div.style.fontSize === '1.8em',
       'fontSize was recorded');
assert(div.style.borderWidth === '0',
       'borderWidth was recorded');</pre>
      
      <p class="noind">Moving on, we use an assignment to change the value of the <kbd class="calibre15">borderWidth</kbd> property in the style object to <kbd class="calibre15">4</kbd> pixels wide and test that the change is applied. We can see in <a href="#ch12fig01" class="calibre4">figure 12.1</a> that the test passes and that the previously invisible border is applied to the element. This assignment causes a <kbd class="calibre15">borderWidth</kbd> property to appear in the <kbd class="calibre15">style</kbd> property of the element, as proven by the test.
      </p>
      
      <pre id="PLd0e31941" class="calibre5">div.style.borderWidth = "4px";
assert(div.style.borderWidth === '4px',
       'borderWidth was replaced');</pre>
      
      <p class="noind">It should be noted that any values in an element’s <kbd class="calibre15">style</kbd> property take precedence over anything inherited by a style sheet (even if the style sheet rule uses the <kbd class="calibre15">!important</kbd> annotation).
      </p>
      
      <p class="noind">One thing that you may have noted in <a href="#ch12ex06" class="calibre4">listing 12.6</a> is that CSS specifies the font size property as <kbd class="calibre15">font-size</kbd>, but in script you reference it as <kbd class="calibre15">fontSize</kbd>. Why is that?
      </p>
      
      
      
      
      <h4 id="ch12lev2sec4" class="calibre26">12.3.2. <a id="ch12lev2sec4__title" class="calibre4"></a>Style property naming
      </h4>
      
      <p class="noind"><a id="iddle1364" class="calibre4"></a><a id="iddle2078" class="calibre4"></a>CSS attributes cause relatively few cross-browser difficulties when it comes to accessing the values provided by the browser.
         But differences between how CSS names styles and how we access those in script do exist, and some style names differ across
         browsers.
      </p>
      
      <p class="noind">CSS attributes that span more than one word separate the words with a hyphen; examples are <kbd class="calibre15">font-weight</kbd>, <kbd class="calibre15">font-size</kbd>, and <kbd class="calibre15">background-color</kbd>. You may recall that property names in JavaScript <i class="calibre6">can</i> contain a hyphen, but including a hyphen prevents the property from being accessed via the dot operator.
      </p>
      
      <p class="noind">Consider this example:</p>
      
      <pre id="PLd0e32016" class="calibre5">const fontSize = element.style['font-size'];</pre>
      
      <p class="noind">The preceding is perfectly valid. But the following isn’t:</p>
      
      <pre id="PLd0e32025" class="calibre5">const fontSize = element.style.font-size;</pre>
      
      <p class="noind">The JavaScript parser would see the hyphen as a subtraction operator, and nobody would be happy with the outcome. Rather than
         forcing page developers to always use the general form for property access, <i class="calibre6">multiword CSS style names are converted to camel case when used as a property name</i>. As a result, <kbd class="calibre15">font-size</kbd> becomes <kbd class="calibre15">fontSize</kbd>, and <kbd class="calibre15">backgroundcolor</kbd> becomes <kbd class="calibre15">backgroundColor</kbd>.
      </p>
      
      <p class="noind">We can either remember to do this, or write a simple API to set or get styles that automatically handle the camel casing,
         as shown in the following listing.
      </p>
      
      
      
      <h5 id="ch12ex07" class="notetitle">Listing 12.7. <a id="ch12ex07__title" class="calibre4"></a>A simple method for accessing styles
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/318fig01_alt.jpg" alt="" class="calibre2" width="590" height="330" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/318fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1239" class="calibre4"></a><a id="iddle1361" class="calibre4"></a><a id="iddle2071" class="calibre4"></a><a id="iddle2075" class="calibre4"></a><a id="iddle2163" class="calibre4"></a><a id="iddle2204" class="calibre4"></a>The style function has two important characteristics:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">It uses a regular expression to convert the <kbd class="calibre15">name</kbd> parameter to camel-case notation. (If the regex-driven conversion operation has you scratching your head, you might want
            to review the material in <a href="kindle_split_022.html#ch10" class="calibre4">chapter 10</a>.)
            
         </li>
         
         <li class="calibre20">It can be used both as a setter and a getter, by inspecting its own argument list. For example, we can obtain the value of
            the font-size property with <kbd class="calibre15">style(div, 'font-size')</kbd>, and we can set a new value with <kbd class="calibre15">style(div, 'font-size', '5px')</kbd>.
            
         </li>
         
      </ul>
      
      <p class="noind">Consider the following code:</p>
      
      <pre id="PLd0e32141" class="calibre5">function style(element,name,value){
    ...
  if (typeof value !== 'undefined') {
    element.style[name] = value;
  }

  return element.style[name];
}</pre>
      
      <p class="noind">If a <kbd class="calibre15">value</kbd> argument is passed to the function, the function acts as a setter, setting the passed value as the value of the attribute.
         If the <kbd class="calibre15">value</kbd> argument is omitted and only the first two arguments are passed, it acts as a getter, retrieving the value of the specified
         attribute. In either case, the value of the attribute is returned, which makes it easy to use the function in either of its
         modes in a function-call chain.
      </p>
      
      <p class="noind">The <kbd class="calibre15">style</kbd> property of an element doesn’t include any style information that an element inherits from style sheets in scope for the
         element. Many times it would be handy to know the full computed style that’s been applied to an element, so let’s see if there’s
         a way to obtain that.
      </p>
      
      
      
      <h4 id="ch12lev2sec5" class="calibre26">12.3.3. <a id="ch12lev2sec5__title" class="calibre4"></a>Fetching computed styles
      </h4>
      
      <p class="noind">At any point in time, the <i class="calibre6">computed style</i> of an element is a combination of all the built-in styles provided by the browser, all the styles applied to it via style
         sheets, the element’s <kbd class="calibre15">style</kbd> attribute, and any manipulations of the <kbd class="calibre15">style</kbd> property by script. <a href="#ch12fig02" class="calibre4">Figure 12.2</a> shows how browser developer tools differentiate between styles.
      </p>
      
      
      
      <h5 id="ch12fig02" class="notetitle">Figure 12.2. <a id="ch12fig02__title" class="calibre4"></a>The final style associated with an element can come from many things: the browser builtin styles (user agent style sheet),
         the styles assigned through the style property, and styles from the CSS rules defined in CSS code.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/12fig02_alt.jpg" alt="" class="calibre2" width="590" height="331" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/12fig02_alt.jpg"></p>
      
      
      <p class="noind">The standard method, implemented by all modern browsers, is the <kbd class="calibre15">getComputedStyle</kbd> method. This method accepts an element whose styles are to be computed and returns an interface through which property queries
         can be made. The returned interface provides a method named <kbd class="calibre15">getPropertyValue</kbd> for retrieving the computed style of a specific style property.
      </p>
      
      <p class="noind">Unlike the properties of an element’s <kbd class="calibre15">style</kbd> object, the <kbd class="calibre15">getPropertyValue</kbd> method accepts CSS property names (such as <kbd class="calibre15">font-size</kbd> and <kbd class="calibre15">background-color</kbd>) rather than the camel-cased versions of those names.
      </p>
      
      <p class="noind">The following listing shows a simple example.</p>
      
      <h5 id="ch12ex08" class="notetitle">Listing 12.8. <a id="ch12ex08__title" class="calibre4"></a>Fetching computed style values
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex08-0.jpg" alt="" class="calibre2" width="590" height="177" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex08-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex08-1.jpg" alt="" class="calibre2" width="590" height="299" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex08-1.jpg"></p>
      
      <p class="noind"><a id="iddle1231" class="calibre4"></a><a id="iddle1241" class="calibre4"></a><a id="iddle1971" class="calibre4"></a>To test the function that we’ll be creating, we set up an element that specifies style information in its markup and a style
         sheet that provides style rules to be applied to the element. We expect that the computed styles will be the result of applying
         both the immediate and the applied styles to the element.
      </p>
      
      <p class="noind">We then define the new function, which accepts an element and the style property that we want to find the computed value for.
         And to be especially friendly (after all, we’re ninjas—making things easier for those using our code is part of the job),
         we’ll allow multiword property names to be specified in either format: dashed or camel-cased. In other words, we’ll accept
         both <kbd class="calibre15">backgroundColor</kbd> and <kbd class="calibre15">background-color</kbd>. We’ll see how to accomplish that in a little bit.
      </p>
      
      <p class="noind">The first thing we want to do is to obtain the computed style interface, which we store in a variable, <kbd class="calibre15">computedStyles</kbd>, for later reference. We want to do things this way because we don’t know how expensive making this call may be, and it’s
         likely best to avoid repeating it needlessly.
      </p>
      
      <pre id="PLd0e32270" class="calibre5">const computedStyles = getComputedStyle(element);
if (computedStyles) {
  property = property.replace(/([A-Z])/g,'-$1').toLowerCase();
  return computedStyles.getPropertyValue(property);
}</pre>
      
      <p class="noind">If that succeeds (and we can’t think of any reason why it wouldn’t, but it frequently pays to be cautious), we call the <kbd class="calibre15">getPropertyValue()</kbd> method of the interface to get the computed style value. But first we adjust the name of the property to accommodate either
         the camel-cased or dashed version of the property name. The <kbd class="calibre15">getPropertyValue</kbd> method expects the dashed version, so we use the <kbd class="calibre15">String</kbd>’s <kbd class="calibre15">replace()</kbd> method, with a simple but clever regular expression, to insert a hyphen before every uppercase character and then lowercase
         the whole thing. (Bet that was easier than you thought it would be.)
      </p>
      
      <p class="noind">To test the function, we make calls to the function, passing various style names in various formats, and display the results,
         as shown in <a href="#ch12fig03" class="calibre4">figure 12.3</a>.
      </p>
      
      
      
      <h5 id="ch12fig03" class="notetitle">Figure 12.3. <a id="ch12fig03__title" class="calibre4"></a>Computed styles include all styles specified with the element as well as those inherited from style sheets.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/12fig03.jpg" alt="" class="calibre2" width="388" height="316" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/12fig03.jpg"></p>
      
      
      
      <p class="noind">Note that the styles are fetched regardless of whether they’re explicitly declared on the element or inherited from the style
         sheet. Also note that the <kbd class="calibre15">color</kbd> property, specified in both the style sheet and directly on the element, returns the explicit value. Styles specified by
         an element’s <kbd class="calibre15">style</kbd> attribute always take precedence over inherited styles, even if marked <kbd class="calibre15">!important</kbd>.
      </p>
      
      <p class="noind"><a id="iddle1051" class="calibre4"></a><a id="iddle1126" class="calibre4"></a><a id="iddle1362" class="calibre4"></a><a id="iddle1867" class="calibre4"></a><a id="iddle2065" class="calibre4"></a><a id="iddle2073" class="calibre4"></a><a id="iddle2076" class="calibre4"></a>We need to be aware of one more topic when dealing with style properties: <i class="calibre6">amalgam</i> properties. CSS allows us to use a shortcut notation for the amalgam of properties such as the <kbd class="calibre15">border-</kbd>properties. Rather than forcing us to specify colors, widths, and border styles individually and for all four borders, we
         can use a rule such as this:
      </p>
      
      <pre id="PLd0e32381" class="calibre5">border: 1px solid crimson;</pre>
      
      <p class="noind">We used this exact rule in <a href="#ch12ex08" class="calibre4">listing 12.8</a>. This saves a lot of typing, but we need to be aware that when we retrieve the properties, we need to fetch the low-level
         individual properties. We can’t fetch <kbd class="calibre15">border</kbd>, but we can fetch styles such as <kbd class="calibre15">border-top-color</kbd> and <kbd class="calibre15">border-top-width</kbd>, just as we did in the example.
      </p>
      
      <p class="noind">It can be a bit of a hassle, especially when all four styles are given the same values, but that’s the hand we’ve been dealt.</p>
      
      
      
      <h4 id="ch12lev2sec6" class="calibre26">12.3.4. <a id="ch12lev2sec6__title" class="calibre4"></a>Converting pixel values
      </h4>
      
      <p class="noind">An important point to consider when setting style values is the assignment of numeric values that represent pixels. When setting
         a numeric value for a style property, we must specify the unit in order for it to work reliably across all browsers. For example,
         let’s say that we want to set the <kbd class="calibre15">height</kbd> style value of an element to 10 pixels. Either of the following is a safe way to do this across browsers:
      </p>
      
      <pre id="PLd0e32417" class="calibre5">element.style.height = "10px";
element.style.height = 10 + "px";</pre>
      
      <p class="noind">The following isn’t safe across browsers:</p>
      
      <pre id="PLd0e32426" class="calibre5">element.style.height = 10;</pre>
      
      <p class="noind">You might think it’d be easy to add a little logic to the <kbd class="calibre15">style()</kbd> function of <a href="#ch12ex07" class="calibre4">listing 12.7</a> to tack a <kbd class="calibre15">px</kbd> to the end of a numeric value coming into the function. But not so fast! Not all numeric values represent pixels! Some style
         properties take numeric values that don’t represent a pixel dimension. The list includes the following:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><kbd class="calibre15">z-index</kbd>
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">font-weight</kbd>
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">opacity</kbd>
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">zoom</kbd>
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">line-height</kbd>
            
         </li>
         
      </ul>
      
      <p class="noind"><a id="iddle1330" class="calibre4"></a><a id="iddle1363" class="calibre4"></a><a id="iddle1634" class="calibre4"></a><a id="iddle1803" class="calibre4"></a><a id="iddle1828" class="calibre4"></a><a id="iddle1833" class="calibre4"></a><a id="iddle1854" class="calibre4"></a><a id="iddle1871" class="calibre4"></a><a id="iddle2066" class="calibre4"></a><a id="iddle2077" class="calibre4"></a><a id="iddle2179" class="calibre4"></a><a id="iddle2196" class="calibre4"></a>For these (and any others you can think of), go ahead and extend the function of <a href="#ch12ex06" class="calibre4">listing 12.6</a> to automatically handle nonpixel values. Also, when attempting to read a pixel value out of a style attribute, the <kbd class="calibre15">parseFloat</kbd> method should be used to make sure that you get the intended value under all circumstances.
      </p>
      
      <p class="noind">Now let’s take a look at a set of important style properties that can be tough to handle.</p>
      
      
      
      <h4 id="ch12lev2sec7" class="calibre26">12.3.5. <a id="ch12lev2sec7__title" class="calibre4"></a>Measuring heights and widths
      </h4>
      
      <p class="noind">Style properties such as <kbd class="calibre15">height</kbd> and <kbd class="calibre15">width</kbd> pose a special problem, because their values default to <kbd class="calibre15">auto</kbd> when not specified, so that the element sizes itself according to its contents. As a result, we can’t use the <kbd class="calibre15">height</kbd> and <kbd class="calibre15">width</kbd> style properties to get accurate values unless explicit values are provided in the attribute string.
      </p>
      
      <p class="noind">Thankfully, the <kbd class="calibre15">offsetHeight</kbd> and <kbd class="calibre15">offsetWidth</kbd> properties provide just that: a fairly reliable means to access the height and width of an element. But be aware that the
         values assigned to these two properties include the padding of the element. This information is usually exactly what we want
         if we’re attempting to position one element over another. But sometimes we may want to obtain information about the element’s
         dimensions with and without borders and padding.
      </p>
      
      <p class="noind">Something to watch out for, however, is that in highly interactive sites, elements will likely spend some of their time in
         a nondisplayed state (with the <kbd class="calibre15">display</kbd> style being set to <kbd class="calibre15">none</kbd>), and when an element isn’t part of the display, it has no dimensions. Any attempt to fetch the <kbd class="calibre15">offsetWidth</kbd> or <kbd class="calibre15">offsetHeight</kbd> properties of a nondisplayed element will result in a value of <kbd class="calibre15">0</kbd>.
      </p>
      
      <p class="noind">For such hidden elements, if we want to obtain the nonhidden dimensions, we can employ a trick to momentarily unhide the element,
         grab the values, and hide it again. Of course, we want to do so in such a way that we leave no visible clue that this is going
         on behind the scenes. How can we make a hidden element not hidden without making it visible?
      </p>
      
      <p class="noind">Employing our ninja skills, we can do it! Here’s how:</p>
      
      <p class="calibre18"></p>
      <ol class="calibre27">
         
         <li class="calibre20">Change the <kbd class="calibre15">display</kbd> property to <kbd class="calibre15">block</kbd>.
            
         </li>
         
         <li class="calibre20">Set <kbd class="calibre15">visibility</kbd> to <kbd class="calibre15">hidden</kbd>.
            
         </li>
         
         <li class="calibre20">Set <kbd class="calibre15">position</kbd> to <kbd class="calibre15">absolute</kbd>.
            
         </li>
         
         <li class="calibre20">Grab the dimension values.
            
         </li>
         
         <li class="calibre20">Restore the changed properties.
            
         </li>
         
      </ol>
      
      <p class="noind">Changing the <kbd class="calibre15">display</kbd> property to <kbd class="calibre15">block</kbd> allows us to grab the values of <kbd class="calibre15">offsetHeight</kbd> and <kbd class="calibre15">offsetWidth</kbd>, but that makes the element part of the display and therefore visible. To make the element invisible, we’ll set the <kbd class="calibre15">visibility</kbd> property to <kbd class="calibre15">hidden</kbd>. But (there’s always another <i class="calibre6">but</i>) that will leave a big hole where the element is positioned, so we also set the <kbd class="calibre15">position</kbd> property to <kbd class="calibre15">absolute</kbd> to take the element out of the normal display flow.
      </p>
      
      <p class="noind">All that sounds more complicated than the implementation, which is shown in the following listing.</p>
      
      
      <p class="noind"></p>
      <h5 id="ch12ex09" class="notetitle">Listing 12.9. <a id="ch12ex09__title" class="calibre4"></a>Grabbing the dimensions of hidden elements
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex09-0.jpg" alt="" class="calibre2" width="590" height="350" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex09-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex09-1.jpg" alt="" class="calibre2" width="590" height="661" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch12ex09-1.jpg"></p>
      
      <p class="noind"><a id="iddle1336" class="calibre4"></a>That’s a long listing, but most of it is test code; the implementation of the new dimension-fetching function spans only a
         dozen or so lines of code.
      </p>
      
      <p class="noind">Let’s take a look at it piece by piece. First, we set up elements to test: a <kbd class="calibre15">&lt;div&gt;</kbd> element containing a bunch of text with two images embedded within it, left-justified by styles in an external style sheet.
         These image elements will be the subjects of our tests; one is visible, and one is hidden.
      </p>
      
      <p class="noind">Prior to running any script, the elements appear as shown in <a href="#ch12fig04" class="calibre4">figure 12.4</a>. If the second image weren’t hidden, it would appear as a second ninja just to the right of the visible one.
      </p>
      
      
      
      <h5 id="ch12fig04" class="notetitle">Figure 12.4. <a id="ch12fig04__title" class="calibre4"></a>We’ll use two images—one visible, one hidden—for testing the fetching of dimensions of hidden elements.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/12fig04.jpg" alt="" class="calibre2" width="388" height="264" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/12fig04.jpg"></p>
      
      
      
      <p class="noind">Then we set about defining our new function. We’re going to use a hash for some important information, but we don’t want to
         pollute the global namespace with this hash; we want it to be available to the function in its local scope, but no further
         than that.
      </p>
      
      <p class="noind">We accomplish that by enclosing the hash definition and function declaration within an immediate function, which creates a
         local scope. The hash isn’t accessible outside the immediate function, but the <kbd class="calibre15">getDimensions</kbd> function that we also define within the immediate function has access to the hash via its closure. Nifty, eh?
      </p>
      
      <pre id="PLd0e32755" class="calibre5">(function(){
    const PROPERTIES = {
      position: "absolute",
      visibility: "hidden",
      display: "block"
    };
    window.getDimensions = element =&gt; {
      const previous = {};
      for (let key in PROPERTIES) {
        previous[key] = element.style[key];
        element.style[key] = PROPERTIES[key];
      }
      const result = {
        width: element.offsetWidth,
        height: element.offsetHeight
      };
      for (let key in PROPERTIES) {
        element.style[key] = previous[key];
      }
      return result;
    };
  })();</pre>
      
      <p class="noind"><a id="iddle1875" class="calibre4"></a>Our new dimension-fetching function is then declared, accepting the element that’s to be measured. Within that function, we
         first create a hash named <kbd class="calibre15">previous</kbd> in which we’ll record the previous values of the style properties that we’ll be stomping on, so that we can restore them
         later. Looping over the replacement properties, we then record each of their previous values and replace those values with
         the new ones.
      </p>
      
      <p class="noind">That accomplished, we’re ready to measure the element, which has now been made part of the display layout, invisible, and
         absolutely positioned. The dimensions are recorded in a hash assigned to local variable <kbd class="calibre15">result</kbd>.
      </p>
      
      <p class="noind">Now that we’ve pilfered what we came for, we erase our tracks by restoring the original values of the style properties that
         we modified, and we return the results as a hash containing <kbd class="calibre15">width</kbd> and <kbd class="calibre15">height</kbd> properties.
      </p>
      
      <p class="noind">All well and good, but does it work? Let’s find out.</p>
      
      <p class="noind">In a load handler, we perform the tests in a callback to a 3-second timer. Why, you ask? The load handler ensures that we
         don’t perform the test until we know that the DOM has been built, and the timer enables us to watch the display while the
         test is running, to make sure no display glitches occur while we fiddle with the properties of the hidden element. After all,
         if the display is disturbed in any way when we run our function, it’s a bust.
      </p>
      
      <p class="noind">In the timer callback, we first get a reference to our test subjects (the two images) and assert that we can obtain the dimensions
         of the visible image by using the offset properties. This test passes, which we can see if we peek ahead to <a href="#ch12fig05" class="calibre4">figure 12.5</a>.
      </p>
      
      
      
      <h5 id="ch12fig05" class="notetitle">Figure 12.5. <a id="ch12fig05__title" class="calibre4"></a>By temporarily adjusting the style properties of hidden elements, we can successfully fetch their dimensions.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/12fig05.jpg" alt="" class="calibre2" width="500" height="433" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/12fig05.jpg"></p>
      
      
      
      <p class="noind">Then we make the same test on the hidden element, incorrectly assuming that the offset properties will work with a hidden
         image. Not surprisingly, because we’ve already acknowledged that this won’t work, the test fails.
      </p>
      
      <p class="noind">Next, we call our new function on the hidden image, and then retest with those results. Success! Our test passes, as shown
         in <a href="#ch12fig05" class="calibre4">figure 12.5</a>.
      </p>
      
      <p class="noind">If we watch the display of the page while the test is running—remember, we delay running the test until 3 seconds after the
         DOM is loaded—we can see that the display isn’t perturbed in any way by our behind-the-scenes adjustments of the hidden element’s
         properties.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch12note02" class="notetitle">Tip</h5>
      
      
      <p class="noindclose">Checking the <kbd class="calibre15">offsetWidth</kbd> and <kbd class="calibre15">offsetHeight</kbd> style properties for zeroes can serve as an incredibly efficient means of determining the visibility of an element.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      
      
      
      <h3 id="ch12lev1sec4" class="calibre24"><a id="ch12lev1sec4__title" class="calibre3"></a>12.4. Minimizing layout thrashing
      </h3>
      
      <p class="noind"><a id="iddle1356" class="calibre4"></a><a id="iddle1715" class="calibre4"></a>So far in this chapter, you’ve learned how to relatively easily modify the DOM: by creating and inserting new elements, removing
         existing elements, or modifying their attributes. Modifying the DOM is one of the fundamental tools for achieving highly dynamic
         web applications.
      </p>
      
      <p class="noind">But this tool also comes with usage asterisks, one of the most important being, be aware of <i class="calibre6">layout thrashing</i>. Layout thrashing occurs when we perform a series of consecutive reads and writes to DOM, in the process not allowing the
         browser to perform layout optimizations.
      </p>
      
      <p class="noind">Before we delve deeper, consider that changing attributes of one element (or modifying its content) doesn’t necessarily affect
         only that element; instead it can cause a cascade of changes. For example, setting the width of one element can lead to changes
         in the element’s children, siblings, and parents. So whenever a change is made, the browser has to calculate the impact of
         those changes. In certain cases, there’s nothing we can do about it; we need those changes to occur. But at the same time,
         there’s no need to put additional weight on the shoulders of our poor browsers, causing our web application performance to
         dwindle.
      </p>
      
      <p class="noind">Because recalculating layout is expensive, browsers try to be as lazy as possible, by delaying working with the layout as
         much as they can; they try to batch as many write operations as possible on the DOM in a queue so that these operations can
         be executed in one go. Then, when an operation that requires an up-to-date layout comes along, the browser grudgingly obeys,
         and executes all batched operations and finally updates the layout. But sometimes, the way we’ll write our code doesn’t give
         the browser enough room to perform these sorts of optimizations, and we force the <a id="iddle1194" class="calibre4"></a>browser to perform a lot of (possibly needless) recalculations. This is what layout thrashing is all about; it occurs when
         our code performs a series of (often unnecessary) consecutive reads and writes to the DOM, not allowing the browser to optimize
         layout operations. The problem is that, whenever we modify the DOM, the browser has to recalculate the layout before any layout
         information is read. This action is expensive, in terms of performance. Let’s take a look at an example.
      </p>
      
      
      
      <h5 id="ch12ex10" class="notetitle">Listing 12.10. <a id="ch12ex10__title" class="calibre4"></a>Consecutive series of reads and writes causes layout thrashing
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/328fig01_alt.jpg" alt="" class="calibre2" width="590" height="272" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/328fig01_alt.jpg"></p>
      
      
      <p class="noind">Reading the value of the element’s <kbd class="calibre15">clientWidth</kbd> property is one of those actions that requires the browser to have an up-to-date layout. By performing consecutive reads
         and writes to the width property of different elements, we don’t allow the browser to be lazy in a smart way. Instead, because
         we read layout information after every layout modification, the browser has to recalculate the layout every time, just to
         be sure that we still get the correct information.
      </p>
      
      <p class="noind">One way of minimizing layout thrashing is to write code in a way that doesn’t cause needless layout recalculations. For example,
         we can rewrite <a href="#ch12ex10" class="calibre4">listing 12.10</a> into the following.
      </p>
      
      
      
      <h5 id="ch12ex11" class="notetitle">Listing 12.11. <a id="ch12ex11__title" class="calibre4"></a>Batch DOM reads and writes to avoid layout thrashing
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/328fig02_alt.jpg" alt="" class="calibre2" width="590" height="233" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/328fig02_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1191" class="calibre4"></a><a id="iddle1192" class="calibre4"></a><a id="iddle1193" class="calibre4"></a><a id="iddle1476" class="calibre4"></a><a id="iddle1610" class="calibre4"></a><a id="iddle1611" class="calibre4"></a><a id="iddle1829" class="calibre4"></a><a id="iddle1830" class="calibre4"></a><a id="iddle1831" class="calibre4"></a><a id="iddle1832" class="calibre4"></a><a id="iddle1834" class="calibre4"></a><a id="iddle1835" class="calibre4"></a><a id="iddle1836" class="calibre4"></a><a id="iddle1994" class="calibre4"></a><a id="iddle1995" class="calibre4"></a><a id="iddle1996" class="calibre4"></a><a id="iddle1997" class="calibre4"></a><a id="iddle1998" class="calibre4"></a><a id="iddle1999" class="calibre4"></a><a id="iddle2000" class="calibre4"></a><a id="iddle2002" class="calibre4"></a><a id="iddle2003" class="calibre4"></a><a id="iddle2005" class="calibre4"></a><a id="iddle2006" class="calibre4"></a><a id="iddle2197" class="calibre4"></a>Here we batch all reads and writes, because we know that no dependencies exist between the dimensions of our elements; setting
         the width of the <kbd class="calibre15">ninja</kbd> element doesn’t influence the width of the <kbd class="calibre15">samurai</kbd> element. This allows the browser to lazily batch operations that modify the DOM.
      </p>
      
      <p class="noind">Layout thrashing isn’t something that you’d notice in smaller, simpler pages, but it’s something to keep in mind when developing
         complex web applications, especially on mobile devices. For this reason, it’s always good to keep in mind the methods and
         properties that require an up-to-date layout, shown in the following table (obtained from <a href="http://ricostacruz.com/cheatsheets/layout-thrashing.html" class="calibre4">http://ricostacruz.com/cheatsheets/layout-thrashing.html</a>).
      </p>
      
      <h5 id="ch12table02" class="notetitle">Table 12.2. <a id="ch12table02__title" class="calibre4"></a>APIs and properties that cause layout invalidation
      </h5>
      <table cellpadding="8" width="100%" frame="hsides" cellspacing="5" rules="groups" class="calibre29">
         <colgroup span="2" class="calibre8">
            <col width="150" class="calibre9">
            <col width="400" class="calibre9">
         </colgroup>
         <thead class="calibre30">
            <tr class="calibre11">
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Interface</p>
               </th>
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Property name</p>
               </th>
            </tr>
         </thead>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="docTableCell" valign="top">Element</td>
               <td class="docTableCell" valign="top">clientHeight, clientLeft, clientTop, clientWidth, focus, getBoundingClientRect, getClientRects, innerText, offsetHeight, offsetLeft,
                  offsetParent, offsetTop, offsetWidth, outerText, scrollByLines, scrollByPages, scrollHeight, scrollIntoView, scrollIntoViewIfNeeded,
                  scrollLeft, scrollTop, scrollWidth
               </td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">MouseEvent</td>
               <td class="docTableCell" valign="top">layerX, layerY, offsetX, offsetY</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">Window</td>
               <td class="docTableCell" valign="top">getComputedStyle, scrollBy, scrollTo, scroll, scrollY</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">Frame, Document, Image</td>
               <td class="docTableCell" valign="top">height, width</td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Several libraries that try to minimize layout thrashing have been developed. One of the more popular ones is FastDom (<a href="https://github.com/wilsonpage/fastdom" class="calibre4">https://github.com/wilsonpage/fastdom</a>). The library repository includes examples that clearly show the performance gains that can be achieved by batching DOM read/write
         operations (<a href="https://wilsonpage.github.io/fastdom/examples/aspect-ratio.html" class="calibre4">https://wilsonpage.github.io/fastdom/examples/aspect-ratio.html</a>).
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <b id="ch12sb01" class="calibre21">React’s virtual DOM</b>
         
         <p class="noind">One of the most popular client-side libraries is Facebook’s React (<a href="https://facebook.github.io/react/" class="calibre4">https://facebook.github.io/react/</a>). React achieves great performance by using a virtual DOM, a set of JavaScript objects that mimic the actual DOM. When we
            develop applications in React, we perform all modifications on the virtual DOM, without any regard for layout thrashing. Then,
            at an appropriate time, React uses the virtual DOM to figure out what changes have to be made to the actual DOM, in order
            to keep the UI in sync. This batching of updates increases the performance of applications.
         </p>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      
      
      <h3 id="ch12lev1sec5" class="calibre24"><a id="ch12lev1sec5__title" class="calibre3"></a>12.5. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Converting an HTML string into DOM elements includes the following steps:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">Making sure that the HTML string is valid HTML code
                  
               </li>
               
               <li class="calibre20">Wrapping it into enclosing markup, required by browser rules
                  
               </li>
               
               <li class="calibre20">Inserting the HTML into a dummy DOM element through the <kbd class="calibre15">innerHTML</kbd> property of a DOM element
                  
               </li>
               
               <li class="calibre20">Extracting the created DOM nodes back out
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">For fast inserting of DOM nodes, use DOM fragments, because a fragment can be injected in a single operation, thereby drastically
            reducing the number of operations.
            
         </li>
         
         <li class="calibre20">DOM element attributes and properties, although linked, aren’t always identical! We can read and write to DOM attributes by
            using the <kbd class="calibre15">getAttribute</kbd> and <kbd class="calibre15">setAttribute</kbd> methods, whereas we write to DOM properties by using object property notation.
            
         </li>
         
         <li class="calibre20">When working with attributes and properties, we have to be aware of <i class="calibre6">custom attributes</i>. Attributes that we decide to place on HTML elements in order to carry information useful to our applications aren’t automatically
            presented as element properties.
            
         </li>
         
         <li class="calibre20">The <kbd class="calibre15">style</kbd> element property is an object that holds properties corresponding to the style values specified in the element markup. To
            get the computed styles, which also take into account the styles set in style sheets, use the built-in <kbd class="calibre15">getComputedStyle</kbd> method.
            
         </li>
         
         <li class="calibre20">For getting the dimensions of HTML elements, use <kbd class="calibre15">offsetWidth</kbd> and <kbd class="calibre15">offsetHeight</kbd> properties.
            
         </li>
         
         <li class="calibre20">Layout thrashing occurs when code performs a series of consecutive reads and writes to DOM, each time forcing the browser
            to recalculate the layout information. This leads to slower, less responsive web applications.
            
         </li>
         
         <li class="calibre20">Batch your DOM updates!
            
         </li>
         
      </ul>
      
      
      
      <h3 id="ch12lev1sec6" class="calibre24"><a id="ch12lev1sec6__title" class="calibre3"></a>12.6. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch12qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch12qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch12qa2q1" class="calibre4"></a><b class="calibre21">1. </b></p><p class="noind">In the following code, which of the following assertions will pass?</p>
            
            <pre id="PLd0e33366" class="calibre5">&lt;div id="samurai"&gt;&lt;/div&gt;
&lt;script&gt;
  const element = document.querySelector("#samurai");

  assert(element.id === "samurai", "property id is samurai");
  assert(element.getAttribute("id") === "samurai",
         "attribute id is samurai");

  element.id = "newSamurai";
  assert(element.id === "newSamurai", "property id is newSamurai");
  assert(element.getAttribute("id") === "newSamurai",
         "attribute id is newSamurai");
&lt;/script&gt;</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch12qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch12qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind"><a id="iddle2072" class="calibre4"></a>Given the following code, how can we access the element’s <kbd class="calibre15">border-width</kbd> style property?
            </p>
            
            <pre id="PLd0e33389" class="calibre5">&lt;div id="element" style="border-width: 1px;
                         border-style:solid; border-color: red"&gt;
&lt;/div&gt;
&lt;script&gt;
  const element = document.querySelector("#element");
&lt;/script&gt;</pre>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">element.border-width</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">element.getAttribute("border-width");</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">element.style["border-width"];</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">element.style.borderWidth;</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch12qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch12qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">Which built-in method can get all styles applied to a certain element (styles provided by the browser, styles applied via
               style sheets, and properties set through the style attribute)?
            </p>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">getStyle</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">getAllStyles</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">getComputedStyle</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch12qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch12qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">When does layout thrashing occur?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_43"></div>
<h2 id="ch13" class="part">Chapter 13. <a id="ch13__title" class="calibre3"></a>Surviving events
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Understanding the event loop
            
         </li>
         
         <li class="calibre20">Processing complex tasks with timers
            
         </li>
         
         <li class="calibre20">Managing animations with timers
            
         </li>
         
         <li class="calibre20">Using event bubbling and delegation
            
         </li>
         
         <li class="calibre20">Using custom events
            
         </li>
         
      </ul>
      
      <p class="noind"><a href="kindle_split_012.html#ch02" class="calibre4">Chapter 2</a> included a short discussion on the JavaScript single-threaded execution model and introduced the event loop and the event
         queue, in which events wait for their turn to be processed. This discussion was particularly useful when presenting the steps
         in the lifecycle of a web page, especially when discussing the order in which certain pieces of JavaScript code get executed.
         At the same time, it’s a simplification, so in order to get a more complete picture of how the browser works, we’ll spend
         a significant part of this chapter exploring the nooks and crannies of the event loop. This will help us better understand
         some of the performance limitations inherent in JavaScript and the browser. In turn, we’ll use this knowledge to develop smoother-running
         applications.
      </p>
      
      <p class="noind"><a id="iddle1410" class="calibre4"></a><a id="iddle1739" class="calibre4"></a>During this exploration, we’ll put a special focus on timers, a JavaScript feature that enables us to delay the execution
         of a piece of code asynchronously by a certain amount of time. At first glance, this might not seem like much, but we’ll show
         you how to use timers to break up long-running tasks that make applications slow and unresponsive into smaller tasks that
         don’t clog the browser. This helps develop better-performing applications.
      </p>
      
      <p class="noind">We’ll continue this exploration of events by showing how events are propagated through the DOM tree, and how to use this knowledge
         to write simpler and less memory-intensive code. Finally, we’ll finish the chapter with creating custom events, which can
         help reduce coupling between different parts of the application. Without further ado, let’s start looping through the event
         loop.
      </p>
      
      <h3 class="calibre24"><a id="ch13qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch13qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch13qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">Why is the timing on timer callbacks not guaranteed?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch13qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch13qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">If a <kbd class="calibre15">setInterval</kbd> timer fires every 3 milliseconds while another event handler is running for 16 ms, how many times will the timer’s callback
               function be added to the microtask queue?
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch13qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch13qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">Why is the function context for an event handler sometimes different from the event’s target?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch13lev1sec1" class="calibre24"><a id="ch13lev1sec1__title" class="calibre3"></a>13.1. Diving into the event loop
      </h3>
      
      <p class="noind">As you might have figured out, the event loop is more complicated than its presentation in <a href="kindle_split_012.html#ch02" class="calibre4">chapter 2</a>. For starters, instead of a single event queue, which holds only events, the event loop has at least two queues that, in
         addition to events, hold other actions performed by the browser. These actions are called <i class="calibre6">tasks</i> and are grouped into two categories: <i class="calibre6">macrotasks</i> (or often just called tasks) and <i class="calibre6">microtasks</i>.
      </p>
      
      <p class="noind">Examples of macrotasks include creating the main document object, parsing HTML, executing mainline (or global) JavaScript
         code, changing the current URL, as well as various events such as page loading, input, network events, and timer events. From
         the browser’s perspective, a macrotask represents one discrete, self-contained unit of work. After running a task, the browser
         can continue with other assignments such as re-rendering the UI of the page, or performing garbage collection.
      </p>
      
      <p class="noind">Microtasks, on the other hand, are smaller tasks that update the application state and should be executed before the browser
         continues with other assignments such as re-rendering the UI. Examples include promise callbacks and DOM mutation changes.
         Microtasks should be executed as soon as possible, in an asynchronous way, but without the cost of executing a whole new macrotask.
         Microtasks enable us to execute certain actions <i class="calibre6">before</i> the UI is re-rendered, thereby avoiding unnecessary UI rendering that might show inconsistent application state.
      </p>
      
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch13note01" class="notetitle">Note</h5>
      
      
      <p class="noindclose"><a id="iddle1758" class="calibre4"></a>The ECMAScript specification doesn’t mention event loops. Instead, the event loop is detailed in the HTML specification (<a href="https://html.spec.whatwg.org/#event-loops" class="calibre4">https://html.spec.whatwg.org/#event-loops</a>), which also discusses the concept of macrotasks and microtasks. The ECMAScript specification mentions <i class="calibre6">jobs</i> (which are analogous to microtasks) in respect to handling promise callbacks (<a href="http://mng.bz/fOlK" class="calibre4">http://mng.bz/fOlK</a>). Even though the event loop is defined in the HTML specification, other environments, such as Node.js, also use it.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">The implementation of an event loop <i class="calibre6">should</i> use at least one queue for macrotasks and at least one queue for microtasks. Event loop implementations usually go beyond
         that, and have <i class="calibre6">several</i> queues for different types of macro- and microtasks. This enables the event loop to prioritize types of tasks; for example,
         giving priority to performance-sensitive tasks such as user input. On the other hand, because there are many browsers and
         JavaScript execution environments out in the wild, you shouldn’t be surprised if you run into event loops with only a single
         queue for both types of tasks together.
      </p>
      
      <p class="noind">The event loop is based on two fundamental principles:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Tasks are handled one at a time.
            
         </li>
         
         <li class="calibre20">A task runs to completion and can’t be interrupted by another task.
            
         </li>
         
      </ul>
      
      <p class="noind">Let’s take a look at <a href="#ch13fig01" class="calibre4">figure 13.1</a>, which depicts these two principles.
      </p>
      
      
      
      <h5 id="ch13fig01" class="notetitle">Figure 13.1. <a id="ch13fig01__title" class="calibre4"></a>The event loop usually has access to at least two task queues: a microtask queue and a macrotask queue. Both types of tasks
         are handled one at a time.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig01.jpg" alt="" class="calibre2" width="470" height="599" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig01.jpg"></p>
      
      
      
      <p class="noind"><a id="iddle1411" class="calibre4"></a>On a high level, <a href="#ch13fig01" class="calibre4">figure 13.1</a> shows that in a single iteration, the event loop first checks the macrotask queue, and if there’s a macrotask waiting to
         be executed, starts its execution. Only after the task is fully processed (or if there were no tasks in the queue), the event
         loop moves onto processing the microtask queue. If there’s a task waiting in that queue, the event loop takes it and executes
         it to completion. This is performed for all microtasks in the queue. Note the difference between handling the macrotask and
         microtask queues: In a single loop iteration, one macrotask at most is processed (others are left waiting in the queue), whereas
         all microtasks are processed.
      </p>
      
      <p class="noind">When the microtask queue is finally empty, the event loop checks whether a UI render update is required, and if it is, the
         UI is re-rendered. This ends the current iteration of the event loop, which goes back to the beginning and checks the macrotask
         queue again.
      </p>
      
      <p class="noind">Now that we have a high-level understanding of the event loop, let’s check some of the interesting details shown in <a href="#ch13fig01" class="calibre4">figure 13.1</a>:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><i class="calibre6">Both task queues are placed outside the event loop</i>, to indicate that the act of adding tasks to their matching queues happens outside the event loop. If this wasn’t the case,
            any events that occur while JavaScript code is being executed would be ignored. Because we most definitely don’t want to do
            this, the acts of detecting and adding tasks are done separately from the event loop.
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Both types of tasks are executed one at a time</i>, because JavaScript is based on a single-threaded execution model. When a task starts executing, it’s executed to its completion,
            without being interrupted by another task. Only the browser can stop the execution of a task; for example, if the task starts
            being too selfish by taking up too much time or memory.
            
         </li>
         
         <li class="calibre20"><i class="calibre6">All microtasks should be executed before the next rendering</i>, because their goal is to update the application state before rendering occurs.
            
         </li>
         
         <li class="calibre20"><i class="calibre6">The browser usually tries to render the page 60 times per second</i>, to achieve 60 frames per second (60 fps), a frame rate that’s often considered ideal for smooth motion, such as animations—<i class="calibre6">meaning, the browser tries to render a frame every 16 ms.</i> Notice how the “Update rendering” action, shown in <a href="#ch13fig01" class="calibre4">figure 13.1</a>, happens inside the event loop, because the page content shouldn’t be modified by another task while the page is being rendered.
            This all means that, if we want to achieve smooth-running applications, we don’t have much time to process tasks in a single
            event-loop iteration. <i class="calibre6">A single task and all microtasks generated by that task should ideally complete within 16 ms</i>.
            
         </li>
         
      </ul>
      
      <p class="noind">Now, let’s consider three situations that can occur in the next event-loop iteration, after the browser has completed a page
         render:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The event loop reaches the “Is rendering required?” decision point before another 16 ms has elapsed. Because updating the
            UI is a complex operation, if there isn’t an explicit need to render the page, the browser may choose not to perform the UI
            rendering in this loop iteration.
            
         </li>
         
         <li class="calibre20"><a id="iddle1412" class="calibre4"></a><a id="iddle1738" class="calibre4"></a><a id="iddle1759" class="calibre4"></a>The event loop reaches the “Is rendering required?” decision point roughly around 16 ms after the last rendering. In this
            case, the browser updates the UI, and users will experience a smooth-running application.
            
         </li>
         
         <li class="calibre20">Executing the next task (and all related microtasks) takes much more than 16 ms. In this case, the browser won’t be able to
            re-render the page at the target frame rate, and the UI won’t be updated. If running the task code doesn’t take up too much
            time (more than a couple of hundred milliseconds), this delay might not even be perceivable, especially if there isn’t much
            motion going on in the page. On the other hand, if we take too much time, or animations are running on the page, users will
            probably perceive the web page as slow and nonresponsive. In a worst-case scenario, in which a task gets executed for more
            than a couple of seconds, the user’s browser shows the dreaded “Unresponsive script” message. (Don’t worry, later in the chapter
            we’ll show you a technique for breaking complex tasks into smaller ones that won’t clog the event loop.)
            
         </li>
         
      </ul>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch13note02" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Be careful about which events you decide to handle, how often they occur, and how much processing time an event handler takes.
         For example, you should be extra careful when handling mouse-move events. Moving the mouse around causes a large number of
         events to be queued, so performing any complex operation in that mouse-move handler is a sure path to building a slow and
         jerky web application.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Now that we’ve described how the event loop works, you’re ready to explore a couple of examples in detail.</p>
      
      
      <h4 id="ch13lev2sec1" class="calibre26">13.1.1. <a id="ch13lev2sec1__title" class="calibre4"></a>An example with only macrotasks
      </h4>
      
      <p class="noind">The unavoidable result of JavaScript’s single-threaded execution model is that only one task can be executed at a time. This
         in turn means that all created tasks have to wait in a queue until their turn for execution comes.
      </p>
      
      <p class="noind">Let’s focus our attention on a simple web page that contains the following:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Nontrivial mainline (global) JavaScript code
            
         </li>
         
         <li class="calibre20">Two buttons and two nontrivial click handlers, one for each button
            
         </li>
         
      </ul>
      
      <p class="noind">The following listing shows the sample code.</p>
      
      
      
      <h5 id="ch13ex01" class="notetitle">Listing 13.1. <a id="ch13ex01__title" class="calibre4"></a>Pseudocode for our event loop demo with one task queue
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/336fig01_alt.jpg" alt="" class="calibre2" width="590" height="209" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/336fig01_alt.jpg"></p>
      
      
      <p class="noind">This example requires some imagination, so instead of cluttering the code fragment with unnecessary code, we ask you to imagine
         the following:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Our mainline JavaScript code takes 15 ms to execute.
            
         </li>
         
         <li class="calibre20">The first click event handler runs for 8 ms.
            
         </li>
         
         <li class="calibre20">The second click event handler runs for 5 ms.
            
         </li>
         
      </ul>
      
      <p class="noind">Now let’s continue to be imaginative, and say that we have a super quick user who clicks the first button 5 ms after our script
         starts executing, and the second button 12 ms after. <a href="#ch13fig02" class="calibre4">Figure 13.2</a> depicts this situation.
      </p>
      
      
      
      <h5 id="ch13fig02" class="notetitle">Figure 13.2. <a id="ch13fig02__title" class="calibre4"></a>This timing diagram shows how events are added to the task queue as they occur. When a task is done executing, the event loop
         takes it off the queue, and continues by executing the next task.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig02_alt.jpg" alt="" class="calibre2" width="590" height="479" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig02_alt.jpg"></p>
      
      
      <p class="noind">There’s a lot of information to digest here, but understanding it completely will give you a better idea of how the event
         loop works. In the top part of the figure, time (in milliseconds) is running from left to right along the x-axis. The rectangles
         underneath that timeline represent portions of JavaScript code under execution, extending for the amount of time they’re running.
         For example, the first block of mainline JavaScript code executes for approximately 15 ms, the first click handler for approximately
         8 ms, and the second click handler for approximately 5 ms. The timing diagram also shows when certain events occur; for example,
         the first button click occurs 5 ms into application execution, and the second button click at 12 ms. The bottom part of the
         figure shows the state of the macrotask queue at various points of application execution.
      </p>
      
      <p class="noind">The program starts by executing mainline JavaScript code. Immediately, two elements, <kbd class="calibre15">firstButton</kbd> and <kbd class="calibre15">secondButton</kbd>, are fetched from the DOM, and two functions, <kbd class="calibre15">firstHandler</kbd> and <kbd class="calibre15">secondHandler</kbd>, are registered as click event handlers:
      </p>
      
      <pre id="PLd0e33876" class="calibre5">firstButton.addEventListener("click", function firstHandler(){...});
secondButton.addEventListener("click", function secondHandler(){...});</pre>
      
      <p class="noind">This is followed by code that executes for another 15 ms. During this execution, our quick user clicks <kbd class="calibre15">firstButton</kbd> 5 ms after the program starts executing, and clicks <kbd class="calibre15">secondButton</kbd> 12 ms after.
      </p>
      
      <p class="noind">Because JavaScript is based on a single-threaded execution model, clicking <kbd class="calibre15">firstButton</kbd> doesn’t mean that the click handler is immediately executed. (Remember, if a task is already being executed, it can’t be
         interrupted by another task.) Instead, the click event related to <kbd class="calibre15">firstButton</kbd> is placed in the task queue, where it patiently waits for its turn to be executed. The same thing happens when a click of
         <kbd class="calibre15">secondButton</kbd> occurs: A matching event is placed in the task queue, and waits for execution. Note that it’s important that the event detection
         and addition to the task queue happens outside the event loop; the tasks are added to the task queue even while mainline JavaScript
         code is being executed.
      </p>
      
      <p class="noind">If we take a snapshot of our task queue 12 ms into the execution of our script, we’ll see the following three tasks:</p>
      
      <p class="calibre18"></p>
      <ol class="calibre27">
         
         <li class="calibre20">Evaluate mainline JavaScript code—the currently executing task.
            
         </li>
         
         <li class="calibre20">Click <kbd class="calibre15">firstButton</kbd>—the event created when <kbd class="calibre15">firstButton</kbd> is clicked.
            
         </li>
         
         <li class="calibre20">Click <kbd class="calibre15">secondButton</kbd>—the event created when <kbd class="calibre15">secondButton</kbd> is clicked.
            
         </li>
         
      </ol>
      
      <p class="noind">These tasks are also shown in <a href="#ch13fig03" class="calibre4">figure 13.3</a>.
      </p>
      
      
      
      <h5 id="ch13fig03" class="notetitle">Figure 13.3. <a id="ch13fig03__title" class="calibre4"></a>12 ms into the application execution, the task queue has three tasks: one for evaluating mainline JavaScript code (the currently
         executing task), and one for each button-click event.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig03.jpg" alt="" class="calibre2" width="390" height="340" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig03.jpg"></p>
      
      
      
      <p class="noind">The next interesting point in the application execution happens at 15 ms, when the mainline JavaScript code finishes its <a id="iddle1413" class="calibre4"></a><a id="iddle1757" class="calibre4"></a>execution. As shown in <a href="#ch13fig01" class="calibre4">figure 13.1</a>, after a task has finished the execution, the event loop moves on to processing the microtask queue. Because in this situation
         we don’t have any microtasks (we don’t even show the microtask queue in the diagram, because it’s always empty), we skip this
         step and move on to updating the UI. In this example, even though the update happens and takes some time, for simplicity sake,
         we keep it out of our discussion. With this, the event loop finishes the first iteration and starts the second iteration,
         by moving onto the following task in the queue.
      </p>
      
      <p class="noind">Next, the <kbd class="calibre15">firstButton</kbd> click task starts its execution. <a href="#ch13fig04" class="calibre4">Figure 13.4</a> illustrates the task queue 15 ms into the application execution. The execution of <kbd class="calibre15">firstHandler</kbd>, associated with the <kbd class="calibre15">firstButton</kbd> click, takes around 8 ms, and the handler is executed to its completion, without interruption, while the click event related
         to <kbd class="calibre15">secondButton</kbd> is waiting in the queue.
      </p>
      
      
      
      <h5 id="ch13fig04" class="notetitle">Figure 13.4. <a id="ch13fig04__title" class="calibre4"></a>The task queue 15 ms into application execution contains two tasks for click events. The first task is currently being executed.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig04.jpg" alt="" class="calibre2" width="500" height="299" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig04.jpg"></p>
      
      
      
      <p class="noind">Next, at 23 ms, the <kbd class="calibre15">firstButton</kbd> click event is fully processed, and the matching task is removed from the task queue. Again, the browser checks the microtask
         queue, which is still empty, and re-renders the page, if necessary.
      </p>
      
      <p class="noind">Finally, in the third loop iteration, the <kbd class="calibre15">secondButton</kbd> click event is being handled, as shown in <a href="#ch13fig05" class="calibre4">figure 13.5</a>. The <kbd class="calibre15">secondHandler</kbd> takes around 5 ms to execute, and after this is performed, the task queue is finally empty, at 28 ms.
      </p>
      
      
      
      <h5 id="ch13fig05" class="notetitle">Figure 13.5. <a id="ch13fig05__title" class="calibre4"></a>23 ms after the application starts executing, only one task, handling the <kbd class="calibre15">secondButton</kbd> click event, remains to be executed.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig05_alt.jpg" alt="" class="calibre2" width="590" height="263" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig05_alt.jpg"></p>
      
      
      <p class="noind">This example emphasizes that an event has to wait its turn to be processed, if other tasks are already being handled. For
         example, even though the <kbd class="calibre15">secondButton</kbd> click has happened 12 ms into the application execution, the matching handler is called somewhere around 23 ms into the application
         execution.
      </p>
      
      <p class="noind">Now let’s extend this code to include microtasks.</p>
      
      
      
      <h4 id="ch13lev2sec2" class="calibre26">13.1.2. <a id="ch13lev2sec2__title" class="calibre4"></a>An example with both macro- and microtasks
      </h4>
      
      <p class="noind">Now that you’ve seen how the event loop works against one task queue, we’ll extend our example to also include a microtask
         queue. The cleanest way to do this is to include a promise in the first button-click handler and the code that handles the
         promise after it resolves. As you’ll recall from <a href="kindle_split_017.html#ch06" class="calibre4">chapter 6</a>, <i class="calibre6">a promise is a placeholder for a value that we don’t have yet but will have later;</i> it’s a guarantee that we’ll eventually know <a id="iddle2116" class="calibre4"></a>the result of an asynchronous computation. For this reason, promise handlers, the callbacks we attach through the promise’s
         <kbd class="calibre15">then</kbd> method, are always called asynchronously, even if we attach them to already resolved promises.
      </p>
      
      <p class="noind">The following listing shows the modified code for this two-queue example.</p>
      
      
      
      <h5 id="ch13ex02" class="notetitle">Listing 13.2. <a id="ch13ex02__title" class="calibre4"></a>Pseudocode for our event loop demo with two queues
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/340fig01_alt.jpg" alt="" class="calibre2" width="590" height="298" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/340fig01_alt.jpg"></p>
      
      
      <p class="noind">In this example, we assume that the same actions occur as in the first example:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><kbd class="calibre15">firstButton</kbd> is clicked after 5 ms.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">secondButton</kbd> is clicked after 12 ms.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">firstHandler</kbd> handles the click event of <kbd class="calibre15">firstButton</kbd> and runs for 8 ms.
            
         </li>
         
         <li class="calibre20"><kbd class="calibre15">secondHandler</kbd> handles the click event of <kbd class="calibre15">secondButton</kbd> and runs for 5 ms.
            
         </li>
         
      </ul>
      
      <p class="noind">The only difference is that this time, within the <kbd class="calibre15">firstHandler</kbd> code, we also create an immediately resolved promise to which we pass a callback that will run for 4 ms. Because a promise
         represents a future value that we usually don’t know immediately, promise handlers are always handled asynchronously.
      </p>
      
      <p class="noind">To be honest, in this case, where we’ve created an immediately resolved promise, the JavaScript engine could immediately invoke
         the callback, because we already know that the promise is successfully resolved. But, for consistency sake, the JavaScript
         engine doesn’t do this, and instead calls all promise callbacks asynchronously, after the rest of the <kbd class="calibre15">firstHandler</kbd> code (which runs for 8 ms) is done executing. It does this by creating a new microtask and pushing it onto the microtask
         queue. Let’s explore the timing diagram of this execution in <a href="#ch13fig06" class="calibre4">figure 13.6</a>.
      </p>
      
      
      
      <h5 id="ch13fig06" class="notetitle">Figure 13.6. <a id="ch13fig06__title" class="calibre4"></a>If a microtask is queued in the microtask queue, it gets priority and is processed even if an older task is already waiting
         in the queue. In this case, the promise success microtask gets priority over the <kbd class="calibre15">secondButton</kbd> click event task.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig06_alt.jpg" alt="" class="calibre2" width="590" height="640" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig06_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1882" class="calibre4"></a>This timing diagram is similar to the diagram of the previous example. If we take a snapshot of the task queue 12 ms into
         the application execution, we’ll see the exact same tasks in the queue: The mainline JavaScript code is being processed while
         the tasks for handling the <kbd class="calibre15">firstButton</kbd> click and the <kbd class="calibre15">secondButton</kbd> click are waiting for their turns (just as in <a href="#ch13fig03" class="calibre4">figure 13.3</a>). But in addition to the task queue, in this example we’ll also focus on the microtask queue, which is still empty 12 ms
         into application execution.
      </p>
      
      <p class="noind">The next interesting point in application execution happens at 15 ms, when mainline JavaScript execution ends. Because a task
         has finished executing, the event loop checks the microtask queue, which is empty, and moves onto page rendering, if necessary.
         Again, for simplicity sake, we don’t include a rendering fragment in our timing diagram.
      </p>
      
      <p class="noind">In the next iteration of the event loop, the task associated with the <kbd class="calibre15">firstButton</kbd> click is being processed:
      </p>
      
      <pre id="PLd0e34189" class="calibre5">firstButton.addEventListener("click", function firstHandler(){
    <b class="calibre21">Promise.resolve().then(() =&gt; {</b>
      <b class="calibre21">/*Some promise handling code that runs for 4ms*/</b>
    });
    /*Some click handle code that runs for 8ms*/
  });</pre>
      
      <p class="noind">The <kbd class="calibre15">firstHandler</kbd> function creates an already resolved promise, by calling <kbd class="calibre15">Promise.resolve()</kbd> with a callback function that will for sure be invoked, because the promise is already resolved. This creates a new microtask
         to run the callback code. The microtask is placed into the microtask queue, and the click handler continues to execute for
         another 8 ms. The current state of the task queues is shown in <a href="#ch13fig07" class="calibre4">figure 13.7</a>.
      </p>
      
      
      
      <h5 id="ch13fig07" class="notetitle">Figure 13.7. <a id="ch13fig07__title" class="calibre4"></a>During the execution of the first click handler, a resolved promise is created. This queues up a promise success microtask
         in the microtask queue that will be executed as soon as possible, but without interrupting the currently running task.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig07.jpg" alt="" class="calibre2" width="500" height="356" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig07.jpg"></p>
      
      
      
      <p class="noind">We revisit the task queues again 23 ms into the application execution, after the <kbd class="calibre15">firstButton</kbd> click has been completely handled and its task taken off the task queue.
      </p>
      
      <p class="noind">At this point, the event loop has to choose which task to process next. We have one macrotask for handling the <kbd class="calibre15">secondButton</kbd> click that was placed in the task queue 12 ms into application execution, and one microtask for handling the promise success
         that was placed in the microtask queue somewhere around 15 ms into the application execution.
      </p>
      
      <p class="noind">If we consider things like this, it would be only fair that the <kbd class="calibre15">secondButton</kbd> click task gets handled first, but as we already mentioned, microtasks are smaller tasks that should be executed as soon
         as possible. Microtasks have priority, and if you look back at <a href="#ch13fig01" class="calibre4">figure 13.1</a>, you’ll see that every time a task is processed, the event loop first checks the microtask queue, with the goal of processing
         all microtasks before continuing on to either rendering or other tasks.
      </p>
      
      <p class="noind">For this reason, the promise success task is executed <i class="calibre6">immediately</i> after the <kbd class="calibre15">firstButton</kbd> click, even with the “older” <kbd class="calibre15">secondButton</kbd> click task still waiting in the task queue, as shown in <a href="#ch13fig08" class="calibre4">figure 13.8</a>.
      </p>
      
      
      
      <h5 id="ch13fig08" class="notetitle">Figure 13.8. <a id="ch13fig08__title" class="calibre4"></a>After a task gets executed, the event loop processes all tasks in the microtask queue. In this case, before moving to the
         <kbd class="calibre15">secondButton</kbd> click task, the promise success task is handled.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig08_alt.jpg" alt="" class="calibre2" width="590" height="286" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig08_alt.jpg"></p>
      
      
      <p class="noind">There’s one important point that we need to emphasize. After a macrotask gets executed, the event loop immediately moves onto
         handling the microtask queue, without allowing rendering until the microtask queue is empty. Just take a look at the timing
         diagram in <a href="#ch13fig09" class="calibre4">figure 13.9</a>.
      </p>
      
      
      
      <h5 id="ch13fig09" class="notetitle">Figure 13.9. <a id="ch13fig09__title" class="calibre4"></a>A page can be re-rendered between two macrotasks (mainline JavaScript execution and first click handler), while it <i class="calibre6">can’t</i> be rendered before a microtask is executed (before the promise handler).
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig09_alt.jpg" alt="" class="calibre2" width="590" height="169" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig09_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1184" class="calibre4"></a><a id="iddle1185" class="calibre4"></a><a id="iddle1414" class="calibre4"></a><a id="iddle2020" class="calibre4"></a><a id="iddle2033" class="calibre4"></a><a id="iddle2125" class="calibre4"></a><a href="#ch13fig09" class="calibre4">Figure 13.9</a> shows that a re-render can occur between two macrotasks, only if there are no microtasks in between. In our case, the page
         can be rendered between the mainline JavaScript execution and the first click handler, but it can’t be rendered immediately
         after the first click handler, because microtasks, such as promise handlers, have priority over rendering.
      </p>
      
      <p class="noind">A render can also occur after a microtask, but only if no other microtasks are waiting in the microtask queue. In our example,
         after the promise handler occurs, but before the event loop moves onto the second click handler, the browser can re-render
         the page.
      </p>
      
      <p class="noind">Note that there’s nothing stopping the promise success microtask from queuing other microtasks, and that all of these microtasks
         will have priority over the <kbd class="calibre15">secondButton</kbd> click task. The event loop will re-render the page and move onto the <kbd class="calibre15">secondButton</kbd> task only when the microtask queue is empty, so be careful!
      </p>
      
      <p class="noind">Now that you understand how the event loop works, let’s take a look at a special group of events: timers.</p>
      
      
      
      
      <h3 id="ch13lev1sec2" class="calibre24"><a id="ch13lev1sec2__title" class="calibre3"></a>13.2. Taming timers: time-outs and intervals
      </h3>
      
      <p class="noind">Timers, an often misused and poorly understood feature in JavaScript, can enhance the development of complex applications
         if used properly. Timers enable us to delay the execution of a piece of code by <i class="calibre6">at least</i> a certain number of milliseconds. We’ll use this capability to break long-running tasks into smaller tasks that won’t clog
         the event loop, thereby stopping the browser from rendering, and in the process making our web applications slow and unresponsive.
      </p>
      
      <p class="noind">But first, we’ll start by examining the functions we can use to construct and manipulate timers. The browser provides two
         methods for creating timers: <kbd class="calibre15">setTimeout</kbd> and <kbd class="calibre15">setInterval</kbd>. The browser also provides two corresponding methods to clear (or remove) them: <kbd class="calibre15">clearTimeout</kbd> and <kbd class="calibre15">clearInterval</kbd>. All are methods of the <kbd class="calibre15">window</kbd> (global context) object. Similarly to the event loop, timers aren’t defined within JavaScript itself; instead they’re provided
         by the host environment (such as the browser on the client, or Node.js on the server). <a href="#ch13table01" class="calibre4">Table 13.1</a> lists the methods for creating and clearing timers.
      </p>
      
      <h5 id="ch13table01" class="notetitle">Table 13.1. <a id="ch13table01__title" class="calibre4"></a>JavaScript’s timer-manipulation methods (methods of the global <kbd class="calibre15">window</kbd> object)
      </h5>
      <table cellpadding="8" width="100%" frame="hsides" cellspacing="5" rules="groups" class="calibre29">
         <colgroup span="3" class="calibre8">
            <col width="200" class="calibre9">
            <col width="200" class="calibre9">
            <col width="200" class="calibre9">
         </colgroup>
         <thead class="calibre30">
            <tr class="calibre11">
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Method</p>
               </th>
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Format</p>
               </th>
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Description</p>
               </th>
            </tr>
         </thead>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="docTableCell" valign="top">setTimeout</td>
               <td class="docTableCell" valign="top">id = setTimeout(fn,delay)</td>
               <td class="docTableCell" valign="top">Initiates a timer that will execute the passed callback once after the specified delay has elapsed. A value that uniquely
                  identifies the timer is returned.
               </td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">clearTimeout</td>
               <td class="docTableCell" valign="top">clearTimeout(id)</td>
               <td class="docTableCell" valign="top">Cancels (clears) the timer identified by the passed value if the timer hasn’t yet fired.</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top"><a id="iddle1416" class="calibre4"></a><a id="iddle2127" class="calibre4"></a>setInterval
               </td>
               <td class="docTableCell" valign="top">id = setInterval(fn,delay)</td>
               <td class="docTableCell" valign="top">Initiates a timer that will continually try to execute the passed callback at the specified delay interval, until canceled.
                  A value that uniquely identifies the timer is returned.
               </td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">clearInterval</td>
               <td class="docTableCell" valign="top">clearInterval(id)</td>
               <td class="docTableCell" valign="top">Cancels (clears) the interval timer identified by the passed value.</td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">These methods allow us to set and clear timers that either fire a single time or fire periodically at a specified interval.
         In practice, most browsers allow you to use both <kbd class="calibre15">clearTimeout</kbd> and <kbd class="calibre15">clearInterval</kbd> to cancel both kinds of timers, but it’s recommended that the methods be used in matched pairs, if for nothing other than
         clarity.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch13note03" class="notetitle">Note</h5>
      
      
      <p class="noindclose">It’s important to understand that <i class="calibre6">a timer’s delay isn’t guaranteed</i>. This has a great deal to do with the event loop, as we’ll see in the next section.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      <h4 id="ch13lev2sec3" class="calibre26">13.2.1. <a id="ch13lev2sec3__title" class="calibre4"></a>Timer execution within the event loop
      </h4>
      
      <p class="noind">You’ve already examined exactly what happens when an event occurs. But timers are different from standard events, so let’s
         explore an example similar to the ones you’ve seen so far. The following listing shows the code used for this example.
      </p>
      
      
      
      <h5 id="ch13ex03" class="notetitle">Listing 13.3. <a id="ch13ex03__title" class="calibre4"></a>Pseudocode for our time-out and interval demo
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/345fig01_alt.jpg" alt="" class="calibre2" width="590" height="260" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/345fig01_alt.jpg"></p>
      
      
      <p class="noind">This time we have only one button, but we also register two timers. First, we register a time-out that expires after 10 ms:</p>
      
      <pre id="PLd0e34558" class="calibre5">setTimeout(function timeoutHandler(){
  /*Some timeout handler code that runs for 6ms*/
}, 10);</pre>
      
      <p class="noind">As a handler, that time-out has a function that takes 6 ms to execute. Next, we also register an interval that expires every
         10 ms:
      </p>
      
      <pre id="PLd0e34568" class="calibre5">setInterval(function intervalHandler(){
  /*Some interval handler code that runs for 8ms*/
}, 10);</pre>
      
      <p class="noind">The interval has a handler that takes 8 ms to execute. We continue by registering a button-click event handler that takes
         10 ms to execute:
      </p>
      
      <pre id="PLd0e34577" class="calibre5">const myButton = document.getElementById("myButton");
myButton.addEventListener("click", function clickHandler(){
   /*Some click handler code that runs for 10ms*/
});</pre>
      
      <p class="noind">This example ends with a code block that runs for about 18 ms (again, humor us a bit and imagine some complex code here).</p>
      
      <p class="noind">Now, let’s say we again have a quick and impatient user who clicks the button 6 ms into the application execution. <a href="#ch13fig10" class="calibre4">Figure 13.10</a> shows a timing diagram of the first 18 ms of execution.
      </p>
      
      
      
      <h5 id="ch13fig10" class="notetitle">Figure 13.10. <a id="ch13fig10__title" class="calibre4"></a>A timing diagram that shows 18 ms of execution in the example program. The first, currently running task is to evaluate mainline
         JavaScript code. It takes 18 ms to execute. During that execution, three events occur: a mouse click, a timer expiry, and
         an interval firing.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig10_alt.jpg" alt="" class="calibre2" width="590" height="338" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig10_alt.jpg"></p>
      
      
      <p class="noind">As in the previous examples, the first task in the queue is to execute mainline JavaScript code. During that execution, which
         roughly takes 18 ms to complete, three important things occur:
      </p>
      
      <p class="calibre18"></p>
      <ol class="calibre27">
         
         <li class="calibre20"><a id="iddle2021" class="calibre4"></a><a id="iddle2034" class="calibre4"></a>At 0 ms, a time-out timer is initiated with a 10 ms delay, and an interval timer is also initiated with a 10 ms delay. Their
            references are kept by the browser.
            
         </li>
         
         <li class="calibre20">At 6 ms, the mouse is clicked.
            
         </li>
         
         <li class="calibre20">At 10 ms, the time-out timer expires and the first interval fires.
            
         </li>
         
      </ol>
      
      <p class="noind">As we already know from our event-loop exploration, a task always runs to completion and can’t be interrupted by another task.
         Instead, all newly created tasks are placed in a queue, where they patiently wait their turn to be processed. When the user
         clicks the button 6 ms into application execution, that task is added to the task queue. A similar thing happens at around
         10 ms, when the timer expires and the interval fires. Timer events, just like input events (such as mouse events), are placed
         in the task queue. Note that both the timer and interval are initiated with a 10 ms delay, and that after this period, their
         matching tasks are placed in the task queue. We’ll come back to this later, but for now it’s enough that you notice that the
         tasks are added to the queue in the order in which the handlers are registered: first the time-out handler and then the interval
         handler.
      </p>
      
      <p class="noind">The initial block of code completes executing after 18 ms, and because there are no microtasks in this execution, the browser
         can re-render the page (again, left out from our timing discussions, due to simplicity) and move onto the second iteration
         of the event loop. The state of the task queue at this time is shown in <a href="#ch13fig11" class="calibre4">figure 13.11</a>.
      </p>
      
      
      
      <h5 id="ch13fig11" class="notetitle">Figure 13.11. <a id="ch13fig11__title" class="calibre4"></a>Timer events are placed into the task queue as they expire.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig11.jpg" alt="" class="calibre2" width="425" height="374" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig11.jpg"></p>
      
      
      
      <p class="noind">When the initial block of code ends execution at 18 ms, three code blocks are queued up for execution: the click handler,
         the time-out handler, and the first invocation of the interval handler. This means that the waiting click handler (which we
         assume takes 10 ms to execute) begins execution. <a href="#ch13fig12" class="calibre4">Figure 13.12</a> shows another timing diagram.
      </p>
      
      
      
      <h5 id="ch13fig12" class="notetitle">Figure 13.12. <a id="ch13fig12__title" class="calibre4"></a>If an interval event fires, and a task is already associated with that interval waiting in the queue, a new task isn’t added.
         Instead, nothing happens, as is shown for the queues at 20 ms and 30 ms.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig12_alt.jpg" alt="" class="calibre2" width="590" height="471" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig12_alt.jpg"></p>
      
      
      <p class="noind">Unlike the <kbd class="calibre15">setTimeout</kbd> function, which expires only once, the <kbd class="calibre15">setInterval</kbd> function fires until we explicitly clear it. So, at around 20 ms, another interval fires. Normally, this would create a new
         task and add it to the task queue. But this time, because an instance of an interval task is already queued and awaiting execution,
         this invocation is dropped. <i class="calibre6">The browser won’t queue up more than one instance of a specific interval handler</i>.
      </p>
      
      <p class="noind">The click handler completes at 28 ms, and the browser is again allowed to re-render the page before the event loop goes into
         another iteration. In the next iteration of the event loop, at 28 ms, the time-out task is processed. But think back to the
         beginning of this example. We used the following function call to set a time-out that should expire after 10 ms:
      </p>
      
      <pre id="PLd0e34693" class="calibre5">setTimeout(function timeoutHandler(){
  /*Some timeout handle code that runs for 6ms*/
}, 10);</pre>
      
      <p class="noind">Because this is the first task in our application, it’s not weird to expect that the time-out handler will be executed exactly
         after 10 ms. But as you see in <a href="#ch13fig11" class="calibre4">figure 13.11</a>, the time-out starts at the 28 ms mark!
      </p>
      
      <p class="noind">That’s why we were extra careful when saying that a timer provides the capability to asynchronously delay the execution of
         a piece of code by <i class="calibre6">at least</i> a certain number of milliseconds. Because of the single-threaded nature of JavaScript, we can control only when the timer
         task is added to the queue, and not when it’s finally executed! Now that we cleared up this little conundrum, let’s continue
         with the remainder of the application execution.
      </p>
      
      <p class="noind"><a id="iddle2022" class="calibre4"></a>The time-out task takes 6 ms to execute, so it should be finished 34 ms into the application execution. During this time period,
         at 30 ms another interval fires, because we’ve scheduled it to be executed every 10 ms. Once more, no additional task is queued,
         because a matching task for interval handler execution is already waiting in the queue. At 34 ms, the time-out handler finishes,
         and the browser again has a chance to re-render the page and enter another iteration of the event loop.
      </p>
      
      <p class="noind">Finally, the interval handler starts its execution at 34 ms, 24 ms <i class="calibre6">after</i> the 10 ms mark at which it was added to the event queue. This again emphasizes that the delay we pass in as an argument to
         the functions <kbd class="calibre15">setTimeout(fn, delay)</kbd> and <kbd class="calibre15">setInterval(fn, delay)</kbd> specifies only the delay after which the matching task is added to the queue, and not the exact time of execution.
      </p>
      
      <p class="noind">The interval handler takes 8 ms to execute, so while it’s executing, another interval expires at the 40 ms mark. This time,
         because the interval handler is being executed (and not waiting in the queue), a new interval task is finally added to the
         task queue, and the execution of our application continues, as shown in <a href="#ch13fig13" class="calibre4">figure 13.13</a>. Setting a <kbd class="calibre15">setInterval</kbd> delay to 10 ms doesn’t mean that we’ll end up with our handler executing every 10 ms. For example, because tasks are queued
         and the duration of a single task execution can vary, intervals can be executed one right after another, as is the case with
         intervals at the 42 and 50 ms marks.
      </p>
      
      
      
      <h5 id="ch13fig13" class="notetitle">Figure 13.13. <a id="ch13fig13__title" class="calibre4"></a>Because of the setbacks caused by the mouse click and time-out handler, it takes some time for the interval handlers to start
         executing every 10 ms.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig13_alt.jpg" alt="" class="calibre2" width="590" height="198" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig13_alt.jpg"></p>
      
      
      <p class="noind">Finally, after 50 ms our intervals stabilize and are executed every 10 ms. The important concept to take away is that the
         event loop can process only one task at a time, and that we can never be certain that timer handlers will execute exactly
         when we expect them to. This is especially true of interval handlers. We saw in this example that even though we scheduled
         an interval expected to fire at 10, 20, 30, 40, 50, 60, and 70 ms marks, the callbacks were executed at 34, 42, 50, 60, and
         70 ms marks. In this case, we completely lost two of them along the way, and some weren’t executed at the expected time.
      </p>
      
      <p class="noind">As we can see, intervals have special considerations that don’t apply to time-outs. Let’s look at those more closely.</p>
      
      
      
      <h5 id="ch13lev3sec1" class="notetitle"><a id="ch13lev3sec1__title" class="calibre4"></a>Differences between time-outs and intervals
      </h5>
      
      <p class="noind"><a id="iddle1238" class="calibre4"></a><a id="iddle1415" class="calibre4"></a><a id="iddle1417" class="calibre4"></a><a id="iddle1684" class="calibre4"></a><a id="iddle2035" class="calibre4"></a><a id="iddle2121" class="calibre4"></a><a id="iddle2126" class="calibre4"></a>At first glance, an interval may look like a time-out that periodically repeats itself. But the differences run a little deeper.
         Let’s look at an example to better illustrate the differences between <kbd class="calibre15">setTimeout</kbd> and <kbd class="calibre15">setInterval</kbd>:
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/350fig01_alt.jpg" alt="" class="calibre2" width="590" height="121" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/350fig01_alt.jpg"></p>
      
      <p class="noind">The two pieces of code may <i class="calibre6">appear</i> to be functionally equivalent, but they aren’t. Notably, the <kbd class="calibre15">setTimeout</kbd> variant of the code will always have at least a 10 ms delay after the previous callback execution (depending on the state
         of the event queue, it may end up being more, but never less), whereas <kbd class="calibre15">setInterval</kbd> will attempt to execute a callback every 10 ms regardless of when the last callback was executed. And, as you saw in the
         example from the previous section, intervals can be fired immediately one after another, regardless of the delay.
      </p>
      
      <p class="noind">We know that the time-out callback is never guaranteed to execute exactly when it’s fired. Rather than being fired every 10
         ms, as the interval is, it will reschedule itself for 10 ms after it gets around to executing.
      </p>
      
      <p class="noind">All of this is incredibly important knowledge. Knowing how a JavaScript engine handles asynchronous code, especially with
         the large number of asynchronous events that typically occur in the average page, creates a great foundation for building
         advanced pieces of application code.
      </p>
      
      <p class="noind">With all that under our belts, let’s see how our understanding of timers and the event loop can help avoid some performance
         pitfalls.
      </p>
      
      
      
      
      <h4 id="ch13lev2sec4" class="calibre26">13.2.2. <a id="ch13lev2sec4__title" class="calibre4"></a>Dealing with computationally expensive processing
      </h4>
      
      <p class="noind">The single-threaded nature of JavaScript is probably the largest gotcha in complex JavaScript application development. While
         JavaScript is busy executing, user interaction in the browser can become, at best, sluggish, and, at worst, unresponsive.
         The browser may stutter or seem to hang, because all updates to the rendering of a page are suspended while JavaScript is
         executing.
      </p>
      
      <p class="noind">Reducing all complex operations that take any more than a few hundred milliseconds into manageable portions becomes a necessity
         if we want to keep the interface responsive. Additionally, most browsers will produce a dialog box warning the user that a
         script has become “unresponsive” if it has run nonstop for at least 5 seconds, while some other browsers will even silently
         kill any script running for more than 5 seconds.
      </p>
      
      <p class="noind">You may have been to a family reunion where a garrulous uncle won’t stop talking and insists on telling the same stories over
         and over again. If no one else gets a chance to break in and get a word in edgewise, the conversation’s not going to be pleasant
         for anyone (except for Uncle Bruce). Likewise, code that hogs all the processing time results in an outcome that’s less than
         desirable; producing an unresponsive user interface is never good. But situations will almost certainly arise that require
         us to process a significant amount of data, situations such as manipulating a couple of thousand DOM elements, for example.
      </p>
      
      <p class="noind">On these occasions, timers can come to the rescue and become especially useful. Because timers are capable of effectively
         suspending the execution of a piece of JavaScript until a later time, they can also break individual pieces of code into fragments
         that aren’t long enough to cause the browser to hang. Taking this into account, we can convert intensive loops and operations
         into nonblocking operations.
      </p>
      
      <p class="noind">Let’s look at the following example of a task that’s likely to take a long time.</p>
      
      
      
      <h5 id="ch13ex04" class="notetitle">Listing 13.4. <a id="ch13ex04__title" class="calibre4"></a>A long-running task
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/351fig01_alt.jpg" alt="" class="calibre2" width="590" height="222" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/351fig01_alt.jpg"></p>
      
      
      <p class="noind">In this example, we’re creating a total of 240,000 DOM nodes, populating a table with 20,000 rows of 6 cells, each containing
         a text node. This is incredibly expensive and will likely hang the browser for a noticeable period while executing, preventing
         the user from performing normal interactions (much in the same way that Uncle Bruce dominates the conversation at the family
         get-together).
      </p>
      
      <p class="noind">What we need to do is shut up Uncle Bruce at regular intervals so that other people can get a chance to join the conversation.
         In code, we can introduce timers to create just such “breaks in the conversation,” as shown in the next listing.
      </p>
      
      
      
      <h5 id="ch13ex05" class="notetitle">Listing 13.5. <a id="ch13ex05__title" class="calibre4"></a>Using a timer to break up a long-running task
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/351fig02_alt.jpg" alt="" class="calibre2" width="590" height="324" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/351fig02_alt.jpg"></p>
      
      
      <p class="noind">In this modification to the example, we’ve broken up the lengthy operation into four smaller operations, each creating its
         own share of DOM nodes. These smaller operations are much less likely to interrupt the flow of the browser, as shown in <a href="#ch13fig14" class="calibre4">figure 13.14</a>. Note that we’ve set it up so that the data values controlling the operation are collected into easily tweakable variables
         (<kbd class="calibre15">rowCount</kbd>, <kbd class="calibre15">divideInto</kbd>, and <kbd class="calibre15">chunkSize</kbd>), should we need to break the operations into, let’s say, ten parts instead of four.
      </p>
      
      
      
      <h5 id="ch13fig14" class="notetitle">Figure 13.14. <a id="ch13fig14__title" class="calibre4"></a>Use timers to break long-running tasks into smaller tasks that won’t clog the event loop.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig14_alt.jpg" alt="" class="calibre2" width="590" height="509" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig14_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1041" class="calibre4"></a>Also important to note is the little bit of math needed to keep track of where we left off in the previous iteration, <kbd class="calibre15">base = chunkSize * iteration</kbd>, and how we automatically schedule the next iterations until we determine that we’re done:
      </p>
      
      <pre id="PLd0e34945" class="calibre5">if (iteration &lt; divideInto)
    setTimeout(generateRows, 0);</pre>
      
      <p class="noind">What’s impressive is just how little the code has to change in order to accommodate this new, asynchronous approach. We have
         to do a <i class="calibre6">little</i> more work to keep track of what’s going on, to ensure that the operation is correctly conducted, and to schedule the execution
         parts. But beyond that, the core of the code looks similar to what we started with.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch13note04" class="notetitle">Note</h5>
      
      
      <p class="noindclose">In this case, we’ve used <kbd class="calibre15">0</kbd> for our time-out delay. If you’ve paid close attention to how the event loop works, you know that this doesn’t mean that
         the callback will be executed in 0 ms. Instead, it’s a way of telling the browser, please execute this callback as soon as
         possible; but unlike with microtasks, you’re allowed to do page rendering in between. This allows the browser to update the
         UI and make our web applications more responsive.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">The most perceptible change resulting from this technique, from the user’s perspective, is that a long browser hang is replaced
         with four (or however many we choose) visual updates of the page. Although the browser will attempt to execute the code segments
         as quickly as possible, it will also render the DOM changes after each step of the timer. In the original version of the code,
         it needed to wait for one large bulk update.
      </p>
      
      <p class="noind">Much of the time, these types of updates are imperceptible to the user, but it’s important to remember that they do occur.
         We should strive to ensure that any code we introduce into the page doesn’t perceptibly interrupt the normal operation of
         the browser.
      </p>
      
      <p class="noind">It’s often surprising just how useful this technique can be. By understanding how the event loop works, we can work around
         the restrictions of the single-threaded browser environment, while still providing a pleasant experience to the user.
      </p>
      
      <p class="noind">Now that we understand the event loop and the roles timers can play in dealing with complex operations, let’s take a closer
         look at how the events themselves work.
      </p>
      
      
      
      
      <h3 id="ch13lev1sec3" class="calibre24"><a id="ch13lev1sec3__title" class="calibre3"></a>13.3. Working with events
      </h3>
      
      <p class="noind">When a certain event occurs, we can handle it in our code. As you’ve seen many times throughout this book, one common way
         of registering event handlers is by using the built-in <kbd class="calibre15">addEventListener</kbd> method, as shown in the following listing.
      </p>
      
      
      
      <h5 id="ch13ex06" class="notetitle">Listing 13.6. <a id="ch13ex06__title" class="calibre4"></a>Registering event handlers
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/353fig01_alt.jpg" alt="" class="calibre2" width="590" height="176" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/353fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1359" class="calibre4"></a><a id="iddle1432" class="calibre4"></a><a id="iddle2089" class="calibre4"></a>In this snippet, we define a button named <kbd class="calibre15">myButton</kbd> and register a click event handler by using the built-in <kbd class="calibre15">addEventListener</kbd> method that’s accessible from all elements.
      </p>
      
      <p class="noind">After a click event occurs, the browser calls the associated handler, in this case the <kbd class="calibre15">myHandler</kbd> function. To this handler, the browser passes in an event object that contains properties that we can use to find out more
         information about the event, such as the position of the mouse or the mouse button that was clicked, in case we’re dealing
         with a mouse-click event, or the pressed key if we’re dealing with a keyboard event.
      </p>
      
      <p class="noind">One of the properties of the passed-in event object is the <kbd class="calibre15">target</kbd> property, which references the element on which the event has occurred.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch13note05" class="notetitle">Note</h5>
      
      
      <p class="noindclose">As within most other functions, within the event handler, we can use the <kbd class="calibre15">this</kbd> keyword. People often colloquially say that within an event handler, the <kbd class="calibre15">this</kbd> keyword refers to the object on which the event has occurred, but as we’ll soon find out, this isn’t exactly true. Instead,
         the <kbd class="calibre15">this</kbd> keyword refers to the element on which the event handler has been <i class="calibre6">registered</i>. To be honest, in most cases the element on which the event handler has been registered <i class="calibre6">is</i> the element on which the event has occurred, but there are exceptions. We’ll explore these situations shortly.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Before exploring this concept further, let’s set the stage so you can see how events can be propagated through the DOM.</p>
      
      
      <h4 id="ch13lev2sec5" class="calibre26">13.3.1. <a id="ch13lev2sec5__title" class="calibre4"></a>Propagating events through the DOM
      </h4>
      
      <p class="noind">As we already know from <a href="kindle_split_012.html#ch02" class="calibre4">chapter 2</a>, in HTML documents, elements are organized in a tree. An element can have zero or more children, and every element (except
         the root <kbd class="calibre15">html</kbd> element) has exactly one parent. Now, suppose that we’re working with a page that has an element inside another element,
         and both elements have a click handler, as in the following listing.
      </p>
      
      <h5 id="ch13ex07" class="notetitle">Listing 13.7. <a id="ch13ex07__title" class="calibre4"></a>Nested elements and click handlers
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch13ex07-0.jpg" alt="" class="calibre2" width="590" height="226" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch13ex07-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch13ex07-1.jpg" alt="" class="calibre2" width="590" height="223" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch13ex07-1.jpg"></p>
      
      <p class="noind"><a id="iddle1338" class="calibre4"></a><a id="iddle1402" class="calibre4"></a><a id="iddle1405" class="calibre4"></a>Here we have two HTML elements, <kbd class="calibre15">outerContainer</kbd> and <kbd class="calibre15">innerContainer</kbd>, that are, like all the other HTML elements, contained within our global <kbd class="calibre15">document</kbd>. And on all three objects, we register a click handler.
      </p>
      
      <p class="noind">Now let’s suppose that a user clicks the <kbd class="calibre15">innerContainer</kbd> element. Because <kbd class="calibre15">innerContainer</kbd> is contained within the <kbd class="calibre15">outerContainer</kbd> element, and both of these elements are contained within the <kbd class="calibre15">document</kbd>, it’s obvious that this should trigger the execution of all three event handlers, outputting three messages. What’s not apparent
         is the order in which the event handlers should be executed.
      </p>
      
      <p class="noind">Should we follow the order in which the events were registered? Should we start with the element on which the event occurs
         and move upward? Or should we start from the top and move downward toward the targeted element? Back in the day, when browsers
         were first making these decisions, the two primary competitors, Netscape and Microsoft, made opposing choices.
      </p>
      
      <p class="noind">In Netscape’s event model, the event handling starts with the top element and trickles down to the event target element. In
         our case, the event handlers would be executed in the following order: <kbd class="calibre15">document</kbd> click handler, <kbd class="calibre15">outerContainer</kbd> click handler, and finally <kbd class="calibre15">innerContainer</kbd> click handler. This is called <i class="calibre6">event capturing.</i></p>
      
      <p class="noind">Microsoft chose to go the other way around: start from the targeted element and bubble up the DOM tree. In our case, the events
         would be executed in the following order: <kbd class="calibre15">innerContainer</kbd> click handler, <kbd class="calibre15">outerContainer</kbd> click handler, and <kbd class="calibre15">document</kbd> click handler. This is called <i class="calibre6">event bubbling.</i></p>
      
      <p class="noind">The standard set by the W3 Consortium (<a href="http://www.w3.org/TR/DOM-Level-3-Events/" class="calibre4">www.w3.org/TR/DOM-Level-3-Events/</a>), which is implemented by all modern browsers, embraces both approaches. An event is handled in two phases:
      </p>
      
      <p class="calibre18"></p>
      <ol class="calibre27">
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Capturing phase—</i> </b><a id="iddle1042" class="calibre4"></a><a id="iddle1138" class="calibre4"></a><a id="iddle1160" class="calibre4"></a>An event is first captured at the top element and trickled down to the target element.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Bubbling phase—</i> </b>After the target element has been reached in the capturing phase, the event handling switches to bubbling, and the event bubbles
            up again from the target element to the top element.
            
         </li>
         
      </ol>
      
      <p class="noind">These two phases are shown in <a href="#ch13fig15" class="calibre4">figure 13.15</a>.
      </p>
      
      
      
      <h5 id="ch13fig15" class="notetitle">Figure 13.15. <a id="ch13fig15__title" class="calibre4"></a>With capturing, the event trickles down to the target element. With bubbling, the event bubbles up from the target element.
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig15.jpg" alt="" class="calibre2" width="477" height="506" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig15.jpg"></p>
      
      
      
      <p class="noind">We can easily decide which event-handling order we want to use, by adding another Boolean argument to the <kbd class="calibre15">addEventListener</kbd> method. If we use <kbd class="calibre15">true</kbd> as the third argument, the event will be captured, whereas if we use <kbd class="calibre15">false</kbd> (or leave out the value), the event will bubble. So in a sense, the W3C standard prefers event bubbling slightly more to
         event capturing, because bubbling has been made the default option.
      </p>
      
      <p class="noind">Now let’s go back to <a href="#ch13ex07" class="calibre4">listing 13.7</a> and look closely at the way we’ve registered events:
      </p>
      
      <pre id="PLd0e35262" class="calibre5">outerContainer.addEventListener("click", () =&gt; {
  report("Outer container click");
});

innerContainer.addEventListener("click", () =&gt; {
  report("Inner container click");
});

document.addEventListener("click", () =&gt; {
  report("Document click");
});</pre>
      
      <p class="noind"><a id="iddle1339" class="calibre4"></a>As you can see, in all three cases, we’ve called the <kbd class="calibre15">addEventListener</kbd> method with only two arguments, which means that the default method, <i class="calibre6">bubbling</i>, is chosen. So in this case, if we click the <kbd class="calibre15">innerContainer</kbd> element, the event handlers would be executed in this order: <kbd class="calibre15">innerContainer</kbd> click handler, <kbd class="calibre15">outerContainer</kbd> click handler, <kbd class="calibre15">document</kbd> click handler.
      </p>
      
      <p class="noind">Let’s modify the code in <a href="#ch13ex07" class="calibre4">listing 13.7</a> in the following way.
      </p>
      
      
      
      <h5 id="ch13ex08" class="notetitle">Listing 13.8. <a id="ch13ex08__title" class="calibre4"></a>Capturing versus bubbling
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/357fig01_alt.jpg" alt="" class="calibre2" width="590" height="238" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/357fig01_alt.jpg"></p>
      
      
      <p class="noind">This time, we set the event handler of the <kbd class="calibre15">outerContainer</kbd> to capturing mode (by passing in <kbd class="calibre15">true</kbd> as the third argument), and the event handlers of <kbd class="calibre15">innerContainer</kbd> (by passing in <kbd class="calibre15">false</kbd> as the third argument) and <kbd class="calibre15">document</kbd> to bubbling mode (leaving out the third argument chooses the default, bubbling mode).
      </p>
      
      <p class="noind">As you know, a single event can trigger the execution of multiple event handlers, where each handler can be in either capturing
         or bubbling mode. For this reason, the event first goes through capturing, starting from the top element and trickling down
         to the event target element. When the target element is reached, bubbling mode is activated, and the event bubbles from the
         target element all the way back to the top.
      </p>
      
      <p class="noind">In our case, capturing starts from the top, <kbd class="calibre15">window</kbd> object and trickles down to the <kbd class="calibre15">innerContainer</kbd> element, with the goal of finding all elements that have an event handler for this click event in capturing mode. Only one
         element, <kbd class="calibre15">outerContainer</kbd>, is found, and its matching click handler is executed as the first event handler.
      </p>
      
      <p class="noind">The event continues traveling down the capturing path, but no more event handlers with capturing are found. After the event
         reaches the event target element, the <kbd class="calibre15">innerContainer</kbd> element, the event moves on to the bubbling phase, where it goes from the target element all the way back to the top, executing
         all bubbling event handlers on that path.
      </p>
      
      <p class="noind">In our case, the <kbd class="calibre15">innerContainer</kbd> click handler will be executed as the second event handler, and the <kbd class="calibre15">document</kbd> click handler as the third. The output generated by clicking the <kbd class="calibre15">innerContainer</kbd> element, as well as the taken path, is shown in <a href="#ch13fig16" class="calibre4">figure 13.16</a>.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="ch13fig16" class="notetitle">Figure 13.16. <a id="ch13fig16__title" class="calibre4"></a>First the event trickles down from the top, executing all event handlers in capturing mode. When the target element is reached,
         the event bubbles up to the top, executing all event handlers in bubbling mode.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig16_alt.jpg" alt="" class="calibre2" width="590" height="447" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/13fig16_alt.jpg"></p>
      
      
      <p class="noind">One of the things this example shows is that the element on which the event is handled doesn’t have to be the element on which
         the event occurs. For example, in our case, the event occurs on the <kbd class="calibre15">innerContainer</kbd> element, but we can handle it on elements higher up in the DOM hierarchy, such as on the <kbd class="calibre15">outerContainer</kbd> or the <kbd class="calibre15">document</kbd> element.
      </p>
      
      <p class="noind">This takes us back to the <kbd class="calibre15">this</kbd> keyword in event handlers, and why we explicitly stated that the <kbd class="calibre15">this</kbd> keyword refers to the element on which the event handler is registered, and not necessarily to the element on which the event
         occurs.
      </p>
      
      <p class="noind">Again, let’s modify our running example, as shown in the following listing.</p>
      
      
      
      <h5 id="ch13ex09" class="notetitle">Listing 13.9. <a id="ch13ex09__title" class="calibre4"></a>The difference between this and event.target in event handlers
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/358fig01_alt.jpg" alt="" class="calibre2" width="590" height="302" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/358fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1043" class="calibre4"></a><a id="iddle1403" class="calibre4"></a><a id="iddle1423" class="calibre4"></a><a id="iddle2090" class="calibre4"></a>Again, let’s look at the application execution when a click occurs on <kbd class="calibre15">innerContainer</kbd>. Because both event handlers use event bubbling (there’s no third argument set to <kbd class="calibre15">true</kbd> in the <kbd class="calibre15">addEventListener</kbd> methods), first the <kbd class="calibre15">innerContainer</kbd> click handler is invoked. Within the body of the handler, we check that both the <kbd class="calibre15">this</kbd> keyword and the <kbd class="calibre15">event.target</kbd> property refer to the <kbd class="calibre15">innerContainer</kbd> element:
      </p>
      
      <pre id="PLd0e35463" class="calibre5">assert(this === innerContainer,
       "This refers to the innerContainer");
assert(event.target === innerContainer,
       "event.target refers to the innerContainer");</pre>
      
      <p class="noind">The <kbd class="calibre15">this</kbd> keyword points to the <kbd class="calibre15">innerContainer</kbd> element because that’s the element on which the current handler has been <i class="calibre6">registered</i>, whereas the <kbd class="calibre15">event.target</kbd> property points to the <kbd class="calibre15">innerContainer</kbd> element because that’s the element on which the event has <i class="calibre6">occurred</i>.
      </p>
      
      <p class="noind">Next, the event bubbles up to the <kbd class="calibre15">outerContainer</kbd> handler. This time, the <kbd class="calibre15">this</kbd> keyword and the <kbd class="calibre15">event.target</kbd> point to different elements:
      </p>
      
      <pre id="PLd0e35502" class="calibre5">assert(this === <b class="calibre21">outerContainer</b>,
       "This refers to the outerContainer");
assert(event.target === <b class="calibre21">innerContainer</b>,
       "event.target refers to the innerContainer");</pre>
      
      <p class="noind">As expected, the <kbd class="calibre15">this</kbd> keyword refers to the <kbd class="calibre15">outerContainer</kbd> element, because this is the element on which the current handler has been registered. On the other hand, the <kbd class="calibre15">event.target</kbd> property points to the <kbd class="calibre15">innerContainer</kbd> element, because this is the element on which the event has occurred.
      </p>
      
      <p class="noind">Now that we understand how an event is propagated through the DOM tree and how to access the element on which the event has
         originally occurred, let’s see how to apply this knowledge to write less memory-intensive code.
      </p>
      
      
      
      <h5 id="ch13lev3sec2" class="notetitle"><a id="ch13lev3sec2__title" class="calibre4"></a>Delegating events to an ancestor
      </h5>
      
      <p class="noind"><a id="iddle1301" class="calibre4"></a><a id="iddle1424" class="calibre4"></a>Let’s say that we want to visually indicate whether a cell within a table has been clicked by the user, by initially displaying
         a white background for each cell and then changing the background color to yellow after the cell is clicked. Sounds easy enough.
         We can iterate through all the cells and establish a handler on each one that changes the background color property:
      </p>
      
      <pre id="PLd0e35555" class="calibre5">const cells = document.querySelectorAll('td');
for (let n = 0; n &lt; cells.length; n++) {
  cells[n].addEventListener('click', function(){
    this.style.backgroundColor = 'yellow';
  });
}</pre>
      
      <p class="noind">Sure this works, but is it elegant? No. We’re establishing the exact same event handler on potentially hundreds of elements,
         and they all do <i class="calibre6">the exact same thing</i>.
      </p>
      
      <p class="noind">A much more elegant approach is to establish a single handler at a level higher than the cells that can handle all the events
         using event bubbling.
      </p>
      
      <p class="noind">We know that all the cells will be descendants of their enclosing table, and we know that we can get a reference to the element
         that was clicked via <kbd class="calibre15">event.target</kbd>. It’s much more suave to <i class="calibre6">delegate</i> the event handling to the table, as follows:
      </p>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/360fig01_alt.jpg" alt="" class="calibre2" width="590" height="76" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/360fig01_alt.jpg"></p>
      
      <p class="noind">Here, we establish one handler that easily handles the work of changing the background color for all cells in the table that
         were clicked. This is much more efficient and elegant.
      </p>
      
      <p class="noind">With event delegation, we have to make sure that it’s only applied to elements that are ancestors of the elements that are
         the event targets. That way, we’re sure that the events will eventually bubble up to the element to which the handler has
         been delegated.
      </p>
      
      <p class="noind">So far, we’ve been dealing with events that are provided by the browser, but haven’t you ever fervently desired the ability
         to trigger your own <i class="calibre6">custom</i> events?
      </p>
      
      
      
      
      <h4 id="ch13lev2sec6" class="calibre26">13.3.2. <a id="ch13lev2sec6__title" class="calibre4"></a>Custom events
      </h4>
      
      <p class="noind">Imagine a scenario in which you want to perform an action, but you want to trigger it under a variety of conditions from different
         pieces of code, perhaps even from code that’s in shared script files. A novice would repeat the code everywhere it’s needed.
         A journeyman would create a global function and call it from everywhere it’s needed. A ninja would use custom events. But
         why?
      </p>
      
      
      
      <h5 id="ch13lev3sec3" class="notetitle"><a id="ch13lev3sec3__title" class="calibre4"></a>Loose coupling
      </h5>
      
      <p class="noind"><a id="iddle1196" class="calibre4"></a><a id="iddle1302" class="calibre4"></a><a id="iddle1304" class="calibre4"></a><a id="iddle1425" class="calibre4"></a><a id="iddle1427" class="calibre4"></a><a id="iddle1736" class="calibre4"></a>Say we’re doing operations from shared code, and we want to let page code know when it’s time to react to a particular condition.
         If we use the journeyman’s global function approach, we introduce the disadvantage that our shared code needs to define a
         fixed name for the function, and all pages that use the shared code need to use such a function.
      </p>
      
      <p class="noind">Moreover, what if there are multiple things to do when the triggering condition occurs? Making allowances for multiple notifications
         would be arduous and necessarily messy. These disadvantages are a result of <i class="calibre6">close coupling</i>, in which the code that detects the conditions has to know the details of the code that will react to that condition.
      </p>
      
      <p class="noind"><i class="calibre6">Loose coupling</i>, on the other hand, occurs when the code that triggers the condition doesn’t know anything about the code that will react
         to the condition, or even if there’s anything that will react to it at all. One of the advantages of event handlers is that
         we can establish as many as we want, and these handlers are completely independent of each other. So event handling is a good
         example of loose coupling. When a button-click event is triggered, the code triggering the event has no knowledge of what
         handlers we’ve established on the page, or even if there are any. Rather, the click event is pushed onto the task queue by
         the browser, and whatever caused the event to trigger could care less what happens after that. If handlers have been established
         for the click event, they’ll eventually be individually invoked in a completely independent fashion.
      </p>
      
      <p class="noind">There’s much to be said for loose coupling. In our scenario, the shared code, when it detects an interesting condition, triggers
         a signal of some sort that says, “This interesting thing has happened; anyone interested can deal with it,” and it couldn’t
         give a darn whether anyone’s interested. Let’s examine a concrete example.
      </p>
      
      
      
      <h5 id="ch13lev3sec4" class="notetitle"><a id="ch13lev3sec4__title" class="calibre4"></a>An Ajax-y example
      </h5>
      
      <p class="noind">Let’s pretend that we’ve written some shared code that will be performing an Ajax request. The pages that this code will be
         used on want to be notified when an Ajax request begins and when it ends; each page has its own things that it needs to do
         when these “events” occur.
      </p>
      
      <p class="noind">For example, on one page using this package, we want to display a spinning pinwheel when an Ajax request starts, and we want
         to hide it when the request completes, in order to give the user some visual feedback that a request is being processed. If
         we imagine the start condition as an event named <kbd class="calibre15">ajax-start</kbd>, and the stop condition as <kbd class="calibre15">ajax-complete</kbd>, wouldn’t it be grand if we could establish event handlers on the page for these events that show and hide the image as appropriate?
      </p>
      
      <p class="noind">Consider this:</p>
      
      <pre id="PLd0e35699" class="calibre5">document.addEventListener('ajax-start', e =&gt; {
  document.getElementById('whirlyThing').style.display = 'inline-block';
});
document.addEventListener('ajax-complete', e =&gt; {
  document.getElementById('whirlyThing').style.display = 'none';
});</pre>
      
      <p class="noind"><a id="iddle1303" class="calibre4"></a><a id="iddle1426" class="calibre4"></a>Sadly, these events don’t exist, but there’s nothing stopping us from bringing them into existence.
      </p>
      
      
      
      <h5 id="ch13lev3sec5" class="notetitle"><a id="ch13lev3sec5__title" class="calibre4"></a>Creating custom events
      </h5>
      
      <p class="noind">Custom events are a way of simulating (for the user of our shared code) the experience of a real event, but an event that
         has business sense within the context of our application. The following listing shows an example of triggering a custom event.
      </p>
      
      <h5 id="ch13ex10" class="notetitle">Listing 13.10. <a id="ch13ex10__title" class="calibre4"></a>Using custom events
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch13ex10-0.jpg" alt="" class="calibre2" width="590" height="227" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch13ex10-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch13ex10-1.jpg" alt="" class="calibre2" width="590" height="237" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/ch13ex10-1.jpg"></p>
      
      <p class="noind">In this example, we explore custom events by establishing the scenario described in the previous section: An animated pinwheel
         image is displayed while an Ajax operation is underway. The operation is triggered by the click of a button.
      </p>
      
      <p class="noind">In a completely decoupled fashion, a handler for a custom event named <kbd class="calibre15">ajax-start</kbd> is established, as is the one for the <kbd class="calibre15">ajax-complete</kbd> custom event. The handlers for these events show and hide the pinwheel image, respectively:
      </p>
      
      
      <pre id="PLd0e35763" class="calibre5">button.addEventListener('click', () =&gt; {
  performAjaxOperation();
});

document.addEventListener('ajax-start', e =&gt; {
  document.getElementById('whirlyThing').style.display = 'inline-block';
  assert(e.detail.url === 'my-url', 'We can pass in event data');
});

document.addEventListener('ajax-complete', e =&gt; {
    document.getElementById('whirlyThing').style.display = 'none';
});</pre>
      
      <p class="noind">Note that the three handlers know nothing of each other’s existence. In particular, the button click handler has no responsibilities
         with respect to showing and hiding the image.
      </p>
      
      <p class="noind">The Ajax operation itself is simulated with the following code:</p>
      
      <pre id="PLd0e35775" class="calibre5">function performAjaxOperation() {
  triggerEvent(document, 'ajax-start', { url: 'my-url'});
  setTimeout(() =&gt; {
    triggerEvent(document, 'ajax-complete');
  }, 5000);
}</pre>
      
      <p class="noind">The function triggers the <kbd class="calibre15">ajax-start</kbd> event and sends data about the event (the <kbd class="calibre15">url</kbd> property), pretending that an Ajax request is about to be made. The function then issues a 5-second time-out, simulating
         an Ajax request that spans 5 seconds. When the timer expires, we pretend that the response has been returned and trigger an
         <kbd class="calibre15">ajax-complete</kbd> event to signify that the Ajax operation has completed.
      </p>
      
      <p class="noind">Notice the high degree of decoupling throughout this example. The shared Ajax operation code has no knowledge of what the
         page code is going to do when the events are triggered, or even if there’s page code to trigger at all. The page code is modularized
         into small handlers that don’t know about each other. Furthermore, the page code has no idea how the shared code is doing
         its thing; it just reacts to events that may or may not be triggered.
      </p>
      
      <p class="noind">This level of decoupling helps to keep code modular, easier to write, and a lot easier to debug when something goes wrong.
         It also makes it easy to share portions of code and to move them around without fear of violating a coupled dependency between
         the code fragments. Decoupling is a fundamental advantage when using custom events in code, and it allows us to develop applications
         in a much more expressive and flexible manner.
      </p>
      
      
      
      
      
      
      <h3 id="ch13lev1sec4" class="calibre24"><a id="ch13lev1sec4__title" class="calibre3"></a>13.4. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><a id="iddle1404" class="calibre4"></a><a id="iddle1406" class="calibre4"></a><a id="iddle1431" class="calibre4"></a><a id="iddle2023" class="calibre4"></a><a id="iddle2036" class="calibre4"></a><a id="iddle2091" class="calibre4"></a>An event-loop task represents an action performed by the browser. Tasks are grouped into two categories:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">Macrotasks are discrete, self-contained browser actions such as creating the main document object, handling various events,
                  and making URL changes.
                  
               </li>
               
               <li class="calibre20">Microtasks are smaller tasks that should be executed as soon as possible. Examples include promise callbacks and DOM mutation
                  changes.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">Because of the single-threaded execution model, tasks are processed one at a time, and after a task starts executing, it can’t
            be interrupted by another task. The event loop usually has at least two event queues: a macrotask queue and a microtask queue.
            
         </li>
         
         <li class="calibre20">Timers provide the ability to asynchronously delay the execution of a piece of code by <i class="calibre6">at least</i> some number of milliseconds.
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">Use the <kbd class="calibre15">setTimeout</kbd> function to execute a callback once after the specified delay has elapsed.
                  
               </li>
               
               <li class="calibre20">Use the <kbd class="calibre15">setInterval</kbd> function to initiate a timer that will try to execute the callback at the specified delay interval, until canceled.
                  
               </li>
               
               <li class="calibre20">Both functions return an ID of the timer that we can use to cancel a timer through the <kbd class="calibre15">clearTimeout</kbd> and <kbd class="calibre15">clearInterval</kbd> functions.
                  
               </li>
               
               <li class="calibre20">Use timers to break up computationally expensive code into manageable chunks that won’t clog the browser.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">The DOM is a hierarchical tree of elements, and an event that occurs on an element (the target) is usually propagated through
            the DOM. There are two propagation mechanisms:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20">In event capturing, the event trickles down from the top element all the way to the target element.
                  
               </li>
               
               <li class="calibre20">In event bubbling, the event bubbles up from the target element all the way to the top element.
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20">When calling event handlers, the browser also passes in an event object. Access the element on which the event has occurred
            through the event’s <kbd class="calibre15">target</kbd> property. Within the handler, use the <kbd class="calibre15">this</kbd> keyword to refer to the element on which the handler has been registered.
            
         </li>
         
         <li class="calibre20">Use custom events, created through the built-in <kbd class="calibre15">CustomEvent</kbd> constructor, and dispatched with the <kbd class="calibre15">dispatchEvent</kbd> method, to reduce coupling between different parts of your application.
            
         </li>
         
      </ul>
      
      
      
      <h3 id="ch13lev1sec5" class="calibre24"><a id="ch13lev1sec5__title" class="calibre3"></a>13.5. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch13qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch13qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch13qa2q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">Why is it important that adding tasks into the task queue happens outside the event loop?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch13qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch13qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind">Why is it important that each iteration of the event loop doesn’t take much more than about 16 ms?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch13qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch13qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">What’s the output from running the following code for 2 seconds?</p>
            
            <pre id="PLd0e35982" class="calibre5">setTimeout(function(){
  console.log("Timeout ");
}, 1000);

setInterval(function(){
  console.log("Interval ");
}, 500);</pre>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">Timeout Interval Interval Interval Interval</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">Interval Timeout Interval Interval Interval</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">Interval Timeout Timeout</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch13qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch13qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">What’s the output from running the following code for 2 seconds?</p>
            
            <pre id="PLd0e36016" class="calibre5">const timeoutId = setTimeout(function(){
  console.log("Timeout ");
}, 1000);

setInterval(function(){
  console.log("Interval ");
}, 500);

clearTimeout(timeoutId);</pre>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">Interval Timeout Interval Interval Interval</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">Interval</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">Interval Interval Interval Interval</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch13qa2qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch13qa2q5" class="calibre4"></a><b class="calibre21">5 </b></p><p class="noind">What’s the output from running the following code and clicking the element with the ID <kbd class="calibre15">inner</kbd>?
            </p>
            
            <pre id="PLd0e36053" class="calibre5">&lt;body&gt;
  &lt;div id="outer"&gt;
    &lt;div id="inner"&gt;&lt;/div&gt;
  &lt;/div&gt;
  &lt;script&gt;
    const innerElement = document.querySelector("#inner");
    const outerElement = document.querySelector("#outer");
    const bodyElement = document.querySelector("body");

    innerElement.addEventListener("click", function(){
       console.log("Inner");
    });

    outerElement.addEventListener("click", function(){
       console.log("Outer");
    }, true);

    bodyElement.addEventListener("click", function(){
       console.log("Body");
    })
  &lt;/script&gt;
&lt;/body&gt;</pre>
            
            <p class="calibre18"></p>
            <ol class="calibre27">
               
               <li class="calibre20"><kbd class="calibre15">Inner Outer Body</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">Body Outer Inner</kbd>
                  
               </li>
               
               <li class="calibre20"><kbd class="calibre15">Outer Inner Body</kbd>
                  
               </li>
               
            </ol>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      
      
      <div class="calibre25" id="calibre_pb_45"></div>
<h2 id="ch14" class="part">Chapter 14. <a id="ch14__title" class="calibre3"></a>Developing cross-browser strategies
      </h2>
      
      <p class="noind"><i class="calibre6">This chapter covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Developing reusable, cross-browser JavaScript code
            
         </li>
         
         <li class="calibre20">Analyzing cross-browser issues needing to be tackled
            
         </li>
         
         <li class="calibre20">Tackling those issues in a smart way
            
         </li>
         
      </ul>
      
      <p class="noind">Anyone who’s spent time developing on-page JavaScript code knows that a wide range of pain points exist when it comes to ensuring
         that the code works flawlessly across a set of supported browsers. These considerations span from providing basic development
         for immediate needs, to planning for future browser releases, all the way to reusing code on web pages that have yet to be
         created.
      </p>
      
      <p class="noind">Coding for multiple browsers is a nontrivial task that must be balanced according to the development methodologies that you
         have in place, as well as the resources available to your project. As much as we’d love for our pages to work perfectly in
         every browser that ever existed or will ever exist, reality will rear its ugly head and we must realize that we have finite
         development resources. We must plan to apply those resources appropriately and carefully, getting the biggest bang for our
         buck.
      </p>
      
      <p class="noind"><a id="iddle1287" class="calibre4"></a><a id="iddle1627" class="calibre4"></a>Because of this, we start this chapter with advice on choosing which browsers to support. This is followed with a discussion
         of the major concerns regarding cross-browser development, as well as effective strategies for dealing with such problems.
         Let’s jump right into ways to carefully choose supported browsers.
      </p>
      
      <h3 class="calibre24"><a id="ch14qa1" class="calibre3"></a>Do you know?
      </h3>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch14qa1qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch14qa1q1" class="calibre4"></a><b class="calibre21">Q1: </b></p><p class="noind">What are some common ways of dealing with inconsistencies in behavior with different browsers?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch14qa1qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch14qa1q2" class="calibre4"></a><b class="calibre21">Q2: </b></p><p class="noind">What is the best way to make your code usable on other people’s pages?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch14qa1qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch14qa1q3" class="calibre4"></a><b class="calibre21">Q3: </b></p><p class="noind">Why are polyfills useful in cross-browser scripting?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h3 id="ch14lev1sec1" class="calibre24"><a id="ch14lev1sec1__title" class="calibre3"></a>14.1. Cross-browser considerations
      </h3>
      
      <p class="noind">Perfecting our JavaScript programming skills will take us far, especially now that JavaScript has escaped the confines of
         the browser and is being used on the server with Node.js. But when developing browser-based JavaScript applications (which
         is the focus of this book), sooner rather than later, we’re going to run face first into <i class="calibre6">The Browsers</i> and their various issues and inconsistencies.
      </p>
      
      <p class="noind">In a perfect world, all browsers would be bug-free and would support web standards consistently, but as we all know, we don’t
         live in that world. Although the quality of browsers has improved greatly as of late, all still have some bugs, missing APIs,
         and browser-specific quirks that we’ll need to deal with. Developing a comprehensive strategy for tackling these browser issues,
         and becoming intimately familiar with their differences and quirks, isn’t less important than proficiency in JavaScript itself.
      </p>
      
      <p class="noind">When writing browser applications, choosing which browsers to support is important. We’d probably like to support them all,
         but limitations on development and testing resources dictate otherwise. So how do we decide which to support, and to what
         level?
      </p>
      
      <p class="noind">One approach that we can employ is loosely borrowed from an older Yahoo! approach, <i class="calibre6">graded browser support</i>. In this technique, we create a browser-support matrix that serves as a snapshot of how important a browser and its platform
         are to our needs. In this table, we list the target platforms on one axis, and the browsers on the other. Then, in the table
         cells, we give a “grade” (A through F, or any other grading system that meets our needs) to each browser/platform combination.
         <a href="#ch14table01" class="calibre4">Table 14.1</a> shows a hypothetical example.
      </p>
      
      
      <p class="noind"></p>
      <h5 id="ch14table01" class="notetitle">Table 14.1. <a id="ch14table01__title" class="calibre4"></a>A hypothetical browser-support matrix
      </h5>
      <table cellpadding="8" width="100%" frame="hsides" cellspacing="5" rules="groups" class="calibre29">
         <colgroup span="6" class="calibre8">
            <col width="100" class="calibre9">
            <col width="100" class="calibre9">
            <col width="100" class="calibre9">
            <col width="100" class="calibre9">
            <col width="100" class="calibre9">
            <col width="100" class="calibre9">
         </colgroup>
         <thead class="calibre30">
            <tr class="calibre11">
               <th scope="col" class="docTableCell2" valign="top">&nbsp;</th>
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Windows</p>
               </th>
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">OS X</p>
               </th>
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Linux</p>
               </th>
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">iOS</p>
               </th>
               <th scope="col" class="docTableCell1" valign="top">
                  <p class="noind">Android</p>
               </th>
            </tr>
         </thead>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="docTableCell" valign="top">IE 9</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">N/A</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">IE10</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">N/A</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">IE11</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">N/A</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">Edge</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">N/A</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">Firefox</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">Chrome</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">Opera</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
            </tr>
            <tr class="calibre11">
               <td class="docTableCell" valign="top">Safari</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">N/A</td>
               <td class="docTableCell" valign="top">&nbsp;</td>
               <td class="docTableCell" valign="top">N/A</td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Note that we haven’t filled in any grades. The grades you assign to a particular combination of platform and browser are entirely
         dependent on the needs and requirements of your project, as well as other important factors, such as the makeup of the target
         audience. We can use this approach to come up with grades that measure the importance of support for that platform/browser,
         and combine that info with the cost of that support to try to come up with the optimal set of supported browsers.
      </p>
      
      <p class="noind">When we choose to support a browser, we’re typically making the following promises:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">We’ll actively test against that browser with our test suite.
            
         </li>
         
         <li class="calibre20">We’ll fix bugs and regressions associated with that browser.
            
         </li>
         
         <li class="calibre20">The browser will execute our code with a reasonable level of performance.
            
         </li>
         
      </ul>
      
      <p class="noind">Because it’s impractical to develop against lots of platform/browser combinations, we must weigh the costs versus the benefits
         of supporting the various browsers. This analysis must take into account multiple considerations, and the primary ones are
         as follows:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The expectations and needs of the target audience
            
         </li>
         
         <li class="calibre20">The market share of the browser
            
         </li>
         
         <li class="calibre20">The amount of effort necessary to support the browser
            
         </li>
         
      </ul>
      
      <p class="noind">The first point is a subjective one that only your project can determine. Market share, on the other hand, can frequently
         be measured using available information. And a rough estimate of the effort involved in supporting each browser can be determined
         by considering the capabilities of the browsers and their adherence to modern standards.
      </p>
      
      <p class="noind"><a href="#ch14fig01" class="calibre4">Figure 14.1</a> shows a sample chart that represents information on browser use (obtained from <a href="http://gs.statcounter.com" class="calibre4">http://gs.statcounter.com</a> for April 2016). Any piece of reusable JavaScript code, whether it’s a mass-consumption JavaScript library or our own onpage
         code, should be developed to work in as many environments as feasible, concentrating on the browsers and platforms that are
         important to the end user. For mass-consumption libraries, that’s a large set; for more-targeted applications, the required
         set may be narrower.
      </p>
      
      
      
      <h5 id="ch14fig01" class="notetitle">Figure 14.1. <a id="ch14fig01__title" class="calibre4"></a>Looking at the usage statistics of browsers on desktop and mobile devices gives us an idea of which browsers to focus our
         attention on.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/14fig01_alt.jpg" alt="" class="calibre2" width="590" height="327" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/14fig01_alt.jpg"></p>
      
      
      <p class="noind">But it’s vitally important not to bite off more than you can chew, and quality should never be sacrificed for coverage. That’s
         important enough to repeat; in fact, we urge you to read it out loud:
      </p>
      
      <blockquote class="calibre14">
         
         <p class="noind"><i class="calibre6">Quality should never be sacrificed for coverage.</i></p>
         
      </blockquote>
      
      <p class="noind">In this chapter, we’ll examine the situations that JavaScript code will find itself up against with regards to cross-browser
         support. Then we’ll examine some of the best ways to write that code with the aim of alleviating any potential problems that
         those situations pose. This should go a long way in helping you decide which of these techniques are worth your time to adopt,
         and it should help you fill out your own browser-support chart.
      </p>
      
      
      
      <h3 id="ch14lev1sec2" class="calibre24"><a id="ch14lev1sec2__title" class="calibre3"></a>14.2. The five major development concerns
      </h3>
      
      <p class="noind">Any piece of nontrivial code carries myriad development concerns to worry about. But five major points pose the biggest challenges
         to our reusable JavaScript code, as illustrated in <a href="#ch14fig02" class="calibre4">figure 14.2</a>.
      </p>
      
      
      
      <h5 id="ch14fig02" class="notetitle">Figure 14.2. <a id="ch14fig02__title" class="calibre4"></a>The five major points of concern for the development of reusable JavaScript
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/14fig02.jpg" alt="" class="calibre2" width="414" height="237" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/14fig02.jpg"></p>
      
      
      
      <p class="noind">These are the five points:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Browser bugs
            
         </li>
         
         <li class="calibre20">Browser bug fixes
            
         </li>
         
         <li class="calibre20">External code
            
         </li>
         
         <li class="calibre20">Browser regressions
            
         </li>
         
         <li class="calibre20">Missing features in the browsers
            
         </li>
         
      </ul>
      
      <p class="noind">We’ll want to balance the amount of time we spend on each point against the resulting benefits. Ultimately, these <a id="iddle1133" class="calibre4"></a><a id="iddle1277" class="calibre4"></a>are questions that you’ll have to answer, applying them to your own situation. An analysis of your intended audience, development
         resources, and schedule are all factors that go into your decision.
      </p>
      
      <p class="noind">When striving to develop reusable JavaScript code, we must take all the points into consideration but pay closest attention
         to the most popular browsers that exist right now, because these are most likely to be used by our targeted audience. With
         other, less popular browsers, we should at least make sure that our code degrades gracefully. For example, if a browser doesn’t
         support a certain API, at the very least, we should be careful that our code doesn’t throw any exceptions so that the rest
         of the code can be executed.
      </p>
      
      <p class="noind">In the following sections, we’ll break down these various concerns to get a better understanding of the challenges we’re up
         against and how to combat them.
      </p>
      
      
      <h4 id="ch14lev2sec1" class="calibre26">14.2.1. <a id="ch14lev2sec1__title" class="calibre4"></a>Browser bugs and differences
      </h4>
      
      <p class="noind">One of the concerns that we’ll need to deal with when developing reusable JavaScript code is handling the various bugs and
         API differences associated with the set of browsers we’ve decided to support. Even though browsers are much more uniform these
         days, any features that we provide in our code should be completely and <i class="calibre6">verifiably</i> correct in <i class="calibre6">all</i> browsers we choose to support.
      </p>
      
      <p class="noind">The way to achieve this is straightforward: We need a comprehensive suite of tests to cover both the common and fringe use
         cases of the code. With good test coverage, we can feel safe in knowing that the code we develop will work in the supported
         set of browsers. And assuming that no subsequent browser changes break backward compatibility, we’ll have a warm, fuzzy feeling
         that our code will even work in future versions of those browsers. We’ll be looking at specific strategies for dealing with
         browser bugs and differences in <a href="#ch14lev1sec3" class="calibre4">section 14.3</a>.
      </p>
      
      <p class="noind">A tricky point in all of this is implementing fixes for current browser bugs in such a way that they’re resistant to any fixes
         for those bugs that are implemented in future versions of the browser.
      </p>
      
      
      
      <h4 id="ch14lev2sec2" class="calibre26">14.2.2. <a id="ch14lev2sec2__title" class="calibre4"></a>Browser bug fixes
      </h4>
      
      <p class="noind">Assuming that a browser will forever present a particular bug is foolhardy—most browser bugs eventually get fixed, and <i class="calibre6">counting</i> on the presence of the bug is a dangerous development strategy. It’s best to use the techniques in <a href="#ch14lev1sec3" class="calibre4">section 14.3</a> to make sure that any bug work-arounds are future-proofed as much as possible.
      </p>
      
      <p class="noind">When writing a piece of reusable JavaScript code, we want to make sure that it can last a long time. As with writing any aspect
         of a website (CSS, HTML, and so on), we don’t want to have to go back and fix code that’s broken by a new browser release.
      </p>
      
      <p class="noind">Making assumptions about browser bugs causes a common form of website breakage: specific hacks put in place to work around
         bugs presented by a browser that break when the browser fixes the bugs in future releases.
      </p>
      
      <p class="noind"><a id="iddle1644" class="calibre4"></a><a id="iddle2001" class="calibre4"></a><a id="iddle2004" class="calibre4"></a>The problem with handling browser bugs is twofold:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Our code is liable to break when the bug fix is eventually instituted.
            
         </li>
         
         <li class="calibre20">We could end up training browser vendors to <i class="calibre6">not</i> fix bugs for fear of causing websites to break.
            
         </li>
         
      </ul>
      
      <p class="noind">An interesting example of the second situation occurred just recently, with the <kbd class="calibre15">scrollTop</kbd> bug (<a href="https://dev.opera.com/articles/fixing-the-scrolltop-bug/" class="calibre4">https://dev.opera.com/articles/fixing-the-scrolltop-bug/</a>).
      </p>
      
      <p class="noind">When dealing with elements in the HTML DOM, we can use the <kbd class="calibre15">scrollTop</kbd> and <kbd class="calibre15">scrollLeft</kbd> properties to access and modify the current scroll position of the element. But if we use these properties on the root, <kbd class="calibre15">html</kbd> element, these properties should, according to specification, instead report (and influence) the scroll position of the viewport.
         IE 11 and Firefox closely follow this specification. Unfortunately, Safari, Chrome, and Opera don’t. Instead, if you try to
         modify these properties of the root, <kbd class="calibre15">html</kbd> element, nothing happens. To achieve the same effect in these browsers, we have to use the <kbd class="calibre15">scrollTop</kbd> and <kbd class="calibre15">scrollLeft</kbd> properties on the <kbd class="calibre15">body</kbd> element.
      </p>
      
      <p class="noind">When faced with this inconsistency, web developers have often resorted to detecting the current name of the browser (through
         the user agent string, more on this later), and then modifying the <kbd class="calibre15">scrollTop</kbd> and <kbd class="calibre15">scrollLeft</kbd> of the <kbd class="calibre15">html</kbd> element if our JavaScript code is being executed in IE or Firefox, and of the <kbd class="calibre15">body</kbd> element if the code is being executed in Safari, Chrome, or Opera. Unfortunately, this way of circumventing this bug has
         proved to be disastrous. Because many pages now explicitly encode “if this is Safari, Chrome, or Opera,” modify the <kbd class="calibre15">body</kbd> element, these browsers can’t really fix this bug, because the bug fix would, ironically, cause failures in many web pages.
      </p>
      
      <p class="noind">This brings up another important point concerning bugs: When determining whether a piece of functionality is potentially a
         bug, always verify it with the specification!
      </p>
      
      <p class="noind">A browser bug is also different from an unspecified API. It’s important to refer to browser specifications, because they provide
         the exact standards that browsers use to develop and improve their code. In contrast, the implementation of an unspecified
         API could change at any point (especially if the implementation ever attempts to become standardized). In the case of inconsistencies
         in unspecified APIs, you should always test for your expected output. Always be aware that future changes could occur in these
         APIs as they become solidified.
      </p>
      
      <p class="noind">Additionally, there’s a distinction between bug fixes and API changes. Whereas bug fixes are easily foreseen—a browser will
         eventually fix the bugs in its implementation, even if it takes a long time—API changes are much harder to spot. Standard
         APIs are unlikely to change (though it’s not completely unheard of); changes are much more likely to occur with unspecified
         APIs.
      </p>
      
      <p class="noind">Luckily, this rarely happens in a way that will massively break most web applications. But if it does, it’s effectively undetectable
         in advance (unless, of course, we test every single API that we ever touch—but the overhead incurred in such a process would
         be ludicrous). API changes of this sort should be handled like any other regression.
      </p>
      
      <p class="noind">For our next point of concern, we know that no man is an island, and neither is our code. Let’s explore the ramifications.</p>
      
      
      
      
      <h4 id="ch14lev2sec3" class="calibre26">14.2.3. <a id="ch14lev2sec3__title" class="calibre4"></a>External code and markup
      </h4>
      
      <p class="noind"><a id="iddle1279" class="calibre4"></a><a id="iddle1282" class="calibre4"></a><a id="iddle1384" class="calibre4"></a><a id="iddle1466" class="calibre4"></a><a id="iddle1469" class="calibre4"></a><a id="iddle1708" class="calibre4"></a>Any reusable code must coexist with the code that surrounds it. Whether we’re expecting our code to work on pages that we
         write or on websites developed by others, we need to ensure that it can exist on the page with any other random code.
      </p>
      
      <p class="noind">This is a double-edged sword: Our code not only must be able to withstand living with potentially poorly written external
         code, but also must take care not to have adverse effects on the code with which it lives.
      </p>
      
      <p class="noind">Exactly how much we need to be vigilant about this point of concern depends a great deal on the environment in which we expect
         the code to be used. For example, if we’re writing reusable code for a single or limited number of websites that we have some
         level of control over, it might be safe to worry less about effects of external code because we know where the code will operate,
         and we can, to some degree, fix any problems ourselves.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch14note01" class="notetitle">Tip</h5>
      
      
      <p class="noindclose">This is an important enough concern to warrant an entire book on the subject. If you’d like to delve more deeply, we highly
         recommend <i class="calibre6">Third-Party JavaScript</i> by Ben Vinegar and Anton Kovalyov (Manning, 2013, <a href="https://www.manning.com/books/third-party-javascript" class="calibre4">https://www.manning.com/books/third-party-javascript</a>).
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">If we’re developing code that will have a broad level of applicability in unknown (and uncontrollable) environments, we’ll
         need to make doubly sure that our code is robust. Let’s discuss some strategies to achieve that.
      </p>
      
      
      <h5 id="ch14lev3sec1" class="notetitle"><a id="ch14lev3sec1__title" class="calibre4"></a>Encapsulating our code
      </h5>
      
      <p class="noind">To keep our code from affecting other pieces of code on the pages where it’s loaded, it’s best to practice <i class="calibre6">encapsulation</i>. In general, this refers to the act of placing something in, or as if in, a capsule. A more domain-focused definition is
         “a language mechanism for restricting access to some of the object’s components.” Your Aunt Mathilda might summarize it more
         succinctly as “Keep your nose in your own business!”
      </p>
      
      <p class="noind">Keeping an incredibly small global footprint when introducing our code into a page can go a long way toward making Aunt Mathilda
         happy. In fact, keeping our global footprint to a handful of global variables, or better yet, <i class="calibre6">one</i>, is fairly easy.
      </p>
      
      <p class="noind">As you saw in <a href="kindle_split_025.html#ch12" class="calibre4">chapter 12</a>, jQuery, the most popular client-side JavaScript library, is a good example of this. It introduces one global variable (a
         function) named <kbd class="calibre15">jQuery</kbd>, and one alias for that global variable, <kbd class="calibre15">$</kbd>. It even has a supported means to give the <kbd class="calibre15">$</kbd> alias back to whatever other on-page code or other library may want to use it.
      </p>
      
      <p class="noind">Almost all operations in jQuery are made via the <kbd class="calibre15">jQuery</kbd> function. And any other functions that it provides (called <i class="calibre6">utility functions</i>) are defined as properties of <kbd class="calibre15">jQuery</kbd> (remember from <a href="kindle_split_014.html#ch03" class="calibre4">chapter 3</a> how easy it is to define functions that are properties of other functions), thus using the name <kbd class="calibre15">jQuery</kbd> as a <i class="calibre6">namespace</i> for all its definitions.
      </p>
      
      <p class="noind">We can use the same strategy. Let’s say that we’re defining a set of functions for our own use, or for the use of others,
         that we’ll group under a namespace of our own choosing—say, <kbd class="calibre15">ninja</kbd>.
      </p>
      
      <p class="noind"><a id="iddle1054" class="calibre4"></a><a id="iddle1281" class="calibre4"></a><a id="iddle1283" class="calibre4"></a><a id="iddle1349" class="calibre4"></a><a id="iddle1468" class="calibre4"></a><a id="iddle1470" class="calibre4"></a><a id="iddle1649" class="calibre4"></a>We could, like jQuery, define a global function named <kbd class="calibre15">ninja()</kbd>that performs various operations based on what we pass to the function. For example:
      </p>
      
      <pre id="PLd0e36929" class="calibre5">var ninja = function(){ /* implementation code goes here */ }</pre>
      
      <p class="noind">Defining our own utility functions that use this function as their namespace is easy:</p>
      
      <pre id="PLd0e36938" class="calibre5">ninja.hitsuke = function(){ /* code to distract guards with fire here */ }</pre>
      
      <p class="noind">If we didn’t want or need <kbd class="calibre15">ninja</kbd> to be a function but only to serve as a namespace, we could define it as follows:
      </p>
      
      <pre id="PLd0e36950" class="calibre5">var ninja = {};</pre>
      
      <p class="noind">This creates an empty object in which we can define properties and functions in order to keep from adding these names to the
         global namespace.
      </p>
      
      <p class="noind">Other practices that we want to avoid, in order to keep our code encapsulated, are modifying any existing variables, function
         prototypes, or even DOM elements. Any aspect of the page that our code modifies, outside itself, is a potential area for collision
         and confusion.
      </p>
      
      <p class="noind">The other side of the two-way street is that even if <i class="calibre6">we</i> follow best practices and carefully encapsulate our code, we can’t be assured that code we haven’t written is going to be
         as well-behaved.
      </p>
      
      
      
      <h5 id="ch14lev3sec2" class="notetitle"><a id="ch14lev3sec2__title" class="calibre4"></a>Dealing with less-than-exemplary code
      </h5>
      
      <p class="noind">There’s an old joke that’s been going around since Grace Hopper removed that moth from a relay back in the Cretaceous period:
         “The only code that doesn’t suck is the code you write yourself.” This may seem cynical, but when our code coexists with code
         that we can’t control, we should assume the worst, just to be safe.
      </p>
      
      <p class="noind">Some code, even if well-written, might <i class="calibre6">intentionally</i> be doing things like modifying function prototypes, object properties, and DOM element methods. This practice, well-meant
         or otherwise, can lay traps for us to step into.
      </p>
      
      <p class="noind">In these circumstances, our code could be doing something innocuous, such as using JavaScript arrays, and no one could fault
         us for making the simple assumption that JavaScript arrays are going to act like JavaScript arrays. But if some other on-page
         code modifies the way that arrays work, our code could end up not working as intended, through absolutely no fault of our
         own.
      </p>
      
      <p class="noind">Unfortunately, there aren’t many steadfast rules when dealing with situations of this nature, but we can take some mitigating
         steps. The next few sections introduce these defensive steps.
      </p>
      
      
      
      <h5 id="ch14lev3sec3" class="notetitle"><a id="ch14lev3sec3__title" class="calibre4"></a>Coping with greedy IDs
      </h5>
      
      <p class="noind">Most browsers exhibit an <i class="calibre6">anti-feature</i> (we can’t call it a <i class="calibre6">bug</i> because the behavior is absolutely intended) that can cause our code to trip and fall unexpectedly. This feature causes element
         references to be added to other elements by using the <kbd class="calibre15">id</kbd> or <kbd class="calibre15">name</kbd> attributes of the original element. And when that <kbd class="calibre15">id</kbd> or <kbd class="calibre15">name</kbd> conflicts with properties that are already part of the element, bad things can happen.
      </p>
      
      <p class="noind"><a id="iddle1038" class="calibre4"></a><a id="iddle1512" class="calibre4"></a><a id="iddle1674" class="calibre4"></a>Take a look at the following HTML snippet to observe the nastiness that can ensue as a result of these <i class="calibre6">greedy IDs</i>:
      </p>
      
      <pre id="PLd0e37038" class="calibre5">&lt;form id="form" action="/conceal"&gt;
  &lt;input type="text" id="action"/&gt;
  &lt;input type="submit" id="submit"/&gt;
&lt;/form&gt;</pre>
      
      <p class="noind">Now, in the browsers, let’s call this:</p>
      
      <pre id="PLd0e37047" class="calibre5">var what = document.getElementById('form').action;</pre>
      
      <p class="noind">Rightly, we’d expect this to be the value of the form’s <kbd class="calibre15">action</kbd> attribute. And in most cases, it would be. But if we inspect the value of variable <kbd class="calibre15">what</kbd>, we find that it’s instead a reference to the <kbd class="calibre15">input#action</kbd> element! Huh?
      </p>
      
      <p class="noind">Let’s try something else:</p>
      
      <pre id="PLd0e37068" class="calibre5">document.getElementById('form').submit();</pre>
      
      <p class="noind">This statement should cause the form to be submitted, but instead, we get a script error:</p>
      
      <pre id="PLd0e37077" class="calibre5">Uncaught TypeError: Property 'submit' of object #&lt;HTMLFormElement&gt; is not a function</pre>
      
      <p class="noind">What’s going on?</p>
      
      <p class="noind">The browsers have added properties to the <kbd class="calibre15">&lt;form&gt;</kbd> element for each of the input elements within the form that reference the element. This might seem handy at first, until
         we realize that the name of the added property is taken from the <kbd class="calibre15">id</kbd> or <kbd class="calibre15">name</kbd> values of the input elements. And if that value just happens to be an already-used property of the form element, such as
         <kbd class="calibre15">action</kbd> or <kbd class="calibre15">submit</kbd>, those original properties are replaced by the new property. This is usually referred to as <i class="calibre6">DOM clobbering</i>.
      </p>
      
      <p class="noind">So, before the <kbd class="calibre15">input#submit</kbd> element is created, the reference <kbd class="calibre15">form.action</kbd> points to the value of the <kbd class="calibre15">action</kbd> attribute for the <kbd class="calibre15">&lt;form&gt;</kbd>. Afterward, it points to the <kbd class="calibre15">input#submit</kbd> element. The same thing happens to <kbd class="calibre15">form.submit</kbd>. Yeesh!
      </p>
      
      <p class="noind">This is a remnant from way back, from a time when browsers didn’t have a rich set of API methods for fetching elements from
         the DOM. Browser vendors added this feature to give easy access to form elements. Nowadays we can easily access any element
         in the DOM, so we’re left with only the unfortunate side effects of the feature.
      </p>
      
      <p class="noind">In any case, this particular “feature” of the browsers can cause numerous and mystifying problems in our code, and we should
         keep it in mind when debugging. When we encounter properties that have seemingly been inexplicably transformed into something
         other than what we expect, DOM clobbering is a likely culprit.
      </p>
      
      <p class="noind">Luckily, we can avoid this problem in our own markup by avoiding simple <kbd class="calibre15">id</kbd> and <kbd class="calibre15">name</kbd> values that can conflict with standard property names, and we can encourage others to do the same. The value <kbd class="calibre15">submit</kbd> is especially to be avoided, as it’s a common source of frustrating and perplexing buggy behavior.
      </p>
      
      
      
      
      <h5 id="ch14lev3sec4" class="notetitle"><a id="ch14lev3sec4__title" class="calibre4"></a>Loading order of style sheets and scripts
      </h5>
      
      <p class="noind"><a id="iddle1044" class="calibre4"></a><a id="iddle1108" class="calibre4"></a><a id="iddle1280" class="calibre4"></a><a id="iddle1290" class="calibre4"></a><a id="iddle1300" class="calibre4"></a><a id="iddle1467" class="calibre4"></a><a id="iddle1933" class="calibre4"></a>Often we’ll expect CSS rules to already be available by the time our code executes. One of the best ways to ensure that CSS
         rules provided by style sheets are defined when our JavaScript code executes is to include the external style sheets <i class="calibre6">prior</i> to including the external script files.
      </p>
      
      <p class="noind">Not doing so can cause unexpected results, because the script attempts to access the as-yet-undefined style information. Unfortunately,
         this issue can’t easily be rectified with pure JavaScript and should instead be handled with user documentation.
      </p>
      
      <p class="noind">These last few sections have covered some basic examples of how externalities can affect how our code works, frequently in
         unintentional and confounding ways. Issues with our code will often pop up when other users try to integrate it into <i class="calibre6">their</i> sites, at which point we should be able to diagnose the issues and build appropriate tests to handle them. At other times,
         we’ll discover such problems when we integrate others’ code into our pages, and hopefully the tips in these sections will
         help to identify the causes.
      </p>
      
      <p class="noind">It’s unfortunate that there are no better and deterministic solutions to handling these integration issues other than to take
         some smart first steps and to write our code defensively. We’ll now move on to the next point of concern.
      </p>
      
      
      
      
      <h4 id="ch14lev2sec4" class="calibre26">14.2.4. <a id="ch14lev2sec4__title" class="calibre4"></a>Regressions
      </h4>
      
      <p class="noind"><i class="calibre6">Regressions</i> are one of the hardest problems we’ll encounter in creating reusable and maintainable JavaScript code. These are bugs, or
         non-backward-compatible API changes (mostly to unspecified APIs), that browsers have introduced and that cause code to break
         in unpredictable ways.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="ch14note02" class="notetitle">Note</h5>
      
      
      <p class="noindclose">Here we’re using the term <i class="calibre6">regression</i> in its classical definition: a feature that used to work but no longer functions as expected. This is usually unintentional,
         but it’s sometimes caused by deliberate changes that break existing code.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      <h5 id="ch14lev3sec5" class="notetitle"><a id="ch14lev3sec5__title" class="calibre4"></a>Anticipating changes
      </h5>
      
      <p class="noind">There <i class="calibre6">are</i> some API changes that, with some foresight, we can proactively detect and handle, as shown in <a href="#ch14ex01" class="calibre4">listing 14.1</a>. For example, with Internet Explorer 9, Microsoft introduced support for DOM level 2 event handlers (bound using the <kbd class="calibre15">addEventListener</kbd> method), while previous versions of IE were using the IE-specific built-in <kbd class="calibre15">attachEvent</kbd> method. For code written prior to IE 9, simple feature detection was able to handle that change.
      </p>
      
      
      
      <h5 id="ch14ex01" class="notetitle">Listing 14.1. <a id="ch14ex01__title" class="calibre4"></a>Anticipating an upcoming API change
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/376fig01_alt.jpg" alt="" class="calibre2" width="590" height="134" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/376fig01_alt.jpg"></p>
      
      
      <p class="noind">In this example, we future-proof our code knowing (or hoping against hope) that someday Microsoft will bring Internet Explorer
         into line with DOM standards. If the browser supports the standards-compliant API, we use feature detection to infer that
         and use the standard API, the <kbd class="calibre15">addEventListener</kbd> method. If not, we check to see that the IE-proprietary method <kbd class="calibre15">attachEvent</kbd> is available and use that. If all else fails, we do nothing.
      </p>
      
      <p class="noind">Most future API changes, alas, aren’t that easy to predict, and there’s no way to predict upcoming bugs. This is but one of
         the important reasons that we’ve stressed testing throughout this book. In the face of unpredictable changes that will affect
         our code, the best that we can hope for is to be diligent in monitoring our tests for each browser release, and to quickly
         address issues that regressions may introduce.
      </p>
      
      <p class="noind">Having a good suite of tests and keeping close track of upcoming browser releases is absolutely the best way to deal with
         future regressions of this nature. It doesn’t have to be taxing on your normal development cycle, which should already include
         routine testing. Running these tests on new browser releases should always be factored into the planning of any development
         cycle.
      </p>
      
      <p class="noind">You can get information on upcoming browser releases from the following locations:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Microsoft Edge (a successor to IE): <a href="http://blogs.windows.com/msedgedev/" class="calibre4">http://blogs.windows.com/msedgedev/</a>
            
         </li>
         
         <li class="calibre20">Firefox: <a href="http://ftp.mozilla.org/pub/firefox/nightly/latest-trunk/" class="calibre4">http://ftp.mozilla.org/pub/firefox/nightly/latest-trunk/</a>
            
         </li>
         
         <li class="calibre20">WebKit (Safari): <a href="https://webkit.org/nightly/" class="calibre4">https://webkit.org/nightly/</a>
            
         </li>
         
         <li class="calibre20">Opera: <a href="https://dev.opera.com/" class="calibre4">https://dev.opera.com/</a>
            
         </li>
         
         <li class="calibre20">Chrome: <a href="http://chrome.blogspot.hr/" class="calibre4">http://chrome.blogspot.hr/</a>
            
         </li>
         
      </ul>
      
      <p class="noind">Diligence is important. Because we can never fully predict the bugs that will be introduced by a browser, it’s best to make
         sure that we stay on top of our code and quickly avert any crises that may arise.
      </p>
      
      <p class="noind">Thankfully, browser vendors are doing a lot to make sure that regressions of this nature don’t occur, and browsers often have
         test suites from various JavaScript libraries integrated into their main browser test suite. This ensures that no future regressions
         will be introduced that affect those libraries directly. Although this won’t catch all regressions (and certainly won’t in
         all browsers), it’s a great start and shows good progress by the browser vendors toward preventing as many issues as possible.
      </p>
      
      <p class="noind">In this section, we’ve gone through four major points of concern for the development of reusable JavaScript: browser bugs,
         browser bug fixes, external code, and browser regressions. The fifth point—missing features in the browsers—deserves a special
         mention, so we cover it in the next section, alongside other implementation strategies relevant for cross-browser web applications.
      </p>
      
      
      
      
      
      
      <h3 id="ch14lev1sec3" class="calibre24"><a id="ch14lev1sec3__title" class="calibre3"></a>14.3. Implementation strategies
      </h3>
      
      <p class="noind"><a id="iddle1285" class="calibre4"></a><a id="iddle2141" class="calibre4"></a><a id="iddle2198" class="calibre4"></a>Knowing which issues to be aware of is only half the battle. Figuring out effective solutions and using them to implement
         robust cross-browser code is another matter.
      </p>
      
      <p class="noind">A wide range of strategies are available, and although not every strategy will work in every situation, the range presented
         in this section covers most of the concerns that we’ll need to address within our robust code bases. Let’s start with something
         that’s easy and almost trouble free.
      </p>
      
      
      <h4 id="ch14lev2sec5" class="calibre26">14.3.1. <a id="ch14lev2sec5__title" class="calibre4"></a>Safe cross-browser fixes
      </h4>
      
      <p class="noind">The simplest (and safest) classes of cross-browser fixes are those that exhibit two important traits:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">They have no negative effects or side effects on other browsers.
            
         </li>
         
         <li class="calibre20">They use no form of browser or feature detection.
            
         </li>
         
      </ul>
      
      <p class="noind">The instances for applying these fixes may be rare, but they’re a tactic that we should always strive for in our applications.</p>
      
      <p class="noind">Let’s look at an example. The following code snippet represents a change (plucked from jQuery) that came about when working
         with Internet Explorer:
      </p>
      
      <pre id="PLd0e37408" class="calibre5">// ignore negative width and height values
if ((key == 'width' || key == 'height') &amp;&amp; parseFloat(value) &lt; 0)
  value = undefined;</pre>
      
      <p class="noind">Some versions of IE throw an exception when a negative value is set on the <kbd class="calibre15">height</kbd> or <kbd class="calibre15">width</kbd> style properties. All other browsers ignore negative input. This work-around ignores all negative values in <i class="calibre6">all</i> browsers. This change prevents an exception from being thrown in Internet Explorer and has no effect on any other browser.
         This is a painless change that provides a unified API to the user (because throwing unexpected exceptions is never desired).
      </p>
      
      <p class="noind">Another example of this type of fix (also from jQuery) appears in the attribute manipulation code. Consider this:</p>
      
      <pre id="PLd0e37429" class="calibre5">if (name == "type" &amp;&amp;
    elem.nodeName.toLowerCase()== "input" &amp;&amp;
    elem.parentNode)
  throw "type attribute can't be changed";</pre>
      
      <p class="noind">Internet Explorer doesn’t allow us to manipulate the <kbd class="calibre15">type</kbd> attribute of input elements that are already part of the DOM; attempts to change this attribute result in a proprietary exception
         being thrown. jQuery came to a middle-ground solution: It disallows <i class="calibre6">all</i> attempts to manipulate the <kbd class="calibre15">type</kbd> attribute on injected input elements in all browsers, throwing a uniform informational exception.
      </p>
      
      <p class="noind"><a id="iddle1076" class="calibre4"></a><a id="iddle1284" class="calibre4"></a><a id="iddle1288" class="calibre4"></a><a id="iddle1478" class="calibre4"></a><a id="iddle1484" class="calibre4"></a><a id="iddle1753" class="calibre4"></a><a id="iddle1787" class="calibre4"></a><a id="iddle1868" class="calibre4"></a>This change to the jQuery code base requires no browser or feature detection; it unifies the API across all browsers. The
         action still results in an exception, but that exception is uniform across all browser types.
      </p>
      
      <p class="noind">This particular approach could be considered controversial. It purposefully limits the features of the library in all browsers
         because of a bug that exists in only one. The jQuery team weighed this decision carefully and decided that it was better to
         have a unified API that works consistently than an API that would break unexpectedly when developing cross-browser code. You
         might come across situations like this when developing your own reusable code bases, and you’ll need to carefully consider
         whether a limiting approach such as this is appropriate for your audience.
      </p>
      
      <p class="noind">The important thing to remember for these types of code changes is that they provide a solution that works seamlessly across
         browsers without the need for browser or feature detection, effectively making them immune to changes going forward. You should
         always strive for solutions that work in this manner, even if the applicable instances are few and far between.
      </p>
      
      
      
      <h4 id="ch14lev2sec6" class="calibre26">14.3.2. <a id="ch14lev2sec6__title" class="calibre4"></a>Feature detection and polyfills
      </h4>
      
      <p class="noind">As we’ve previously discussed, <i class="calibre6">feature detection</i> is a commonly used approach when writing cross-browser code. This approach isn’t only simple but also generally effective.
         It works by determining whether a certain object or object property exists, and if so, assuming that it provides the implied
         functionality. (In the next section, we’ll see what to do about cases where this assumption fails.)
      </p>
      
      <p class="noind">Most commonly, feature detection is used to choose between multiple APIs that provide duplicate pieces of functionality. For
         example, <a href="kindle_split_022.html#ch10" class="calibre4">chapter 10</a> explored the <kbd class="calibre15">find</kbd> method, accessible to all arrays, a method that we can use to find the first array item that satisfies a certain condition.
         Unfortunately, the method is accessible only in browsers that fully support ES6. So what do we do when we’re stuck with browsers
         that still don’t support this feature? In general, how do we deal with missing features in the browsers?
      </p>
      
      <p class="noind">The answer is polyfilling! A polyfill is a browser fallback. If a browser doesn’t support a particular functionality, we provide
         our own implementation. For example, the Mozilla Developer Network (MDN) provides polyfills for a wide range of ES6 functionality.
         Among other things, this includes the JavaScript implementation of the <kbd class="calibre15">Array.prototype.find</kbd> method (<a href="http://mng.bz/d9lU" class="calibre4">http://mng.bz/d9lU</a>), as shown in the following listing.
      </p>
      
      
      
      <h5 id="ch14ex02" class="notetitle">Listing 14.2. <a id="ch14ex02__title" class="calibre4"></a>A polyfill for the Array.prototype.find method
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/379fig01_alt.jpg" alt="" class="calibre2" width="590" height="355" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/379fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1020" class="calibre4"></a><a id="iddle1720" class="calibre4"></a><a id="iddle2217" class="calibre4"></a>In this example, we first use feature detection to check whether the current browser has built-in support for the <kbd class="calibre15">find</kbd> method:
      </p>
      
      <pre id="PLd0e37573" class="calibre5">if (!Array.prototype.find) {
 ...
}</pre>
      
      <p class="noind">Whenever possible, we should default to the standard way of performing any action. As mentioned before, this will help make
         our code as future-proof as possible. For this reason, if the browser already supports the method, we do nothing. If we’re
         dealing with a browser that hasn’t yet caught up with ES6, we provide our own implementation.
      </p>
      
      <p class="noind">It turns out that the core of the method is straightforward. We loop through the array, calling the passed-in predicate function,
         which checks whether an array item satisfies our criteria. If it does, we return it.
      </p>
      
      <p class="noind">One interesting technique is presented in this listing:</p>
      
      <pre id="PLd0e37588" class="calibre5">var length = list.length &gt;&gt;&gt; 0;</pre>
      
      <p class="noind">The <kbd class="calibre15">&gt;&gt;&gt;</kbd> operator is the <i class="calibre6">zero-fill right-shift operator</i>, which shifts the first operand the specified number of bits to the right, while discarding the excess bits. In this case,
         this operator is used to convert the <kbd class="calibre15">length</kbd> property to a non-negative integer. This is done because array indexes in JavaScript should be unsigned integers.
      </p>
      
      <p class="noind">An important use of feature detection is discovering the facilities provided by the browser environment in which the code
         is executing. This allows us to provide features that use those facilities in our code, or to determine whether we need to
         provide a fallback.
      </p>
      
      <p class="noind">The following code snippet shows a basic example of detecting the presence of a browser feature by using feature detection,
         to determine whether we should provide full application functionality or a reduced-experience fallback:
      </p>
      
      
      <pre id="PLd0e37614" class="calibre5">if (typeof document !== "undefined" &amp;&amp;
    document.addEventListener &amp;&amp;
    document.querySelector &amp;&amp;
    document.querySelectorAll) {
  // We have enough of an API to work with to build our application
}
else {
  // Provide Fallback
}</pre>
      
      <p class="noind"><a id="iddle1291" class="calibre4"></a><a id="iddle1296" class="calibre4"></a><a id="iddle1429" class="calibre4"></a><a id="iddle2154" class="calibre4"></a><a id="iddle2159" class="calibre4"></a>Here, we test whether
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The browser has a document loaded
            
         </li>
         
         <li class="calibre20">The browser provides a means to bind event handlers
            
         </li>
         
         <li class="calibre20">The browser can find elements based on a selector
            
         </li>
         
      </ul>
      
      <p class="noind">Failing any of these tests causes us to resort to a fallback position. What is done in the fallback is up to the expectations
         of the consumers of the code, and the requirements placed on the code. A few options can be considered:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">We could perform further feature detection to figure out how to provide a reduced experience that still uses some JavaScript.
            
         </li>
         
         <li class="calibre20">We could opt to not execute any JavaScript, falling back to the unscripted HTML on the page.
            
         </li>
         
         <li class="calibre20">We could redirect the user to a plainer version of the site. Google does this with Gmail, for example.
            
         </li>
         
      </ul>
      
      <p class="noind">Because feature detection has little overhead (it’s just a property/object lookup) and is relatively simple in its implementation,
         it’s a good way to provide basic levels of fallback, both at the API and application levels. It’s a good choice for the first
         line of defense in your reusable code authoring.
      </p>
      
      
      
      <h4 id="ch14lev2sec7" class="calibre26">14.3.3. <a id="ch14lev2sec7__title" class="calibre4"></a>Untestable browser issues
      </h4>
      
      <p class="noind">Unfortunately, JavaScript and the DOM have several possible problem areas that are either impossible or prohibitively expensive
         to test for. These situations are fortunately rare, but when we encounter them, it always pays to spend time investigating
         to see whether there’s something we can do about it.
      </p>
      
      <p class="noind">The following sections discuss some known issues that are impossible to test using any conventional JavaScript interactions.</p>
      
      
      <h5 id="ch14lev3sec6" class="notetitle"><a id="ch14lev3sec6__title" class="calibre4"></a>Event handler bindings
      </h5>
      
      <p class="noind">One of the infuriating lapses in browsers is the inability to programmatically determine whether an event handler has been
         bound. The browsers don’t provide any way of determining whether any functions have been bound to an event listener on an
         element. There’s no way to remove all bound event handlers from an element unless we’ve maintained references to all bound
         handlers as we create them.
      </p>
      
      
      
      
      <h5 id="ch14lev3sec7" class="notetitle"><a id="ch14lev3sec7__title" class="calibre4"></a>Event firing
      </h5>
      
      <p class="noind"><a id="iddle1293" class="calibre4"></a><a id="iddle1294" class="calibre4"></a><a id="iddle1295" class="calibre4"></a><a id="iddle1299" class="calibre4"></a><a id="iddle1428" class="calibre4"></a><a id="iddle1780" class="calibre4"></a><a id="iddle1781" class="calibre4"></a><a id="iddle1785" class="calibre4"></a><a id="iddle1786" class="calibre4"></a><a id="iddle2156" class="calibre4"></a><a id="iddle2157" class="calibre4"></a><a id="iddle2158" class="calibre4"></a>Another aggravation is determining whether an event will fire. Although it’s possible to determine whether a browser supports
         a means of binding an event, it’s <i class="calibre6">not</i> possible to know whether a browser will fire an event. This becomes problematic in a couple of places.
      </p>
      
      <p class="noind">First, if a script is loaded dynamically after the page has already loaded, the script may try to bind a listener to wait
         for the window to load when, in fact, that event already happened. Because there’s no way to determine whether the event has
         already occurred, the code may wind up waiting forever to execute.
      </p>
      
      <p class="noind">The second situation occurs if a script wants to use custom events provided by a browser as an alternative. For example, Internet
         Explorer provides <kbd class="calibre15">mouseenter</kbd> and <kbd class="calibre15">mouseleave</kbd> events, which simplify the process of determining when a user’s mouse enters or leaves an element’s boundaries. These are
         frequently used as alternatives to the <kbd class="calibre15">mouseover</kbd> and <kbd class="calibre15">mouseout</kbd> events, because they act slightly more intuitively than the standard events. But because there’s no way of determining whether
         these events will fire without first binding the events and waiting for a user interaction against them, it’s hard to use
         them in reusable code.
      </p>
      
      
      
      <h5 id="ch14lev3sec8" class="notetitle"><a id="ch14lev3sec8__title" class="calibre4"></a>CSS property effects
      </h5>
      
      <p class="noind">Yet another pain point is determining whether changing certain CSS properties affects the presentation. Some CSS properties
         affect only the visual representation of the display and nothing else; they don’t change surrounding elements or affect other
         properties on the element. Examples are <kbd class="calibre15">color</kbd>, <kbd class="calibre15">backgroundColor</kbd>, and <kbd class="calibre15">opacity</kbd>.
      </p>
      
      <p class="noind">There’s no way to programmatically determine whether changing these style properties will generate the effects desired. The
         only way to verify the impact is through a visual examination of the page.
      </p>
      
      
      
      <h5 id="ch14lev3sec9" class="notetitle"><a id="ch14lev3sec9__title" class="calibre4"></a>Browser crashes
      </h5>
      
      <p class="noind">Testing script that causes the browser to crash is another annoyance. Code that causes a browser to crash is especially problematic,
         because unlike exceptions that can be easily caught and handled, these will always cause the browser to break.
      </p>
      
      <p class="noind">For example, in older versions of Safari (see <a href="http://bugs.jquery.com/ticket/1331" class="calibre4">http://bugs.jquery.com/ticket/1331</a>), creating a regular expression that used Unicode-character ranges would always cause the browser to crash, as in the following
         example:
      </p>
      
      <pre id="PLd0e37886" class="calibre5">new RegExp("[\\w\u0128-\uFFFF*_-]+");</pre>
      
      <p class="noind">The problem with this is that it’s not possible to test whether this problem exists, because the test itself will always produce
         a crash in that older browser.
      </p>
      
      <p class="noind">Additionally, bugs that cause crashes to occur forever become embroiled in difficulty, because although it may be acceptable
         for JavaScript to be disabled in some segment of the population using your browser, it’s never acceptable to outright crash
         the browser of those users.
      </p>
      
      
      
      
      <h5 id="ch14lev3sec10" class="notetitle"><a id="ch14lev3sec10__title" class="calibre4"></a>Incongruous APIs
      </h5>
      
      <p class="noind"><a id="iddle1056" class="calibre4"></a><a id="iddle1057" class="calibre4"></a><a id="iddle1102" class="calibre4"></a><a id="iddle1289" class="calibre4"></a><a id="iddle1292" class="calibre4"></a><a id="iddle1297" class="calibre4"></a><a id="iddle1760" class="calibre4"></a><a id="iddle2142" class="calibre4"></a><a id="iddle2155" class="calibre4"></a><a id="iddle2160" class="calibre4"></a><a id="iddle2161" class="calibre4"></a>A while back, we saw that jQuery decided to disallow the ability to change the <kbd class="calibre15">type</kbd> attribute in all browsers because of a bug in Internet Explorer. We <i class="calibre6">could</i> test this feature and disable it only in IE, but that would set up an incongruity, as the API would work differently from
         browser to browser. In these situations, when a bug is so bad that it causes an API to break, the only option is to work around
         the affected area and provide a different solution.
      </p>
      
      <p class="noind">In addition to impossible-to-test problems, some issues are <i class="calibre6">possible</i> to test but are prohibitively difficult to test effectively. Let’s look at some of them.
      </p>
      
      
      
      <h5 id="ch14lev3sec11" class="notetitle"><a id="ch14lev3sec11__title" class="calibre4"></a>API performance
      </h5>
      
      <p class="noind">Sometimes specific APIs are faster or slower in different browsers. When writing reusable and robust code, it’s important
         to try to use the APIs that provide good performance. But it’s not always obvious which API that is.
      </p>
      
      <p class="noind">Effectively conducting performance analysis of a feature usually entails throwing a large amount of data at it, and that typically
         takes a relatively long time. Therefore, it’s not something we can do whenever our page is loaded.
      </p>
      
      <p class="noind">Untestable features are a significant hassle that hinder writing reusable JavaScript, but frequently we can work around them
         with a bit of effort and cleverness. By using alternative techniques, or constructing our APIs so as to obviate these issues
         in the first place, we’ll likely be able to build effective code despite the odds stacked against us.
      </p>
      
      
      
      
      
      <h3 id="ch14lev1sec4" class="calibre24"><a id="ch14lev1sec4__title" class="calibre3"></a>14.4. Reducing assumptions
      </h3>
      
      <p class="noind">Writing cross-browser, reusable code is a battle of assumptions, but by using clever detection and authoring, we can reduce
         the number of assumptions that we make in our code. When we make assumptions about the code that we write, we stand to encounter
         problems further down the road.
      </p>
      
      <p class="noind">For example, assuming that an issue or a bug will always exist in a specific browser is a huge and dangerous assumption. Instead,
         testing for the problem (as we’ve done throughout this chapter) proves to be much more effective. In our coding, we should
         always strive to reduce the number of assumptions, effectively reducing the room for error and the probability that something
         is going to come back and bite us in the behind.
      </p>
      
      <p class="noind">The most common area for making assumptions in JavaScript is in user-agent detection—specifically, analyzing the user agent
         provided by a browser (<kbd class="calibre15">navigator.userAgent</kbd>) and using it to make an assumption about how the browser will behave (in other words, browser detection). Unfortunately,
         most user-agent string analysis proves to be a superb source of future-induced errors. Assuming that a bug, issue, or proprietary
         feature will always be linked to a specific browser is a recipe for disaster.
      </p>
      
      <p class="noind">But reality intervenes when it comes to minimizing assumptions: It’s virtually impossible to remove all of them. At some point,
         we’ll have to assume that a browser will do what it’s supposed to do. Figuring out where to strike that balance is completely
         up to the developer, and it’s what “separates the men from the boys,” as they say (with apologies to our female readers).
      </p>
      
      <p class="noind">For example, let’s reexamine the event-attaching code that we’ve already seen in this chapter:</p>
      
      <pre id="PLd0e38046" class="calibre5">function bindEvent(element, type, handle) {
  if (element.addEventListener) {
    element.addEventListener(type, handle, false);
  }
  else if (element.attachEvent) {
    element.attachEvent("on" + type, handle);
  }
}</pre>
      
      <p class="noind">Without looking ahead, see if you can spot three assumptions made by this code. Go on, we’ll wait. (<i class="calibre6">Jeopardy</i> theme plays...)
      </p>
      
      <p class="noind">How’d you do? The preceding code has at least these three assumptions:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The properties that we’re checking are callable functions.
            
         </li>
         
         <li class="calibre20">They’re the correct functions, performing the actions that we expect.
            
         </li>
         
         <li class="calibre20">These two methods are the only possible ways of binding an event.
            
         </li>
         
      </ul>
      
      <p class="noind">We could easily get rid of the first assumption by adding checks to see whether the properties are, in fact, functions. Tackling
         the remaining two points is much more difficult.
      </p>
      
      <p class="noind">In this code, we always need to decide how many assumptions are optimal for our requirements, our target audience, and us.
         Frequently, reducing the number of assumptions also increases the size and complexity of the code base. It’s fully possible,
         and rather easy, to attempt to reduce assumptions to the point of complete insanity, but at some point we have to stop and
         take stock of what we have, say “good enough,” and work from there. Remember that even the least-assuming code is still prone
         to regressions introduced by a browser.
      </p>
      
      
      
      <h3 id="ch14lev1sec5" class="calibre24"><a id="ch14lev1sec5__title" class="calibre3"></a>14.5. Summary
      </h3>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Although the situation has improved considerably, browsers unfortunately aren’t bug-free and usually don’t support web standards
            consistently.
            
         </li>
         
         <li class="calibre20">When writing JavaScript applications, choosing which browsers and platforms to support is an important consideration.
            
         </li>
         
         <li class="calibre20">Because it’s not possible to support all combinations, quality should never be sacrificed for coverage!
            
         </li>
         
         <li class="calibre20">The biggest challenges to writing JavaScript code that can be executed in various browsers are bug fixes, regressions, browser
            bugs, missing features, and external code.
            
         </li>
         
         <li class="calibre20">Reusable cross-browser development involves juggling several factors:
            
            <p class="calibre18"></p>
            <ul class="calibre28">
               
               <li class="calibre20"><b class="calibre21"><i class="calibre6">Code size—</i> </b>Keeping the file size small
                  
               </li>
               
               <li class="calibre20"><b class="calibre21"><i class="calibre6">Performance overhead—</i> </b>Keeping the performance level above a palatable minimum
                  
               </li>
               
               <li class="calibre20"><b class="calibre21"><i class="calibre6">API quality—</i> </b>Making sure that the APIs work uniformly across browsers
                  
               </li>
               
            </ul>
            
         </li>
         
         <li class="calibre20"><a id="iddle1278" class="calibre4"></a>There’s no magic formula for determining the correct balance of these factors.
            
         </li>
         
         <li class="calibre20">The development factors are something that have to be balanced by every developer in their individual development efforts.
            
         </li>
         
         <li class="calibre20">By using smart techniques such as feature detection, we can defend against the numerous directions from which reusable code
            will be attacked without making any undue sacrifices.
            
         </li>
         
      </ul>
      
      
      
      <h3 id="ch14lev1sec6" class="calibre24"><a id="ch14lev1sec6__title" class="calibre3"></a>14.6. Exercises
      </h3>
      
      <p class="calibre18"><a id="ch14qa2" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch14qa2qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch14qa2q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">What should we take into account when deciding which browsers to support?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch14qa2qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch14qa2q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind">Explain the problem of greedy IDs.</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch14qa2qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch14qa2q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">What is feature detection?</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="ch14qa2qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="ch14qa2q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">What is a browser polyfill?</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      
      <h2 id="app01" class="part">Appendix A. <a id="app01__title" class="calibre3"></a>Additional ES6 features
      </h2>
      
      
      
      <p class="noind"><a id="iddle1321" class="calibre4"></a><a id="iddle1385" class="calibre4"></a><a id="iddle1397" class="calibre4"></a><a id="iddle1788" class="calibre4"></a><a id="iddle2060" class="calibre4"></a><a id="iddle2093" class="calibre4"></a><i class="calibre6">This appendix covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Template literals
            
         </li>
         
         <li class="calibre20">Destructuring
            
         </li>
         
         <li class="calibre20">Object literal enhancements
            
         </li>
         
      </ul>
      
      <p class="noind">This appendix covers some of the “smaller” ES6 features that don’t fit neatly into the previous chapters. <i class="calibre6">Template literals</i> enable string interpolation and multiline strings, <i class="calibre6">destructuring</i> enables us to easily extract data from objects and arrays, and <i class="calibre6">enhanced object literals</i> improve dealings with, well, object literals.
      </p>
      
      
      <h3 id="app01lev1sec1" class="calibre24"><a id="app01lev1sec1__title" class="calibre3"></a>Template literals
      </h3>
      
      <p class="noind">Template literals are a new ES6 feature that make manipulating strings much more pleasant than before. Just think back; how
         many times have you been forced to write something as ugly as this?
      </p>
      
      
      <pre id="PLd0e38299" class="calibre5">const ninja = {
  name: "Yoshi",
  action: "subterfuge"
};

const concatMessage = "Name: " + ninja.name + " "
                    + "Action: " + ninja.action;</pre>
      
      <p class="noind"><a id="iddle1001" class="calibre4"></a><a id="iddle1024" class="calibre4"></a><a id="iddle1117" class="calibre4"></a>In this example, we have to construct a string with data dynamically inserted. To achieve this, we have to resort to some
         messy concatenations. But not anymore! In ES6 we can achieve the same result with template literals; just take a look at the
         following listing.
      </p>
      
      
      
      <h5 id="app01ex01" class="notetitle">Listing A.1. <a id="app01ex01__title" class="calibre4"></a>Template literals
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/388fig01_alt.jpg" alt="" class="calibre2" width="590" height="173" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/388fig01_alt.jpg"></p>
      
      
      <p class="noind">As you can see, ES6 provides a new type of string that uses backticks (<kbd class="calibre15">`</kbd>), a string that can contain placeholders, denoted with the <kbd class="calibre15">${}</kbd> syntax. Within these placeholders, we can place any JavaScript expression: a simple variable, an object property access (as
         we did with <kbd class="calibre15">ninja.action</kbd>), and even function calls.
      </p>
      
      <p class="noind">When a template string gets evaluated, the placeholders are replaced with the result of evaluating the JavaScript expression
         contained within those placeholders.
      </p>
      
      <p class="noind">In addition, template literals aren’t limited to a single line (as are standard double and single quoted ones), and there’s
         nothing stopping us from making them multiline, as shown in the following listing.
      </p>
      
      
      
      <h5 id="app01ex02" class="notetitle">Listing A.2. <a id="app01ex02__title" class="calibre4"></a>Multiline template literals
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/388fig02_alt.jpg" alt="" class="calibre2" width="590" height="70" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/388fig02_alt.jpg"></p>
      
      
      <p class="noind">Now that we’ve given you a short intro to template literals, let’s look at another ES6 feature: destructuring.</p>
      
      
      
      
      <h3 id="app01lev1sec2" class="calibre24"><a id="app01lev1sec2__title" class="calibre3"></a>Destructuring
      </h3>
      
      <p class="noind"><a id="iddle1322" class="calibre4"></a><a id="iddle1379" class="calibre4"></a><a id="iddle1392" class="calibre4"></a>Destructuring allows us to easily extract data from objects and arrays by using patterns. For example, imagine that you have
         an object whose properties you want to assign to a couple of variables, as in the following listing.
      </p>
      
      
      
      <h5 id="app01ex03" class="notetitle">Listing A.3. <a id="app01ex03__title" class="calibre4"></a>Destructuring objects
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/389fig01_alt.jpg" alt="" class="calibre2" width="590" height="270" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/389fig01_alt.jpg"></p>
      
      
      <p class="noind">As <a href="#app01ex03" class="calibre4">listing A.3</a> shows, with object destructuring, we can easily extract multiple variables from an object literal, all in one go. Consider
         the following statement:
      </p>
      
      <pre id="PLd0e38415" class="calibre5">const {name, action, weapon} = ninja;</pre>
      
      <p class="noind">This creates three new variables (<kbd class="calibre15">name</kbd>, <kbd class="calibre15">action</kbd>, and <kbd class="calibre15">weapon</kbd>) whose values are the values of the matching properties of the object on the right-hand side of the statement (<kbd class="calibre15">ninja.name</kbd>, <kbd class="calibre15">ninja.action</kbd>, and <kbd class="calibre15">ninja.weapon</kbd>, respectively).
      </p>
      
      <p class="noind">When we don’t want to use the names of object properties, we can fine-tune them, as in the following statement:</p>
      
      <pre id="PLd0e38445" class="calibre5">const {name: myName, action: myAction, weapon: myWeapon} = ninja;</pre>
      
      <p class="noind">Here we create three variables (<kbd class="calibre15">myName</kbd>, <kbd class="calibre15">myAction</kbd>, and <kbd class="calibre15">myWeapon</kbd>) and assign to them values of the specified object properties.
      </p>
      
      <p class="noind">Earlier, we mentioned that we can also destructure arrays, as arrays are just a special kind of object. Take a look at the
         following listing.
      </p>
      
      
      
      <h5 id="app01ex04" class="notetitle">Listing A.4. <a id="app01ex04__title" class="calibre4"></a>Destructuring arrays
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/389fig02_alt.jpg" alt="" class="calibre2" width="590" height="229" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/389fig02_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1386" class="calibre4"></a><a id="iddle1393" class="calibre4"></a><a id="iddle1811" class="calibre4"></a>Destructing arrays is slightly different from destructuring objects, primarily in syntax, because the variables are wrapped
         in brackets (as opposed to braces, which are used for object destructuring), as shown in the following fragment:
      </p>
      
      <pre id="PLd0e38507" class="calibre5">const [firstNinja, secondNinja, thirdNinja] = ninjas;</pre>
      
      <p class="noind">In this case, <kbd class="calibre15">Yoshi</kbd>, the first ninja, is assigned to the variable <kbd class="calibre15">firstNinja</kbd>. <kbd class="calibre15">Kuma</kbd> is assigned to the variable <kbd class="calibre15">secondNinja</kbd>. <kbd class="calibre15">Hattori</kbd> is assigned to the variable <kbd class="calibre15">thirdNinja</kbd>.
      </p>
      
      <p class="noind">Array destructuring also has some advanced uses. For example, if we want to skip certain items, we can omit variable names,
         while keeping commas, as in the following statement:
      </p>
      
      <pre id="PLd0e38537" class="calibre5">const [, , third] = ninjas;</pre>
      
      <p class="noind">In this case, the first two ninjas will be ignored, while the value of the third ninja, <kbd class="calibre15">Hattori</kbd>, will be assigned to the variable <kbd class="calibre15">third</kbd>.
      </p>
      
      <p class="noind">In addition, we can extract only certain items, while assigning remaining items to a new array:</p>
      
      <pre id="PLd0e38555" class="calibre5">const [first, ...remaining] = ninjas;</pre>
      
      <p class="noind">The first item, <kbd class="calibre15">Yoshi</kbd>, is assigned to the variable <kbd class="calibre15">first</kbd>, and the remaining ninjas, <kbd class="calibre15">Kuma</kbd> and <kbd class="calibre15">Hattori</kbd>, are assigned to the new array, <kbd class="calibre15">remaining</kbd>. Notice that in this case, the remaining items are marked in the same way as the rest parameters (the <kbd class="calibre15">. . .</kbd> operator).
      </p>
      
      
      
      <h3 id="app01lev1sec3" class="calibre24"><a id="app01lev1sec3__title" class="calibre3"></a>Enhanced object literals
      </h3>
      
      <p class="noind">One of the great things about JavaScript is its ease of creating objects with object literals: We define a couple of properties
         and wrap them within curly braces, and voilà, we’ve created a new object. In ES6, the object literal syntax has gained some
         new extensions. Let’s look at an example. Say we want to create a <kbd class="calibre15">ninja</kbd> object, and assign to it a property based on the value of a variable that’s in scope, a property whose name is dynamically
         computed, and a method, as shown in the following listing.
      </p>
      
      <h5 id="app01ex05" class="notetitle">Listing A.5. <a id="app01ex05__title" class="calibre4"></a>Enhanced object literals
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/app01ex05-0.jpg" alt="" class="calibre2" width="590" height="203" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/app01ex05-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/app01ex05-1.jpg" alt="" class="calibre2" width="590" height="225" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/app01ex05-1.jpg"></p>
      
      <p class="noind">This example starts by creating an <kbd class="calibre15">oldNinja</kbd> object using the old pre-ES6 object literal syntax:
      </p>
      
      <pre id="PLd0e38614" class="calibre5">const name = "Yoshi";
const oldNinja = {
  name: name,
  getName: function(){
    return this.name;
  }
};
oldNinja["old" + name] = true;</pre>
      
      <p class="noind">We contrast this with enhanced object literals that achieve exactly the same effect, with less syntactic clutter:</p>
      
      <pre id="PLd0e38623" class="calibre5">const newNinja = {
  name,
  getName(){
    return this.name;
  },
  ["new" + name]: true
};</pre>
      
      <p class="noind">This completes our exploration of important, new concepts introduced by ES6.</p>
      
      
      <h2 id="app02" class="part">Appendix B. <a id="app02__title" class="calibre3"></a>Arming with testing and debugging
      </h2>
      
      
      
      <p class="noind"><i class="calibre6">This appendix covers</i></p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Tools for debugging JavaScript code
            
         </li>
         
         <li class="calibre20">Techniques for generating tests
            
         </li>
         
         <li class="calibre20">Building a test suite
            
         </li>
         
         <li class="calibre20">Surveying some of the popular testing frameworks
            
         </li>
         
      </ul>
      
      <p class="noind">This appendix presents some fundamental techniques in developing client-side web applications: debugging and testing. Constructing
         effective test suites for our code is always important. After all, if we don’t test our code, how do we know that it does
         what we intend? Testing gives us a means to ensure that our code not only runs, but runs <i class="calibre6">correctly</i>.
      </p>
      
      <p class="noind">Moreover, as important as a solid testing strategy is for <i class="calibre6">all</i> code, it can be crucial when external factors have the potential to affect the operation of our code, which <a id="iddle1324" class="calibre4"></a><a id="iddle1487" class="calibre4"></a><a id="iddle1489" class="calibre4"></a><a id="iddle1645" class="calibre4"></a><a id="iddle1660" class="calibre4"></a><a id="iddle1680" class="calibre4"></a><a id="iddle2180" class="calibre4"></a><a id="iddle2183" class="calibre4"></a><a id="iddle2184" class="calibre4"></a>is <i class="calibre6">exactly</i> the case we’re faced with in cross-browser JavaScript development. Not only do we have the typical problems of ensuring the
         quality of the code (especially when dealing with multiple developers working on a single code base) and guarding against
         regressions that could break portions of an API (generic problems that all programmers need to deal with), but we also have
         the problem of determining whether our code works in all the browsers that we choose to support.
      </p>
      
      <p class="noind">In this chapter, we’ll look at tools and techniques for debugging JavaScript code, generating tests based on those results,
         and constructing a test suite to reliably run those tests. Let’s get started.
      </p>
      
      
      <h3 id="app02lev1sec1" class="calibre24"><a id="app02lev1sec1__title" class="calibre3"></a>Web developer tools
      </h3>
      
      <p class="noind">For a long time, the development of JavaScript applications was hindered by the lack of a basic debugging infrastructure.
         The only way to debug JavaScript code was to scatter <kbd class="calibre15">alert</kbd> statements that would notify us about the value of the alerted expression, all around the code that was acting strangely.
         As you might imagine, this made debugging (hardly ever a fun activity) even more difficult.
      </p>
      
      <p class="noind">Luckily, Firebug, an extension to Firefox, was developed in 2007. Firebug holds a special place in the hearts of many web
         developers, because it was the first tool that provided a debugging experience that closely matched debugging in state-of-the-art
         integrated development environments (IDEs), such as Visual Studio or Eclipse. In addition, Firebug has inspired the development
         of similar developer tools for all major browsers: F12 Developer Tools, included in Internet Explorer and Microsoft Edge;
         WebKit Inspector, included in Safari; Firefox Developer Tools, included in Firefox; and Chrome DevTools included in Chrome
         and Opera. Let’s explore them a bit.
      </p>
      
      
      <h4 id="app02lev2sec1" class="calibre26"><a id="app02lev2sec1__title" class="calibre4"></a>Firebug
      </h4>
      
      <p class="noind">Firebug, the first advanced web application debugging tool, is available exclusively for Firefox, and is accessed by pressing
         the F12 key (or by right-clicking anywhere on the page and selecting Inspect Element with Firebug). You can install Firebug
         by opening the page in Firefox (<a href="https://getfirebug.com/" class="calibre4">https://getfirebug.com/</a>) and following the instructions. <a href="#app02fig01" class="calibre4">Figure B.1</a> shows Firebug.
      </p>
      
      
      
      <h5 id="app02fig01" class="notetitle">Figure B.1. <a id="app02fig01__title" class="calibre4"></a>Firebug, available only in Firefox, was the first advanced debugging tool for web applications.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig01_alt.jpg" alt="" class="calibre2" width="590" height="396" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig01_alt.jpg"></p>
      
      
      <p class="noind">Firebug offers advanced debugging functionalities, some of which it has even pioneered. For example, we can easily explore
         the current state of the DOM by using the HTML pane (the pane shown in <a href="#app02fig01" class="calibre4">figure B.1</a>), run custom JavaScript code within the context of the current page by using the console (the bottom of <a href="#app02fig01" class="calibre4">figure B.1</a>), explore the state of our JavaScript code by using the Script pane, and even explore network communications from the Net
         pane.
      </p>
      
      
      
      <h4 id="app02lev2sec2" class="calibre26"><a id="app02lev2sec2__title" class="calibre4"></a>Firefox Developer Tools
      </h4>
      
      <p class="noind">In addition to Firebug, if you’re a Firefox user, you can use the built-in Firefox DevTools, shown in <a href="#app02fig02" class="calibre4">figure B.2</a>. As you can see, the general look and feel of Firefox developer tools is similar to Firebug (apart from some minor layout
         and label differences; for example, the HTML pane from Firebug is called Inspector in Firefox developer tools).
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="app02fig02" class="notetitle">Figure B.2. <a id="app02fig02__title" class="calibre4"></a>Firefox developer tools, built into Firefox, offer all the Firebug features and then some.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig02_alt.jpg" alt="" class="calibre2" width="590" height="408" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig02_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1306" class="calibre4"></a><a id="iddle1367" class="calibre4"></a><a id="iddle1472" class="calibre4"></a><a id="iddle1662" class="calibre4"></a><a id="iddle1682" class="calibre4"></a><a id="iddle1978" class="calibre4"></a><a id="iddle2147" class="calibre4"></a><a id="iddle2182" class="calibre4"></a>Firefox developer tools are built by the Mozilla team, which has taken advantage of this close integration with Firefox by
         bringing in some additional useful features. The Performance pane, for instance, provides detailed insight about the performance
         of our web applications. In addition, Firefox developer tools are built with the modern web in mind. For example, they offer
         Responsive Design mode, which helps us explore the look and feel of our web applications across different screen sizes—which
         is something we have to be careful about, because nowadays users access web applications not only from their PCs, but also
         from mobile devices, tablets, and even TVs.
      </p>
      
      
      
      <h4 id="app02lev2sec3" class="calibre26"><a id="app02lev2sec3__title" class="calibre4"></a>F12 Developer Tools
      </h4>
      
      <p class="noind">If you’re in the Internet Explorer (IE) camp, you’ll be happy to know that IE and Microsoft Edge (the successor to IE) offer
         their own developer tools, the F12 developer tools. (Quickly, try to guess which key toggles them on and off.) These tools
         are shown in <a href="#app02fig03" class="calibre4">figure B.3</a>.
      </p>
      
      
      
      <h5 id="app02fig03" class="notetitle">Figure B.3. <a id="app02fig03__title" class="calibre4"></a>F12 developer tools (toggled by pressing F12) are available in Internet Explorer and Edge.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig03_alt.jpg" alt="" class="calibre2" width="590" height="241" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig03_alt.jpg"></p>
      
      
      <p class="noind">Again, notice the similarities between the F12 developer tools and Firefox’s developer tools (with only slight differences
         in labels). The F12 tools also enable us to explore the current state of the DOM (the DOM Explorer pane, <a href="#app02fig03" class="calibre4">figure B.3</a>), run custom JavaScript code through the console, debug our JavaScript code (the Debugger pane), analyze the network traffic
         (Network), deal with responsive design (UI Responsiveness), and analyze performance and memory consumption (Profiler and Memory).
      </p>
      
      
      
      
      <h4 id="app02lev2sec4" class="calibre26"><a id="app02lev2sec4__title" class="calibre4"></a>WebKit inspector
      </h4>
      
      <p class="noind"><a id="iddle1176" class="calibre4"></a><a id="iddle1327" class="calibre4"></a><a id="iddle2181" class="calibre4"></a><a id="iddle2186" class="calibre4"></a><a id="iddle2188" class="calibre4"></a>If you’re an OS X user, you can use WebKit Inspector, which is offered by Safari, as shown in <a href="#app02fig04" class="calibre4">figure B.4</a>. Although the UI of Safari’s WebKit Inspector is slightly different
      </p>
      
      
      
      <h5 id="app02fig04" class="notetitle">Figure B.4. <a id="app02fig04__title" class="calibre4"></a>WebKit Inspector, available in Safari
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig04_alt.jpg" alt="" class="calibre2" width="590" height="317" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig04_alt.jpg"></p>
      
      
      <p class="noind">from that of F12 developer tools or Firefox’s developer tools, rest assured that the WebKit Inspector also supports all important
         debugging features.
      </p>
      
      
      
      <h4 id="app02lev2sec5" class="calibre26"><a id="app02lev2sec5__title" class="calibre4"></a>Chrome DevTools
      </h4>
      
      <p class="noind">We’ll complete our little survey of developer tools with Chrome DevTools—in our opinion, the current flagship of web application
         developer tools that’s been driving a lot of innovations lately. As you can see in <a href="#app02fig05" class="calibre4">figure B.5</a>, the basic UI and features are similar to the rest of the developer tools.
      </p>
      
      
      
      <h5 id="app02fig05" class="notetitle">Figure B.5. <a id="app02fig05__title" class="calibre4"></a>Chrome DevTools, available in Chrome and Opera
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig05_alt.jpg" alt="" class="calibre2" width="590" height="183" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig05_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1247" class="calibre4"></a><a id="iddle1308" class="calibre4"></a><a id="iddle1311" class="calibre4"></a><a id="iddle1734" class="calibre4"></a>Throughout this book, we’ve used Chrome DevTools, for the sake of convention. But as you’ve seen throughout this section,
         most developer tools offer similar features (and if one of them offers something new, the others catch up quickly). You can
         just as easily use the developer tools offered by your browser of choice.
      </p>
      
      <p class="noind">Now that you’ve had an introduction to the tools you can use for debugging code, let’s explore some debugging techniques.</p>
      
      
      
      
      <h3 id="app02lev1sec2" class="calibre24"><a id="app02lev1sec2__title" class="calibre3"></a>Debugging code
      </h3>
      
      <p class="noind">A significant portion of time developing software is spent on removing annoying bugs. Although this can sometimes be interesting,
         almost like solving a whodunit mystery, typically we’ll want our code working correctly and bug-free as soon as possible.
      </p>
      
      <p class="noind">Debugging JavaScript has two important aspects:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><i class="calibre6">Logging</i>, which prints out what’s going on as our code is running
            
         </li>
         
         <li class="calibre20"><i class="calibre6">Breakpoints</i>, which allow us to temporarily pause the execution of our code and explore the current state of the application
            
         </li>
         
      </ul>
      
      <p class="noind">They’re both useful for answering the important question, “What’s going on in my code?” but each tackles it from a different
         angle. Let’s start by looking at logging.
      </p>
      
      
      <h4 id="app02lev2sec6" class="calibre26"><a id="app02lev2sec6__title" class="calibre4"></a>Logging
      </h4>
      
      <p class="noind"><i class="calibre6">Logging</i> statements are used for outputting messages during program execution, without impeding the normal flow of the program. When
         we add logging statements to our code (for example, by using the <kbd class="calibre15">console.log</kbd> method), we benefit from seeing messages in the browser’s console. For example, if we want to know the value of a variable
         named <kbd class="calibre15">x</kbd> at certain points of program execution, we might write something like the following listing.
      </p>
      
      
      
      <h5 id="app0Bex01" class="notetitle">Listing B.1. <a id="app0Bex01__title" class="calibre4"></a>Logging the value of variable x at various points of program execution
      </h5>
      <pre id="PLd0e39063" class="calibre5">  &lt;!DOCTYPE html&gt;
1: &lt;html&gt;
2:   &lt;head&gt;
3:    &lt;title&gt;Logging&lt;/title&gt;
4:    &lt;script&gt;
5:      var x = 213;
6:      console.log("The value of x is: ", x);
7:
8:      x = "Hello " + "World";
9:      console.log("The value of x is now:", x);
10:   &lt;/script&gt;
11:  &lt;/head&gt;
12:  &lt;body&gt;&lt;/body&gt;
13:&lt;/html&gt;</pre>
      
      <p class="noind"><a href="#app02fig06" class="calibre4">Figure B.6</a> shows the result of executing this code in the Chrome browser with the JavaScript console enabled.
      </p>
      
      
      <p class="noind"></p>
      
      
      <h5 id="app02fig06" class="notetitle">Figure B.6. <a id="app02fig06__title" class="calibre4"></a>Logging lets us see the state of our code as it’s running. In this case, we can see that the value of 213 is logged from line
         6, and the value of “Hello World” from line 9 of listing B.1. All developer tools, including Chrome DevTools shown here, have
         a Console tab for logging purposes.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig06_alt.jpg" alt="" class="calibre2" width="590" height="274" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig06_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1130" class="calibre4"></a><a id="iddle1309" class="calibre4"></a>As you can see, the browser logs the messages directly to the JavaScript console, showing both the logged message and the
         line in which the message was logged.
      </p>
      
      <p class="noind">This is a simple example of logging a value of a variable at different points of program execution. But in general, you can
         use logging to explore various facets of your running applications, such as the execution of important functions, the change
         of an important object property, or the occurrence of a particular event.
      </p>
      
      <p class="noind">Logging is all well and good for seeing the state of things while the code is running, but sometimes we’ll want to stop the
         action and take a look around. That’s where breakpoints come in.
      </p>
      
      
      
      <h4 id="app02lev2sec7" class="calibre26"><a id="app02lev2sec7__title" class="calibre4"></a>Breakpoints
      </h4>
      
      <p class="noind">Using <i class="calibre6">breakpoints</i> can be more complex than logging, but they possess a notable advantage: They halt the execution of a script at a specific
         line of code, pausing the browser. This allows us to leisurely investigate the state of all sorts of things at the point of
         the break.
      </p>
      
      <p class="noind">Let’s say that we have a page that logs a greeting to a famous ninja, as shown in the following listing.</p>
      
      
      
      <h5 id="app0Bex02" class="notetitle">Listing B.2. <a id="app0Bex02__title" class="calibre4"></a>A simple “greet a ninja” page
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/398fig01_alt.jpg" alt="" class="calibre2" width="590" height="316" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/398fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1307" class="calibre4"></a><a id="iddle1312" class="calibre4"></a><a id="iddle1583" class="calibre4"></a><a id="iddle2056" class="calibre4"></a>Say we set a breakpoint by using the Chrome DevTools on the annotated line that calls the <kbd class="calibre15">logGreeting</kbd> function in listing B.2 (by clicking the line number gutter in the Debugger pane) and refresh the page to cause the code
         to execute. The debugger would then stop the execution at that line and show us the display in <a href="#app02fig07" class="calibre4">figure B.7</a>.
      </p>
      
      
      
      <h5 id="app02fig07" class="notetitle">Figure B.7. <a id="app02fig07__title" class="calibre4"></a>When we set a breakpoint on a line of code (by clicking the line gutter) and load the page, the browser will stop executing
         JavaScript code before that line is executed. Then you can leisurely explore the current state of the application in the pane
         on the right.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig07_alt.jpg" alt="" class="calibre2" width="590" height="331" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig07_alt.jpg"></p>
      
      
      <p class="noind">The pane on the right shows the state of the application within which our code is running, including the value of the <kbd class="calibre15">ninja</kbd> variable (<kbd class="calibre15">Hattori Hanzo</kbd>). The debugger breaks on a line <i class="calibre6">before</i> the breakpointed line is executed; in this example, the call to the <kbd class="calibre15">logGreeting</kbd> function has yet to be executed.
      </p>
      
      
      
      <h4 id="app02lev2sec8" class="calibre26"><a id="app02lev2sec8__title" class="calibre4"></a>Stepping into a function
      </h4>
      
      <p class="noind">If we’re trying to debug a problem with our <kbd class="calibre15">logGreeting</kbd> function, we might want to <i class="calibre6">step into</i> that function to see what’s going on inside it. While our execution is paused on the <kbd class="calibre15">logGreeting</kbd> call (with a breakpoint that we’ve previously set), we click the Step Into button (shown as an arrow pointing to a dot in
         most debuggers) or press F11, which will cause the debugger to execute up to the first line of our <kbd class="calibre15">logGreeting</kbd> function. <a href="#app02fig08" class="calibre4">Figure B.8</a> shows the result.
      </p>
      
      
      
      <h5 id="app02fig08" class="notetitle">Figure B.8. <a id="app02fig08__title" class="calibre4"></a>Stepping into a function lets us see the new state in which the function is executed. We can explore the current position
         by studying the Call Stack and the current values of local variables.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig08_alt.jpg" alt="" class="calibre2" width="590" height="433" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig08_alt.jpg"></p>
      
      
      <p class="noind">Note that the look of Chrome DevTools has changed a bit (when compared to <a href="#app02fig07" class="calibre4">figure B.7</a>) to allow us to poke around the application state in which the <kbd class="calibre15">logGreeting</kbd> function executes. For example, now we can easily explore the local variables of our <kbd class="calibre15">logGreeting</kbd> function and see that we have a <kbd class="calibre15">name</kbd> variable with the value <kbd class="calibre15">Hattori Hanzo</kbd> (the variable values are even shown inline, with the source code on the left). Also notice that in the upper-right corner
         is a Call Stack pane, which shows that we’re currently within the <kbd class="calibre15">logGreeting</kbd> function, which was called by global code.
      </p>
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <div class="calibre13">
         
         <b id="app02sb01" class="calibre21">Step Over and Step Out</b>
         
         <p class="noind">In addition to the Step Into command, we can use Step Over and Step Out.</p>
         
         <p class="noind">The Step Over command executes our code line by line. If the code in the executed line contains a function call, the debugger
            steps over the function (the function will be executed, but the debugger won’t jump into its code).
         </p>
         
         <p class="noind">If we’ve paused the execution of a function, clicking the Step Out button will execute the code to the end of the function,
            and the debugger will again pause right after the execution has left that function.
         </p>
         
      </div>
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      
      
      
      <h4 id="app02lev2sec9" class="calibre26"><a id="app02lev2sec9__title" class="calibre4"></a>Conditional breakpoints
      </h4>
      
      <p class="noind"><a id="iddle1039" class="calibre4"></a><a id="iddle1129" class="calibre4"></a><a id="iddle1242" class="calibre4"></a><a id="iddle1310" class="calibre4"></a>Standard breakpoints cause the debugger to stop the application execution every time a debugger reaches that particular point
         in program execution. In certain cases, this can be tiring. Consider the following listing.
      </p>
      
      
      
      <h5 id="app0Bex03" class="notetitle">Listing B.3. <a id="app0Bex03__title" class="calibre4"></a>Counting Ninjas and conditional breakpoints
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/401fig01_alt.jpg" alt="" class="calibre2" width="590" height="193" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/401fig01_alt.jpg"></p>
      
      
      <p class="noind">Imagine that we want to explore the state of the application when counting the 50th ninja. How tiring would it be to have
         to visit all 49 ninjas before finally reaching the one we want?
      </p>
      
      <p class="noind">Welcome to conditional breakpoints! Unlike traditional breakpoints, which halt every time the breakpointed line is executed,
         a <i class="calibre6">conditional breakpoints</i> causes the debugger to break only if an expression associated with the conditional breakpoints is satisfied. You can set
         a conditional breakpoint by right-clicking in the line-number gutter and choosing Add (see <a href="#app02fig09" class="calibre4">figure B.9</a> for how it’s done in Chrome).
      </p>
      
      
      
      <h5 id="app02fig09" class="notetitle">Figure B.9. <a id="app02fig09__title" class="calibre4"></a>Right-click in the line-number margin to set a breakpoint as conditional; notice that these are shown in a different color,
         usually orange.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig09_alt.jpg" alt="" class="calibre2" width="590" height="174" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig09_alt.jpg"></p>
      
      
      <p class="noind">By associating the expression: <kbd class="calibre15">i == 49</kbd> with a conditional breakpoint, the debugger will halt only when that condition is satisfied. In that way, we can jump immediately
         to the point in the application execution that we’re interested in, and ignore the less interesting ones.
      </p>
      
      <p class="noind">So far, you’ve seen how to use various developer tools from different browsers in order to debug our code with logging and
         breakpoints. These are all great tools that <a id="iddle1254" class="calibre4"></a><a id="iddle1314" class="calibre4"></a><a id="iddle2094" class="calibre4"></a><a id="iddle2096" class="calibre4"></a><a id="iddle2098" class="calibre4"></a><a id="iddle2099" class="calibre4"></a><a id="iddle2104" class="calibre4"></a><a id="iddle2106" class="calibre4"></a>help us locate specific bugs and achieve a better understanding of the execution of a particular application. But in addition
         to this, we want to have an infrastructure in place that will help us detect bugs as soon as possible. This can be achieved
         with testing.
      </p>
      
      
      
      
      <h3 id="app02lev1sec3" class="calibre24"><a id="app02lev1sec3__title" class="calibre3"></a>Creating tests
      </h3>
      
      <p class="noind">Robert Frost wrote that “good fences make good neighbors,” but in the world of web applications, and indeed any programming
         discipline, good tests make good code. Note the emphasis on the word <i class="calibre6">good</i>. It’s possible to have an extensive test suite that doesn’t help the quality of our code one iota if the tests are poorly
         constructed.
      </p>
      
      <p class="noind">Good tests exhibit three important characteristics:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Repeatability—</i> </b>Our test results should be highly reproducible. Tests that run repeatedly should always produce the exact same results. If
            test results are nondeterministic, how would we know which results are valid and which are invalid? Additionally, reproducibility
            ensures that our tests aren’t dependent on external factors, such as network or CPU loads.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Simplicity—</i> </b>Our tests should focus on testing <i class="calibre6">one</i> thing. We should strive to remove as much HTML markup, CSS, or JavaScript as we can without disrupting the intent of the
            test case. The more we remove, the greater the likelihood that the test case will be influenced by only the specific code
            that we’re testing.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Independence—</i> </b>Our tests should execute in isolation. We must avoid making the results from one test dependent on another. Breaking tests
            into the smallest possible units will help us determine the exact source of a bug when an error occurs.
            
         </li>
         
      </ul>
      
      <p class="noind">We can use various approaches to construct tests. The two primary approaches are deconstructive and constructive:</p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Deconstructive test cases—</i> </b>Existing code is whittled down (deconstructed) to isolate a problem, eliminating anything that’s not germane to the issue.
            This helps achieve the three characteristics listed previously. We might start with a complete website, but after removing
            extra markup, CSS, and JavaScript, we’ll arrive at a smaller case that reproduces the problem.
            
         </li>
         
         <li class="calibre20"><b class="calibre21"><i class="calibre6">Constructive test cases—</i> </b>We start from a known good, reduced case and build up until we’re able to reproduce the bug in question. To use this style
            of testing, we’ll need a couple of simple test files from which to build up tests, and a way to generate these new tests with
            a clean copy of our code.
            
         </li>
         
      </ul>
      
      <p class="noind">Let’s look at an example of constructive testing.</p>
      
      <p class="noind">When creating reduced test cases, we can start with a few HTML files with minimum functionality already included in them.
         We might even have different starting files for various functional areas; for example, one for DOM manipulation, one for Ajax
         tests, one for animations, and so on.
      </p>
      
      <p class="noind">For example, the following listing shows a simple DOM test case used to test jQuery.</p>
      
      
      
      <h5 id="app0Bex04" class="notetitle">Listing B.4. <a id="app0Bex04__title" class="calibre4"></a>A reduced DOM test case for jQuery
      </h5>
      <pre id="PLd0e39490" class="calibre5">&lt;style&gt;
  #test { width: 100px; height: 100px; background: red; }
&lt;/style&gt;
&lt;div id="test"&gt;&lt;/div&gt;
&lt;script src="dist/jquery.js"&gt;&lt;/script&gt;
&lt;script&gt;
  $(document).ready(function() {
    $("#test").append("test");
  });
&lt;/script&gt;</pre>
      
      <p class="noind">Another alternative is to use a prebuilt service designed for creating simple test cases, for example JSFiddle (<a href="http://jsfiddle.net/" class="calibre4">http://jsfiddle.net/</a>), CodePen (<a href="http://codepen.io/" class="calibre4">http://codepen.io/</a>), or JS Bin (<a href="http://jsbin.com/" class="calibre4">http://jsbin.com/</a>). All have similar functionality; they allow us to build test cases that become available at a unique URL. (And you can even
         include copies of popular libraries.) An example in JSFiddle is shown in <a href="#app02fig10" class="calibre4">figure B.10</a>.
      </p>
      
      
      
      <h5 id="app02fig10" class="notetitle">Figure B.10. <a id="app02fig10__title" class="calibre4"></a>JSFiddle enables us to test combinations of HTML, CSS, and JavaScript snippets in a sandbox to see if everything works as
         intended.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig10_alt.jpg" alt="" class="calibre2" width="590" height="472" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig10_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1100" class="calibre4"></a><a id="iddle1101" class="calibre4"></a><a id="iddle2105" class="calibre4"></a><a id="iddle2107" class="calibre4"></a>Using JSFiddle (or similar tools) is all nice and practical when we have to do a quick test of a certain concept, especially
         because you can easily share it with other people, and maybe even get some useful feedback. Unfortunately, running such tests
         requires that you manually open the test and check its result, which might be fine if you have only a couple of tests, but
         normally we should have lots and lots of tests that check every nook and cranny of our code. For this reason, we want to automate
         our tests as much as possible. Let’s look at how to achieve that.
      </p>
      
      
      
      <h3 id="app02lev1sec4" class="calibre24"><a id="app02lev1sec4__title" class="calibre3"></a>The fundamentals of a testing framework
      </h3>
      
      <p class="noind">The primary purpose of a testing framework is to allow us to specify individual tests that can be wrapped into a single unit,
         so that they can be run in bulk, providing a single resource that can be run easily and repeatedly.
      </p>
      
      <p class="noind">To better understand how a testing framework works, it makes sense to look at how it’s constructed. Perhaps surprisingly,
         JavaScript testing frameworks are easy to construct.
      </p>
      
      <p class="noind">You’d have to ask, though, “Why would I want to build a new testing framework?” For most cases, writing your own JavaScript
         testing framework isn’t necessary, because many good-quality ones are already available (as you’ll soon see). But building
         your own test framework can serve as a good learning experience.
      </p>
      
      
      <h4 id="app02lev2sec10" class="calibre26"><a id="app02lev2sec10__title" class="calibre4"></a>The assertion
      </h4>
      
      <p class="noind">The core of a unit-testing framework is its assertion method, customarily named <kbd class="calibre15">assert</kbd>. This method usually takes a <i class="calibre6">value</i>—an expression whose premise is <i class="calibre6">asserted</i>—and a description of the purpose of the assertion. If the value evaluates to <kbd class="calibre15">true,</kbd> the assertion passes; otherwise, it’s considered a failure. The associated message is usually logged with an appropriate
         pass/fail indicator.
      </p>
      
      <p class="noind">A simple implementation of this concept can be seen in the following listing.</p>
      
      
      
      <h5 id="app0Bex05" class="notetitle">Listing B.5. <a id="app0Bex05__title" class="calibre4"></a>A simple implementation of a JavaScript assertion
      </h5>
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/404fig01_alt.jpg" alt="" class="calibre2" width="590" height="395" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/404fig01_alt.jpg"></p>
      
      
      <p class="noind"><a id="iddle1245" class="calibre4"></a><a id="iddle1473" class="calibre4"></a><a id="iddle1731" class="calibre4"></a>The function named <kbd class="calibre15">assert</kbd> is almost surprisingly straightforward. It creates a new <kbd class="calibre15">&lt;li&gt;</kbd> element containing the description, assigns a class named <kbd class="calibre15">pass</kbd> or <kbd class="calibre15">fail</kbd>, depending on the value of the assertion parameter (<kbd class="calibre15">value</kbd>), and appends the new element to a list element in the document body.
      </p>
      
      <p class="noind">The test suite consists of two trivial tests: one that will always succeed, and one that will always fail:</p>
      
      <pre id="PLd0e39643" class="calibre5">assert(true, "The test suite is running."); //Will always pass
assert(false, "Fail!"); //Will always fail</pre>
      
      <p class="noind">Style rules for the <kbd class="calibre15">pass</kbd> and <kbd class="calibre15">fail</kbd> classes visually indicate success or failure using colors.
      </p>
      
      <p class="noind">The result of running our test suite in Chrome is shown in <a href="#app02fig11" class="calibre4">figure B.11</a>.
      </p>
      
      
      
      <h5 id="app02fig11" class="notetitle">Figure B.11. <a id="app02fig11__title" class="calibre4"></a>The result of running our first test suite
      </h5>
      
      
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig11.jpg" alt="" class="calibre2" width="500" height="293" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig11.jpg"></p>
      
      
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      <h5 id="app02note01" class="notetitle">Tip</h5>
      
      
      <p class="noindclose">If you’re looking for something quick, you can use the built-in <kbd class="calibre15">console.assert()</kbd> method (see <a href="#app02fig12" class="calibre4">figure B.12</a>).
      </p>
      
      
      
      <h5 id="app02fig12" class="notetitle">Figure B.12. <a id="app02fig12__title" class="calibre4"></a>You can use the built-in <kbd class="calibre15">console.assert</kbd> as a quick way to test code. The fail message is logged to the console only if an assertion fails.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig12_alt.jpg" alt="" class="calibre2" width="590" height="368" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig12_alt.jpg"></p>
      
      
      <table width="100%" border="1" cellspacing="5" class="calibre7">
         <colgroup class="calibre16">
            <col width="550" class="calibre9">
         </colgroup>
         <tbody class="calibre10">
            <tr class="calibre11">
               <td class="calibre17"></td>
            </tr>
         </tbody>
      </table>
      
      <p class="noind">Now that we’ve built our own rudimentary testing framework, let’s meet some of the widely available, more popular testing
         frameworks.
      </p>
      
      
      
      
      <h4 id="app02lev2sec11" class="calibre26"><a id="app02lev2sec11__title" class="calibre4"></a>Popular testing frameworks
      </h4>
      
      <p class="noind"><a id="iddle1927" class="calibre4"></a><a id="iddle2100" class="calibre4"></a><a id="iddle2110" class="calibre4"></a>A test framework should be a fundamental part of your development workflow, so you should pick a framework that works particularly
         well for your coding style and your code base. A JavaScript testing framework should serve a single need: displaying the results
         of the tests, and making it easy to determine which tests have passed or failed. Testing frameworks can help us reach that
         goal without having to worry about anything other than creating the tests and organizing them into collections called <i class="calibre6">test suites</i>.
      </p>
      
      <p class="noind">There are several features that we might want to look for in a JavaScript unit-testing framework, depending on the needs of
         the tests. Some of these features include the following:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The ability to simulate browser behavior (clicks, key presses, and so on)
            
         </li>
         
         <li class="calibre20">Interactive control of tests (pausing and resuming tests)
            
         </li>
         
         <li class="calibre20">Handling asynchronous test time-outs
            
         </li>
         
         <li class="calibre20">The ability to filter which tests are to be executed
            
         </li>
         
      </ul>
      
      <p class="noind">Let’s meet the two currently most popular testing frameworks: QUnit and Jasmine.</p>
      
      
      
      <h4 id="app02lev2sec12" class="calibre26"><a id="app02lev2sec12__title" class="calibre4"></a>QUnit
      </h4>
      
      <p class="noind">QUnit is the unit-testing framework originally built to test jQuery. It has since expanded beyond its initial goals and is
         now a standalone unit-testing framework. <a id="iddle1458" class="calibre4"></a><a id="iddle1698" class="calibre4"></a><a id="iddle2108" class="calibre4"></a>QUnit is primarily designed to be a simple solution to unit testing, providing a minimal but easy-to-use API. QUnit’s distinguishing
         features are as follows:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">Simple API
            
         </li>
         
         <li class="calibre20">Supports asynchronous testing
            
         </li>
         
         <li class="calibre20">Not limited to jQuery or jQuery-using code
            
         </li>
         
         <li class="calibre20">Especially well-suited for regression testing
            
         </li>
         
      </ul>
      
      <p class="noind">Let’s look at a QUnit test example in the following listing that tests whether we’ve developed a function that accurately
         says “Hi” to a ninja.
      </p>
      
      
      
      <h5 id="app0Bex06" class="notetitle">Listing B.6. <a id="app0Bex06__title" class="calibre4"></a>QUnit test example
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/407fig01_alt.jpg" alt="" class="calibre2" width="590" height="329" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/407fig01_alt.jpg"></p>
      
      
      <p class="noind">When you open this example in a browser, you should get the results shown in <a href="#app02fig13" class="calibre4">figure B.13</a>, with one passing assertion from executing the line <kbd class="calibre15">sayHiToNinja("Hatori")</kbd>, and one failing assertion from <kbd class="calibre15">assert.ok(false, "Failed")</kbd>.
      </p>
      
      
      
      <h5 id="app02fig13" class="notetitle">Figure B.13. <a id="app02fig13__title" class="calibre4"></a>An example of a QUnit test run. As a part of our test, we have one passing and one failing assertion (one assertion of two
         passed, one failed.) The displayed results put a much bigger emphasis on the failing test, to make sure we fix it as soon
         as possible.
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig13_alt.jpg" alt="" class="calibre2" width="590" height="478" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig13_alt.jpg"></p>
      
      
      <p class="noind">More information on QUnit can be found at <a href="http://qunitjs.com/" class="calibre4">http://qunitjs.com/</a>.
      </p>
      
      
      
      <h4 id="app02lev2sec13" class="calibre26"><a id="app02lev2sec13__title" class="calibre4"></a>Jasmine
      </h4>
      
      <p class="noind">Jasmine is another popular testing framework, built on slightly different foundations than QUnit. The principal parts of the
         framework are as follows:
      </p>
      
      <p class="calibre18"></p>
      <ul class="calibre19">
         
         <li class="calibre20">The <kbd class="calibre15">describe</kbd> function, which describes test suites
            
         </li>
         
         <li class="calibre20">The <kbd class="calibre15">it</kbd> function, which specifies individual tests
            
         </li>
         
         <li class="calibre20">The <kbd class="calibre15">expect</kbd> function, which checks individual assertions
            
         </li>
         
      </ul>
      
      <p class="noind">The combination and naming of these functions are geared toward making the test suite almost conversational in nature. For
         example, the following listing shows how to test the <kbd class="calibre15">sayHiToNinja</kbd> function using Jasmine.
      </p>
      
      <h5 id="app0Bex07" class="notetitle">Listing B.7. <a id="app0Bex07__title" class="calibre4"></a>Jasmine test example
      </h5>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/app0bex07-0.jpg" alt="" class="calibre2" width="590" height="179" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/app0bex07-0.jpg"></p>
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/app0bex07-1.jpg" alt="" class="calibre2" width="590" height="214" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/app0bex07-1.jpg"></p>
      
      <p class="noind">The result of running this Jasmine test suite in the browser is shown in <a href="#app02fig14" class="calibre4">figure B.14</a>.
      </p>
      
      
      
      <h5 id="app02fig14" class="notetitle">Figure B.14. <a id="app02fig14__title" class="calibre4"></a>The result of running a Jasmine test suite in the browser. We have two tests: one passing and one failing (two specs, one
         failure).
      </h5>
      
      <p class="center1"><img src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig14_alt.jpg" alt="" class="calibre2" width="590" height="478" data-mfp-src="https://learning.oreilly.com/library/view/secrets-of-the/9781617292859/b0fig14_alt.jpg"></p>
      
      
      <p class="noind">More information on Jasmine can be found at <a href="http://jasmine.github.io/" class="calibre4">http://jasmine.github.io/</a>.
      </p>
      
      
      
      
      <h4 id="app02lev2sec14" class="calibre26"><a id="app02lev2sec14__title" class="calibre4"></a>Measuring code coverage
      </h4>
      
      <p class="noind"><a id="iddle2109" class="calibre4"></a>It’s difficult to say what makes a particular test suite <i class="calibre6">good</i>. Ideally, we should test all possible execution paths of our programs. Unfortunately, except for the most trivial cases,
         this isn’t possible. A step in the right direction is trying to test as much code as we can, and a metric that tells us the
         degree to which a test suite covers our code is called <i class="calibre6">code coverage</i>.
      </p>
      
      <p class="noind">For example, saying that a test suite has 80% code coverage means that 80% of our program code is executed by the test suite,
         whereas 20% of our code isn’t. Although we can’t be entirely sure that this 80% of code doesn’t contain bugs (we might have
         missed an execution path that leads to one), we’re completely in the dark about the 20% that wasn’t even executed. This is
         why we should measure the code coverage of our test suites.
      </p>
      
      <p class="noind">In JavaScript development, we can use several libraries to measure the coverage of our test suites, most notably Blanket.js
         (<a href="https://github.com/alex-seville/blanket" class="calibre4">https://github.com/alex-seville/blanket</a>) and Istanbul (<a href="https://github.com/gotwarlost/istanbul" class="calibre4">https://github.com/gotwarlost/istanbul</a>). Setting up these libraries goes beyond the scope of this book, but their respective web pages offer all the info we might
         need on properly setting them up.
      </p>
      
      
      
      <h2 id="app03" class="part">Appendix C. <a id="app03__title" class="calibre3"></a>Exercise answers
      </h2>
      
      
      
      
      <h3 id="app03lev1sec1" class="calibre24"><a id="app03lev1sec1__title" class="calibre3"></a>Chapter 2. Building the page at runtime
      </h3>
      
      <p class="calibre18"><a id="app03qa3" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa3qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa3q1" class="calibre4"></a><b class="calibre21"><a href="#app03qa3q1a1" class="calibre4 totri-footnote">1</a> </b></p><p class="noind"><a id="iddle1045" class="calibre4"></a><a id="iddle1139" class="calibre4"></a><a id="iddle1444" class="calibre4"></a><a id="iddle1446" class="calibre4"></a><a id="iddle1453" class="calibre4"></a><a id="iddle1987" class="calibre4"></a>What are the two phases in the lifecycle of a client-side web application?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa3q1a1" class="calibre4"></a><b class="calibre21"><a href="#app03qa3q1" class="calibre4">A:</a> </b></p><p class="noind">The two phases in the lifecycle of a client-side web application are page building and event handling. In the page-building
               phase, the user interface of our page is built by processing HTML code and by executing mainline JavaScript code. After the
               last HTML node is processed, the page enters the event-handling phase, in which various events are processed.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa3qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa3q2" class="calibre4"></a><b class="calibre21"><a href="#app03qa3q2a2" class="calibre4 totri-footnote">2</a> </b></p><p class="noind">What is the main advantage of using the <kbd class="calibre15">addEventListener</kbd> method to register an event handler versus assigning a handler to a specific element property?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa3q2a2" class="calibre4"></a><b class="calibre21"><a href="#app03qa3q2" class="calibre4">A:</a> </b></p><p class="noind">When assigning event handlers to specific element properties, we can register only one event handler; <kbd class="calibre15">addEventListener</kbd>, on the other hand, enables us to register as many event handlers as necessary.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa3qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa3q3" class="calibre4"></a><b class="calibre21"><a href="#app03qa3q3a3" class="calibre4 totri-footnote">3</a> </b></p><p class="noind">How many events can be processed at once?</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa3q3a3" class="calibre4"></a><b class="calibre21"><a href="#app03qa3q3" class="calibre4">A:</a> </b></p><p class="noind">JavaScript is based on a single-threaded execution model, in which events are processed one at a time.</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa3qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa3q4" class="calibre4"></a><b class="calibre21"><a href="#app03qa3q4a4" class="calibre4 totri-footnote">4</a> </b></p><p class="noind">In what order are events from the event queue processed?</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa3q4a4" class="calibre4"></a><b class="calibre21"><a href="#app03qa3q4" class="calibre4">A:</a> </b></p><p class="noind">Events are processed in the order in which they were generated: first in, first out.</p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      <h3 id="app03lev1sec2" class="calibre24"><a id="app03lev1sec2__title" class="calibre3"></a>Chapter 3. First-class functions for the novice: definitions and arguments
      </h3>
      
      <p class="calibre18"><a id="app03qa4" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa4qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa4q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">In the following code snippet, which functions are callback functions?</p>
            
            <pre id="PLd0e40118" class="calibre5">//sortAsc is a callback because the JavaScript engine
//calls it to compare array items
numbers.sort(function <b class="calibre21">sortAsc</b>(a,b){
  return a – b;
});

//Not a callback; ninja is called like a standard function
function <b class="calibre21">ninja</b>(){}
ninja();

var myButton = document.getElementById("myButton");
//handleClick is a callback, the function is called
//whenever myButton is clicked
myButton.addEventListener("click", function <b class="calibre21">handleClick</b>(){
  alert("Clicked");
});</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa4qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa4q2" class="calibre4"></a><b class="calibre21">2 </b></p><p class="noind"><a id="iddle2095" class="calibre4"></a>In the following snippet, categorize functions according to their type (function declaration, function expression, or arrow
               function).
            </p>
            
            <pre id="PLd0e40147" class="calibre5">//function expression as argument to another function
numbers.sort(function <b class="calibre21">sortAsc</b>(a,b){
  return a – b;
});

//arrow function as argument to another function
numbers.sort(<b class="calibre21">(a,b) =&gt; b – a</b>);

//function expression as the callee in a call expression
<b class="calibre21">function(){}</b>)();

//function declaration
<b class="calibre21">function outer(){</b>
  //function declaration
  <b class="calibre21">function inner(){}</b>
  return inner;
<b class="calibre21">}</b>

//function expression call wrapped in an expression
(<b class="calibre21">function(){}</b>());

//arrow function as a callee
(<b class="calibre21">()=&gt;"Yoshi"</b>)();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa4qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa4q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">After executing the following code snippet, what are the values of variables <kbd class="calibre15">samurai</kbd> and <kbd class="calibre15">ninja</kbd>?
            </p>
            
            <pre id="PLd0e40190" class="calibre5">//"Tomoe", the value of the expression body of the arrow function
var samurai = (() =&gt; "Tomoe")();
//undefined, in case an arrow function's body is a block statement
//the value is the value of the return statement.
//Because there's no return statement, the value is undefined.
var ninja = (() =&gt; {"Yoshi"})();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa4qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa4q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">Within the body of the <kbd class="calibre15">test</kbd> function, what are the values of parameters <kbd class="calibre15">a</kbd>, <kbd class="calibre15">b</kbd>, and <kbd class="calibre15">c</kbd> for the two function calls?
            </p>
            
            
            <pre id="PLd0e40217" class="calibre5">function test(a, b, ...c){ /*a, b, c*/}

// a = 1; b = 2; c = [3, 4, 5]
test(1, 2, 3, 4, 5);
// a = undefined; b = undefined; c = []
test();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa4qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa4q5" class="calibre4"></a><b class="calibre21">5 </b></p><p class="noind"><a id="iddle1071" class="calibre4"></a><a id="iddle1455" class="calibre4"></a><a id="iddle1571" class="calibre4"></a><a id="iddle1685" class="calibre4"></a>After executing the following code snippet, what are the values of the <kbd class="calibre15">message1</kbd> and <kbd class="calibre15">message2</kbd> variables?
            </p>
            
            <pre id="PLd0e40271" class="calibre5">function getNinjaWieldingWeapon(ninja, weapon = "katana"){
  return ninja + " " + katana;
}

//"Yoshi katana" – there's only one argument in the call
//so weapon defaults to "katana"
var message1 = getNinjaWieldingWeapon("Yoshi");

//"Yoshi wakizashi" – we've sent in two arguments, the default
//value is not taken into account
var message2 = getNinjaWieldingWeapon("Yoshi", "wakizashi");</pre>
            <p class="calibre18"></p>
      </blockquote>
      
      
      
      <h3 id="app03lev1sec3" class="calibre24"><a id="app03lev1sec3__title" class="calibre3"></a>Chapter 4. Functions for the journeyman: understanding function invocation
      </h3>
      
      <p class="calibre18"><a id="app03qa5" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa5qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa5q1" class="calibre4"></a><b class="calibre21"><a href="#app03qa5q1a1" class="calibre4 totri-footnote">1</a> </b></p><p class="noind">The following function calculates the sum of the passed-in arguments using the <kbd class="calibre15">arguments</kbd> object. By using the rest parameters introduced in the previous chapter, rewrite the <kbd class="calibre15">sum</kbd> function so that it doesn’t use the <kbd class="calibre15">arguments</kbd> object.
            </p>
            
            <pre id="PLd0e40304" class="calibre5">function sum(){
  var sum = 0;
  for(var i = 0; i &lt; arguments.length; i++){
     sum += arguments[i];
  }
  return sum;
}

assert(sum(1, 2, 3) === 6, 'Sum of first three numbers is 6');
assert(sum(1, 2, 3, 4) === 10, 'Sum of first four numbers is 10');</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa5q1a1" class="calibre4"></a><b class="calibre21"><a href="#app03qa5q1" class="calibre4">A:</a> </b></p><p class="noind">Add a rest parameter to the function definition and slightly adjust the function body:</p>
            
            <pre id="PLd0e40316" class="calibre5">function sum(<b class="calibre21">... numbers</b>){
  var sum = 0;
  for(var i = 0; i &lt; <b class="calibre21">numbers</b>.length; i++){
     sum += <b class="calibre21">numbers</b>[i];
  }
  return sum;
}

assert(sum(1, 2, 3) === 6, 'Sum of first three numbers is 6');
assert(sum(1, 2, 3, 4) === 10, 'Sum of first four numbers is 10');</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa5qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa5q2" class="calibre4"></a><b class="calibre21"><a href="#app03qa5q2a2" class="calibre4 totri-footnote">2</a> </b></p><p class="noind"><a id="iddle1809" class="calibre4"></a><a id="iddle2203" class="calibre4"></a>After running the following code in the browser, what are the values of variables <kbd class="calibre15">ninja</kbd> and <kbd class="calibre15">samurai</kbd>?
            </p>
            
            <pre id="PLd0e40356" class="calibre5">function getSamurai(samurai){
  "use strict"

  arguments[0] = "Ishida";

  return samurai;
}

function getNinja(ninja){
  arguments[0] = "Fuma";
  return ninja;
}

var samurai = getSamurai("Toyotomi");
var ninja = getNinja("Yoshi");</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa5q2a2" class="calibre4"></a><b class="calibre21"><a href="#app03qa5q2" class="calibre4">A:</a> </b></p><p class="noind"><kbd class="calibre15">samurai</kbd> will have the value <kbd class="calibre15">Toyotomi</kbd>, and <kbd class="calibre15">ninja</kbd> will have the value <kbd class="calibre15">Fuma</kbd>. Because the <kbd class="calibre15">getSamurai</kbd> function is in strict mode, the <kbd class="calibre15">arguments</kbd> parameter doesn’t alias function parameters, so changing the value of the first argument won’t change the value of the <kbd class="calibre15">samurai</kbd> parameter. Because the <kbd class="calibre15">getNinja</kbd> function is in nonstrict mode, any changes made to the <kbd class="calibre15">arguments</kbd> parameter will be reflected in the function parameters.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa5qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa5q3" class="calibre4"></a><b class="calibre21"><a href="#app03qa5q3a3" class="calibre4 totri-footnote">3</a> </b></p><p class="noind">When running the following code, which of the assertions will pass?</p>
            
            <pre id="PLd0e40402" class="calibre5">function whoAmI1(){
  "use strict";
  return this;
}

function whoAmI2(){
  return this;
}

assert(whoAmI1() === window, "Window?"); <b class="calibre21">//fail</b>
assert(whoAmI2() === window, "Window?"); <b class="calibre21">//pass</b></pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa5q3a3" class="calibre4"></a><b class="calibre21"><a href="#app03qa5q3" class="calibre4">A:</a> </b></p><p class="noind">The <kbd class="calibre15">whoAmI1</kbd> function is in strict mode; when it’s called as a function, the value of the <kbd class="calibre15">this</kbd> parameter will be <kbd class="calibre15">undefined</kbd> (and not <kbd class="calibre15">window</kbd>). The second assertion will pass: If a function in nonstrict mode is called as a function, <kbd class="calibre15">this</kbd> refers to the global object (the <kbd class="calibre15">window</kbd> object, when running the code in the browser).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa5qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa5q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind">When running the following code, which of the assertions will pass?</p>
            
            <pre id="PLd0e40444" class="calibre5">var ninja1 = {
   whoAmI: function(){
     return this;
   }
};

var ninja2 = {
  whoAmI: ninja1.whoAmI
};

var identify = ninja2.whoAmI;

//pass: whoAmI called as a method of ninja1
assert(ninja1.whoAmI() === ninja1, "ninja1?");

//fail: whoAmI called as a method of ninja2
assert(ninja2.whoAmI() === ninja1, " ninja1 again?");

//fail: identify calls the function as a function
//because we are in non-strict mode, this refers to the window
assert(identify() === ninja1, "ninja1 again?");

//pass: Using call to supply the function context
//this refers to ninja2
assert(ninja1.whoAmI.call(ninja2) === ninja2, "ninja2 here?");</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa5qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa5q5" class="calibre4"></a><b class="calibre21">5 </b></p><p class="noind">When running the following code, which of the assertions will pass?</p>
            
            <pre id="PLd0e40459" class="calibre5">function Ninja(){
  this.whoAmI = () =&gt; this;
}

var ninja1 = new Ninja();
var ninja2 = {
  whoAmI: ninja1.whoAmI
};

//pass: whoAmI is an arrow function inherits the function context
//from the context in which it was created.
//Because it was created during the construction of ninja1
//this will always point to ninja1
assert(ninja1.whoAmI() === ninja1, "ninja1 here?");

//false: this always refers to ninja1
assert(ninja2.whoAmI() === ninja2, "ninja2 here?");</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa5qe6" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa5q6" class="calibre4"></a><b class="calibre21">6 </b></p><p class="noind">Which of the following assertions will pass?</p>
            
            <pre id="PLd0e40472" class="calibre5">function Ninja(){
  this.whoAmI = function(){
    return this;
  }.bind(this);
}

var ninja1 = new Ninja();
var ninja2 = {
  whoAmI: ninja1.whoAmI
};
//pass: the function assigned to whoAmI is a function bound
//to ninja1 (the value of this when the constructor was invoked)
//this will always refer to ninja1
assert(ninja1.whoAmI() === ninja1, "ninja1 here?");
//fail: this in whoAmI always refers to ninja1
//because whoAmI is a bound function.
assert(ninja2.whoAmI() === ninja2, "ninja2 here?");</pre>
            <p class="calibre18"></p>
      </blockquote>
      
      
      
      <h3 id="app03lev1sec4" class="calibre24"><a id="app03lev1sec4__title" class="calibre3"></a>Chapter 5. Functions for the master: closures and scopes
      </h3>
      
      <p class="calibre18"><a id="app03qa6" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa6qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa6q1" class="calibre4"></a><b class="calibre21"><a href="#app03qa6q1a1" class="calibre4 totri-footnote">1</a> </b></p><p class="noind"><a id="iddle1198" class="calibre4"></a><a id="iddle1452" class="calibre4"></a><a id="iddle1549" class="calibre4"></a><a id="iddle1580" class="calibre4"></a><a id="iddle1990" class="calibre4"></a>Closures allow functions to
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa6q1a1" class="calibre4"></a><b class="calibre21"><a href="#app03qa6q1" class="calibre4">A:</a> </b></p><p class="noind">Access external variables that are in scope when the function is defined (option a)</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa6qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa6q2" class="calibre4"></a><b class="calibre21"><a href="#app03qa6q2a2" class="calibre4 totri-footnote">2</a> </b></p><p class="noind">Closures come with</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa6q2a2" class="calibre4"></a><b class="calibre21"><a href="#app03qa6q2" class="calibre4">A:</a> </b></p><p class="noind">Memory costs (closures keep alive the variables that are in scope when the function is defined) (option b)</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa6qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa6q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">In the following code example, mark the identifiers accessed through closures:</p>
            
            <pre id="PLd0e40565" class="calibre5">function Samurai(name) {
  var weapon = "katana";

  this.getWeapon = function(){
    //accesses the local variable: weapon
    return weapon;
  };

  this.getName = function(){
    //accesses the function parameter: name
    return name;
  }

  this.message = name + " wielding a " + weapon;

  this.getMessage = function(){
    //this.message is not accessed through a closure
   //it is an object property (and not a variable)
    return this.message;
  }
}

var samurai = new Samurai("Hattori");

samurai.getWeapon();
samurai.getName();
samurai.getMessage();</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa6qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa6q4" class="calibre4"></a><b class="calibre21"><a href="#app03qa6q4a3" class="calibre4 totri-footnote">4</a> </b></p><p class="noind">In the following code, how many execution contexts are created, and what’s the largest size of the execution context stack?</p>
            
            <pre id="PLd0e40579" class="calibre5">function perfom(ninja) {
  sneak(ninja);
  infiltrate(ninja);
}

function sneak(ninja) {
  return ninja + " skulking";
}

function infiltrate(ninja) {
  return ninja + " infiltrating";
}


perfom("Kuma");</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa6q4a3" class="calibre4"></a><b class="calibre21"><a href="#app03qa6q4" class="calibre4">A:</a> </b></p><p class="noind"><a id="iddle1454" class="calibre4"></a><a id="iddle1559" class="calibre4"></a><a id="iddle1579" class="calibre4"></a><a id="iddle1597" class="calibre4"></a><a id="iddle1722" class="calibre4"></a><a id="iddle1886" class="calibre4"></a><a id="iddle1913" class="calibre4"></a>The largest stack size is 3, in the following situations:
            </p>
            
            <p class="calibre18"></p>
            <ul class="calibre19">
               
               <li class="calibre20">global code -&gt; <kbd class="calibre15">perform</kbd> -&gt; <kbd class="calibre15">sneak</kbd>
                  
               </li>
               
               <li class="calibre20">global code -&gt; <kbd class="calibre15">perform</kbd> -&gt; <kbd class="calibre15">infiltrate</kbd>
                  
               </li>
               
            </ul>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa6qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa6q5" class="calibre4"></a><b class="calibre21"><a href="#app03qa6q5a4" class="calibre4 totri-footnote">5</a> </b></p><p class="noind">Which keyword in JavaScript allows us to define variables that can’t be reassigned to a completely new value?</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa6q5a4" class="calibre4"></a><b class="calibre21"><a href="#app03qa6q5" class="calibre4">A:</a> </b></p><p class="noind"><kbd class="calibre15">const</kbd> variables can’t be reassigned to new values.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa6qe6" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa6q6" class="calibre4"></a><b class="calibre21"><a href="#app03qa6q6a5" class="calibre4 totri-footnote">6</a> </b></p><p class="noind">What’s the difference between <kbd class="calibre15">var</kbd> and <kbd class="calibre15">let</kbd>?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa6q6a5" class="calibre4"></a><b class="calibre21"><a href="#app03qa6q6" class="calibre4">A:</a> </b></p><p class="noind">The keyword <kbd class="calibre15">var</kbd> is used to define only function- or global-scoped variables, whereas <kbd class="calibre15">let</kbd> enables us to define block-scoped, function-scoped, and global-scoped variables.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa6qe7" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa6q7" class="calibre4"></a><b class="calibre21"><a href="#app03qa6q7a6" class="calibre4 totri-footnote">7</a> </b></p><p class="noind">Where and why will the following code throw an exception?</p>
            
            <pre id="PLd0e40725" class="calibre5">getNinja();
getSamurai();  //throws an exception

function getNinja() {
  return "Yoshi";
}

var getSamurai = () =&gt; "Hattori";</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa6q7a6" class="calibre4"></a><b class="calibre21"><a href="#app03qa6q7" class="calibre4">A:</a> </b></p><p class="noind">An exception will be thrown when trying to invoke the <kbd class="calibre15">getSamurai</kbd> function. The <kbd class="calibre15">getNinja</kbd> function is defined with a function declaration and will be created before any of the code is executed; we can call it “before”
               its declaration has been reached in code. The <kbd class="calibre15">getSamurai</kbd> function, on the other hand, is an arrow function that’s created when the execution reaches it, so it will be undefined when
               we try to invoke it.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      <h3 id="app03lev1sec5" class="calibre24"><a id="app03lev1sec5__title" class="calibre3"></a>Chapter 6. Functions for the future: generators and promises
      </h3>
      
      <p class="calibre18"><a id="app03qa7" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa7qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa7q1" class="calibre4"></a><b class="calibre21">1 </b></p><p class="noind">After running the following code, what are the values of variables <kbd class="calibre15">a1</kbd> to <kbd class="calibre15">a4</kbd>?
            </p>
            
            <pre id="PLd0e40769" class="calibre5">function *EvenGenerator(){
  let num = 2;
  while(true){
    yield num;
    num = num + 2;
  }
}

let generator = EvenGenerator();

//2 the first value yielded
let a1 = generator.next().value;

//4 the second value yielded
let a2 = generator.next().value;
//2, because we have started a new generator
let a3 = EvenGenerator().next().value;
//6, we go back to the first generator
let a4 = generator.next().value;</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa7qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa7q2" class="calibre4"></a><b class="calibre21"><a href="#app03qa7q2a1" class="calibre4 totri-footnote">2</a> </b></p><p class="noind"><a id="iddle1509" class="calibre4"></a><a id="iddle2192" class="calibre4"></a>What’s the content of the <kbd class="calibre15">ninjas</kbd> array after running the following code? (Hint: Think about how the <kbd class="calibre15">for-of</kbd> loop can be implemented with a <kbd class="calibre15">while</kbd> loop.)
            </p>
            
            <pre id="PLd0e40804" class="calibre5">function* NinjaGenerator(){
  yield "Yoshi";
  return "Hattori";
  yield "Hanzo";
}

var ninjas = [];
for(let ninja of NinjaGenerator()){
  ninjas.push(ninja);
}

ninjas;</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa7q2a1" class="calibre4"></a><b class="calibre21"><a href="#app03qa7q2" class="calibre4">A:</a> </b></p><p class="noind">The <kbd class="calibre15">ninjas</kbd> array will contain only <kbd class="calibre15">Yoshi</kbd>. This happens because the <kbd class="calibre15">for-of</kbd> loop iterates over a generator until the generator says it’s done (without including the value passed along with done). This
               happens either when there’s no more code in the generator to execute, or when a <kbd class="calibre15">return</kbd> statement is encountered.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa7qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa7q3" class="calibre4"></a><b class="calibre21">3 </b></p><p class="noind">What’s the value of variables <kbd class="calibre15">a1</kbd> and <kbd class="calibre15">a2</kbd>, after running the following code?
            </p>
            
            <pre id="PLd0e40841" class="calibre5">function *Gen(val){
  val = yield val * 2;
  yield val;
}

let generator = Gen(2);
//4. The value of the first value passed in through next: 3 is ignored
//because the generator hasn't yet started its execution, and there
//is no waiting yield expression.
//Because the generator is created with val being 2
//the first yield occurs for val * 2, i.e. 2*2 == 4
let a1 = generator.next(3).value;
//5: passing in 5 as a argument to next
//means that the waiting yielded expression will get the value 5
//(yield val * 2) == 5
//because that value is then assigned to val, the next yield expression
//yield val;
//will return 5
let a2 = generator.next(5).value;</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa7qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa7q4" class="calibre4"></a><b class="calibre21">4 </b></p><p class="noind"><a id="iddle1456" class="calibre4"></a><a id="iddle1813" class="calibre4"></a>What’s the output of the following code?
            </p>
            
            <pre id="PLd0e40869" class="calibre5">const promise = new Promise((resolve, reject) =&gt; {
  reject("Hattori"); //the promise was explicitly rejected
});

//the error handler will be invoked
promise.then(val =&gt; alert("Success: " + val))
       .catch(e =&gt; alert("Error: " + e));</pre>
            <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa7qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa7q5" class="calibre4"></a><b class="calibre21">5 </b></p><p class="noind">What’s the output of the following code?</p>
            
            <pre id="PLd0e40882" class="calibre5">const promise = new Promise((resolve, reject) =&gt; {
  //the promise was explicitly resolved
  resolve("Hattori");
  //once a promise has settled, it can't be changed
  //rejecting it after 500ms will have no effect
  setTimeout(()=&gt; reject("Yoshi"), 500);
});

//the success handler will be invoked
promise.then(val =&gt; alert("Success: " + val))
       .catch(e =&gt; alert("Error: " + e));</pre>
            <p class="calibre18"></p>
      </blockquote>
      
      
      
      <h3 id="app03lev1sec6" class="calibre24"><a id="app03lev1sec6__title" class="calibre3"></a>Chapter 7. Object orientation with prototypes
      </h3>
      
      <p class="calibre18"><a id="app03qa8" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa8qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa8q1" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q1a1" class="calibre4 totri-footnote">1</a> </b></p><p class="noind">Which of the following properties points to an object that will be searched if the target object doesn’t have the searched-for
               property?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa8q1a1" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q1" class="calibre4">A:</a> </b></p><p class="noind"><kbd class="calibre15">prototype</kbd> (option c)
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa8qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa8q2" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q2a2" class="calibre4 totri-footnote">2</a> </b></p><p class="noind">What’s the value of variable <kbd class="calibre15">a1</kbd> after the following code is executed?
            </p>
            
            <pre id="PLd0e40925" class="calibre5">function Ninja(){}
Ninja.prototype.talk = function (){
  return "Hello";
};

const ninja = new Ninja();
const a1 = ninja.talk(); //"Hello"</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa8q2a2" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q2" class="calibre4">A:</a> </b></p><p class="noind">The value of variable a1 will be <kbd class="calibre15">Hello</kbd>. Even though the object <kbd class="calibre15">ninja</kbd> doesn’t possess the <kbd class="calibre15">talk</kbd> method, its prototype does.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa8qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa8q3" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q3a3" class="calibre4 totri-footnote">3</a> </b></p><p class="noind">What’s the value of <kbd class="calibre15">a1</kbd> after running the following code?
            </p>
            
            
            <pre id="PLd0e40959" class="calibre5">function Ninja(){}
Ninja.message = "Hello";

const ninja = new Ninja();

const a1 = ninja.message;</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa8q3a3" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q3" class="calibre4">A:</a> </b></p><p class="noind"><a id="iddle1262" class="calibre4"></a>The value of variable <kbd class="calibre15">a1</kbd> will be undefined. The <kbd class="calibre15">message</kbd> property is defined in the constructor function <kbd class="calibre15">Ninja</kbd>, and isn’t acessible through the <kbd class="calibre15">ninja</kbd> object.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa8qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa8q4" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q4a4" class="calibre4 totri-footnote">4</a> </b></p><p class="noind">Explain the difference between the <kbd class="calibre15">getFullName</kbd> method in these two code fragments:
            </p>
            
            <pre id="PLd0e40999" class="calibre5">//First fragment
function Person(firstName, lastName){
  this.firstName = firstName;
  this.lastName = lastName;

  this.getFullName = function () {
    return this.firstName + " " + this.lastName;
  }
}

//Second fragment
function Person(firstName, lastName) {
  this.firstName = firstName;
  this.lastName = lastName;
}

Person.prototype.getFullName = function () {
  return this.firstName + " " + this.lastName;
}</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa8q4a4" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q4" class="calibre4">A:</a> </b></p><p class="noind">In the first fragment, the <kbd class="calibre15">getFullName</kbd> method is defined directly on the instance created with the <kbd class="calibre15">Person</kbd> constructor. Each object created with the <kbd class="calibre15">Person</kbd> constructor gets its own <kbd class="calibre15">getFullName</kbd> method. In the second fragment, the <kbd class="calibre15">getFullName</kbd> method is defined on the prototype of the <kbd class="calibre15">Person</kbd> function. All instances created with the <kbd class="calibre15">Person</kbd> function will have access to this single method.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa8qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa8q5" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q5a5" class="calibre4 totri-footnote">5</a> </b></p><p class="noind">After running the following code, what will <kbd class="calibre15">ninja.constructor</kbd> point to?
            </p>
            
            <pre id="PLd0e41043" class="calibre5">function Person() { }
function Ninja() { }

const ninja = new Ninja();</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa8q5a5" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q5" class="calibre4">A:</a> </b></p><p class="noind">When accessing <kbd class="calibre15">ninja.constructor</kbd>, the constructor property is found on <kbd class="calibre15">ninja</kbd>’s prototype. Because <kbd class="calibre15">ninja</kbd> was created with the <kbd class="calibre15">Ninja</kbd> constructor function, the constructor property points to the <kbd class="calibre15">Ninja</kbd> function.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa8qe6" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa8q6" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q6a6" class="calibre4 totri-footnote">6</a> </b></p><p class="noind"><a id="iddle1679" class="calibre4"></a>After running the following code, what will <kbd class="calibre15">ninja.constructor</kbd> point to?
            </p>
            
            <pre id="PLd0e41087" class="calibre5">function Person() { }
function Ninja() { }
Ninja.prototype = new Person();
const ninja = new Ninja();</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa8q6a6" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q6" class="calibre4">A:</a> </b></p><p class="noind">The <kbd class="calibre15">constructor</kbd> property is the property of the prototype object that was created with the constructor function. In this example, we override
               the built-in prototype of the <kbd class="calibre15">Ninja</kbd> function with a new <kbd class="calibre15">Person</kbd> object. Therefore, when a <kbd class="calibre15">ninja</kbd> object is created with the <kbd class="calibre15">Ninja</kbd> constructor, its prototype is set to the new <kbd class="calibre15">person</kbd> object. Finally, when we access the <kbd class="calibre15">constructor</kbd> property on the <kbd class="calibre15">ninja</kbd> object, because the <kbd class="calibre15">ninja</kbd> object doesn’t have its own <kbd class="calibre15">constructor</kbd> property, its prototype, the new <kbd class="calibre15">person</kbd> object, is consulted. The <kbd class="calibre15">person</kbd> object also doesn’t have a <kbd class="calibre15">constructor</kbd> property, so its prototype, the <kbd class="calibre15">Person.prototype</kbd> object, is consulted. That object has a <kbd class="calibre15">constructor</kbd> property, referencing the <kbd class="calibre15">Person</kbd> function. This example perfectly illustrates why we should be careful when using the <kbd class="calibre15">constructor</kbd> property: Even though our <kbd class="calibre15">ninja</kbd> object was created with the <kbd class="calibre15">Ninja</kbd> function, the <kbd class="calibre15">constructor</kbd> property, due to the hiccup of overriding the default <kbd class="calibre15">Ninja.prototype</kbd>, points to the <kbd class="calibre15">Person</kbd> function.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa8qe7" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa8q7" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q7a7" class="calibre4 totri-footnote">7</a> </b></p><p class="noind">Explain how the <kbd class="calibre15">instanceof</kbd> operator works in the following example.
            </p>
            
            <pre id="PLd0e41176" class="calibre5">function Warrior() { }

function Samurai() { }
Samurai.prototype = new Warrior();

var samurai = new Samurai();

samurai instanceof Warrior; //Explain</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa8q7a7" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q7" class="calibre4">A:</a> </b></p><p class="noind">The <kbd class="calibre15">instanceof</kbd> operator checks whether the prototype of the function on the right-hand side is in the prototype chain of the object on the
               left-hand side. The object on the left is created with the <kbd class="calibre15">Samurai</kbd> function, and its prototype has a new <kbd class="calibre15">warrior</kbd> object, whose prototype is the prototype of the <kbd class="calibre15">Warrior</kbd> function (<kbd class="calibre15">Warrior.prototype</kbd>). On the right we have the <kbd class="calibre15">Warrior</kbd> function. So in this example, the <kbd class="calibre15">instanceof</kbd> operator will return <kbd class="calibre15">true</kbd>, because the prototype of the function on the right, <kbd class="calibre15">Warrior.prototype</kbd>, can be found in the prototype chain of the object on the left.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa8qe8" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa8q8" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q8a8" class="calibre4 totri-footnote">8</a> </b></p><p class="noind">Translate the following ES6 code into ES5 code.</p>
            
            <pre id="PLd0e41223" class="calibre5"><b class="calibre21">class</b> Warrior {
  constructor(weapon){
    this.weapon = weapon;
  }

  wield() {
    return "Wielding " + this.weapon;
  }

  static duel(warrior1, warrior2){
    return warrior1.wield() + " " + warrior2.wield();
  }
}</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa8q8a8" class="calibre4"></a><b class="calibre21"><a href="#app03qa8q8" class="calibre4">A:</a> </b></p><p class="noind"><a id="iddle1025" class="calibre4"></a><a id="iddle1445" class="calibre4"></a><a id="iddle1819" class="calibre4"></a>We can translate the code in the following way:
            </p>
            
            <pre id="PLd0e41263" class="calibre5">function Warrior(weapon) {
  this.weapon = weapon;
}

Warrior.prototype.wield = function () {
  return "Wielding " + this.weapon;
};

Warrior.duel = function (warrior1, warrior2) {
  return warrior1.wield() + " " + warrior2.wield();
};</pre>
            <p class="calibre18"></p>
      </blockquote>
      
      
      
      <h3 id="app03lev1sec7" class="calibre24"><a id="app03lev1sec7__title" class="calibre3"></a>Chapter 8. Controlling access to objects
      </h3>
      
      <p class="calibre18"><a id="app03qa9" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa9qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa9q1" class="calibre4"></a><b class="calibre21"><a href="#app03qa9q1a1" class="calibre4 totri-footnote">1</a> </b></p><p class="noind">After running the following code, which of the following expressions will throw an exception and why?</p>
            
            <pre id="PLd0e41287" class="calibre5">const ninja = {
   get name() {
     return "Akiyama";
   }
}</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa9q1a1" class="calibre4"></a><b class="calibre21"><a href="#app03qa9q1" class="calibre4">A:</a> </b></p><p class="noind">Calling <kbd class="calibre15">ninja.name()</kbd> throws an exception because <kbd class="calibre15">ninja</kbd> doesn’t have a name method (option a). Accessing <kbd class="calibre15">ninja.name</kbd> in <kbd class="calibre15">const name = ninja.name</kbd> works like a charm; the getter gets activated, and the variable name gets the value <kbd class="calibre15">Akiyama</kbd>.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa9qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa9q2" class="calibre4"></a><b class="calibre21"><a href="#app03qa9q2a2" class="calibre4 totri-footnote">2</a> </b></p><p class="noind">In the following code, which mechanism allows getters to access a private object variable?</p>
            
            <pre id="PLd0e41322" class="calibre5">function Samurai() {
  const _weapon = "katana";
  Object.defineProperty(this, "weapon", {
    get: () =&gt; _weapon
  });
}
const samurai = new Samurai();
assert(samurai.weapon === "katana", "A katana wielding samurai");</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa9q2a2" class="calibre4"></a><b class="calibre21"><a href="#app03qa9q2" class="calibre4">A:</a> </b></p><p class="noind">Closures allow getters to access private object variables. In this case, the <kbd class="calibre15">get</kbd> method creates a closure around the <kbd class="calibre15">_weapon</kbd> private variable defined in the constructor function, which keeps the <kbd class="calibre15">_weapon</kbd> variable alive.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa9qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa9q3" class="calibre4"></a><b class="calibre21"><a href="#app03qa9q3a3" class="calibre4 totri-footnote">3</a> </b></p><p class="noind">Which of the following assertions will pass?</p>
            
            <pre id="PLd0e41352" class="calibre5">const daimyo = { name: "Matsu", clan: "Takasu"};
const proxy = new Proxy(daimyo, {
  get: (target, key) =&gt; {
    if(key === "clan"){
      return "Tokugawa";
    }
  }
});

assert(daimyo.clan === "Takasu", "Matsu of clan Takasu");     <b class="calibre21">//pass</b>
assert(proxy.clan === "Tokugawa", "Matsu of clan Tokugawa?"); <b class="calibre21">//pass</b>

proxy.clan = "Tokugawa";

assert(daimyo.clan === "Takasu", "Matsu of clan Takasu");     <b class="calibre21">//fail</b>
assert(proxy.clan === "Tokugawa", "Matsu of clan Tokugawa?"); <b class="calibre21">//pass</b></pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa9q3a3" class="calibre4"></a><b class="calibre21"><a href="#app03qa9q3" class="calibre4">A:</a> </b></p><p class="noind">The first assertion passes because <kbd class="calibre15">daimyo</kbd> has a <kbd class="calibre15">clan</kbd> property with value <kbd class="calibre15">Takasu</kbd>. The second assertion passes, because we access the property <kbd class="calibre15">clan</kbd> through a proxy with a get trap that always returns <kbd class="calibre15">Tokugawa</kbd> as the value of the <kbd class="calibre15">clan</kbd> property.
            </p>
            
            <p class="noind">When the expression <kbd class="calibre15">proxy.clan = "Tokugawa"</kbd> is evaluated, the value <kbd class="calibre15">Tokugawa</kbd> is stored in the <kbd class="calibre15">daimyo</kbd>’s <kbd class="calibre15">clan</kbd> property because the proxy doesn’t have a set trap, so the default action of setting the property is carried out on the target,
               <kbd class="calibre15">daimyo</kbd> object.
            </p>
            
            <p class="noind">The third assertion fails, because the <kbd class="calibre15">daimyo</kbd>’s clan property has the value <kbd class="calibre15">Tokugawa</kbd> and not <kbd class="calibre15">Takasu</kbd>.
            </p>
            
            <p class="noind">The fourth assertion passes, because the proxy always returns <kbd class="calibre15">Tokugawa</kbd>, regardless of the value stored in the target object’s <kbd class="calibre15">clan</kbd> property.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa9qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa9q4" class="calibre4"></a><b class="calibre21"><a href="#app03qa9q4a4" class="calibre4 totri-footnote">4</a> </b></p><p class="noind">Which of the following assertions will pass?</p>
            
            <pre id="PLd0e41440" class="calibre5">const daimyo = { name: "Matsu", clan: "Takasu", armySize: 10000};
const proxy = new Proxy(daimyo, {
  set: (target, key, value) =&gt; {
    if(key === "armySize") {
      const number = Number.parseInt(value);
      if(!Number.isNaN(number)){
        target[key] = number;
      }
    } else {
        target[key] = value;
    }
  },
});
//pass
assert(daimyo.armySize === 10000, "Matsu has 10 000 men at arms");
//pass
assert(proxy.armySize === 10000, "Matsu has 10 000 men at arms");

proxy.armySize = "large";
assert(daimyo.armySize === "large", "Matsu has a large army"); <b class="calibre21">//fail</b>

daimyo.armySize = "large";
assert(daimyo.armySize === "large", "Matsu has a large army");<b class="calibre21">//pass</b></pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa9q4a4" class="calibre4"></a><b class="calibre21"><a href="#app03qa9q4" class="calibre4">A:</a> </b></p><p class="noind"><a id="iddle1220" class="calibre4"></a><a id="iddle1448" class="calibre4"></a>The first assertion passes; the value of <kbd class="calibre15">daimyo</kbd>’s <kbd class="calibre15">armySize</kbd> property is <kbd class="calibre15">10000</kbd>. The second assertion also passes; the proxy doesn’t have a get trap defined so the value of the target, <kbd class="calibre15">daimyo</kbd>’s <kbd class="calibre15">armySize</kbd> property, is returned.
            </p>
            
            <p class="noind">When the expression <kbd class="calibre15">proxy.armySize = "large";</kbd> is evaluated, the proxy’s set trap is activated. The setter checks whether the passed-in value is a number, and only if it
               is, the value is assigned to the target’s property. In this case, the passed-in value isn’t a number, so no changes are made
               to the <kbd class="calibre15">armySize</kbd> property. For this reason, the third assertion, which assumes the change, fails.
            </p>
            
            <p class="noind">The expression <kbd class="calibre15">daimyo.armySize = "large";</kbd> directly writes to the <kbd class="calibre15">armySize</kbd> property, bypassing the proxy. Therefore, the final assertion passes.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      <h3 id="app03lev1sec8" class="calibre24"><a id="app03lev1sec8__title" class="calibre3"></a>Chapter 9. Dealing with collections
      </h3>
      
      <p class="calibre18"><a id="app03qa10" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa10qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa10q1" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q1a1" class="calibre4 totri-footnote">1</a> </b></p><p class="noind">After running the following code, what’s the content of the <kbd class="calibre15">samurai</kbd> array?
            </p>
            
            <pre id="PLd0e41529" class="calibre5">const samurai = ["Oda", "Tomoe"];
samurai[3] = "Hattori";</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa10q1a1" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q1" class="calibre4">A:</a> </b></p><p class="noind">The value of the <kbd class="calibre15">samurai</kbd> is <kbd class="calibre15">["Oda", "Tomoe", undefined, "Hattori"]</kbd>. The array starts with <kbd class="calibre15">Oda</kbd> and <kbd class="calibre15">Tomoe</kbd> at indexes <kbd class="calibre15">0</kbd> and <kbd class="calibre15">1</kbd>. We then add a new samurai, <kbd class="calibre15">Hattori,</kbd> at index 3, which “expands” the array, and leaves index 2 with <kbd class="calibre15">undefined</kbd>.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa10qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa10q2" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q2a2" class="calibre4 totri-footnote">2</a> </b></p><p class="noind">After running the following code, what’s the content of the <kbd class="calibre15">ninjas</kbd> array?
            </p>
            
            <pre id="PLd0e41576" class="calibre5">const ninjas = [];

ninjas.push("Yoshi");
ninjas.unshift("Hattori");

ninjas.length = 3;

ninjas.pop();</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa10q2a2" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q2" class="calibre4">A:</a> </b></p><p class="noind">The value of <kbd class="calibre15">ninjas</kbd> is [<kbd class="calibre15">"Hattori", "Yoshi"]</kbd>. We start with an empty array, <kbd class="calibre15">push</kbd> adds <kbd class="calibre15">Yoshi</kbd> to the end, and <kbd class="calibre15">unshift</kbd> adds <kbd class="calibre15">Hattori</kbd> to the beginning. Explicitly setting <kbd class="calibre15">length</kbd> to <kbd class="calibre15">3</kbd> expands the array with <kbd class="calibre15">undefined</kbd> at index <kbd class="calibre15">2</kbd>. Calling <kbd class="calibre15">pop</kbd> removes that <kbd class="calibre15">undefined</kbd> from the array, leaving only [<kbd class="calibre15">"Hattori", "Yoshi"]</kbd>.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa10qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa10q3" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q3a3" class="calibre4 totri-footnote">3</a> </b></p><p class="noind">After running the following code, what’s the content of the <kbd class="calibre15">samurai</kbd> array?
            </p>
            
            <pre id="PLd0e41639" class="calibre5">const samurai = [];

samurai.push("Oda");
samurai.unshift("Tomoe");
samurai.splice(1, 0, "Hattori", "Takeda");
samurai.pop();</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa10q3a3" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q3" class="calibre4">A:</a> </b></p><p class="noind">The value of <kbd class="calibre15">samurai</kbd> is <kbd class="calibre15">["Tomoe", "Hattori", "Takeda"]</kbd>. The array starts empty; <kbd class="calibre15">push</kbd> adds <kbd class="calibre15">Oda</kbd> to the end, and <kbd class="calibre15">unshift</kbd> adds <kbd class="calibre15">Tomoe</kbd> to the beginning; <kbd class="calibre15">splice</kbd> removes the item at index <kbd class="calibre15">1</kbd> (<kbd class="calibre15">Oda</kbd>) and adds <kbd class="calibre15">Hattori</kbd> and <kbd class="calibre15">Takeda</kbd> instead.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa10qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa10q4" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q4a4" class="calibre4 totri-footnote">4</a> </b></p><p class="noind">After running the following code, what’s stored in the variables <kbd class="calibre15">first</kbd>, <kbd class="calibre15">second</kbd>, and <kbd class="calibre15">third</kbd>?
            </p>
            
            <pre id="PLd0e41701" class="calibre5">const ninjas = [{name:"Yoshi", age: 18},
    {name:"Hattori", age: 19},
    {name:"Yagyu", age: 20}];

const first = persons.map(ninja =&gt; ninja.age);
const second = first.filter(age =&gt; age % 2 == 0);
const third = first.reduce((aggregate, item) =&gt;  aggregate + item, 0);</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa10q4a4" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q4" class="calibre4">A:</a> </b></p><p class="noind">first: [18, 19, 20]; second: [18, 20]; third: 57</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa10qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa10q5" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q5a5" class="calibre4 totri-footnote">5</a> </b></p><p class="noind">After running the following code, what’s stored in the variables <kbd class="calibre15">first</kbd> and <kbd class="calibre15">second</kbd>?
            </p>
            
            <pre id="PLd0e41727" class="calibre5">const ninjas = [{ name: "Yoshi", age: 18 },
               { name: "Hattor", age: 19 },
               { name: "Yagyu", age: 20 }];

const first = ninjas.some(ninja =&gt; ninja.age % 2 == 0);
const second = ninjas.every(ninja =&gt; ninja.age % 2 == 0);</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa10q5a5" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q5" class="calibre4">A:</a> </b></p><p class="noind">first: true; second: false</p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa10qe6" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa10q6" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q6a6" class="calibre4 totri-footnote">6</a> </b></p><p class="noind">Which of the following assertions will pass?</p>
            
            <pre id="PLd0e41747" class="calibre5">const samuraiClanMap = new Map();

const samurai1 = { name: "Toyotomi"};
const samurai2 = { name: "Takeda"};
const samurai3 = { name: "Akiyama"};

const oda = { clan: "Oda"};
const tokugawa = { clan: "Tokugawa"};
const takeda ={clan: "Takeda"};
samuraiClanMap.set(samurai1, oda);
samuraiClanMap.set(samurai2, tokugawa);
samuraiClanMap.set(samurai2, takeda);

assert(samuraiClanMap.size === 3, "There are three mappings");
assert(samuraiClanMap.has(samurai1), "The first samurai has a mapping");
assert(samuraiClanMap.has(samurai3), "The third samurai has a mapping");</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa10q6a6" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q6" class="calibre4">A:</a> </b></p><p class="noind"><a id="iddle1457" class="calibre4"></a><a id="iddle1946" class="calibre4"></a><a id="iddle1961" class="calibre4"></a>The first assertion fails, because a mapping for <kbd class="calibre15">samurai2</kbd> was created twice. The second assertion passes, because a mapping for <kbd class="calibre15">samurai1</kbd> was added. And the third assertion fails, because a mapping for <kbd class="calibre15">samurai3</kbd> was never created.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa10qe7" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa10q7" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q7a7" class="calibre4 totri-footnote">7</a> </b></p><p class="noind">Which of the following assertions will pass?</p>
            
            <pre id="PLd0e41799" class="calibre5">const samurai = new Set("Toyotomi", "Takeda", "Akiyama", "Akiyama");
assert(samurai.size === 4, "There are four samurai in the set");

samurai.add("Akiyama");
assert(samurai.size === 5, "There are five samurai in the set");

assert(samurai.has("Toyotomi", "Toyotomi is in!");
assert(samurai.has("Hattori", "Hattori is in!");</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa10q7a7" class="calibre4"></a><b class="calibre21"><a href="#app03qa10q7" class="calibre4">A:</a> </b></p><p class="noind">The first assertion fails because <kbd class="calibre15">Akiyama</kbd> is added only once to the set. The second assertion also fails, because trying to add <kbd class="calibre15">Akiyama</kbd> once more will not change the set (nor its length). The last two assertions will pass.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      <h3 id="app03lev1sec9" class="calibre24"><a id="app03lev1sec9__title" class="calibre3"></a>Chapter 10. Wrangling regular expressions
      </h3>
      
      <p class="calibre18"><a id="app03qa11" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa11qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa11q1" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q1a1" class="calibre4 totri-footnote">1</a> </b></p><p class="noind">In JavaScript, regular expressions can be created with which of the following?</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa11q1a1" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q1" class="calibre4">A:</a> </b></p><p class="noind">Regular expression literals (option a) and by using the built-in <kbd class="calibre15">RegExp</kbd> constructor (option B). Answer c is incorrect; no built-in <kbd class="calibre15">RegularExpression</kbd> constructor exists.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa11qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa11q2" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q2a2" class="calibre4 totri-footnote">2</a> </b></p><p class="noind">Which of the following is a regular expression literal?</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa11q2a2" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q2" class="calibre4">A:</a> </b></p><p class="noind">In JavaScript, a regular expression literal is enclosed in two forward slashes: <kbd class="calibre15">/test/</kbd> (option a).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa11qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa11q3" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q3a3" class="calibre4 totri-footnote">3</a> </b></p><p class="noind">Choose the correct regular expression flags.</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa11q3a3" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q3" class="calibre4">A:</a> </b></p><p class="noind">With regular expression literals, expression flags are placed after the closing forward slash: <kbd class="calibre15">/test/g</kbd> (option a). With <kbd class="calibre15">RegExp</kbd> constructors, they’re passed as a second argument: <kbd class="calibre15">new RegExp ("test", "gi");</kbd> (option c).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa11qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa11q4" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q4a4" class="calibre4 totri-footnote">4</a> </b></p><p class="noind">The regular expression <kbd class="calibre15">/def/</kbd> matches which of the following strings?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa11q4a4" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q4" class="calibre4">A:</a> </b></p><p class="noind">The regular expression <kbd class="calibre15">/def/</kbd> matches only <kbd class="calibre15">def</kbd>: <i class="calibre6">d</i> followed by <i class="calibre6">e</i>, followed by <i class="calibre6">f</i> (option b).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa11qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa11q5" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q5a5" class="calibre4 totri-footnote">5</a> </b></p><p class="noind">The regular expression <kbd class="calibre15">/[^abc]/</kbd> matches which of the following?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa11q5a5" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q5" class="calibre4">A:</a> </b></p><p class="noind"><a id="iddle1022" class="calibre4"></a><a id="iddle1447" class="calibre4"></a><a id="iddle1773" class="calibre4"></a><a id="iddle1866" class="calibre4"></a>The regular expression <kbd class="calibre15">/[^abc]/</kbd> matches one of the strings <kbd class="calibre15">d</kbd>, <kbd class="calibre15">e</kbd>, <kbd class="calibre15">f</kbd>—one character that isn’t <i class="calibre6">a</i>, <i class="calibre6">b</i>, or <i class="calibre6">c</i> (option b).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa11qe6" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa11q6" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q6a6" class="calibre4 totri-footnote">6</a> </b></p><p class="noind">Which of the following regular expressions matches the string <kbd class="calibre15">hello</kbd>?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa11q6a6" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q6" class="calibre4">A:</a> </b></p><p class="noind">Options a, b, and c match. <kbd class="calibre15">/hello/</kbd> matches only the exact string <kbd class="calibre15">hello</kbd>. <kbd class="calibre15">/hell?o/</kbd> matches either <kbd class="calibre15">hello</kbd> or <kbd class="calibre15">helo</kbd> (the second <kbd class="calibre15">l</kbd> is optional). <kbd class="calibre15">/hel*o/</kbd>, after the first <kbd class="calibre15">l</kbd>, matches any number of the letter <kbd class="calibre15">l</kbd>.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa11qe7" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa11q7" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q7a7" class="calibre4 totri-footnote">7</a> </b></p><p class="noind">The regular expression <kbd class="calibre15">/(cd)+(de)*/</kbd> matches which of the following strings?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa11q7a7" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q7" class="calibre4">A:</a> </b></p><p class="noind">Options a, c, d, and f are correct. <kbd class="calibre15">/(cd)+(de)*/</kbd> matches one or more occurrences of <kbd class="calibre15">cd</kbd> followed by any number of occurrences of <kbd class="calibre15">de</kbd>.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa11qe8" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa11q8" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q8a8" class="calibre4 totri-footnote">8</a> </b></p><p class="noind">In regular expressions, we can express alternatives with which of the following?</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa11q8a8" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q8" class="calibre4">A:</a> </b></p><p class="noind">We use the pipe character, <kbd class="calibre15">|</kbd>, to express alternatives in regular expressions (option c).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa11qe9" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa11q9" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q9a9" class="calibre4 totri-footnote">9</a> </b></p><p class="noind">In the regular expression <kbd class="calibre15">/([0-9])2/</kbd>, we can reference the first matched digit with which of the following?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa11q9a9" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q9" class="calibre4">A:</a> </b></p><p class="noind"><kbd class="calibre15">\1</kbd> (option d)
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa11qe10" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa11q10" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q10a10" class="calibre4">10</a> </b></p><p class="noind">The regular expression <kbd class="calibre15">/([0-5])6\1/</kbd> will match which of the following?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa11q10a10" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q10" class="calibre4">A:</a> </b></p><p class="noind">In the regular expression <kbd class="calibre15">/([0-5])6\1/</kbd>, the first character is a digit from 0–5, the second character is the digit 6, and the third character is the first matched
               digit, so both <kbd class="calibre15">060</kbd> and <kbd class="calibre15">565</kbd> match (options a and d).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa11qe11" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa11q11" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q11a11" class="calibre4">11</a> </b></p><p class="noind">The regular expression <kbd class="calibre15">/(?:ninja)-(trick)?-\1/</kbd> will match which of the following?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa11q11a11" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q11" class="calibre4">A:</a> </b></p><p class="noind">In the regular expression <kbd class="calibre15">/(?:ninja)-(trick)?-\1/</kbd>, the first group <kbd class="calibre15">(?:ninja)</kbd> is a noncapturing one, whereas the second group is a capturing one, which is optional <kbd class="calibre15">(trick)?</kbd>. But if this second group is found, in the end we have a backreference to it. Therefore, <kbd class="calibre15">ninja-</kbd> and <kbd class="calibre15">ninja-trick-trick</kbd> match (options a and c).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa11qe12" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa11q12" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q12a12" class="calibre4">12</a> </b></p><p class="noind">What is the result of executing <kbd class="calibre15">"012675".replace(/0-5/g, "a")</kbd>?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa11q12a12" class="calibre4"></a><b class="calibre21"><a href="#app03qa11q12" class="calibre4">A:</a> </b></p><p class="noind">The code replaces all occurrences of digits from 0 to 5 with the letter a, so <kbd class="calibre15">aaa67a</kbd> results (option a).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      <h3 id="app03lev1sec10" class="calibre24"><a id="app03lev1sec10__title" class="calibre3"></a>Chapter 11. Code modularization techniques
      </h3>
      
      <p class="calibre18"><a id="app03qa12" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa12qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa12q1" class="calibre4"></a><b class="calibre21"><a href="#app03qa12q1a1" class="calibre4 totri-footnote">1</a> </b></p><p class="noind">Which mechanism enables private module variables in the module pattern?</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa12q1a1" class="calibre4"></a><b class="calibre21"><a href="#app03qa12q1" class="calibre4">A:</a> </b></p><p class="noind">In the module pattern, closures allow us to hide module internals: The methods of the module’s public API keep the module
               internals alive (option b).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa12qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa12q2" class="calibre4"></a><b class="calibre21"><a href="#app03qa12q2a2" class="calibre4 totri-footnote">2</a> </b></p><p class="noind">In the following code that uses ES6 modules, which identifiers can be accessed if the module is imported?</p>
            
            <pre id="PLd0e42200" class="calibre5">const spy = "Yagyu";
function command(){
  return general + " commands you to wage war!";
}
export const general = "Minamoto";</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa12q2a2" class="calibre4"></a><b class="calibre21"><a href="#app03qa12q2" class="calibre4">A:</a> </b></p><p class="noind"><a id="iddle1350" class="calibre4"></a><a id="iddle1450" class="calibre4"></a>From outside the module, we can access only the <kbd class="calibre15">general</kbd> identifier, because it’s the only identifier that has been explicitly exported (option c).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa12qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa12q3" class="calibre4"></a><b class="calibre21"><a href="#app03qa12q3a3" class="calibre4 totri-footnote">3</a> </b></p><p class="noind">In the following code that uses ES6 modules, which identifiers can be accessed when the module is imported?</p>
            
            <pre id="PLd0e42240" class="calibre5">const ninja = "Yagyu";
function command(){
  return general + " commands you to wage war!";
}
const general  = "Minamoto";

export {ninja as spy};</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa12q3a3" class="calibre4"></a><b class="calibre21"><a href="#app03qa12q3" class="calibre4">A:</a> </b></p><p class="noind">From outside the module, we can access only the <kbd class="calibre15">spy</kbd> identifier: This is the only identifier that has been exported as an alias of the <kbd class="calibre15">ninja</kbd> variable (option a).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa12qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa12q4" class="calibre4"></a><b class="calibre21"><a href="#app03qa12q4a4" class="calibre4 totri-footnote">4</a> </b></p><p class="noind">Which of the following imports are allowed?</p>
            
            <pre id="PLd0e42266" class="calibre5">//File: personnel.js
const ninja = "Yagyu";
function command(){
  return general + " commands you to wage war!";
}
const general  = "Minamoto";

export {ninja as spy};</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa12q4a4" class="calibre4"></a><b class="calibre21"><a href="#app03qa12q4" class="calibre4">A:</a> </b></p><p class="noind">The first import isn’t allowed because the <kbd class="calibre15">personnel</kbd> module doesn’t export <kbd class="calibre15">ninja</kbd> and <kbd class="calibre15">general</kbd> identifiers (option a). The second import is allowed because we import the whole module, which is accessible through the
               object <kbd class="calibre15">Personnel</kbd> (option b). The third import is also allowed, because we import the exported <kbd class="calibre15">spy</kbd> identifier (option c).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa12qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa12q5" class="calibre4"></a><b class="calibre21"><a href="#app03qa12q5a5" class="calibre4 totri-footnote">5</a> </b></p><p class="noind">If we have the following module code, which statement will import the <kbd class="calibre15">Ninja</kbd> class?
            </p>
            
            <pre id="PLd0e42304" class="calibre5">//Ninja.js
export default class Ninja {
  skulk(){ return "skulking"; }
}</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa12q5a5" class="calibre4"></a><b class="calibre21"><a href="#app03qa12q5" class="calibre4">A:</a> </b></p><p class="noind">The first import is allowed: We import the default export (option a). The second import is allowed: We import the whole module
               (option b). The third import isn’t allowed because it isn’t syntactically correct (after the <kbd class="calibre15">*</kbd> should come the “as Name” part) (option c).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      <h3 id="app03lev1sec11" class="calibre24"><a id="app03lev1sec11__title" class="calibre3"></a>Chapter 12. Working the DOM
      </h3>
      
      <p class="calibre18"><a id="app03qa13" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa13qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa13q1" class="calibre4"></a><b class="calibre21"><a href="#app03qa13q1a1" class="calibre4 totri-footnote">1</a> </b></p><p class="noind">In the following code, which of the following assertions will pass?</p>
            
            <pre id="PLd0e42337" class="calibre5">&lt;div id="samurai"&gt;&lt;/div&gt;
&lt;script&gt;
  const element = document.querySelector("#samurai");
  assert(element.id === "samurai", "property id is samurai");
  assert(element.getAttribute("id") === "samurai",
         "attribute id is samurai");

  element.id = "newSamurai";

  assert(element.id === "newSamurai", "property id is newSamurai");
  assert(element.getAttribute("id") === "newSamurai",
         "attribute id is newSamurai");
&lt;/script&gt;</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa13q1a1" class="calibre4"></a><b class="calibre21"><a href="#app03qa13q1" class="calibre4">A:</a> </b></p><p class="noind"><a id="iddle1128" class="calibre4"></a><a id="iddle1430" class="calibre4"></a><a id="iddle1451" class="calibre4"></a><a id="iddle1612" class="calibre4"></a><a id="iddle1650" class="calibre4"></a>In this code, all assertions pass. The <kbd class="calibre15">id</kbd> attribute and the <kbd class="calibre15">id</kbd> property are linked; a change to one of them is reflected in the other.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa13qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa13q2" class="calibre4"></a><b class="calibre21"><a href="#app03qa13q2a2" class="calibre4 totri-footnote">2</a> </b></p><p class="noind">Given the following code, how can we access the element’s <kbd class="calibre15">border-width</kbd> style property?
            </p>
            
            <pre id="PLd0e42399" class="calibre5">&lt;div id="element" style="border-width: 1px;
                         border-style:solid; border-color: red"&gt;
&lt;/div&gt;
&lt;script&gt;
  const element = document.querySelector("#element");
&lt;/script&gt;</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa13q2a2" class="calibre4"></a><b class="calibre21"><a href="#app03qa13q2" class="calibre4">A:</a> </b></p><p class="noind">The <kbd class="calibre15">element.border-width expression</kbd> doesn’t make much sense. It calculates the difference between <kbd class="calibre15">element.border</kbd> and a variable <kbd class="calibre15">width</kbd>, which definitely isn’t something we want. The next option, <kbd class="calibre15">element.getAttribute ("border-width");</kbd>, fetches the attribute of the HTML element, and not the style property. Finally, the last two options give the value of <kbd class="calibre15">1px</kbd> (options c and d).
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa13qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa13q3" class="calibre4"></a><b class="calibre21"><a href="#app03qa13q3a3" class="calibre4 totri-footnote">3</a> </b></p><p class="noind">Which built-in method can get all styles applied to a certain element (styles provided by the browser, styles applied via
               style sheets, and properties set through the style attribute)?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa13q3a3" class="calibre4"></a><b class="calibre21"><a href="#app03qa13q3" class="calibre4">A:</a> </b></p><p class="noind">Only the last option, <kbd class="calibre15">getComputedStyle</kbd>, is a built-in method that can be used to get the computed style of a certain HTML element (option c). The other three methods
               aren’t included in the standard API.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa13qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa13q4" class="calibre4"></a><b class="calibre21"><a href="#app03qa13q4a4" class="calibre4 totri-footnote">4</a> </b></p><p class="noind">When does layout trashing occur?</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa13q4a4" class="calibre4"></a><b class="calibre21"><a href="#app03qa13q4" class="calibre4">A:</a> </b></p><p class="noind">Layout trashing occurs when our code performs a series of consecutive reads and writes to DOM, each time forcing the browser
               to recalculate the layout information. This leads to slower, less responsive web applications.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      <h3 id="app03lev1sec12" class="calibre24"><a id="app03lev1sec12__title" class="calibre3"></a>Chapter 13. Surviving events
      </h3>
      
      <p class="calibre18"><a id="app03qa14" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa14qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa14q1" class="calibre4"></a><b class="calibre21"><a href="#app03qa14q1a1" class="calibre4 totri-footnote">1</a> </b></p><p class="noind">Why is it important that adding tasks into the task queue happens outside the event loop?</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa14q1a1" class="calibre4"></a><b class="calibre21"><a href="#app03qa14q1" class="calibre4">A:</a> </b></p><p class="noind">If the process of adding tasks into the task queue were part of the event loop, any events that occur while JavaScript code
               is being executed would be ignored. This would definitely be a bad idea.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa14qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa14q2" class="calibre4"></a><b class="calibre21"><a href="#app03qa14q2a2" class="calibre4 totri-footnote">2</a> </b></p><p class="noind"><a id="iddle2024" class="calibre4"></a><a id="iddle2037" class="calibre4"></a>Why is it important that each iteration of the event loop doesn’t take much more than about 16 ms?
            </p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa14q2a2" class="calibre4"></a><b class="calibre21"><a href="#app03qa14q2" class="calibre4">A:</a> </b></p><p class="noind">To achieve smooth-running applications, the browser tries to perform rendering around 60 times per second. Because rendering
               is performed at the end of the event loop, each iteration shouldn’t last much longer than 16 ms, unless we want to create
               slow and jagged applications.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa14qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa14q3" class="calibre4"></a><b class="calibre21"><a href="#app03qa14q3a3" class="calibre4 totri-footnote">3</a> </b></p><p class="noind">What’s the output from running the following code for 2 seconds?</p>
            
            <pre id="PLd0e42514" class="calibre5">setTimeout(function(){
  console.log("Timeout ");
}, 1000);

setInterval(function(){
  console.log("Interval ");
}, 500);</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa14q3a3" class="calibre4"></a><b class="calibre21"><a href="#app03qa14q3" class="calibre4">A:</a> </b></p><p class="noind"><kbd class="calibre15">Interval Timeout Interval Interval Interval</kbd> (option b). The <kbd class="calibre15">setInterval</kbd> method calls the handler with at least the fixed delay between each call, until the interval is explicitly cleared. The <kbd class="calibre15">setTimeout</kbd> method, on the other hand, calls the callback only once, after the specified delay has elapsed. In this example, first the
               <kbd class="calibre15">setInterval</kbd> callback is fired once after 500 ms. Then the <kbd class="calibre15">setTimeout</kbd> callback is invoked after 1000 ms, and another <kbd class="calibre15">setInterval</kbd> immediately after. Our examination stops with two more <kbd class="calibre15">setInterval</kbd> callback invocations, one at 1500 ms, and the other at 2000 ms.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa14qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa14q4" class="calibre4"></a><b class="calibre21"><a href="#app03qa14q4a4" class="calibre4 totri-footnote">4</a> </b></p><p class="noind">What’s the output from running the following code for 2 seconds?</p>
            
            <pre id="PLd0e42554" class="calibre5">const timeoutId = setTimeout(function(){
  console.log("Timeout ");
}, 1000);

setInterval(function(){
  console.log("Interval ");
}, 500);

clearTimeout(timeoutId);</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa14q4a4" class="calibre4"></a><b class="calibre21"><a href="#app03qa14q4" class="calibre4">A:</a> </b></p><p class="noind"><kbd class="calibre15">Interval Interval Interval Interval</kbd> (option c). The <kbd class="calibre15">setTimeout</kbd> callback is cleared before it has the chance to fire, so in this case we have only four executions of the <kbd class="calibre15">setInterval</kbd> callback.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa14qe5" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa14q5" class="calibre4"></a><b class="calibre21"><a href="#app03qa14q5a5" class="calibre4 totri-footnote">5</a> </b></p><p class="noind">What’s the output from running the following code and clicking the element with the ID <kbd class="calibre15">inner</kbd>?
            </p>
            
            <pre id="PLd0e42585" class="calibre5">&lt;body&gt;
  &lt;div id="outer"&gt;
    &lt;div id="inner"&gt;&lt;/div&gt;
  &lt;/div&gt;
  &lt;script&gt;
    const innerElement = document.querySelector("#inner");
    const outerElement = document.querySelector("#outer");
    const bodyElement = document.querySelector("body");
    innerElement.addEventListener("click", function(){
      console.log("Inner");
    });

    outerElement.addEventListener("click", function(){
      console.log("Outer");
    }, true);

    bodyElement.addEventListener("click", function(){
      console.log("Body");
    });
  &lt;script&gt;
&lt;/body&gt;</pre>
            <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa14q5a5" class="calibre4"></a><b class="calibre21"><a href="#app03qa14q5" class="calibre4">A:</a> </b></p><p class="noind"><a id="iddle1137" class="calibre4"></a><a id="iddle1161" class="calibre4"></a><a id="iddle1449" class="calibre4"></a><kbd class="calibre15">Outer Inner Body</kbd> (option c). The click handlers on the <kbd class="calibre15">innerElement</kbd> and the <kbd class="calibre15">bodyElement</kbd> are registered in bubbling mode, whereas the click handler on the <kbd class="calibre15">outerElement</kbd> is registered in capturing mode. When processing the event, the event first trickles down from the top and calls all event
               handlers in capturing mode. The first message will be <kbd class="calibre15">Outer</kbd>. After the event target is reached, in our case the element with ID <kbd class="calibre15">inner</kbd>, the event bubbling takes place, and the event bubbles up. Therefore, the second message will be <kbd class="calibre15">Inner</kbd>, and the third one will be <kbd class="calibre15">Body</kbd>.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      
      <h3 id="app03lev1sec13" class="calibre24"><a id="app03lev1sec13__title" class="calibre3"></a>Chapter 14. Developing cross-browser strategies
      </h3>
      
      <p class="calibre18"><a id="app03qa15" class="calibre4"></a></p>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa15qe1" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa15q1" class="calibre4"></a><b class="calibre21"><a href="#app03qa15q1a1" class="calibre4 totri-footnote">1</a> </b></p><p class="noind">What should we take into account when deciding which browsers to support?</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa15q1a1" class="calibre4"></a><b class="calibre21"><a href="#app03qa15q1" class="calibre4">A:</a> </b></p><p class="noind">When deciding which browsers to support, we should at least take into account the following:</p>
            
            <p class="calibre18"></p>
            <ul class="calibre19">
               
               <li class="calibre20">The expectations and needs of the target audience
                  
               </li>
               
               <li class="calibre20">The market share of the browser
                  
               </li>
               
               <li class="calibre20">The amount of effort necessary to support the browser
                  
               </li>
               
            </ul>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa15qe2" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa15q2" class="calibre4"></a><b class="calibre21"><a href="#app03qa15q2a2" class="calibre4 totri-footnote">2</a> </b></p><p class="noind">Explain the problem of greedy IDs.</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa15q2a2" class="calibre4"></a><b class="calibre21"><a href="#app03qa15q2" class="calibre4">A:</a> </b></p><p class="noind">When working with form elements, the browser adds properties to the form element for each descendent element with an ID, so
               that we can access these elements easily through the form element. Unfortunately, this can override some of the built-in form
               properties such as <kbd class="calibre15">action</kbd> or <kbd class="calibre15">submit</kbd>.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa15qe3" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa15q3" class="calibre4"></a><b class="calibre21"><a href="#app03qa15q3a3" class="calibre4 totri-footnote">3</a> </b></p><p class="noind">What is feature detection?</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa15q3a3" class="calibre4"></a><b class="calibre21"><a href="#app03qa15q3" class="calibre4">A:</a> </b></p><p class="noind">Feature detection works by determining whether a certain object or object property exists, and if so, assumes that it provides
               the implied functionality. Instead of testing whether the user is using a particular browser and then implementing work-arounds
               based on that information, we test whether a certain feature works as it’s supposed to.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      <blockquote class="calibre14">
         <p class="calibre18"><a id="app03qa15qe4" class="calibre4"></a></p>
         <p class="calibre18"><a id="app03qa15q4" class="calibre4"></a><b class="calibre21"><a href="#app03qa15q4a4" class="calibre4 totri-footnote">4</a> </b></p><p class="noind">What is a browser polyfill?</p>
         <p class="calibre18"></p>
         <p class="calibre18"><a id="app03qa15q4a4" class="calibre4"></a><b class="calibre21"><a href="#app03qa15q4" class="calibre4">A:</a> </b></p><p class="noind">If we want to use a certain functionality that’s not supported by all targeted browsers, we can use feature detection. If
               a current browser doesn’t support a certain functionality, we provide our own implementation, and this is called polyfilling.
            </p>
         <p class="calibre18"></p>
      </blockquote>
      
      
      <h2 id="MainIndex" class="part">Index</h2>
      <p class="calibre18"><small class="calibre23">[<a href="#MainIndexSYMBOL" class="calibre4">SYMBOL</a>][<a href="#MainIndexA" class="calibre4 totri-footnote">A</a>][<a href="#MainIndexB" class="calibre4 totri-footnote">B</a>][<a href="#MainIndexC" class="calibre4 totri-footnote">C</a>][<a href="#MainIndexD" class="calibre4 totri-footnote">D</a>][<a href="#MainIndexE" class="calibre4 totri-footnote">E</a>][<a href="#MainIndexF" class="calibre4 totri-footnote">F</a>][<a href="#MainIndexG" class="calibre4 totri-footnote">G</a>][<a href="#MainIndexH" class="calibre4 totri-footnote">H</a>][<a href="#MainIndexI" class="calibre4 totri-footnote">I</a>][<a href="#MainIndexJ" class="calibre4 totri-footnote">J</a>][<a href="#MainIndexK" class="calibre4 totri-footnote">K</a>][<a href="#MainIndexL" class="calibre4 totri-footnote">L</a>][<a href="#MainIndexM" class="calibre4 totri-footnote">M</a>][<a href="#MainIndexN" class="calibre4 totri-footnote">N</a>][<a href="#MainIndexO" class="calibre4 totri-footnote">O</a>][<a href="#MainIndexP" class="calibre4 totri-footnote">P</a>][<a href="#MainIndexQ" class="calibre4 totri-footnote">Q</a>][<a href="#MainIndexR" class="calibre4 totri-footnote">R</a>][<a href="#MainIndexS" class="calibre4 totri-footnote">S</a>][<a href="#MainIndexT" class="calibre4 totri-footnote">T</a>][<a href="#MainIndexU" class="calibre4 totri-footnote">U</a>][<a href="#MainIndexV" class="calibre4 totri-footnote">V</a>][<a href="#MainIndexW" class="calibre4 totri-footnote">W</a>][<a href="#MainIndexX" class="calibre4 totri-footnote">X</a>][<a href="#MainIndexY" class="calibre4 totri-footnote">Y</a>][<a href="#MainIndexZ" class="calibre4 totri-footnote">Z</a>]</small></p>
      <h4 id="MainIndexSYMBOL" class="calibre26">SYMBOL</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1001" class="calibre4"></a><a href="kindle_split_028.html#iddle1001" class="calibre4">` character</a>
               <a id="see_iddle1002" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1002" class="calibre4">^ character</a>
               <a id="see_iddle1003" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1003" class="calibre4">! character</a>
               <a id="see_iddle1004" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1004" class="calibre4">? character</a>
               <a id="see_iddle1005" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1005" class="calibre4">. character</a><a id="see_iddle1006" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1006" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1007" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1007" class="calibre4">() operator</a>
               <a id="see_iddle1008" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1008" class="calibre4">* character</a><a id="see_iddle1009" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1009" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1010" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1010" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1011" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1011" class="calibre4">\ character</a><a id="see_iddle1012" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1012" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1013" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1013" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1014" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle1014" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle1015" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1015" class="calibre4">+ operator</a><a id="see_iddle1016" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1016" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1017" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1017" class="calibre4">&lt; operator</a>
               <a id="see_iddle1018" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1018" class="calibre4">=&gt; operator</a>
               <a id="see_iddle1019" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1019" class="calibre4">&gt; operator</a>
               <a id="see_iddle1020" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1020" class="calibre4">&gt;&gt;&gt; operator</a>
               <a id="see_iddle1021" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1021" class="calibre4">| character</a><a id="see_iddle1022" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle1022" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1023" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1023" class="calibre4">$ character</a>
               <a id="see_iddle1024" class="calibre4"></a><br class="calibre13"><a href="kindle_split_028.html#iddle1024" class="calibre4">${} syntax</a>
               </small></kbd></p>
      <h4 id="MainIndexA" class="calibre26">A</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><br class="calibre13"><br class="calibre13">access to objects, controlling<a id="see_iddle1025" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1025" class="calibre4">exercise answers</a><a id="see_iddle1026" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1026" class="calibre4">overview</a><a id="see_iddle1027" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1027" class="calibre4">properties, access to with getters and setters</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1028" class="calibre4">defining getters and setters</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1029" class="calibre4">using getters and setters to define computed properties</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1030" class="calibre4">using getters and setters to validate property values</a><a id="see_iddle1031" class="calibre4"></a><br class="calibre13">  using proxies<br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1031" class="calibre4">for logging</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1032" class="calibre4">for measuring performance</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1033" class="calibre4">overview</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1034" class="calibre4">performance costs</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1035" class="calibre4">to autopopulate properties</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1036" class="calibre4">to implement negative array indexes</a>
               
               
               
               
               
               
               
               
               
               
               
               <a id="see_iddle1037" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1037" class="calibre4">accessor method</a>
               <a id="see_iddle1038" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1038" class="calibre4">action attribute</a>
               <a id="see_iddle1039" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1039" class="calibre4">Add Conditional Breakpoint option</a>
               <a id="see_iddle1040" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1040" class="calibre4">addEventListener method</a><a id="see_iddle1041" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle1041" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1042" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle1042" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1043" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle1043" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1044" class="calibre4"></a>,&nbsp;<a href="kindle_split_027.html#iddle1044" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1045" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle1045" class="calibre4">6<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               
               <a id="see_iddle1046" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1046" class="calibre4">advanced array methods</a>
               <a id="see_iddle1047" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1047" class="calibre4">aggregating array items</a>
               <a id="see_iddle1048" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1048" class="calibre4">alert() method</a>
               <br class="calibre13"><br class="calibre13">aliases<a id="see_iddle1049" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1049" class="calibre4">arguments object as alias to function parameters</a><a id="see_iddle1050" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1050" class="calibre4">avoiding</a>
               
               <a id="see_iddle1051" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1051" class="calibre4">amalgam properties</a>
               <a id="see_iddle1052" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1052" class="calibre4">AMD (Asynchronous Module Definition)</a>
               <a id="see_iddle1053" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1053" class="calibre4">anonymous functions</a>
               <a id="see_iddle1054" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1054" class="calibre4">anti-feature</a>
               <a id="see_iddle1055" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1055" class="calibre4">Apache Cordova</a>
               <br class="calibre13"><br class="calibre13">APIs<a id="see_iddle1056" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1056" class="calibre4">incongruous</a><a id="see_iddle1057" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1057" class="calibre4">testing performance</a>
               
               <a id="see_iddle1058" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1058" class="calibre4">applications, for embedded devices</a>
               <a id="see_iddle1059" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle1059" class="calibre4">apply trap</a><a id="see_iddle1060" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1060" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <br class="calibre13"><br class="calibre13">apply() method<a id="see_iddle1061" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1061" class="calibre4">forcing function context in callbacks</a><a id="see_iddle1062" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1062" class="calibre4">invoking functions with</a>
               
               <br class="calibre13"><br class="calibre13">arguments<a id="see_iddle1063" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1063" class="calibre4">function parameters and</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1064" class="calibre4">default parameters and</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1065" class="calibre4">rest parameters and</a><a id="see_iddle1066" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1066" class="calibre4">overview</a><a id="see_iddle1067" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1067" class="calibre4">slicing</a>
               
               
               
               
               <a id="see_iddle1068" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1068" class="calibre4">arguments parameter</a><a id="see_iddle1069" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1069" class="calibre4">as alias to function parameters</a><a id="see_iddle1070" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1070" class="calibre4">avoiding aliases</a><a id="see_iddle1071" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1071" class="calibre4">overview</a>
               
               
               
               <a id="see_iddle1072" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1072" class="calibre4">arguments.length property</a>
               <a id="see_iddle1073" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1073" class="calibre4">array literals</a>
               <a id="see_iddle1074" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1074" class="calibre4">Array object</a><a id="see_iddle1075" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1075" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1076" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1076" class="calibre4">Array.prototype.find method</a>
               <a id="see_iddle1077" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1077" class="calibre4">Array.prototype.push() method</a>
               <a id="see_iddle1078" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1078" class="calibre4">arrays</a><a id="see_iddle1079" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1079" class="calibre4">adding and removing items at any array location</a><a id="see_iddle1080" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1080" class="calibre4">adding and removing items at either end of</a><a id="see_iddle1081" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1081" class="calibre4">aggregating array items</a><a id="see_iddle1082" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1082" class="calibre4">creating</a><a id="see_iddle1083" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1083" class="calibre4">iterating over</a><a id="see_iddle1084" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1084" class="calibre4">mapping</a><a id="see_iddle1085" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1085" class="calibre4">reusing built-in array functions</a><a id="see_iddle1086" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1086" class="calibre4">searching</a><a id="see_iddle1087" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1087" class="calibre4">sorting</a><a id="see_iddle1088" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1088" class="calibre4">2<sup class="calibre31">nd</sup></a><a id="see_iddle1089" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1089" class="calibre4">testing array items</a>
               
               
               
               
               
               
               
               
               
               
               
               <a id="see_iddle1090" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1090" class="calibre4">arrow functions</a><a id="see_iddle1091" class="calibre4"></a>,&nbsp;<a href="kindle_split_014.html#iddle1091" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1092" class="calibre4"></a>,&nbsp;<a href="kindle_split_014.html#iddle1092" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1093" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1093" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1094" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1094" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1095" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1095" class="calibre4">6<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               
               <a id="see_iddle1096" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1096" class="calibre4">as keyword</a>
               <a id="see_iddle1097" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1097" class="calibre4">assert() method</a><a id="see_iddle1098" class="calibre4"></a>,&nbsp;<a href="kindle_split_014.html#iddle1098" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1099" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1099" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1100" class="calibre4"></a>,&nbsp;<a href="kindle_split_029.html#iddle1100" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle1101" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1101" class="calibre4">assertion method, testing code</a>
               <a id="see_iddle1102" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1102" class="calibre4">assumptions, cross-browser strategies</a>
               <a id="see_iddle1103" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1103" class="calibre4">asterisk character</a>
               <a id="see_iddle1104" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1104" class="calibre4">async function</a>
               <a id="see_iddle1105" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1105" class="calibre4">asynchronous events</a>
               <a id="see_iddle1106" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1106" class="calibre4">asynchronous handling</a>
               <a id="see_iddle1107" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1107" class="calibre4">Asynchronous Module Definition</a>. <br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<i class="calibre6">See</i> AMD.
               <a id="see_iddle1108" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1108" class="calibre4">attachEvent method</a>
               <a id="see_iddle1109" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1109" class="calibre4">attributes, DOM</a>
               <a id="see_iddle1110" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1110" class="calibre4">augmenting modules</a>
               <br class="calibre13"><br class="calibre13">autopopulating properties<a id="see_iddle1111" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1111" class="calibre4">overview</a><a id="see_iddle1112" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1112" class="calibre4">2<sup class="calibre31">nd</sup></a><a id="see_iddle1113" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1113" class="calibre4">using proxies for</a>
               
               
               <a id="see_iddle1114" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1114" class="calibre4">await keyword</a>
               </small></kbd></p>
      <h4 id="MainIndexB" class="calibre26">B</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1115" class="calibre4"></a><a href="kindle_split_011.html#iddle1115" class="calibre4">Babel</a>
               <a id="see_iddle1116" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1116" class="calibre4">backslash character</a>
               <a id="see_iddle1117" class="calibre4"></a><br class="calibre13"><a href="kindle_split_028.html#iddle1117" class="calibre4">backticks</a>
               <a id="see_iddle1118" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1118" class="calibre4">best practices</a><a id="see_iddle1119" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1119" class="calibre4">debugging</a><a id="see_iddle1120" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1120" class="calibre4">performance analysis</a><a id="see_iddle1121" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1121" class="calibre4">testing</a>
               
               
               
               <br class="calibre13"><br class="calibre13">bind() method<a id="see_iddle1122" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1122" class="calibre4">fixing problem of function contexts with</a><a id="see_iddle1123" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1123" class="calibre4">overview</a>
               
               <a id="see_iddle1124" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1124" class="calibre4">block-scoped variables, using let and const keywords to specify</a>
               <a id="see_iddle1125" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1125" class="calibre4">Boolean property</a>
               <a id="see_iddle1126" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1126" class="calibre4">border-properties</a>
               <a id="see_iddle1127" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1127" class="calibre4">borderWidth property</a><a id="see_iddle1128" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle1128" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <br class="calibre13"><br class="calibre13">breakpoints<a id="see_iddle1129" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle1129" class="calibre4">conditional</a><a id="see_iddle1130" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle1130" class="calibre4">defined</a>
               
               <br class="calibre13"><br class="calibre13">browser<a id="see_iddle1131" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1131" class="calibre4">APIs</a><a id="see_iddle1132" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle1132" class="calibre4">2<sup class="calibre31">nd</sup></a><a id="see_iddle1133" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1133" class="calibre4">bug fixes</a><a id="see_iddle1134" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1134" class="calibre4">compatibility</a><a id="see_iddle1135" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1135" class="calibre4">overview</a>. <br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<i class="calibre6">See also</i> untestable browser issues.
               
               
               
               
               <a id="see_iddle1136" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1136" class="calibre4">browser events</a>
               <a id="see_iddle1137" class="calibre4"></a><br class="calibre13"><a href="kindle_split_030.html#iddle1137" class="calibre4">bubbling mode</a>
               <a id="see_iddle1138" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1138" class="calibre4">bubbling phase</a>
               <a id="see_iddle1139" class="calibre4"></a><br class="calibre13"><a href="kindle_split_030.html#iddle1139" class="calibre4">building page at runtime, exercise answers</a>
               <a id="see_iddle1140" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1140" class="calibre4">built-in array functions, reusing</a>
               <a id="see_iddle1141" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1141" class="calibre4">&lt;button&gt; element</a>
               <a id="see_iddle1142" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1142" class="calibre4">button object</a><a id="see_iddle1143" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1143" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1144" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1144" class="calibre4">button.click() method</a>
               </small></kbd></p>
      <h4 id="MainIndexC" class="calibre26">C</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1145" class="calibre4"></a><a href="kindle_split_016.html#iddle1145" class="calibre4">call stack</a><a id="see_iddle1146" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1146" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1147" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1147" class="calibre4">call() method</a><a id="see_iddle1148" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1148" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1149" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1149" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1150" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1150" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <br class="calibre13"><br class="calibre13">callback functions<a id="see_iddle1151" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1151" class="calibre4">overview</a><a id="see_iddle1152" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1152" class="calibre4">sorting with comparator</a>
               
               <a id="see_iddle1153" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1153" class="calibre4">callback parameter</a>
               <br class="calibre13"><br class="calibre13">callbacks<a id="see_iddle1154" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1154" class="calibre4">concept of</a><a id="see_iddle1155" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1155" class="calibre4">forcing function context in</a><a id="see_iddle1156" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1156" class="calibre4">overview</a><a id="see_iddle1157" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1157" class="calibre4">problems with</a><a id="see_iddle1158" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1158" class="calibre4">using closures with</a>
               
               
               
               
               <a id="see_iddle1159" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1159" class="calibre4">captures</a>
               <a id="see_iddle1160" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1160" class="calibre4">capturing phase</a><a id="see_iddle1161" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle1161" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1162" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1162" class="calibre4">caret character</a>
               <a id="see_iddle1163" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1163" class="calibre4">Cascading Style Sheets</a>. <br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<i class="calibre6">See</i> CSS.
               <a id="see_iddle1164" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1164" class="calibre4">catch block</a><a id="see_iddle1165" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1165" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1166" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1166" class="calibre4">catch method</a><a id="see_iddle1167" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1167" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1168" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1168" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1169" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1169" class="calibre4">catch statement</a>
               <a id="see_iddle1170" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1170" class="calibre4">chaining promises</a>
               <a id="see_iddle1171" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1171" class="calibre4">character class operator</a>
               <a id="see_iddle1172" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1172" class="calibre4">check function</a>
               <a id="see_iddle1173" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1173" class="calibre4">childless elements</a>
               <a id="see_iddle1174" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1174" class="calibre4">Chrome DevTools</a><a id="see_iddle1175" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1175" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1176" class="calibre4"></a>,&nbsp;<a href="kindle_split_029.html#iddle1176" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1177" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1177" class="calibre4">class keyword</a><a id="see_iddle1178" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle1178" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1179" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1179" class="calibre4">classes, using in ES6</a><a id="see_iddle1180" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1180" class="calibre4">implementing inheritance</a><a id="see_iddle1181" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1181" class="calibre4">using class keyword</a>
               
               
               <a id="see_iddle1182" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1182" class="calibre4">className argument</a>
               <a id="see_iddle1183" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1183" class="calibre4">clearInterval method</a><a id="see_iddle1184" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle1184" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1185" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1185" class="calibre4">clearTimeout method</a>
               <a id="see_iddle1186" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1186" class="calibre4">click function</a><a id="see_iddle1187" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle1187" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1188" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle1188" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1189" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1189" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1190" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1190" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               <a id="see_iddle1191" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1191" class="calibre4">clientHeight property</a>
               <a id="see_iddle1192" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1192" class="calibre4">clientLeft property</a>
               <a id="see_iddle1193" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1193" class="calibre4">clientTop property</a>
               <a id="see_iddle1194" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1194" class="calibre4">clientWidth property</a>
               <a id="see_iddle1195" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1195" class="calibre4">cloneNode operation</a>
               <a id="see_iddle1196" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1196" class="calibre4">close coupling</a>
               <br class="calibre13"><br class="calibre13">closures<a id="see_iddle1197" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1197" class="calibre4">example</a><a id="see_iddle1198" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1198" class="calibre4">exercise answers</a><a id="see_iddle1199" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1199" class="calibre4">keeping track of identifiers with lexical environments</a><a id="see_iddle1200" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1200" class="calibre4">overview</a><a id="see_iddle1201" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1201" class="calibre4">private variables, mimicking</a><a id="see_iddle1202" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1202" class="calibre4">2<sup class="calibre31">nd</sup></a><a id="see_iddle1203" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1203" class="calibre4">tracking code execution with execution contexts</a><a id="see_iddle1204" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1204" class="calibre4">using with callbacks</a>
               
               
               
               
               
               
               
               <a id="see_iddle1205" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1205" class="calibre4">code modularization techniques</a>. <br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<i class="calibre6">See</i> modules.
               <a id="see_iddle1206" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1206" class="calibre4">code nesting</a>
               <a id="see_iddle1207" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1207" class="calibre4">&lt;col&gt; element</a>
               <a id="see_iddle1208" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1208" class="calibre4">&lt;colgroup&gt; element</a>
               <br class="calibre13"><br class="calibre13">collections<a id="see_iddle1209" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1209" class="calibre4">arrays</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1210" class="calibre4">adding and removing items at any array location</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1211" class="calibre4">adding and removing items at either end of</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1212" class="calibre4">aggregating array items</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1213" class="calibre4">creating</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1214" class="calibre4">iterating over</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1215" class="calibre4">mapping</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1216" class="calibre4">reusing built-in array functions</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1217" class="calibre4">searching</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1218" class="calibre4">sorting</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1219" class="calibre4">testing array items</a><a id="see_iddle1220" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1220" class="calibre4">exercise answers</a><a id="see_iddle1221" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1221" class="calibre4">maps</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1222" class="calibre4">creating</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1223" class="calibre4">iterating over</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1224" class="calibre4">objects as, don’t use</a><a id="see_iddle1225" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1225" class="calibre4">sets</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1226" class="calibre4">creating</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1227" class="calibre4">difference of</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1228" class="calibre4">intersection of</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1229" class="calibre4">union of</a>
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               <a id="see_iddle1230" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1230" class="calibre4">color property</a><a id="see_iddle1231" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle1231" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1232" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1232" class="calibre4">CommonJS, modules</a>
               <a id="see_iddle1233" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1233" class="calibre4">communicating, with generators</a><a id="see_iddle1234" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1234" class="calibre4">sending values as generator function arguments</a><a id="see_iddle1235" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1235" class="calibre4">throwing exceptions</a><a id="see_iddle1236" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1236" class="calibre4">using next method to send values into generator</a>
               
               
               
               <a id="see_iddle1237" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1237" class="calibre4">comparator, sorting callback functions with</a>
               <a id="see_iddle1238" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1238" class="calibre4">computationally expensive processing, event loop</a>
               <br class="calibre13"><br class="calibre13">computed styles<a id="see_iddle1239" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1239" class="calibre4">DOM</a><a id="see_iddle1240" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1240" class="calibre4">overview</a>
               
               <a id="see_iddle1241" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1241" class="calibre4">computedStyles variable</a>
               <a id="see_iddle1242" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1242" class="calibre4">conditional breakpoints</a>
               <a id="see_iddle1243" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1243" class="calibre4">configurable key</a>
               <a id="see_iddle1244" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1244" class="calibre4">console object</a>
               <a id="see_iddle1245" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1245" class="calibre4">console.assert() method</a>
               <a id="see_iddle1246" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1246" class="calibre4">console.log method</a><a id="see_iddle1247" class="calibre4"></a>,&nbsp;<a href="kindle_split_029.html#iddle1247" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1248" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1248" class="calibre4">console.time method</a><a id="see_iddle1249" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1249" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1250" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1250" class="calibre4">console.timeEnd method</a>
               <a id="see_iddle1251" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1251" class="calibre4">const keyword, specifying block-scoped variables with</a>
               <a id="see_iddle1252" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1252" class="calibre4">const variables</a>
               <a id="see_iddle1253" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle1253" class="calibre4">construct trap</a>
               <a id="see_iddle1254" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1254" class="calibre4">constructive test cases</a>
               <a id="see_iddle1255" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1255" class="calibre4">constructor property</a><a id="see_iddle1256" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle1256" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1257" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle1257" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1258" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle1258" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1259" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle1259" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1260" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle1260" class="calibre4">6<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1261" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1261" class="calibre4">7<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1262" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle1262" class="calibre4">8<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               
               
               
               <br class="calibre13"><br class="calibre13">constructors<a id="see_iddle1263" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1263" class="calibre4">invoking functions as</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1264" class="calibre4">coding considerations for</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1265" class="calibre4">considerations for</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1266" class="calibre4">overview</a>, 2nd<br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1268" class="calibre4">return values</a><a id="see_iddle1269" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1269" class="calibre4">object typing via</a><a id="see_iddle1270" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1270" class="calibre4">overview</a><a id="see_iddle1271" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1271" class="calibre4">2<sup class="calibre31">nd</sup></a>
               
               
               
               
               
               
               
               
               <a id="see_iddle1272" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1272" class="calibre4">context, for functions</a><a id="see_iddle1273" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1273" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1274" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1274" class="calibre4">createElement</a>
               <a id="see_iddle1275" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1275" class="calibre4">Creates object</a>
               <a id="see_iddle1276" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1276" class="calibre4">Crockford, Douglas</a>
               <br class="calibre13"><br class="calibre13">cross-browser strategies<a id="see_iddle1277" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1277" class="calibre4">browser bug fixes</a><a id="see_iddle1278" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1278" class="calibre4">exercises</a><a id="see_iddle1279" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1279" class="calibre4">external code and markup</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1280" class="calibre4">CSS rules</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1281" class="calibre4">DOM clobbering</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1282" class="calibre4">encapsulation</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1283" class="calibre4">working with existing code</a><a id="see_iddle1284" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1284" class="calibre4">feature detection</a><a id="see_iddle1285" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1285" class="calibre4">fixes</a><a id="see_iddle1286" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1286" class="calibre4">overview</a><a id="see_iddle1287" class="calibre4"></a>,&nbsp;<a href="kindle_split_027.html#iddle1287" class="calibre4">2<sup class="calibre31">nd</sup></a><a id="see_iddle1288" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1288" class="calibre4">polyfills</a><a id="see_iddle1289" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1289" class="calibre4">reducing assumptions</a><a id="see_iddle1290" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1290" class="calibre4">regressions</a><a id="see_iddle1291" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1291" class="calibre4">untestable browser issues</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1292" class="calibre4">API performance</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1293" class="calibre4">browser crashes</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1294" class="calibre4">CSS property effects</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1295" class="calibre4">event firing</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1296" class="calibre4">event handler bindings</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1297" class="calibre4">incongruous APIs</a>
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               <br class="calibre13"><br class="calibre13">CSS (Cascading Style Sheets)<a id="see_iddle1298" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1298" class="calibre4">overview</a><a id="see_iddle1299" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1299" class="calibre4">property effects</a><a id="see_iddle1300" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1300" class="calibre4">rules</a>
               
               
               <a id="see_iddle1301" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1301" class="calibre4">custom events</a><a id="see_iddle1302" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1302" class="calibre4">Ajax</a><a id="see_iddle1303" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1303" class="calibre4">creating</a><a id="see_iddle1304" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1304" class="calibre4">loose coupling</a>
               
               
               
               </small></kbd></p>
      <h4 id="MainIndexD" class="calibre26">D</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1305" class="calibre4"></a><a href="kindle_split_022.html#iddle1305" class="calibre4">dash character</a>
               <a id="see_iddle1306" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1306" class="calibre4">Debugger pane</a><a id="see_iddle1307" class="calibre4"></a>,&nbsp;<a href="kindle_split_029.html#iddle1307" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1308" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1308" class="calibre4">debugging code</a><a id="see_iddle1309" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle1309" class="calibre4">breakpoints</a><a id="see_iddle1310" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle1310" class="calibre4">conditional breakpoints</a><a id="see_iddle1311" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle1311" class="calibre4">logging</a><a id="see_iddle1312" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle1312" class="calibre4">stepping into function</a>
               
               
               
               
               <a id="see_iddle1313" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1313" class="calibre4">declarations (function)</a>
               <a id="see_iddle1314" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1314" class="calibre4">deconstructive test cases</a>
               <a id="see_iddle1315" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1315" class="calibre4">default exports, ES6 modules</a>
               <a id="see_iddle1316" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1316" class="calibre4">default parameters (function)</a>
               <a id="see_iddle1317" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1317" class="calibre4">define function</a>
               <a id="see_iddle1318" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1318" class="calibre4">defining module interfaces</a>
               <a id="see_iddle1319" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1319" class="calibre4">delete method</a>
               <a id="see_iddle1320" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1320" class="calibre4">desktop applications</a>
               <a id="see_iddle1321" class="calibre4"></a><br class="calibre13"><a href="kindle_split_028.html#iddle1321" class="calibre4">destructuring</a><a id="see_iddle1322" class="calibre4"></a>,&nbsp;<a href="kindle_split_028.html#iddle1322" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1323" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1323" class="calibre4">Developer Tools, Firefox</a><a id="see_iddle1324" class="calibre4"></a>,&nbsp;<a href="kindle_split_029.html#iddle1324" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1325" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1325" class="calibre4">DevTools</a><a id="see_iddle1326" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1326" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1327" class="calibre4"></a>,&nbsp;<a href="kindle_split_029.html#iddle1327" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1328" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1328" class="calibre4">dictionaries</a>. <br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<i class="calibre6">See</i> maps.
               <a id="see_iddle1329" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1329" class="calibre4">difficult error handling</a>
               <a id="see_iddle1330" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1330" class="calibre4">display property</a>
               <a id="see_iddle1331" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1331" class="calibre4">distinct items</a>
               <a id="see_iddle1332" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1332" class="calibre4">&lt;div&gt; element</a><a id="see_iddle1333" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle1333" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1334" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle1334" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1335" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle1335" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1336" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle1336" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               <a id="see_iddle1337" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1337" class="calibre4">doc.createDocumentFragment() method</a>
               <a id="see_iddle1338" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1338" class="calibre4">document click handler</a><a id="see_iddle1339" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle1339" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1340" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1340" class="calibre4">document object</a><a id="see_iddle1341" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle1341" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1342" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1342" class="calibre4">Document Object Model</a>. <br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<i class="calibre6">See</i> DOM.
               <a id="see_iddle1343" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1343" class="calibre4">document.getElementById method</a>
               <a id="see_iddle1344" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1344" class="calibre4">Dojo toolkit</a>
               <a id="see_iddle1345" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1345" class="calibre4">dollar sign character</a>
               <a id="see_iddle1346" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1346" class="calibre4">DOM (Document Object Model)</a><a id="see_iddle1347" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1347" class="calibre4">attributes and properties</a><a id="see_iddle1348" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1348" class="calibre4">building</a><a id="see_iddle1349" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1349" class="calibre4">cross-browser strategies</a><a id="see_iddle1350" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1350" class="calibre4">exercise answers</a><a id="see_iddle1351" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1351" class="calibre4">injecting HTML into</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1352" class="calibre4">HTML wrapping</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1353" class="calibre4">inserting elements into document</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1354" class="calibre4">overview</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1355" class="calibre4">preprocessing HTML source string</a><a id="see_iddle1356" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1356" class="calibre4">layout thrashing</a><a id="see_iddle1357" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1357" class="calibre4">overview</a><a id="see_iddle1358" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle1358" class="calibre4">2<sup class="calibre31">nd</sup></a><a id="see_iddle1359" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1359" class="calibre4">propagating events through</a><a id="see_iddle1360" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1360" class="calibre4">styling attributes</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1361" class="calibre4">computed styles</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1362" class="calibre4">converting pixel values</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1363" class="calibre4">height and width properties</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1364" class="calibre4">naming</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1365" class="calibre4">overview</a><a id="see_iddle1366" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1366" class="calibre4">traversing using generators</a>
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               <a id="see_iddle1367" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1367" class="calibre4">DOM Explorer pane</a>
               <a id="see_iddle1368" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1368" class="calibre4">DOM fragments</a><a id="see_iddle1369" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle1369" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1370" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1370" class="calibre4">DOM method</a>
               <a id="see_iddle1371" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1371" class="calibre4">DOM specification</a>
               <a id="see_iddle1372" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1372" class="calibre4">DOMContentLoaded handler</a>
               <a id="see_iddle1373" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1373" class="calibre4">done property</a>
               <a id="see_iddle1374" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1374" class="calibre4">double backslash character</a><a id="see_iddle1375" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1375" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1376" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1376" class="calibre4">double brackets</a>
               <a id="see_iddle1377" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1377" class="calibre4">double-escape character</a>
               <a id="see_iddle1378" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1378" class="calibre4">dynamic nature of JavaScript, side effects of</a>
               </small></kbd></p>
      <h4 id="MainIndexE" class="calibre26">E</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1379" class="calibre4"></a><a href="kindle_split_028.html#iddle1379" class="calibre4">ECMAScript 6</a>. <br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<i class="calibre6">See</i> ES6.
               <a id="see_iddle1380" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1380" class="calibre4">elem variable</a>
               <a id="see_iddle1381" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1381" class="calibre4">ellipses</a><a id="see_iddle1382" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle1382" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1383" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1383" class="calibre4">embedded values</a>
               <a id="see_iddle1384" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1384" class="calibre4">encapsulation</a>
               <a id="see_iddle1385" class="calibre4"></a><br class="calibre13"><a href="kindle_split_028.html#iddle1385" class="calibre4">enhanced object literals</a><a id="see_iddle1386" class="calibre4"></a>,&nbsp;<a href="kindle_split_028.html#iddle1386" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1387" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1387" class="calibre4">enumerable key</a>
               <a id="see_iddle1388" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle1388" class="calibre4">enumerate trap</a>
               <a id="see_iddle1389" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1389" class="calibre4">[[Environment]] property</a><a id="see_iddle1390" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1390" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1391" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1391" class="calibre4">errors, catching in chained promises</a>
               <br class="calibre13"><br class="calibre13">ES6 (ECMAScript 6)<a id="see_iddle1392" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_028.html#iddle1392" class="calibre4">destructuring</a><a id="see_iddle1393" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_028.html#iddle1393" class="calibre4">enhanced object literals</a><a id="see_iddle1394" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_023.html#iddle1394" class="calibre4">exporting and importing functionality</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_023.html#iddle1395" class="calibre4">default exports</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_023.html#iddle1396" class="calibre4">renaming exports and imports</a><a id="see_iddle1397" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_028.html#iddle1397" class="calibre4">template literals</a><a id="see_iddle1398" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1398" class="calibre4">using classes in</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1399" class="calibre4">implementing inheritance</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1400" class="calibre4">using class keyword</a>
               
               
               
               
               
               
               
               
               <a id="see_iddle1401" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1401" class="calibre4">escaped characters</a>
               <a id="see_iddle1402" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1402" class="calibre4">event bubbling</a><a id="see_iddle1403" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle1403" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1404" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle1404" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1405" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1405" class="calibre4">event capturing</a><a id="see_iddle1406" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle1406" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <br class="calibre13"><br class="calibre13">event handling<a id="see_iddle1407" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1407" class="calibre4">overview</a><a id="see_iddle1408" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1408" class="calibre4">page-building</a>
               
               <a id="see_iddle1409" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1409" class="calibre4">event loop</a><a id="see_iddle1410" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle1410" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1411" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle1411" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1412" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1412" class="calibre4">macrotasks</a><a id="see_iddle1413" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1413" class="calibre4">microtasks</a><a id="see_iddle1414" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1414" class="calibre4">timers</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1415" class="calibre4">computationally expensive processing</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1416" class="calibre4">overview</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1417" class="calibre4">time-outs and intervals</a>
               
               
               
               
               
               
               
               
               <a id="see_iddle1418" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1418" class="calibre4">event queue</a><a id="see_iddle1419" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle1419" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1420" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle1420" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1421" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1421" class="calibre4">event-driven applications</a>
               <a id="see_iddle1422" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1422" class="calibre4">event-handler registration</a>
               <a id="see_iddle1423" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1423" class="calibre4">event.target property</a>
               <br class="calibre13"><br class="calibre13">events<a id="see_iddle1424" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1424" class="calibre4">custom events</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1425" class="calibre4">Ajax</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1426" class="calibre4">creating</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1427" class="calibre4">loose coupling</a><a id="see_iddle1428" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1428" class="calibre4">event firing</a><a id="see_iddle1429" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1429" class="calibre4">event handler bindings</a><a id="see_iddle1430" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1430" class="calibre4">exercise answers</a><a id="see_iddle1431" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1431" class="calibre4">exercises</a><a id="see_iddle1432" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1432" class="calibre4">propagating through DOM</a>. <br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<i class="calibre6">See also</i> event loop.
               
               
               
               
               
               
               
               
               <a id="see_iddle1433" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1433" class="calibre4">every method</a>
               <a id="see_iddle1434" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1434" class="calibre4">exceptions, throwing</a>
               <a id="see_iddle1435" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1435" class="calibre4">exclamation mark</a>
               <a id="see_iddle1436" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1436" class="calibre4">exec() method</a><a id="see_iddle1437" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1437" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1438" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1438" class="calibre4">executing state</a>
               <a id="see_iddle1439" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1439" class="calibre4">execution</a>
               <br class="calibre13"><br class="calibre13">execution contexts<a id="see_iddle1440" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1440" class="calibre4">tracking code execution with</a><a id="see_iddle1441" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1441" class="calibre4">tracking generators using</a>
               
               <a id="see_iddle1442" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1442" class="calibre4">executor function</a><a id="see_iddle1443" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1443" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1444" class="calibre4"></a><br class="calibre13"><a href="kindle_split_030.html#iddle1444" class="calibre4">exercise answers</a><a id="see_iddle1445" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1445" class="calibre4">access to objects, controlling</a><a id="see_iddle1446" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1446" class="calibre4">building page at runtime</a><a id="see_iddle1447" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1447" class="calibre4">code modularization techniques</a><a id="see_iddle1448" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1448" class="calibre4">collections</a><a id="see_iddle1449" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1449" class="calibre4">cross-browser strategies</a><a id="see_iddle1450" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1450" class="calibre4">DOM</a><a id="see_iddle1451" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1451" class="calibre4">events</a><a id="see_iddle1452" class="calibre4"></a><br class="calibre13">  functions<br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1452" class="calibre4">closures and scopes</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1453" class="calibre4">definitions and arguments</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1454" class="calibre4">generators and promises</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1455" class="calibre4">invocation</a><a id="see_iddle1456" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1456" class="calibre4">prototypes, object orientation with</a><a id="see_iddle1457" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1457" class="calibre4">regular expressions</a>
               
               
               
               
               
               
               
               
               
               
               
               
               
               <a id="see_iddle1458" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1458" class="calibre4">expect function</a>
               <a id="see_iddle1459" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1459" class="calibre4">explicitly rejecting promises</a>
               <a id="see_iddle1460" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1460" class="calibre4">export keyword</a><a id="see_iddle1461" class="calibre4"></a>,&nbsp;<a href="kindle_split_023.html#iddle1461" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1462" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1462" class="calibre4">exports property</a>
               <a id="see_iddle1463" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1463" class="calibre4">exports, renaming</a>
               <a id="see_iddle1464" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1464" class="calibre4">expressions (function)</a>
               <a id="see_iddle1465" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1465" class="calibre4">extends keyword</a>
               <a id="see_iddle1466" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1466" class="calibre4">external code and markup, cross-browser strategies</a><a id="see_iddle1467" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1467" class="calibre4">CSS rules</a><a id="see_iddle1468" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1468" class="calibre4">DOM clobbering</a><a id="see_iddle1469" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1469" class="calibre4">encapsulation</a><a id="see_iddle1470" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle1470" class="calibre4">working with existing code</a>
               
               
               
               
               </small></kbd></p>
      <h4 id="MainIndexF" class="calibre26">F</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1471" class="calibre4"></a><a href="kindle_split_011.html#iddle1471" class="calibre4">F12 Developer Tools</a><a id="see_iddle1472" class="calibre4"></a>,&nbsp;<a href="kindle_split_029.html#iddle1472" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1473" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1473" class="calibre4">fail class</a>
               <a id="see_iddle1474" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1474" class="calibre4">fail function</a>
               <a id="see_iddle1475" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1475" class="calibre4">failure callback</a>
               <a id="see_iddle1476" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1476" class="calibre4">FastDom</a>
               <a id="see_iddle1477" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1477" class="calibre4">fat-arrow operator</a>
               <a id="see_iddle1478" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1478" class="calibre4">feature detection, cross-browser strategies</a>
               <a id="see_iddle1479" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1479" class="calibre4">filter method</a><a id="see_iddle1480" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1480" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1481" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1481" class="calibre4">find method</a><a id="see_iddle1482" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1482" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1483" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1483" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1484" class="calibre4"></a>,&nbsp;<a href="kindle_split_027.html#iddle1484" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle1485" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1485" class="calibre4">findIndex method</a>
               <a id="see_iddle1486" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1486" class="calibre4">Firebug</a><a id="see_iddle1487" class="calibre4"></a>,&nbsp;<a href="kindle_split_029.html#iddle1487" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1488" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1488" class="calibre4">Firefox Developer Tools</a><a id="see_iddle1489" class="calibre4"></a>,&nbsp;<a href="kindle_split_029.html#iddle1489" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1490" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1490" class="calibre4">first-class objects</a><a id="see_iddle1491" class="calibre4"></a>,&nbsp;<a href="kindle_split_014.html#iddle1491" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1492" class="calibre4"></a>,&nbsp;<a href="kindle_split_014.html#iddle1492" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1493" class="calibre4"></a>,&nbsp;<a href="kindle_split_014.html#iddle1493" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1494" class="calibre4"></a>,&nbsp;<a href="kindle_split_014.html#iddle1494" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1495" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1495" class="calibre4">6<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               
               <a id="see_iddle1496" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1496" class="calibre4">Fitzgerald, Michael</a>
               <a id="see_iddle1497" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1497" class="calibre4">for loop</a><a id="see_iddle1498" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1498" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1499" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1499" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1500" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1500" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1501" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1501" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               <a id="see_iddle1502" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1502" class="calibre4">for statement</a>
               <a id="see_iddle1503" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1503" class="calibre4">for-in loop</a>
               <a id="see_iddle1504" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle1504" class="calibre4">for-in statements</a>
               <a id="see_iddle1505" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1505" class="calibre4">for-of loop</a><a id="see_iddle1506" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1506" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1507" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1507" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1508" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1508" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1509" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle1509" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               <a id="see_iddle1510" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1510" class="calibre4">forEach() method</a><a id="see_iddle1511" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1511" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1512" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1512" class="calibre4">&lt;form&gt; element</a>
               <a id="see_iddle1513" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1513" class="calibre4">fragment parameter</a>
               <a id="see_iddle1514" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1514" class="calibre4">Friedl, Jeffrey</a>
               <a id="see_iddle1515" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1515" class="calibre4">fulfilled state</a>
               <a id="see_iddle1516" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1516" class="calibre4">function closures</a>
               <a id="see_iddle1517" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1517" class="calibre4">function code</a><a id="see_iddle1518" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1518" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1519" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1519" class="calibre4">function constructors</a><a id="see_iddle1520" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1520" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <br class="calibre13"><br class="calibre13">function contexts<a id="see_iddle1521" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1521" class="calibre4">fixing problem of</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1522" class="calibre4">using bind method</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1523" class="calibre4">with arrow functions</a><a id="see_iddle1524" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1524" class="calibre4">forcing in callbacks</a><a id="see_iddle1525" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1525" class="calibre4">overview</a><a id="see_iddle1526" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1526" class="calibre4">2<sup class="calibre31">nd</sup></a>
               
               
               
               
               
               <a id="see_iddle1527" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1527" class="calibre4">function declarations</a>
               <a id="see_iddle1528" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1528" class="calibre4">function execution context</a>
               <a id="see_iddle1529" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1529" class="calibre4">function expressions</a><a id="see_iddle1530" class="calibre4"></a>,&nbsp;<a href="kindle_split_014.html#iddle1530" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1531" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1531" class="calibre4">function keyword</a><a id="see_iddle1532" class="calibre4"></a>,&nbsp;<a href="kindle_split_014.html#iddle1532" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1533" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1533" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1534" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1534" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle1535" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1535" class="calibre4">function literal</a>
               <a id="see_iddle1536" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1536" class="calibre4">function() statement</a>
               <a id="see_iddle1537" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1537" class="calibre4">functional programming</a>
               <br class="calibre13"><br class="calibre13">functions<a id="see_iddle1538" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1538" class="calibre4">arguments</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1539" class="calibre4">default parameters and</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1540" class="calibre4">rest parameters and</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1541" class="calibre4">slicing</a><a id="see_iddle1542" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1542" class="calibre4">as first-class objects</a><a id="see_iddle1543" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_023.html#iddle1543" class="calibre4">as modules</a><a id="see_iddle1544" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1544" class="calibre4">as objects</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1545" class="calibre4">self-memoizing functions</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1546" class="calibre4">storing functions</a><a id="see_iddle1547" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1547" class="calibre4">callback</a><a id="see_iddle1548" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1548" class="calibre4">calling functions before their declarations</a><a id="see_iddle1549" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1549" class="calibre4">closures, exercise answers</a><a id="see_iddle1550" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1550" class="calibre4">declaring</a><a id="see_iddle1551" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1551" class="calibre4">defining</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1552" class="calibre4">arrow functions</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1553" class="calibre4">function declarations</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1554" class="calibre4">function expressions</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1555" class="calibre4">immediate functions</a><a id="see_iddle1556" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1556" class="calibre4">fixing problem of function contexts</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1557" class="calibre4">using bind method</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1558" class="calibre4">with arrow functions</a><a id="see_iddle1559" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1559" class="calibre4">generators, exercise answers</a><a id="see_iddle1560" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1560" class="calibre4">implicit function parameters</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1561" class="calibre4">arguments parameter</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1562" class="calibre4">function context</a><a id="see_iddle1563" class="calibre4"></a><br class="calibre13">  importance of in JavaScript<br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1563" class="calibre4">anonymous functions</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1564" class="calibre4">callback concept</a><a id="see_iddle1565" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1565" class="calibre4">invoking</a><a id="see_iddle1566" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1566" class="calibre4">2<sup class="calibre31">nd</sup></a><a id="see_iddle1567" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1567" class="calibre4">3<sup class="calibre31">rd</sup></a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1568" class="calibre4">as constructors</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1569" class="calibre4">as methods</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1570" class="calibre4">considerations for</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1571" class="calibre4">exercise answers</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1572" class="calibre4">overview</a>, 2nd, 3rd<br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1575" class="calibre4">with apply and call methods</a><a id="see_iddle1576" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1576" class="calibre4">overriding</a><a id="see_iddle1577" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1577" class="calibre4">parameters for</a><a id="see_iddle1578" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1578" class="calibre4">2<sup class="calibre31">nd</sup></a><a id="see_iddle1579" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1579" class="calibre4">promises, exercise answers</a><a id="see_iddle1580" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1580" class="calibre4">scopes, exercise answers</a><a id="see_iddle1581" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1581" class="calibre4">self-memoizing</a><a id="see_iddle1582" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1582" class="calibre4">simulating array methods with</a><a id="see_iddle1583" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle1583" class="calibre4">stepping into function</a><a id="see_iddle1584" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1584" class="calibre4">storing</a>
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               </small></kbd></p>
      <h4 id="MainIndexG" class="calibre26">G</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1585" class="calibre4"></a><a href="kindle_split_022.html#iddle1585" class="calibre4">g flag</a><a id="see_iddle1586" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1586" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1587" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1587" class="calibre4">generator functions</a>
               <a id="see_iddle1588" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1588" class="calibre4">generators</a><a id="see_iddle1589" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1589" class="calibre4">combining with promises</a><a id="see_iddle1590" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1590" class="calibre4">communicating with</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1591" class="calibre4">sending values as generator function arguments</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1592" class="calibre4">throwing exceptions</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1593" class="calibre4">using next method to send values into generator</a><a id="see_iddle1594" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1594" class="calibre4">controlling through iterator object</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1595" class="calibre4">iterating iterator</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1596" class="calibre4">yielding to another generator</a><a id="see_iddle1597" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1597" class="calibre4">exercise answers</a><a id="see_iddle1598" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1598" class="calibre4">making async code elegant with</a><a id="see_iddle1599" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1599" class="calibre4">overview</a><a id="see_iddle1600" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1600" class="calibre4">tracking using execution contexts</a><a id="see_iddle1601" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1601" class="calibre4">using to generate IDs</a><a id="see_iddle1602" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1602" class="calibre4">using to traverse DOM</a>
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               <a id="see_iddle1603" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1603" class="calibre4">get keyword</a><a id="see_iddle1604" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1604" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1605" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle1605" class="calibre4">get trap</a><a id="see_iddle1606" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1606" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1607" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1607" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1608" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1608" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle1609" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1609" class="calibre4">getAttribute() method</a>
               <a id="see_iddle1610" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1610" class="calibre4">getBoundingClientRect property</a>
               <a id="see_iddle1611" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1611" class="calibre4">getComputedStyle method</a><a id="see_iddle1612" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle1612" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1613" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1613" class="calibre4">getElementById method</a><a id="see_iddle1614" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle1614" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1615" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1615" class="calibre4">getElementsByTagName method</a>
               <a id="see_iddle1616" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle1616" class="calibre4">getPrototypeOf</a>
               <a id="see_iddle1617" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1617" class="calibre4">getter function</a><a id="see_iddle1618" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1618" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <br class="calibre13"><br class="calibre13">getters and setters<a id="see_iddle1619" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1619" class="calibre4">access to properties using</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1620" class="calibre4">defining getters and setters</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1621" class="calibre4">using getters and setters to define computed properties</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1622" class="calibre4">using getters and setters to validate property values</a><a id="see_iddle1623" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1623" class="calibre4">overview</a>
               
               
               
               
               <a id="see_iddle1624" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1624" class="calibre4">global code</a><a id="see_iddle1625" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1625" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1626" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1626" class="calibre4">Goyvaerts, Jan</a>
               <a id="see_iddle1627" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1627" class="calibre4">graded browser support</a>
               <a id="see_iddle1628" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1628" class="calibre4">greater-than operator</a>
               <a id="see_iddle1629" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1629" class="calibre4">greedy operators</a>
               </small></kbd></p>
      <h4 id="MainIndexH" class="calibre26">H</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1630" class="calibre4"></a><a href="kindle_split_012.html#iddle1630" class="calibre4">handling events</a>
               <a id="see_iddle1631" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1631" class="calibre4">has method</a><a id="see_iddle1632" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1632" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1633" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1633" class="calibre4">head element</a>
               <a id="see_iddle1634" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1634" class="calibre4">height property, DOM</a>
               <a id="see_iddle1635" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1635" class="calibre4">hiding module internals</a>
               <a id="see_iddle1636" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1636" class="calibre4">hoisting</a>
               <br class="calibre13"><br class="calibre13">HTML<a id="see_iddle1637" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1637" class="calibre4">injecting into DOM</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1638" class="calibre4">HTML wrapping</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1639" class="calibre4">inserting elements into document</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1640" class="calibre4">overview</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1641" class="calibre4">preprocessing HTML source string</a><a id="see_iddle1642" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1642" class="calibre4">parsing</a>
               
               
               
               
               
               <a id="see_iddle1643" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1643" class="calibre4">html element</a><a id="see_iddle1644" class="calibre4"></a>,&nbsp;<a href="kindle_split_027.html#iddle1644" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1645" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1645" class="calibre4">HTML pane</a>
               </small></kbd></p>
      <h4 id="MainIndexI" class="calibre26">I</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1646" class="calibre4"></a><a href="kindle_split_022.html#iddle1646" class="calibre4">i flag</a>
               <a id="see_iddle1647" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1647" class="calibre4">i variable</a>
               <a id="see_iddle1648" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1648" class="calibre4">id attribute</a><a id="see_iddle1649" class="calibre4"></a>,&nbsp;<a href="kindle_split_027.html#iddle1649" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1650" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle1650" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1651" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1651" class="calibre4">id values</a><a id="see_iddle1652" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1652" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1653" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1653" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1654" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1654" class="calibre4">identifier resolution</a>
               <br class="calibre13"><br class="calibre13">identifiers<a id="see_iddle1655" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1655" class="calibre4">registering within lexical environments</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1656" class="calibre4">calling functions before declarations</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1657" class="calibre4">overriding functions</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1658" class="calibre4">process</a><a id="see_iddle1659" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1659" class="calibre4">tracking with lexical environments</a>
               
               
               
               
               <a id="see_iddle1660" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1660" class="calibre4">IDEs (integrated development environments)</a>
               <a id="see_iddle1661" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1661" class="calibre4">IDs, generating using generators</a>
               <a id="see_iddle1662" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1662" class="calibre4">IE (Internet Explorer)</a>
               <a id="see_iddle1663" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1663" class="calibre4">IIFE (immediately invoked function expression)</a>
               <a id="see_iddle1664" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1664" class="calibre4">immediate functions</a>
               <a id="see_iddle1665" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1665" class="calibre4">implicit function parameters</a><a id="see_iddle1666" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1666" class="calibre4">arguments parameter</a><a id="see_iddle1667" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1667" class="calibre4">function context</a>
               
               
               <a id="see_iddle1668" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1668" class="calibre4">implicit parameters</a>
               <a id="see_iddle1669" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1669" class="calibre4">import keyword</a>
               <a id="see_iddle1670" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1670" class="calibre4">important annotation</a>
               <a id="see_iddle1671" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1671" class="calibre4">imports, renaming</a>
               <a id="see_iddle1672" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1672" class="calibre4">indexOf method</a>
               <a id="see_iddle1673" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1673" class="calibre4">inheritance</a>
               <a id="see_iddle1674" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1674" class="calibre4">input#action element</a>
               <a id="see_iddle1675" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1675" class="calibre4">instance properties</a>
               <a id="see_iddle1676" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1676" class="calibre4">instanceof operator</a><a id="see_iddle1677" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle1677" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1678" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1678" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1679" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle1679" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle1680" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1680" class="calibre4">integrated development environments</a>. <br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<i class="calibre6">See</i> IDEs.
               <a id="see_iddle1681" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1681" class="calibre4">interfaces, module</a>
               <a id="see_iddle1682" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1682" class="calibre4">Internet Explorer</a>. <br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<i class="calibre6">See</i> IE.
               <a id="see_iddle1683" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1683" class="calibre4">intersection, of sets</a>
               <a id="see_iddle1684" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1684" class="calibre4">intervals, event loop</a>
               <a id="see_iddle1685" class="calibre4"></a><br class="calibre13"><a href="kindle_split_030.html#iddle1685" class="calibre4">invocation, exercise answers</a>
               <a id="see_iddle1686" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1686" class="calibre4">invoking functions</a><a id="see_iddle1687" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1687" class="calibre4">as method</a><a id="see_iddle1688" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1688" class="calibre4">constructor</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1689" class="calibre4">coding considerations for</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1690" class="calibre4">overview</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1691" class="calibre4">return values</a><a id="see_iddle1692" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1692" class="calibre4">overview</a><a id="see_iddle1693" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1693" class="calibre4">with apply and call methods</a>
               
               
               
               
               
               
               
               <a id="see_iddle1694" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1694" class="calibre4">iterating over maps</a>
               <a id="see_iddle1695" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1695" class="calibre4">iterator object, controlling generators through</a><a id="see_iddle1696" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1696" class="calibre4">iterating iterator</a><a id="see_iddle1697" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1697" class="calibre4">yielding to another generator</a>
               
               
               </small></kbd></p>
      <h4 id="MainIndexJ" class="calibre26">J</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1698" class="calibre4"></a><a href="kindle_split_029.html#iddle1698" class="calibre4">Jasmine testing framework</a>
               <br class="calibre13"><br class="calibre13">JavaScript<a id="see_iddle1699" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1699" class="calibre4">best practices</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1700" class="calibre4">debugging</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1701" class="calibre4">performance analysis</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1702" class="calibre4">testing</a><a id="see_iddle1703" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1703" class="calibre4">boosting skill transferability</a><a id="see_iddle1704" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1704" class="calibre4">browser</a><a id="see_iddle1705" class="calibre4"></a><br class="calibre13">  language features<br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1705" class="calibre4">evolution of</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1706" class="calibre4">overview</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1707" class="calibre4">transpilers</a>
               
               
               
               
               
               
               
               
               <a id="see_iddle1708" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1708" class="calibre4">jQuery function</a>
               <a id="see_iddle1709" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1709" class="calibre4">JSON.parse method</a>
               <a id="see_iddle1710" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1710" class="calibre4">juggle() method</a>
               </small></kbd></p>
      <h4 id="MainIndexK" class="calibre26">K</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1711" class="calibre4"></a><a href="kindle_split_021.html#iddle1711" class="calibre4">keys method</a>
               <a id="see_iddle1712" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1712" class="calibre4">Kleene, Stephen</a>
               <a id="see_iddle1713" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1713" class="calibre4">kuma object</a>
               </small></kbd></p>
      <h4 id="MainIndexL" class="calibre26">L</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1714" class="calibre4"></a><a href="kindle_split_014.html#iddle1714" class="calibre4">lambda functions</a>
               <a id="see_iddle1715" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1715" class="calibre4">layout thrashing, DOM</a>
               <a id="see_iddle1716" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1716" class="calibre4">length parameter</a>
               <a id="see_iddle1717" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1717" class="calibre4">length property</a><a id="see_iddle1718" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1718" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1719" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1719" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1720" class="calibre4"></a>,&nbsp;<a href="kindle_split_027.html#iddle1720" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle1721" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1721" class="calibre4">less-than operator</a>
               <br class="calibre13"><br class="calibre13">let keyword<a id="see_iddle1722" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1722" class="calibre4">overview</a><a id="see_iddle1723" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1723" class="calibre4">specifying block-scoped variables with</a>
               
               <a id="see_iddle1724" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1724" class="calibre4">Levithan, Steven</a>
               <br class="calibre13"><br class="calibre13">lexical environments<a id="see_iddle1725" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1725" class="calibre4">keeping track of identifiers with</a><a id="see_iddle1726" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1726" class="calibre4">registering identifiers within</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1727" class="calibre4">calling functions before declarations</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1728" class="calibre4">overriding functions</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_016.html#iddle1729" class="calibre4">process</a>
               
               
               
               
               <a id="see_iddle1730" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1730" class="calibre4">&lt;li&gt; element</a><a id="see_iddle1731" class="calibre4"></a>,&nbsp;<a href="kindle_split_029.html#iddle1731" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1732" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1732" class="calibre4">lifecycle, page-building</a>
               <a id="see_iddle1733" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1733" class="calibre4">location.href property</a>
               <br class="calibre13"><br class="calibre13">logging<a id="see_iddle1734" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle1734" class="calibre4">overview</a><a id="see_iddle1735" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1735" class="calibre4">using proxies for</a>
               
               <a id="see_iddle1736" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1736" class="calibre4">loose coupling</a>
               </small></kbd></p>
      <h4 id="MainIndexM" class="calibre26">M</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1737" class="calibre4"></a><a href="kindle_split_022.html#iddle1737" class="calibre4">m flag</a>
               <br class="calibre13"><br class="calibre13">macrotasks<a id="see_iddle1738" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1738" class="calibre4">event loop</a><a id="see_iddle1739" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1739" class="calibre4">overview</a>
               
               <a id="see_iddle1740" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle1740" class="calibre4">makeLoggable function</a>
               <a id="see_iddle1741" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1741" class="calibre4">Map constructor</a>
               <a id="see_iddle1742" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1742" class="calibre4">map function</a>
               <a id="see_iddle1743" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1743" class="calibre4">mapping arrays</a>
               <a id="see_iddle1744" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1744" class="calibre4">maps</a><a id="see_iddle1745" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1745" class="calibre4">creating</a><a id="see_iddle1746" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1746" class="calibre4">iterating over</a><a id="see_iddle1747" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1747" class="calibre4">objects as, don’t use</a><a id="see_iddle1748" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle1748" class="calibre4">overview</a>
               
               
               
               
               <a id="see_iddle1749" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1749" class="calibre4">match() method</a>
               <br class="calibre13"><br class="calibre13">matching segments, capturing<a id="see_iddle1750" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1750" class="calibre4">noncapturing groups</a><a id="see_iddle1751" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1751" class="calibre4">performing simple captures</a><a id="see_iddle1752" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1752" class="calibre4">referencing captures</a>
               
               
               <a id="see_iddle1753" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1753" class="calibre4">MDN (Mozilla Developer Network)</a>
               <a id="see_iddle1754" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle1754" class="calibre4">measuring performance, proxies for</a>
               <a id="see_iddle1755" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1755" class="calibre4">memoization</a>
               <a id="see_iddle1756" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1756" class="calibre4">methods, invoking functions as</a>
               <br class="calibre13"><br class="calibre13">microtasks<a id="see_iddle1757" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1757" class="calibre4">event loop</a><a id="see_iddle1758" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle1758" class="calibre4">overview</a><a id="see_iddle1759" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle1759" class="calibre4">2<sup class="calibre31">nd</sup></a>
               
               
               <a id="see_iddle1760" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1760" class="calibre4">minimizing assumptions</a>
               <a id="see_iddle1761" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1761" class="calibre4">mobile apps, with frameworks</a>
               <a id="see_iddle1762" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1762" class="calibre4">module parameter</a>
               <a id="see_iddle1763" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1763" class="calibre4">module pattern</a><a id="see_iddle1764" class="calibre4"></a>,&nbsp;<a href="kindle_split_023.html#iddle1764" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1765" class="calibre4"></a>,&nbsp;<a href="kindle_split_023.html#iddle1765" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1766" class="calibre4"></a>,&nbsp;<a href="kindle_split_023.html#iddle1766" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle1767" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1767" class="calibre4">module variable</a><a id="see_iddle1768" class="calibre4"></a>,&nbsp;<a href="kindle_split_023.html#iddle1768" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1769" class="calibre4"></a>,&nbsp;<a href="kindle_split_023.html#iddle1769" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1770" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1770" class="calibre4">module.exports object</a><a id="see_iddle1771" class="calibre4"></a>,&nbsp;<a href="kindle_split_023.html#iddle1771" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <br class="calibre13"><br class="calibre13">modules<a id="see_iddle1772" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_023.html#iddle1772" class="calibre4">ES6</a><a id="see_iddle1773" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1773" class="calibre4">exercise answers</a><a id="see_iddle1774" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_023.html#iddle1774" class="calibre4">in pre-ES6 JavaScript</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_023.html#iddle1775" class="calibre4">Asynchronous Module Definition</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_023.html#iddle1776" class="calibre4">augmenting modules</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_023.html#iddle1777" class="calibre4">CommonJS</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_023.html#iddle1778" class="calibre4">functions as</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_023.html#iddle1779" class="calibre4">module interfaces</a>
               
               
               
               
               
               
               
               <a id="see_iddle1780" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1780" class="calibre4">mouseenter event</a>
               <a id="see_iddle1781" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1781" class="calibre4">mouseleave event</a>
               <a id="see_iddle1782" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1782" class="calibre4">mousemove event</a><a id="see_iddle1783" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle1783" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1784" class="calibre4"></a>,&nbsp;<a href="kindle_split_014.html#iddle1784" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1785" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1785" class="calibre4">mouseout event</a>
               <a id="see_iddle1786" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1786" class="calibre4">mouseover event</a>
               <a id="see_iddle1787" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1787" class="calibre4">Mozilla Developer Network</a>. <br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<i class="calibre6">See</i> MDN.
               <a id="see_iddle1788" class="calibre4"></a><br class="calibre13"><a href="kindle_split_028.html#iddle1788" class="calibre4">multiline strings</a>
               </small></kbd></p>
      <h4 id="MainIndexN" class="calibre26">N</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1789" class="calibre4"></a><a href="kindle_split_023.html#iddle1789" class="calibre4">named export</a><a id="see_iddle1790" class="calibre4"></a>,&nbsp;<a href="kindle_split_023.html#iddle1790" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1791" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle1791" class="calibre4">negative array indexes, implementing using proxies</a>
               <a id="see_iddle1792" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1792" class="calibre4">network events</a>
               <a id="see_iddle1793" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1793" class="calibre4">new operator</a>
               <a id="see_iddle1794" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1794" class="calibre4">newlines, matching</a>
               <a id="see_iddle1795" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1795" class="calibre4">next method</a><a id="see_iddle1796" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1796" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1797" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1797" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1798" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1798" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1799" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1799" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               <a id="see_iddle1800" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1800" class="calibre4">nonblocking callback code</a>
               <a id="see_iddle1801" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1801" class="calibre4">nonblocking generators</a>
               <a id="see_iddle1802" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1802" class="calibre4">noncapturing groups</a>
               <a id="see_iddle1803" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1803" class="calibre4">nondisplayed element</a>
               <a id="see_iddle1804" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1804" class="calibre4">nonexported variables</a>
               <a id="see_iddle1805" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1805" class="calibre4">nongreedy operators</a>
               <a id="see_iddle1806" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1806" class="calibre4">nonimported variables</a>
               <a id="see_iddle1807" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1807" class="calibre4">nonstrict mode</a><a id="see_iddle1808" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1808" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1809" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle1809" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               </small></kbd></p>
      <h4 id="MainIndexO" class="calibre26">O</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><br class="calibre13"><br class="calibre13">object literals<a id="see_iddle1810" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_015.html#iddle1810" class="calibre4">arrow functions and</a><a id="see_iddle1811" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_028.html#iddle1811" class="calibre4">enhanced</a>
               
               <a id="see_iddle1812" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1812" class="calibre4">object methods</a>
               <a id="see_iddle1813" class="calibre4"></a><br class="calibre13"><a href="kindle_split_030.html#iddle1813" class="calibre4">object orientation, using prototypes</a>
               <a id="see_iddle1814" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1814" class="calibre4">Object.defineProperty method</a><a id="see_iddle1815" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle1815" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1816" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1816" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1817" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1817" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle1818" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1818" class="calibre4">Object.setPrototypeOf method</a>
               <br class="calibre13"><br class="calibre13">objects<a id="see_iddle1819" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1819" class="calibre4">access to, controlling</a><a id="see_iddle1820" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle1820" class="calibre4">as maps, don’t use</a><a id="see_iddle1821" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1821" class="calibre4">construction of, prototypes and</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1822" class="calibre4">instance properties</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1823" class="calibre4">object typing via constructors</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1824" class="calibre4">side effects of dynamic nature of JavaScript</a><a id="see_iddle1825" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1825" class="calibre4">functions as</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1826" class="calibre4">self-memoizing functions</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_014.html#iddle1827" class="calibre4">storing functions</a>
               
               
               
               
               
               
               
               
               <a id="see_iddle1828" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1828" class="calibre4">offsetHeight property</a><a id="see_iddle1829" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle1829" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1830" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1830" class="calibre4">offsetLeft property</a>
               <a id="see_iddle1831" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1831" class="calibre4">offsetParent property</a>
               <a id="see_iddle1832" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1832" class="calibre4">offsetTop property</a>
               <a id="see_iddle1833" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1833" class="calibre4">offsetWidth property</a><a id="see_iddle1834" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle1834" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1835" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1835" class="calibre4">offsetX property</a>
               <a id="see_iddle1836" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1836" class="calibre4">offsetY property</a>
               <a id="see_iddle1837" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1837" class="calibre4">onerror event</a>
               <a id="see_iddle1838" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1838" class="calibre4">onload event</a>
               <a id="see_iddle1839" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1839" class="calibre4">onload property</a>
               <a id="see_iddle1840" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1840" class="calibre4">&lt;option&gt; element</a>
               <a id="see_iddle1841" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1841" class="calibre4">outer (parent) lexical environment</a>
               <a id="see_iddle1842" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1842" class="calibre4">overriding functions</a>
               </small></kbd></p>
      <h4 id="MainIndexP" class="calibre26">P</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><br class="calibre13"><br class="calibre13">page-building<a id="see_iddle1843" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1843" class="calibre4">building DOM</a><a id="see_iddle1844" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1844" class="calibre4">event handling</a><a id="see_iddle1845" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1845" class="calibre4">exercises</a><a id="see_iddle1846" class="calibre4"></a><br class="calibre13">  JavaScript code<br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1846" class="calibre4">executing</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1847" class="calibre4">global objects</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1848" class="calibre4">types of</a><a id="see_iddle1849" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1849" class="calibre4">lifecycle</a><a id="see_iddle1850" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1850" class="calibre4">overview</a><a id="see_iddle1851" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_012.html#iddle1851" class="calibre4">parsing HTML</a>
               
               
               
               
               
               
               
               
               <a id="see_iddle1852" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1852" class="calibre4">parameters, for functions</a><a id="see_iddle1853" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle1853" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1854" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1854" class="calibre4">parseFloat method</a>
               <a id="see_iddle1855" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1855" class="calibre4">passive subexpression</a><a id="see_iddle1856" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1856" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1857" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1857" class="calibre4">pattern variable</a>
               <a id="see_iddle1858" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1858" class="calibre4">patterns</a>
               <a id="see_iddle1859" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1859" class="calibre4">pending state</a><a id="see_iddle1860" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1860" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <br class="calibre13"><br class="calibre13">performance<a id="see_iddle1861" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1861" class="calibre4">measuring proxies for</a><a id="see_iddle1862" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1862" class="calibre4">overview</a>
               
               <a id="see_iddle1863" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1863" class="calibre4">period character</a><a id="see_iddle1864" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1864" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1865" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1865" class="calibre4">pipe character</a><a id="see_iddle1866" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle1866" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1867" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1867" class="calibre4">pixel values, DOM</a>
               <a id="see_iddle1868" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1868" class="calibre4">polyfills</a>
               <a id="see_iddle1869" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1869" class="calibre4">pop method</a><a id="see_iddle1870" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1870" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1871" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1871" class="calibre4">position property</a>
               <a id="see_iddle1872" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1872" class="calibre4">precompiling regular expressions</a>
               <a id="see_iddle1873" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1873" class="calibre4">preconstructing regular expressions</a>
               <a id="see_iddle1874" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1874" class="calibre4">predefined character classes</a>
               <a id="see_iddle1875" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1875" class="calibre4">previous hash</a>
               <a id="see_iddle1876" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1876" class="calibre4">prime value</a>
               <a id="see_iddle1877" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle1877" class="calibre4">private variables, mimicking</a>
               <a id="see_iddle1878" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1878" class="calibre4">Promise constructor</a><a id="see_iddle1879" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1879" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1880" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1880" class="calibre4">Promise.all method</a>
               <a id="see_iddle1881" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1881" class="calibre4">Promise.race method</a>
               <a id="see_iddle1882" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle1882" class="calibre4">Promise.resolve() method</a>
               <br class="calibre13"><br class="calibre13">promises<a id="see_iddle1883" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1883" class="calibre4">chaining</a><a id="see_iddle1884" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1884" class="calibre4">combining with generators</a><a id="see_iddle1885" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1885" class="calibre4">creating</a><a id="see_iddle1886" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1886" class="calibre4">exercise answers</a><a id="see_iddle1887" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1887" class="calibre4">making async code elegant with</a><a id="see_iddle1888" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1888" class="calibre4">overview</a><a id="see_iddle1889" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1889" class="calibre4">rejecting</a><a id="see_iddle1890" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_017.html#iddle1890" class="calibre4">waiting for number of</a>
               
               
               
               
               
               
               
               <br class="calibre13"><br class="calibre13">properties<a id="see_iddle1891" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1891" class="calibre4">access to with getters and setters</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1892" class="calibre4">defining getters and setters</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1893" class="calibre4">using getters and setters to define computed properties</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1894" class="calibre4">using getters and setters to validate property values</a><a id="see_iddle1895" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle1895" class="calibre4">DOM</a>
               
               
               
               
               <a id="see_iddle1896" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1896" class="calibre4">property descriptor</a>
               <a id="see_iddle1897" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1897" class="calibre4">prototype chain</a><a id="see_iddle1898" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle1898" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1899" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle1899" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1900" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1900" class="calibre4">prototype methods</a>
               <a id="see_iddle1901" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle1901" class="calibre4">prototype property</a><a id="see_iddle1902" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle1902" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1903" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle1903" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1904" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle1904" class="calibre4">prototype-based object orientation</a>
               <br class="calibre13"><br class="calibre13">prototypes<a id="see_iddle1905" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1905" class="calibre4">achieving inheritance</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1906" class="calibre4">instanceof operator</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1907" class="calibre4">problem of overriding constructor property</a><a id="see_iddle1908" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1908" class="calibre4">instantiating using reference to constructor</a><a id="see_iddle1909" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1909" class="calibre4">object construction and</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1910" class="calibre4">instance properties</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1911" class="calibre4">object typing via constructors</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1912" class="calibre4">side effects of dynamic nature of JavaScript</a><a id="see_iddle1913" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1913" class="calibre4">object orientation using</a><a id="see_iddle1914" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1914" class="calibre4">overview</a><a id="see_iddle1915" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1915" class="calibre4">using JavaScript classes in ES6</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1916" class="calibre4">implementing inheritance</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_019.html#iddle1917" class="calibre4">using class keyword</a>
               
               
               
               
               
               
               
               
               
               
               
               
               <br class="calibre13"><br class="calibre13">proxies<a id="see_iddle1918" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1918" class="calibre4">performance costs of</a><a id="see_iddle1919" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1919" class="calibre4">using for logging</a><a id="see_iddle1920" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1920" class="calibre4">using for measuring performance</a><a id="see_iddle1921" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1921" class="calibre4">using to autopopulate properties</a><a id="see_iddle1922" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_020.html#iddle1922" class="calibre4">using to implement negative array indexes</a>
               
               
               
               
               <a id="see_iddle1923" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle1923" class="calibre4">Proxy constructor</a><a id="see_iddle1924" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle1924" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1925" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1925" class="calibre4">push method</a><a id="see_iddle1926" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle1926" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               </small></kbd></p>
      <h4 id="MainIndexQ" class="calibre26">Q</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1927" class="calibre4"></a><a href="kindle_split_029.html#iddle1927" class="calibre4">QUnit testing framework</a>
               </small></kbd></p>
      <h4 id="MainIndexR" class="calibre26">R</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1928" class="calibre4"></a><a href="kindle_split_019.html#iddle1928" class="calibre4">reconciling property references</a>
               <a id="see_iddle1929" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle1929" class="calibre4">reduce method</a>
               <a id="see_iddle1930" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1930" class="calibre4">referencing captures, capturing matching segments</a>
               <a id="see_iddle1931" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1931" class="calibre4">RegExp() method</a><a id="see_iddle1932" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1932" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle1933" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle1933" class="calibre4">regressions, cross-browser strategies</a>
               <br class="calibre13"><br class="calibre13">regular expressions<a id="see_iddle1934" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1934" class="calibre4">benefits of</a><a id="see_iddle1935" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1935" class="calibre4">capturing matching segments</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1936" class="calibre4">matching using global expressions</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1937" class="calibre4">noncapturing groups</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1938" class="calibre4">performing simple captures</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1939" class="calibre4">referencing captures</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1940" class="calibre4">using global expressions</a><a id="see_iddle1941" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1941" class="calibre4">characters classes</a><a id="see_iddle1942" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1942" class="calibre4">compiling</a><a id="see_iddle1943" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1943" class="calibre4">end of string</a><a id="see_iddle1944" class="calibre4"></a><br class="calibre13">  examples using<br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1944" class="calibre4">matching newlines</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1945" class="calibre4">matching unicode characters</a><a id="see_iddle1946" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_030.html#iddle1946" class="calibre4">exercise answers</a><a id="see_iddle1947" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1947" class="calibre4">overview</a><a id="see_iddle1948" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1948" class="calibre4">replacing using functions</a><a id="see_iddle1949" class="calibre4"></a><br class="calibre13">  solving common problems with<br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1949" class="calibre4">matching escaped characters</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1950" class="calibre4">matching newlines</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1951" class="calibre4">matching Unicode</a><a id="see_iddle1952" class="calibre4"></a><br class="calibre13">  terms and operators<br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1952" class="calibre4">alternation (or)</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1953" class="calibre4">backreferences</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1954" class="calibre4">begins and ends</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1955" class="calibre4">escaping</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1956" class="calibre4">exact matching</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1957" class="calibre4">grouping</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1958" class="calibre4">matching from class of characters</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1959" class="calibre4">predefined character classes</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_022.html#iddle1960" class="calibre4">repeated occurrences</a>
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               <a id="see_iddle1961" class="calibre4"></a><br class="calibre13"><a href="kindle_split_030.html#iddle1961" class="calibre4">RegularExpression constructor</a>
               <a id="see_iddle1962" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1962" class="calibre4">reject function</a><a id="see_iddle1963" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1963" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1964" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1964" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1965" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1965" class="calibre4">rejecting promises</a>
               <a id="see_iddle1966" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1966" class="calibre4">removeChild operation</a>
               <a id="see_iddle1967" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1967" class="calibre4">repeated occurrences, regular expressions and</a>
               <a id="see_iddle1968" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle1968" class="calibre4">replace() method</a><a id="see_iddle1969" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1969" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1970" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle1970" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1971" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle1971" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle1972" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle1972" class="calibre4">representative object</a>
               <a id="see_iddle1973" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1973" class="calibre4">require function</a>
               <a id="see_iddle1974" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle1974" class="calibre4">RequireJS</a>
               <a id="see_iddle1975" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle1975" class="calibre4">resolve function</a><a id="see_iddle1976" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1976" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1977" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1977" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1978" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle1978" class="calibre4">Responsive Design mode</a>
               <a id="see_iddle1979" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1979" class="calibre4">rest parameters (function)</a>
               <a id="see_iddle1980" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle1980" class="calibre4">return statement</a><a id="see_iddle1981" class="calibre4"></a>,&nbsp;<a href="kindle_split_014.html#iddle1981" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1982" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1982" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle1983" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1983" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1984" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle1984" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle1985" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle1985" class="calibre4">6<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               
               <a id="see_iddle1986" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle1986" class="calibre4">return values, constructors</a>
               <a id="see_iddle1987" class="calibre4"></a><br class="calibre13"><a href="kindle_split_030.html#iddle1987" class="calibre4">runtime, building page at</a>
               </small></kbd></p>
      <h4 id="MainIndexS" class="calibre26">S</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle1988" class="calibre4"></a><a href="kindle_split_011.html#iddle1988" class="calibre4">scopes</a><a id="see_iddle1989" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle1989" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1990" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle1990" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1991" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle1991" class="calibre4">script element</a><a id="see_iddle1992" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle1992" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle1993" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle1993" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle1994" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1994" class="calibre4">scroll property</a>
               <a id="see_iddle1995" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1995" class="calibre4">scrollBy property</a>
               <a id="see_iddle1996" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1996" class="calibre4">scrollByLines property</a>
               <a id="see_iddle1997" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1997" class="calibre4">scrollByPages property</a>
               <a id="see_iddle1998" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1998" class="calibre4">scrollHeight property</a>
               <a id="see_iddle1999" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle1999" class="calibre4">scrollIntoView property</a>
               <a id="see_iddle2000" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2000" class="calibre4">scrollLeft property</a><a id="see_iddle2001" class="calibre4"></a>,&nbsp;<a href="kindle_split_027.html#iddle2001" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle2002" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2002" class="calibre4">scrollTo property</a>
               <a id="see_iddle2003" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2003" class="calibre4">scrollTop property</a><a id="see_iddle2004" class="calibre4"></a>,&nbsp;<a href="kindle_split_027.html#iddle2004" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle2005" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2005" class="calibre4">scrollWidth property</a>
               <a id="see_iddle2006" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2006" class="calibre4">scrollY property</a>
               <a id="see_iddle2007" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle2007" class="calibre4">searching arrays</a>
               <a id="see_iddle2008" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2008" class="calibre4">&lt;select&gt; element</a>
               <a id="see_iddle2009" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle2009" class="calibre4">self-memoizing functions</a>
               <a id="see_iddle2010" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle2010" class="calibre4">server-side applications</a>
               <a id="see_iddle2011" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle2011" class="calibre4">set keyword</a>
               <a id="see_iddle2012" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle2012" class="calibre4">set operator</a>
               <a id="see_iddle2013" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle2013" class="calibre4">set trap</a><a id="see_iddle2014" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle2014" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2015" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle2015" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle2016" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle2016" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle2017" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2017" class="calibre4">setAttribute() method</a>
               <a id="see_iddle2018" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle2018" class="calibre4">setInterval method</a><a id="see_iddle2019" class="calibre4"></a>,&nbsp;<a href="kindle_split_016.html#iddle2019" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2020" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle2020" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle2021" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle2021" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle2022" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle2022" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle2023" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle2023" class="calibre4">6<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle2024" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle2024" class="calibre4">7<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               
               
               <a id="see_iddle2025" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle2025" class="calibre4">setPrototypeOf</a>
               <a id="see_iddle2026" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle2026" class="calibre4">sets</a><a id="see_iddle2027" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle2027" class="calibre4">creating</a><a id="see_iddle2028" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle2028" class="calibre4">difference of</a><a id="see_iddle2029" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle2029" class="calibre4">intersection of</a><a id="see_iddle2030" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle2030" class="calibre4">overview</a><a id="see_iddle2031" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle2031" class="calibre4">union of</a>
               
               
               
               
               
               <a id="see_iddle2032" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle2032" class="calibre4">setter function</a>
               <a id="see_iddle2033" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle2033" class="calibre4">setTimeout method</a><a id="see_iddle2034" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle2034" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2035" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle2035" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle2036" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle2036" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle2037" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle2037" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               <a id="see_iddle2038" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle2038" class="calibre4">shift method</a><a id="see_iddle2039" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle2039" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle2040" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle2040" class="calibre4">siblings</a>
               <a id="see_iddle2041" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle2041" class="calibre4">simple elements</a>
               <a id="see_iddle2042" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle2042" class="calibre4">simulating class-based inheritance</a>
               <a id="see_iddle2043" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle2043" class="calibre4">single-threaded execution model</a>
               <a id="see_iddle2044" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle2044" class="calibre4">size property</a><a id="see_iddle2045" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle2045" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle2046" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle2046" class="calibre4">slicing arguments</a>
               <a id="see_iddle2047" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle2047" class="calibre4">sort method</a><a id="see_iddle2048" class="calibre4"></a>,&nbsp;<a href="kindle_split_014.html#iddle2048" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2049" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle2049" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle2050" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle2050" class="calibre4">sorting arrays</a><a id="see_iddle2051" class="calibre4"></a>,&nbsp;<a href="kindle_split_021.html#iddle2051" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle2052" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle2052" class="calibre4">&lt;span&gt; element</a>
               <a id="see_iddle2053" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle2053" class="calibre4">splice method</a>
               <a id="see_iddle2054" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle2054" class="calibre4">square brackets</a>
               <a id="see_iddle2055" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle2055" class="calibre4">stack</a>
               <a id="see_iddle2056" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle2056" class="calibre4">stepping into function</a>
               <a id="see_iddle2057" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle2057" class="calibre4">store variable</a>
               <a id="see_iddle2058" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle2058" class="calibre4">storing functions</a>
               <a id="see_iddle2059" class="calibre4"></a><br class="calibre13"><a href="kindle_split_015.html#iddle2059" class="calibre4">strict mode</a>
               <a id="see_iddle2060" class="calibre4"></a><br class="calibre13"><a href="kindle_split_028.html#iddle2060" class="calibre4">string interpolation</a>
               <a id="see_iddle2061" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle2061" class="calibre4">String object</a><a id="see_iddle2062" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle2062" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2063" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle2063" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle2064" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2064" class="calibre4">style attribute</a><a id="see_iddle2065" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle2065" class="calibre4">and computed styles</a><a id="see_iddle2066" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle2066" class="calibre4">conversion of pixel values</a><a id="see_iddle2067" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle2067" class="calibre4">getting properties from</a><a id="see_iddle2068" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle2068" class="calibre4">overview</a>
               
               
               
               
               <a id="see_iddle2069" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2069" class="calibre4">&lt;style&gt; element</a>
               <a id="see_iddle2070" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2070" class="calibre4">style property</a><a id="see_iddle2071" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle2071" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2072" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle2072" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle2073" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2073" class="calibre4">style() method</a>
               <a id="see_iddle2074" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2074" class="calibre4">styling attributes, DOM</a><a id="see_iddle2075" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle2075" class="calibre4">computed styles</a><a id="see_iddle2076" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle2076" class="calibre4">converting pixel values</a><a id="see_iddle2077" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle2077" class="calibre4">height and width properties</a><a id="see_iddle2078" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle2078" class="calibre4">naming</a><a id="see_iddle2079" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_025.html#iddle2079" class="calibre4">overview</a>
               
               
               
               
               
               <a id="see_iddle2080" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2080" class="calibre4">success callback</a>
               <a id="see_iddle2081" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle2081" class="calibre4">super keyword</a>
               <a id="see_iddle2082" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle2082" class="calibre4">SuperClass method</a>
               <a id="see_iddle2083" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2083" class="calibre4">Suspended start state</a>
               <a id="see_iddle2084" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2084" class="calibre4">Suspended yield state</a>
               </small></kbd></p>
      <h4 id="MainIndexT" class="calibre26">T</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle2085" class="calibre4"></a><a href="kindle_split_020.html#iddle2085" class="calibre4">target object</a><a id="see_iddle2086" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle2086" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2087" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle2087" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle2088" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle2088" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle2089" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle2089" class="calibre4">target property</a><a id="see_iddle2090" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle2090" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2091" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle2091" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle2092" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2092" class="calibre4">&lt;tbody&gt; element</a>
               <a id="see_iddle2093" class="calibre4"></a><br class="calibre13"><a href="kindle_split_028.html#iddle2093" class="calibre4">template literals</a>
               <a id="see_iddle2094" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle2094" class="calibre4">test cases</a>
               <a id="see_iddle2095" class="calibre4"></a><br class="calibre13"><a href="kindle_split_030.html#iddle2095" class="calibre4">test function</a>
               <a id="see_iddle2096" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle2096" class="calibre4">test independence</a>
               <a id="see_iddle2097" class="calibre4"></a><br class="calibre13"><a href="kindle_split_023.html#iddle2097" class="calibre4">test module</a>
               <a id="see_iddle2098" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle2098" class="calibre4">test repeatability</a>
               <a id="see_iddle2099" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle2099" class="calibre4">test simplicity</a>
               <a id="see_iddle2100" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle2100" class="calibre4">test suites</a>
               <a id="see_iddle2101" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle2101" class="calibre4">test() method</a>
               <br class="calibre13"><br class="calibre13">testing<a id="see_iddle2102" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_021.html#iddle2102" class="calibre4">array items</a><a id="see_iddle2103" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle2103" class="calibre4">overview</a>
               
               <a id="see_iddle2104" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle2104" class="calibre4">testing code</a><a id="see_iddle2105" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle2105" class="calibre4">assertion method</a><a id="see_iddle2106" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle2106" class="calibre4">creating tests</a><a id="see_iddle2107" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle2107" class="calibre4">fundamentals of</a><a id="see_iddle2108" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle2108" class="calibre4">Jasmine</a><a id="see_iddle2109" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle2109" class="calibre4">measuring code coverage</a><a id="see_iddle2110" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle2110" class="calibre4">QUnit</a>
               
               
               
               
               
               
               <a id="see_iddle2111" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle2111" class="calibre4">textarea element</a>
               <a id="see_iddle2112" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2112" class="calibre4">then method</a><a id="see_iddle2113" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2113" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2114" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2114" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle2115" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2115" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle2116" class="calibre4"></a>,&nbsp;<a href="kindle_split_026.html#iddle2116" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               <a id="see_iddle2117" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2117" class="calibre4">throw method</a><a id="see_iddle2118" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2118" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle2119" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2119" class="calibre4">throwing exceptions</a>
               <a id="see_iddle2120" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle2120" class="calibre4">time method</a>
               <a id="see_iddle2121" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle2121" class="calibre4">time-outs, event loop</a>
               <a id="see_iddle2122" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle2122" class="calibre4">timeEnd method</a>
               <a id="see_iddle2123" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle2123" class="calibre4">timer events</a>
               <a id="see_iddle2124" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle2124" class="calibre4">timer variable</a>
               <a id="see_iddle2125" class="calibre4"></a><br class="calibre13"><a href="kindle_split_026.html#iddle2125" class="calibre4">timers, event loop</a><a id="see_iddle2126" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle2126" class="calibre4">computationally expensive processing</a><a id="see_iddle2127" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_026.html#iddle2127" class="calibre4">overview</a>
               
               
               <a id="see_iddle2128" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle2128" class="calibre4">toString method</a>
               <a id="see_iddle2129" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle2129" class="calibre4">Traceur</a>
               <a id="see_iddle2130" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle2130" class="calibre4">transform property</a>
               <a id="see_iddle2131" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle2131" class="calibre4">transpilers</a>
               <a id="see_iddle2132" class="calibre4"></a><br class="calibre13"><a href="kindle_split_020.html#iddle2132" class="calibre4">traps</a>
               <a id="see_iddle2133" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2133" class="calibre4">traversing DOM, using generators</a>
               <a id="see_iddle2134" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2134" class="calibre4">try-catch block</a>
               <a id="see_iddle2135" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle2135" class="calibre4">try-catch statements</a><a id="see_iddle2136" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2136" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2137" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2137" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle2138" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2138" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle2139" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2139" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle2140" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2140" class="calibre4">6<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               
               <a id="see_iddle2141" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle2141" class="calibre4">type attribute</a><a id="see_iddle2142" class="calibre4"></a>,&nbsp;<a href="kindle_split_027.html#iddle2142" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle2143" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle2143" class="calibre4">typeof operator</a><a id="see_iddle2144" class="calibre4"></a>,&nbsp;<a href="kindle_split_019.html#iddle2144" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2145" class="calibre4"></a>,&nbsp;<a href="kindle_split_020.html#iddle2145" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               </small></kbd></p>
      <h4 id="MainIndexU" class="calibre26">U</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle2146" class="calibre4"></a><a href="kindle_split_022.html#iddle2146" class="calibre4">u flag</a>
               <a id="see_iddle2147" class="calibre4"></a><br class="calibre13"><a href="kindle_split_029.html#iddle2147" class="calibre4">UI Responsiveness</a>
               <a id="see_iddle2148" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle2148" class="calibre4">ul element</a>
               <a id="see_iddle2149" class="calibre4"></a><br class="calibre13"><a href="kindle_split_014.html#iddle2149" class="calibre4">undefined string</a>
               <a id="see_iddle2150" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle2150" class="calibre4">Unicode, matching</a>
               <a id="see_iddle2151" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle2151" class="calibre4">union, of sets</a>
               <a id="see_iddle2152" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2152" class="calibre4">unresolved promise</a>
               <a id="see_iddle2153" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle2153" class="calibre4">unshift method</a>
               <a id="see_iddle2154" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle2154" class="calibre4">untestable browser issues</a><a id="see_iddle2155" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle2155" class="calibre4">API performance</a><a id="see_iddle2156" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle2156" class="calibre4">browser crashes</a><a id="see_iddle2157" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle2157" class="calibre4">CSS property effects</a><a id="see_iddle2158" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle2158" class="calibre4">event firing</a><a id="see_iddle2159" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle2159" class="calibre4">event handler bindings</a><a id="see_iddle2160" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_027.html#iddle2160" class="calibre4">incongruous APIs</a>
               
               
               
               
               
               
               <a id="see_iddle2161" class="calibre4"></a><br class="calibre13"><a href="kindle_split_027.html#iddle2161" class="calibre4">untestable features</a>
               <a id="see_iddle2162" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle2162" class="calibre4">user events</a>
               </small></kbd></p>
      <h4 id="MainIndexV" class="calibre26">V</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle2163" class="calibre4"></a><a href="kindle_split_025.html#iddle2163" class="calibre4">value argument</a>
               <a id="see_iddle2164" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle2164" class="calibre4">value key</a>
               <a id="see_iddle2165" class="calibre4"></a><br class="calibre13"><a href="kindle_split_021.html#iddle2165" class="calibre4">values method</a>
               <a id="see_iddle2166" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2166" class="calibre4">values, sending into generator</a>
               <a id="see_iddle2167" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle2167" class="calibre4">var keyword, variables</a>
               <a id="see_iddle2168" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle2168" class="calibre4">variable hoisting</a>
               <a id="see_iddle2169" class="calibre4"></a><br class="calibre13"><a href="kindle_split_016.html#iddle2169" class="calibre4">variables</a><a id="see_iddle2170" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle2170" class="calibre4">const variables</a><a id="see_iddle2171" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle2171" class="calibre4">overview</a><a id="see_iddle2172" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle2172" class="calibre4">registering identifiers within lexical environments</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_016.html#iddle2173" class="calibre4">calling functions before declarations</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_016.html#iddle2174" class="calibre4">overriding functions</a><br class="calibre13">&nbsp;&nbsp;&nbsp;&nbsp;<a href="kindle_split_016.html#iddle2175" class="calibre4">process</a><a id="see_iddle2176" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle2176" class="calibre4">using let and const keywords to specify block-scoped variables</a><a id="see_iddle2177" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle2177" class="calibre4">using var keyword</a><a id="see_iddle2178" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_016.html#iddle2178" class="calibre4">variable mutability</a>
               
               
               
               
               
               
               
               
               
               <a id="see_iddle2179" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2179" class="calibre4">visibility property</a>
               </small></kbd></p>
      <h4 id="MainIndexW" class="calibre26">W</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle2180" class="calibre4"></a><a href="kindle_split_029.html#iddle2180" class="calibre4">web developer tools</a><a id="see_iddle2181" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle2181" class="calibre4">Chrome DevTools</a><a id="see_iddle2182" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle2182" class="calibre4">F12</a><a id="see_iddle2183" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle2183" class="calibre4">Firebug</a><a id="see_iddle2184" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_029.html#iddle2184" class="calibre4">Firefox</a><a id="see_iddle2185" class="calibre4"></a><br class="calibre13">&nbsp;&nbsp;<a href="kindle_split_011.html#iddle2185" class="calibre4">WebKit Inspector</a><a id="see_iddle2186" class="calibre4"></a>,&nbsp;<a href="kindle_split_029.html#iddle2186" class="calibre4">2<sup class="calibre31">nd</sup></a>
               
               
               
               
               
               
               <a id="see_iddle2187" class="calibre4"></a><br class="calibre13"><a href="kindle_split_011.html#iddle2187" class="calibre4">WebKit Inspector</a><a id="see_iddle2188" class="calibre4"></a>,&nbsp;<a href="kindle_split_029.html#iddle2188" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a>
               
               <a id="see_iddle2189" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2189" class="calibre4">while loop</a><a id="see_iddle2190" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2190" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2191" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2191" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle2192" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle2192" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               <a id="see_iddle2193" class="calibre4"></a><br class="calibre13"><a href="kindle_split_022.html#iddle2193" class="calibre4">whitespace character</a><a id="see_iddle2194" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle2194" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2195" class="calibre4"></a>,&nbsp;<a href="kindle_split_022.html#iddle2195" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle2196" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2196" class="calibre4">width property</a><a id="see_iddle2197" class="calibre4"></a>,&nbsp;<a href="kindle_split_025.html#iddle2197" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2198" class="calibre4"></a>,&nbsp;<a href="kindle_split_027.html#iddle2198" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle2199" class="calibre4"></a><br class="calibre13"><a href="kindle_split_012.html#iddle2199" class="calibre4">window object</a><a id="see_iddle2200" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle2200" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2201" class="calibre4"></a>,&nbsp;<a href="kindle_split_012.html#iddle2201" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle2202" class="calibre4"></a>,&nbsp;<a href="kindle_split_015.html#iddle2202" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle2203" class="calibre4"></a>,&nbsp;<a href="kindle_split_030.html#iddle2203" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               <a id="see_iddle2204" class="calibre4"></a><br class="calibre13"><a href="kindle_split_025.html#iddle2204" class="calibre4">window.getComputedStyle() method</a>
               <a id="see_iddle2205" class="calibre4"></a><br class="calibre13"><a href="kindle_split_019.html#iddle2205" class="calibre4">writable key</a>
               </small></kbd></p>
      <h4 id="MainIndexX" class="calibre26">X</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle2206" class="calibre4"></a><a href="kindle_split_017.html#iddle2206" class="calibre4">XMLHttpRequest object</a>
               </small></kbd></p>
      <h4 id="MainIndexY" class="calibre26">Y</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle2207" class="calibre4"></a><a href="kindle_split_022.html#iddle2207" class="calibre4">y flag</a>
               <a id="see_iddle2208" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2208" class="calibre4">yield expression</a><a id="see_iddle2209" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2209" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2210" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2210" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a><a id="see_iddle2211" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2211" class="calibre4">4<sup class="calibre31"><small class="calibre32">th</small></sup></a><a id="see_iddle2212" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2212" class="calibre4">5<sup class="calibre31"><small class="calibre32">th</small></sup></a>
               
               
               
               
               <a id="see_iddle2213" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2213" class="calibre4">yield keyword</a><a id="see_iddle2214" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2214" class="calibre4">2<sup class="calibre31"><small class="calibre32">nd</small></sup></a><a id="see_iddle2215" class="calibre4"></a>,&nbsp;<a href="kindle_split_017.html#iddle2215" class="calibre4">3<sup class="calibre31"><small class="calibre32">rd</small></sup></a>
               
               
               <a id="see_iddle2216" class="calibre4"></a><br class="calibre13"><a href="kindle_split_017.html#iddle2216" class="calibre4">yield* operator</a>
               </small></kbd></p>
      <h4 id="MainIndexZ" class="calibre26">Z</h4>
      <p class="calibre18"><kbd class="calibre15"><small class="calibre23"><a id="see_iddle2217" class="calibre4"></a><a href="kindle_split_027.html#iddle2217" class="calibre4">zero-fill right-shift operator</a>
               </small></kbd></p>
      <h2 id="lof" class="part">List of Figures</h2>
      <p class="noind">Chapter 1. JavaScript is everywhere</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_011.html#ch01fig01" class="calibre4">Figure 1.1. Client-side web applications rely on the infrastructure provided by the browser. We’ll particularly focus on the
               DOM, events, timers, and browser APIs.</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Chapter 2. Building the page at runtime</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_012.html#ch02fig01" class="calibre4">Figure 2.1. The lifecycle of a client-side web application starts with the user specifying a website address (or clicking
               a link) and ends when the user leaves the web page. It’s composed of two steps: page building and event handling.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_012.html#ch02fig02" class="calibre4">Figure 2.2. When the code from listing 2.1 runs, messages are logged depending on user actions.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_012.html#ch02fig03" class="calibre4">Figure 2.3. The page-building phase starts when the browser receives the code of the page. It’s performed in two steps: parsing
               the HTML and building the DOM, and executing JavaScript code.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_012.html#ch02fig04" class="calibre4">Figure 2.4. By the time the browser encounters the first script element, it has already created a DOM with multiple HTML elements
               (the nodes on the right).</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_012.html#ch02fig05" class="calibre4">Figure 2.5. An example of invalid HTML that is fixed by the browser</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_012.html#ch02fig06" class="calibre4">Figure 2.6. Program execution flow when executing JavaScript code</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_012.html#ch02fig07" class="calibre4">Figure 2.7. The DOM of the page after executing the JavaScript code contained in the script element</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_012.html#ch02fig08" class="calibre4">Figure 2.8. In the event-handling phase, all events (whether coming from the user, such as mouse clicks and key presses, or
               coming from the server, such as Ajax events) are queued up as they occur and are processed as the single thread of execution
               allows.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_012.html#ch02fig09" class="calibre4">Figure 2.9. Example of an event-handling phase in which two events—mousemove and click—are handled</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_012.html#ch02fig10" class="calibre4">Figure 2.10. The DOM of the example application after handling the mousemove and click events</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Chapter 3. First-class functions for the novice: definitions and arguments</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_014.html#ch03fig01" class="calibre4">Figure 3.1. The result of running the code from listing 3.1</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_014.html#ch03fig02" class="calibre4">Figure 3.2. The flow of execution when making the useless(getText) call. The useless function is called with getText as an
               argument. In the body of the useless function is a call to the passed-in function, which in this case triggers the execution
               of the getText function (we’ve “called back” to the getText function).</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_014.html#ch03fig03" class="calibre4">Figure 3.3. By tacking a property onto a function, we can keep track of it. In that way, we can be sure that our function
               has been added only once.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_014.html#ch03fig04" class="calibre4">Figure 3.4. The function declaration stands on its own, as a separate block of JavaScript code! (It can be contained within
               other functions.)</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_014.html#ch03fig05" class="calibre4">Figure 3.5. A comparison of a standard function call and an immediate call to a function expression</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_014.html#ch03fig06" class="calibre4">Figure 3.6. The syntax of an arrow function</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_014.html#ch03fig07" class="calibre4">Figure 3.7. The difference between function parameters and function arguments</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_014.html#ch03fig08" class="calibre4">Figure 3.8. Arguments are assigned to function parameters in the order specified. Excess arguments aren’t assigned to any
               parameters.</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Chapter 4. Functions for the journeyman: understanding function invocation</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_015.html#ch04fig01" class="calibre4">Figure 4.1. When calling a function with a keyword new, a new empty object is created and set as the context of the constructor
               function, the this parameter.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_015.html#ch04fig02" class="calibre4">Figure 4.2. Why did our test fail? Where did the change of state go? Usually, the event callback’s context is the object raising
               the event (in this case, the HTML button, and not the button object).</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_015.html#ch04fig03" class="calibre4">Figure 4.3. As the first argument, both the call and apply methods take the object that will be used as the function context.
               The difference is in the following arguments. apply takes only one additional argument, an array of argument values; call
               takes any number of arguments, which will be used as function arguments.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_015.html#ch04fig04" class="calibre4">Figure 4.4. Manually setting a function context by using built-in call and apply from listing 4.11 results in these combinations
               of function contexts (the this parameter) and arguments.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_015.html#ch04fig05" class="calibre4">Figure 4.5. The test results show that we have the ability to make any object we please the function context of a callback
               invocation.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_015.html#ch04fig06" class="calibre4">Figure 4.6. Arrow functions don’t have their own context. Instead, the context is inherited from the function in which they’re
               defined. The this parameter in our arrow function callback refers to the button object.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_015.html#ch04fig07" class="calibre4">Figure 4.7. If an arrow function is defined within an object literal that’s defined in global code, the value of the this
               parameter associated with the arrow function is the global window object.</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Chapter 5. Functions for the master: closures and scopes</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_016.html#ch05fig01" class="calibre4">Figure 5.1. Our function has found the ninja, who was hiding in plain sight.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig02" class="calibre4">Figure 5.2. Despite trying to hide inside a function, the ninja has been detected!</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig03" class="calibre4">Figure 5.3. Like a protective bubble, the closure for innerFunction keeps the variables in the function’s scope alive for
               as long as the function exists.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig04" class="calibre4">Figure 5.4. Hiding the variable inside the constructor keeps it invisible to the outer scope, but where it counts, the variable
               is alive and well, protected by the closure.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig05" class="calibre4">Figure 5.5. By keeping the variables for multiple instances of the function separate, we can do many things at once.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig06" class="calibre4">Figure 5.6. The behavior of the execution context stack</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig07" class="calibre4">Figure 5.7. The current state of the execution context stack in Chrome DevTools</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig08" class="calibre4">Figure 5.8. Types of code nesting</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig09" class="calibre4">Figure 5.9. How JavaScript engines resolve the values of variables</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig10" class="calibre4">Figure 5.10. Checking the behavior of const variables. An exception occurs when we try to assign a completely new value to
               a const variable.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig11" class="calibre4">Figure 5.11. When defining variables with the keyword var, a variable is defined in the closest function or global environment
               (while ignoring block environments). In our case, the variables forMessage and i are registered in the reportActivity environment
               (the closest functional environment), even though they’re contained within a for loop.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig12" class="calibre4">Figure 5.12. When defining variables with keywords let and const, a variable is defined in the closest environment. In our
               case, variables forMessage and i are registered in the for block environment, the variable functionActivity in the reportActivity
               environment, and the GLOBAL_NINJA variable in the global environment (in every case, the closest environment to the respective
               variable).</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig13" class="calibre4">Figure 5.13. The function is indeed visible, even before the execution reaches its definition.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig14" class="calibre4">Figure 5.14. The process of registering identifiers, depending on the type of environment</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig15" class="calibre4">Figure 5.15. Private variables are realized as closures that are created by object methods defined in the constructor.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig16" class="calibre4">Figure 5.16. The methods of each instance create closures around the “private” instance variables.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig17" class="calibre4">Figure 5.17. The state of execution contexts and lexical environments when performing the ninja2.getFeints() call. A new getFeints
               environment is created that has the environment of the constructor function in which ninja2 was created as its outer environment.
               getFeints can access the “private” feints variable.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig18" class="calibre4">Figure 5.18. We can access the “private” variables through functions, even if that function is attached to another object!</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_016.html#ch05fig19" class="calibre4">Figure 5.19. By creating multiple closures, we can do many things at once. Every time an interval expires, the callback function
               reactivates the environment that was active at the time of callback creation. The closure of each callback automatically keeps
               track of its own set of variables.</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Chapter 6. Functions for the future: generators and promises</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_017.html#ch06fig01" class="calibre4">Figure 6.1. Add an asterisk (*) after the function keyword to define a generator.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_017.html#ch06fig02" class="calibre4">Figure 6.2. The result of iterating over our WeaponGenerator()</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_017.html#ch06fig03" class="calibre4">Figure 6.3. The first call to ninjaIterator.next() requests a new value from the generator, which returns Hattori skulk and
               suspends the execution of the generator at the yield expression. The second call to ninjaIterator.next("Hanzo") requests a
               new value, but also sends the argument Hanzo into the generator. This value will be used as the value of the whole yield expression,
               and the variable imposter will now carry the value Hanzo.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_017.html#ch06fig04" class="calibre4">Figure 6.4. We can throw exceptions to generators from outside a generator.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_017.html#ch06fig05" class="calibre4">Figure 6.5. During execution, a generator moves between states triggered by calls to the matching iterator’s next method.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_017.html#ch06fig06" class="calibre4">Figure 6.6. The state of the execution context stack before calling the NinjaGenerator function , and when calling the NinjaGenerator
               function </a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_017.html#ch06fig07" class="calibre4">Figure 6.7. The state of the application when returning from the NinjaGenerator call</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_017.html#ch06fig08" class="calibre4">Figure 6.8. Calling the iterator’s next method reactivates the execution context stack item of the matching generator, pushes
               it on the stack, and continues where it left off the last time.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_017.html#ch06fig09" class="calibre4">Figure 6.9. After yielding a value, the generator’s execution context is popped from the stack (but isn’t discarded, because
               ninjaIterator keeps a reference to it), and the generator execution is suspended (the generator moves to the Suspended yield
               state).</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_017.html#ch06fig10" class="calibre4">Figure 6.10. States of a promise</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_017.html#ch06fig11" class="calibre4">Figure 6.11. The result of executing listing 6.11</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Chapter 7. Object orientation with prototypes</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_019.html#ch07fig01" class="calibre4">Figure 7.1. Initially, each object has access to only its own properties.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig02" class="calibre4">Figure 7.2. When we access a property that the object doesn’t have, the object’s prototype is searched for that property.
               Here, we can access hattori’s sneak property through yoshi, because yoshi is hattori’s prototype.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig03" class="calibre4">Figure 7.3. The search for a particular property stops when there are no more prototypes to explore. Accessing yoshi.creep
               triggers the search first in yoshi, then in hattori, and finally in kuma.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig04" class="calibre4">Figure 7.4. Every function, when created, gets a new prototype object. When we use a function as a constructor, the constructed
               object’s prototype is set to the function’s prototype.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig05" class="calibre4">Figure 7.5. If a property can be found on the instance itself, the prototype isn’t even consulted!</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig06" class="calibre4">Figure 7.6. Every instance gets its own version of the properties created within the constructor, but they all have access
               to the same prototype’s properties.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig07" class="calibre4">Figure 7.7. After construction, ninja1 has the property swung, and its prototype is the Ninja prototype that has only a constructor
               property.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig08" class="calibre4">Figure 7.8. Because the ninja1 instance references the Ninja prototype, even changes made after the instance was constructed
               are accessible.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig09" class="calibre4">Figure 7.9. The function’s prototype can be replaced at will. The already constructed instances reference the old prototype!</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig10" class="calibre4">Figure 7.10. All newly created instances reference the new prototype.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig11" class="calibre4">Figure 7.11. The prototype object of each function has a constructor property that references the function.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig12" class="calibre4">Figure 7.12. Our Ninja isn’t really a Person. No happy dance!</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig13" class="calibre4">Figure 7.13. Our Ninja is a Person! Let the victory dance begin.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig14" class="calibre4">Figure 7.14. We’ve achieved inheritance by setting the prototype of the Ninja constructor to a new instance of a Person object.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig15" class="calibre4">Figure 7.15. Properties name and weapon will be visited in the for-in loop, whereas our specially added sneaky property won’t
               (even though we can access it normally).</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig16" class="calibre4">Figure 7.16. The prototype chain of a ninja instance is composed of a new Person() object and the Person prototype.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_019.html#ch07fig17" class="calibre4">Figure 7.17. The instanceof operator checks whether the prototype of the function on the right is in the prototype chain of
               the object on the left. Be careful; the function’s prototype can be changed anytime!</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Chapter 8. Controlling access to objects</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_020.html#ch08fig01" class="calibre4">Figure 8.1. The syntax for defining getters and setters. Prefix the property name with either the get or the set keyword.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_020.html#ch08fig02" class="calibre4">Figure 8.2. The output from listing 8.2: if a property has a getter and a setter method, the getter method is implicitly called
               whenever we read the property value, and the setter method is called whenever we assign a new value to the property.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_020.html#ch08fig03" class="calibre4">Figure 8.3. Accessing a property with a getter method implicitly calls the matching getter. The process is the same as if
               this were a standard method call, and the getter method gets executed. A similar thing happens when we assign a value to a
               property through a setter method.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_020.html#ch08fig04" class="calibre4">Figure 8.4. Accessing the name property directly (on the left) and indirectly, through a proxy (on the right)</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_020.html#ch08fig05" class="calibre4">Figure 8.5. The output of running the code from listing 8.11</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Chapter 9. Dealing with collections</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_021.html#ch09fig01" class="calibre4">Figure 9.1. Writing to an array index outside of array bounds expands the array.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig02" class="calibre4">Figure 9.2. The push and pop methods modify the end of an array, whereas shift and unshift modify the array’s beginning.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig03" class="calibre4">Figure 9.3. Deleting an item from an array creates a hole in the array.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig04" class="calibre4">Figure 9.4. The output of checking the ninjas with a for loop</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig05" class="calibre4">Figure 9.5. The map function calls the provided callback function (fc) on each array item, and creates a new array with callback
               return values.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig06" class="calibre4">Figure 9.6. The every method tests whether all items in an array satisfy a certain condition represented by a callback.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig07" class="calibre4">Figure 9.7. The some method checks whether at least one array item satisfies a condition represented by the passed-in callback.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig08" class="calibre4">Figure 9.8. The find function finds one item in an array: the first item for which the find callback returns true.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig09" class="calibre4">Figure 9.9. The filter function creates a new array that contains all items for which the callback returns true.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig10" class="calibre4">Figure 9.10. If the call-back returns a value less than 0, the first item should come before the second. If the callback returns
               0, both items should be left as is. And if the return value is greater than 0, the first item should come after the second
               item.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig11" class="calibre4">Figure 9.11. The reduce function applies a callback to an aggregated value and each item in an array to reduce the array to
               a single value.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig12" class="calibre4">Figure 9.12. Running listing 9.14 shows that objects aren’t good maps, because they have access to properties that weren’t
               explicitly defined (through their prototypes).</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig13" class="calibre4">Figure 9.13. Running the code from listing 9.15 shows that objects are converted to strings if we try to use them as object
               properties.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig14" class="calibre4">Figure 9.14. A map is a collection of key-value pairs, where a key can be anything—even another object.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig15" class="calibre4">Figure 9.15. If we run the code from listing 9.17, we can see that key equality in maps is based on object equality.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig16" class="calibre4">Figure 9.16. Running the code from listing 9.20 shows that the items in a set are iterated over in the order in which they
               were inserted.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_021.html#ch09fig17" class="calibre4">Figure 9.17. A union of two sets keeps the items from both collections (without duplicates).</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Chapter 11. Code modularization techniques</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_023.html#ch11fig01" class="calibre4">Figure 11.1. The click event handler, through closures, keeps alive the local numClicks variable.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_023.html#ch11fig02" class="calibre4">Figure 11.2. Expose the public interface of a module through a returned object. The internal module implementation (“private”
               variables and functions) is kept alive through closures created by public interface methods.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_023.html#ch11fig03" class="calibre4">Figure 11.3. When augmenting a module, we extend its external interface with new functionality, usually by passing the module
               to another immediate function. In this example, we add the ability to countScrolls to our MouseCounterModule. Notice that
               two separate functions are defined in different environments, and they can’t access each other’s internal variables.</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Chapter 12. Working the DOM</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_025.html#ch12fig01" class="calibre4">Figure 12.1. By running this test, we can see that inline and assigned styles are recorded, but inherited styles aren’t.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_025.html#ch12fig02" class="calibre4">Figure 12.2. The final style associated with an element can come from many things: the browser builtin styles (user agent
               style sheet), the styles assigned through the style property, and styles from the CSS rules defined in CSS code.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_025.html#ch12fig03" class="calibre4">Figure 12.3. Computed styles include all styles specified with the element as well as those inherited from style sheets.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_025.html#ch12fig04" class="calibre4">Figure 12.4. We’ll use two images—one visible, one hidden—for testing the fetching of dimensions of hidden elements.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_025.html#ch12fig05" class="calibre4">Figure 12.5. By temporarily adjusting the style properties of hidden elements, we can successfully fetch their dimensions.</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Chapter 13. Surviving events</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_026.html#ch13fig01" class="calibre4">Figure 13.1. The event loop usually has access to at least two task queues: a microtask queue and a macrotask queue. Both
               types of tasks are handled one at a time.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig02" class="calibre4">Figure 13.2. This timing diagram shows how events are added to the task queue as they occur. When a task is done executing,
               the event loop takes it off the queue, and continues by executing the next task.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig03" class="calibre4">Figure 13.3. 12 ms into the application execution, the task queue has three tasks: one for evaluating mainline JavaScript
               code (the currently executing task), and one for each button-click event.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig04" class="calibre4">Figure 13.4. The task queue 15 ms into application execution contains two tasks for click events. The first task is currently
               being executed.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig05" class="calibre4">Figure 13.5. 23 ms after the application starts executing, only one task, handling the secondButton click event, remains to
               be executed.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig06" class="calibre4">Figure 13.6. If a microtask is queued in the microtask queue, it gets priority and is processed even if an older task is already
               waiting in the queue. In this case, the promise success microtask gets priority over the secondButton click event task.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig07" class="calibre4">Figure 13.7. During the execution of the first click handler, a resolved promise is created. This queues up a promise success
               microtask in the microtask queue that will be executed as soon as possible, but without interrupting the currently running
               task.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig08" class="calibre4">Figure 13.8. After a task gets executed, the event loop processes all tasks in the microtask queue. In this case, before moving
               to the secondButton click task, the promise success task is handled.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig09" class="calibre4">Figure 13.9. A page can be re-rendered between two macrotasks (mainline JavaScript execution and first click handler), while
               it can’t be rendered before a microtask is executed (before the promise handler).</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig10" class="calibre4">Figure 13.10. A timing diagram that shows 18 ms of execution in the example program. The first, currently running task is
               to evaluate mainline JavaScript code. It takes 18 ms to execute. During that execution, three events occur: a mouse click,
               a timer expiry, and an interval firing.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig11" class="calibre4">Figure 13.11. Timer events are placed into the task queue as they expire.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig12" class="calibre4">Figure 13.12. If an interval event fires, and a task is already associated with that interval waiting in the queue, a new
               task isn’t added. Instead, nothing happens, as is shown for the queues at 20 ms and 30 ms.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig13" class="calibre4">Figure 13.13. Because of the setbacks caused by the mouse click and time-out handler, it takes some time for the interval
               handlers to start executing every 10 ms.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig14" class="calibre4">Figure 13.14. Use timers to break long-running tasks into smaller tasks that won’t clog the event loop.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig15" class="calibre4">Figure 13.15. With capturing, the event trickles down to the target element. With bubbling, the event bubbles up from the
               target element.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_026.html#ch13fig16" class="calibre4">Figure 13.16. First the event trickles down from the top, executing all event handlers in capturing mode. When the target
               element is reached, the event bubbles up to the top, executing all event handlers in bubbling mode.</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Chapter 14. Developing cross-browser strategies</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_027.html#ch14fig01" class="calibre4">Figure 14.1. Looking at the usage statistics of browsers on desktop and mobile devices gives us an idea of which browsers
               to focus our attention on.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_027.html#ch14fig02" class="calibre4">Figure 14.2. The five major points of concern for the development of reusable JavaScript</a><br class="calibre13"></p>
      </blockquote>
      <p class="noind">Appendix B. Arming with testing and debugging</p>
      <blockquote class="toc">
         <p class="ind"><a href="kindle_split_029.html#app02fig01" class="calibre4">Figure B.1. Firebug, available only in Firefox, was the first advanced debugging tool for web applications.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig02" class="calibre4">Figure B.2. Firefox developer tools, built into Firefox, offer all the Firebug features and then some.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig03" class="calibre4">Figure B.3. F12 developer tools (toggled by pressing F12) are available in Internet Explorer and Edge.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig04" class="calibre4">Figure B.4. WebKit Inspector, available in Safari</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig05" class="calibre4">Figure B.5. Chrome DevTools, available in Chrome and Opera</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig06" class="calibre4">Figure B.6. Logging lets us see the state of our code as it’s running. In this case, we can see that the value of 213 is logged
               from line 6, and the value of “Hello World” from line 9 of listing B.1. All developer tools, including Chrome DevTools shown
               here, have a Console tab for logging purposes.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig07" class="calibre4">Figure B.7. When we set a breakpoint on a line of code (by clicking the line gutter) and load the page, the browser will stop
               executing JavaScript code before that line is executed. Then you can leisurely explore the current state of the application
               in the pane on the right.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig08" class="calibre4">Figure B.8. Stepping into a function lets us see the new state in which the function is executed. We can explore the current
               position by studying the Call Stack and the current values of local variables.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig09" class="calibre4">Figure B.9. Right-click in the line-number margin to set a breakpoint as conditional; notice that these are shown in a different
               color, usually orange.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig10" class="calibre4">Figure B.10. JSFiddle enables us to test combinations of HTML, CSS, and JavaScript snippets in a sandbox to see if everything
               works as intended.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig11" class="calibre4">Figure B.11. The result of running our first test suite</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig12" class="calibre4">Figure B.12. You can use the built-in console.assert as a quick way to test code. The fail message is logged to the console
               only if an assertion fails.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig13" class="calibre4">Figure B.13. An example of a QUnit test run. As a part of our test, we have one passing and one failing assertion (one assertion
               of two passed, one failed.) The displayed results put a much bigger emphasis on the failing test, to make sure we fix it as
               soon as possible.</a><br class="calibre13"></p>
         <p class="ind"><a href="kindle_split_029.html#app02fig14" class="calibre4">Figure B.14. The result of running a Jasmine test suite in the browser. We have two tests: one passing and one failing (two
               specs, one failure).</a><br class="calibre13"></p>
      </blockquote>